/**
 * 
 *   Version: 10.4.0
 * 
 *   Git Hash: 18a110e8a09523bcccd386391747f378b0b20912
 * 
 *   Created At: 2024/8/21 19:54:23
 * 
 *   Target: NIM_BROWSER_SDK.js
 *   
 */

!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((t="undefined"!=typeof globalThis?globalThis:t||self).NIM={})}(this,(function(t){"use strict";var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var c,m,check=function(t){return t&&t.Math==Math&&t},h=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof a&&a)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},g=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),I=Function.prototype,M=I.apply,T=I.call,S="object"==typeof Reflect&&Reflect.apply||(g?T.bind(M):function(){return T.apply(M,arguments)}),E=Function.prototype,C=E.bind,b=E.call,A=g&&C.bind(b,b),N=g?function(t){return t&&A(t)}:function(t){return t&&function(){return b.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},R=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),w=Function.prototype.call,k=g?w.bind(w):function(){return w.apply(w,arguments)},O={}.propertyIsEnumerable,P=Object.getOwnPropertyDescriptor,x={f:P&&!O.call({1:2},1)?function propertyIsEnumerable(t){var a=P(this,t);return!!a&&a.enumerable}:O},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},V=N({}.toString),L=N("".slice),classofRaw=function(t){return L(V(t),8,-1)},D=Object,U=N("".split),B=fails((function(){return!D("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?U(t,""):D(t)}:D,isNullOrUndefined=function(t){return null==t},q=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw q("Can't call method on "+t);return t},toIndexedObject=function(t){return B(requireObjectCoercible(t))},G="object"==typeof document&&document.all,H=void 0===G&&void 0!==G?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===G}:function(t){return"object"==typeof t?null!==t:isCallable(t)},j={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(j[t])||aFunction(h[t]):j[t]&&j[t][a]||h[t]&&h[t][a]},Y=N({}.isPrototypeOf),$=getBuiltIn("navigator","userAgent")||"",W=h.process,z=h.Deno,K=W&&W.versions||z&&z.version,Q=K&&K.v8;Q&&(m=(c=Q.split("."))[0]>0&&c[0]<4?1:+(c[0]+c[1])),!m&&$&&(!(c=$.match(/Edge\/(\d+)/))||c[1]>=74)&&(c=$.match(/Chrome\/(\d+)/))&&(m=+c[1]);var J=m,X=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&J&&J<41})),Z=X&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ee=Object,te=Z?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&Y(a.prototype,ee(t))},re=String,tryToString=function(t){try{return re(t)}catch(t){return"Object"}},ne=TypeError,aCallable=function(t){if(isCallable(t))return t;throw ne(tryToString(t)+" is not a function")},getMethod=function(t,a){var c=t[a];return isNullOrUndefined(c)?void 0:aCallable(c)},ae=TypeError,ie=Object.defineProperty,oe="__core-js_shared__",se=h[oe]||function(t,a){try{ie(h,t,{value:a,configurable:!0,writable:!0})}catch(c){h[t]=a}return a}(oe,{}),ce=createCommonjsModule((function(t){(t.exports=function(t,a){return se[t]||(se[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),le=Object,toObject=function(t){return le(requireObjectCoercible(t))},ue=N({}.hasOwnProperty),de=Object.hasOwn||function hasOwn(t,a){return ue(toObject(t),a)},pe=0,me=Math.random(),he=N(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+he(++pe+me,36)},ge=ce("wks"),ve=h.Symbol,fe=ve&&ve.for,ye=Z?ve:ve&&ve.withoutSetter||uid,wellKnownSymbol=function(t){if(!de(ge,t)||!X&&"string"!=typeof ge[t]){var a="Symbol."+t;X&&de(ve,t)?ge[t]=ve[t]:ge[t]=Z&&fe?fe(a):ye(a)}return ge[t]},_e=TypeError,Ie=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!H(t)||te(t))return t;var c,m=getMethod(t,Ie);if(m){if(void 0===a&&(a="default"),c=k(m,t,a),!H(c)||te(c))return c;throw _e("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var c,m;if("string"===a&&isCallable(c=t.toString)&&!H(m=k(c,t)))return m;if(isCallable(c=t.valueOf)&&!H(m=k(c,t)))return m;if("string"!==a&&isCallable(c=t.toString)&&!H(m=k(c,t)))return m;throw ae("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return te(a)?a:a+""},Me=h.document,Te=H(Me)&&H(Me.createElement),documentCreateElement=function(t){return Te?Me.createElement(t):{}},Se=!R&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),Ee=Object.getOwnPropertyDescriptor,Ce={f:R?Ee:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),Se)try{return Ee(t,a)}catch(t){}if(de(t,a))return createPropertyDescriptor(!k(x.f,t,a),t[a])}},be=/#|\.prototype\./,isForced=function(t,a){var c=Ne[Ae(t)];return c==we||c!=Re&&(isCallable(a)?fails(a):!!a)},Ae=isForced.normalize=function(t){return String(t).replace(be,".").toLowerCase()},Ne=isForced.data={},Re=isForced.NATIVE="N",we=isForced.POLYFILL="P",ke=isForced,Oe=N(N.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:g?Oe(t,a):function(){return t.apply(a,arguments)}},Pe=R&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xe=String,Ve=TypeError,anObject=function(t){if(H(t))return t;throw Ve(xe(t)+" is not an object")},Le=TypeError,De=Object.defineProperty,Ue=Object.getOwnPropertyDescriptor,Fe="enumerable",Be="configurable",qe="writable",Ge={f:R?Pe?function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),"function"==typeof t&&"prototype"===a&&"value"in c&&qe in c&&!c.writable){var m=Ue(t,a);m&&m.writable&&(t[a]=c.value,c={configurable:Be in c?c.configurable:m.configurable,enumerable:Fe in c?c.enumerable:m.enumerable,writable:!1})}return De(t,a,c)}:De:function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),Se)try{return De(t,a,c)}catch(t){}if("get"in c||"set"in c)throw Le("Accessors not supported");return"value"in c&&(t[a]=c.value),t}},He=R?function(t,a,c){return Ge.f(t,a,createPropertyDescriptor(1,c))}:function(t,a,c){return t[a]=c,t},je=Ce.f,wrapConstructor=function(t){var Wrapper=function(a,c,m){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,c)}return new t(a,c,m)}return S(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var c,m,g,I,M,T,S,E,C=t.target,b=t.global,A=t.stat,R=t.proto,w=b?h:A?h[C]:(h[C]||{}).prototype,k=b?j:j[C]||He(j,C,{})[C],O=k.prototype;for(g in a)c=!ke(b?g:C+(A?".":"#")+g,t.forced)&&w&&de(w,g),M=k[g],c&&(T=t.dontCallGetSet?(E=je(w,g))&&E.value:w[g]),I=c&&T?T:a[g],c&&typeof M==typeof I||(S=t.bind&&c?functionBindContext(I,h):t.wrap&&c?wrapConstructor(I):R&&isCallable(I)?N(I):I,(t.sham||I&&I.sham||M&&M.sham)&&He(S,"sham",!0),He(k,g,S),R&&(de(j,m=C+"Prototype")||He(j,m,{}),He(j[m],g,I),t.real&&O&&!O[g]&&He(O,g,I)))},Ye=Ge.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==Ye,sham:!R},{defineProperty:Ye});var $e,We=createCommonjsModule((function(t){var a=j.Object,c=t.exports=function defineProperty(t,c,m){return a.defineProperty(t,c,m)};a.defineProperty.sham&&(c.sham=!0)})),ze=We,Ke=getDefaultExportFromCjs(createCommonjsModule((function(t){function _defineProperties(t,a){for(var c=0;c<a.length;c++){var m=a[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),ze(t,m.key,m)}}t.exports=function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),ze(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),Qe=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),Je=Math.ceil,Xe=Math.floor,Ze=Math.trunc||function trunc(t){var a=+t;return(a>0?Xe:Je)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:Ze(a)},et=Math.max,rt=Math.min,toAbsoluteIndex=function(t,a){var c=toIntegerOrInfinity(t);return c<0?et(c+a,0):rt(c,a)},nt=Math.min,toLength=function(t){return t>0?nt(toIntegerOrInfinity(t),9007199254740991):0},lengthOfArrayLike=function(t){return toLength(t.length)},createMethod$5=function(t){return function(a,c,m){var h,g=toIndexedObject(a),I=lengthOfArrayLike(g),M=toAbsoluteIndex(m,I);if(t&&c!=c){for(;I>M;)if((h=g[M++])!=h)return!0}else for(;I>M;M++)if((t||M in g)&&g[M]===c)return t||M||0;return!t&&-1}},at={includes:createMethod$5(!0),indexOf:createMethod$5(!1)},it={},ot=at.indexOf,st=N([].push),objectKeysInternal=function(t,a){var c,m=toIndexedObject(t),h=0,g=[];for(c in m)!de(it,c)&&de(m,c)&&st(g,c);for(;a.length>h;)de(m,c=a[h++])&&(~ot(g,c)||st(g,c));return g},ct=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],lt=Object.keys||function keys(t){return objectKeysInternal(t,ct)},ut=R&&!Pe?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var c,m=toIndexedObject(a),h=lt(a),g=h.length,I=0;g>I;)Ge.f(t,c=h[I++],m[c]);return t},dt={f:ut},pt=getBuiltIn("document","documentElement"),mt=ce("keys"),sharedKey=function(t){return mt[t]||(mt[t]=uid(t))},ht=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{$e=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&$e?NullProtoObjectViaActiveX($e):((a=documentCreateElement("iframe")).style.display="none",pt.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX($e);for(var c=ct.length;c--;)delete NullProtoObject.prototype[ct[c]];return NullProtoObject()};it[ht]=!0;var gt=Object.create||function create(t,a){var c;return null!==t?(EmptyConstructor.prototype=anObject(t),c=new EmptyConstructor,EmptyConstructor.prototype=null,c[ht]=t):c=NullProtoObject(),void 0===a?c:dt.f(c,a)};_export({target:"Object",stat:!0,sham:!R},{create:gt});var vt=j.Object,ft=function create(t,a){return vt.create(t,a)},yt=String,_t=TypeError,It=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,c={};try{(t=N(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(c,[]),a=c instanceof Array}catch(t){}return function setPrototypeOf(c,m){return anObject(c),function(t){if("object"==typeof t||isCallable(t))return t;throw _t("Can't set "+yt(t)+" as a prototype")}(m),a?t(c,m):c.__proto__=m,c}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:It});var Mt=j.Object.setPrototypeOf,Tt=N([].slice),St=Function,Et=N([].concat),Ct=N([].join),bt={},construct$8=function(t,a,c){if(!de(bt,a)){for(var m=[],h=0;h<a;h++)m[h]="a["+h+"]";bt[a]=St("C,a","return new C("+Ct(m,",")+")")}return bt[a](t,c)},At=g?St.bind:function bind(t){var a=aCallable(this),c=a.prototype,m=Tt(arguments,1),h=function bound(){var c=Et(m,Tt(arguments));return this instanceof h?construct$8(a,c.length,c):a.apply(t,c)};return H(c)&&(h.prototype=c),h};_export({target:"Function",proto:!0,forced:Function.bind!==At},{bind:At});var entryVirtual=function(t){return j[t+"Prototype"]},Nt=entryVirtual("Function").bind,Rt=Function.prototype,bind$1=function(t){var a=t.bind;return t===Rt||Y(Rt,t)&&a===Rt.bind?Nt:a},wt=createCommonjsModule((function(t){function _setPrototypeOf(a,c){var m;return t.exports=_setPrototypeOf=Mt?bind$1(m=Mt).call(m):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,c)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),kt=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=ft(a.prototype),t.prototype.constructor=t,wt(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports})));_export({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var Ot=9007199254740991,Pt={f:Object.getOwnPropertySymbols},xt=Object.assign,Vt=Object.defineProperty,Lt=N([].concat),Dt=!xt||fails((function(){if(R&&1!==xt({b:1},xt(Vt({},"a",{enumerable:!0,get:function(){Vt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},c=Symbol(),m="abcdefghijklmnopqrst";return t[c]=7,m.split("").forEach((function(t){a[t]=t})),7!=xt({},t)[c]||lt(xt({},a)).join("")!=m}))?function assign(t,a){for(var c=toObject(t),m=arguments.length,h=1,g=Pt.f,I=x.f;m>h;)for(var M,T=B(arguments[h++]),S=g?Lt(lt(T),g(T)):lt(T),E=S.length,C=0;E>C;)M=S[C++],R&&!k(I,T,M)||(c[M]=T[M]);return c}:xt;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==Dt},{assign:Dt});var Ut,Ft,Bt,qt=j.Object.assign,Gt={},Ht=h.WeakMap,jt=isCallable(Ht)&&/native code/.test(String(Ht)),Yt="Object already initialized",$t=h.TypeError,Wt=h.WeakMap;if(jt||se.state){var zt=se.state||(se.state=new Wt),Kt=N(zt.get),Qt=N(zt.has),Jt=N(zt.set);Ut=function(t,a){if(Qt(zt,t))throw $t(Yt);return a.facade=t,Jt(zt,t,a),a},Ft=function(t){return Kt(zt,t)||{}},Bt=function(t){return Qt(zt,t)}}else{var Xt=sharedKey("state");it[Xt]=!0,Ut=function(t,a){if(de(t,Xt))throw $t(Yt);return a.facade=t,He(t,Xt,a),a},Ft=function(t){return de(t,Xt)?t[Xt]:{}},Bt=function(t){return de(t,Xt)}}var Zt,er,tr,rr={set:Ut,get:Ft,has:Bt,enforce:function(t){return Bt(t)?Ft(t):Ut(t,{})},getterFor:function(t){return function(a){var c;if(!H(a)||(c=Ft(a)).type!==t)throw $t("Incompatible receiver, "+t+" required");return c}}},nr=Function.prototype,ar=R&&Object.getOwnPropertyDescriptor,ir=de(nr,"name"),or={EXISTS:ir,PROPER:ir&&"something"===function something(){}.name,CONFIGURABLE:ir&&(!R||R&&ar(nr,"name").configurable)},sr=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),cr=sharedKey("IE_PROTO"),lr=Object,ur=lr.prototype,dr=sr?lr.getPrototypeOf:function(t){var a=toObject(t);if(de(a,cr))return a[cr];var c=a.constructor;return isCallable(c)&&a instanceof c?c.prototype:a instanceof lr?ur:null},defineBuiltIn=function(t,a,c,m){return m&&m.enumerable?t[a]=c:He(t,a,c),t},pr=wellKnownSymbol("iterator"),mr=!1;[].keys&&("next"in(tr=[].keys())?(er=dr(dr(tr)))!==Object.prototype&&(Zt=er):mr=!0);var hr=!H(Zt)||fails((function(){var t={};return Zt[pr].call(t)!==t}));Zt=hr?{}:gt(Zt),isCallable(Zt[pr])||defineBuiltIn(Zt,pr,(function(){return this}));var gr={IteratorPrototype:Zt,BUGGY_SAFARI_ITERATORS:mr},vr={};vr[wellKnownSymbol("toStringTag")]="z";var fr="[object z]"===String(vr),yr=wellKnownSymbol("toStringTag"),_r=Object,Ir="Arguments"==classofRaw(function(){return arguments}()),Mr=fr?classofRaw:function(t){var a,c,m;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(c=function(t,a){try{return t[a]}catch(t){}}(a=_r(t),yr))?c:Ir?classofRaw(a):"Object"==(m=classofRaw(a))&&isCallable(a.callee)?"Arguments":m},Tr=fr?{}.toString:function toString(){return"[object "+Mr(this)+"]"},Sr=Ge.f,Er=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,c,m){if(t){var h=c?t:t.prototype;de(h,Er)||Sr(h,Er,{configurable:!0,value:a}),m&&!fr&&He(h,"toString",Tr)}},Cr=gr.IteratorPrototype,returnThis$1=function(){return this},br=or.PROPER,Ar=gr.BUGGY_SAFARI_ITERATORS,Nr=wellKnownSymbol("iterator"),Rr="keys",wr="values",kr="entries",returnThis=function(){return this},iteratorDefine=function(t,a,c,m,h,g,I){!function(t,a,c,m){var h=a+" Iterator";t.prototype=gt(Cr,{next:createPropertyDescriptor(+!m,c)}),setToStringTag(t,h,!1,!0),Gt[h]=returnThis$1}(c,a,m);var M,T,S,getIterationMethod=function(t){if(t===h&&N)return N;if(!Ar&&t in b)return b[t];switch(t){case Rr:return function keys(){return new c(this,t)};case wr:return function values(){return new c(this,t)};case kr:return function entries(){return new c(this,t)}}return function(){return new c(this)}},E=a+" Iterator",C=!1,b=t.prototype,A=b[Nr]||b["@@iterator"]||h&&b[h],N=!Ar&&A||getIterationMethod(h),R="Array"==a&&b.entries||A;if(R&&(M=dr(R.call(new t)))!==Object.prototype&&M.next&&(setToStringTag(M,E,!0,!0),Gt[E]=returnThis),br&&h==wr&&A&&A.name!==wr&&(C=!0,N=function values(){return k(A,this)}),h)if(T={values:getIterationMethod(wr),keys:g?N:getIterationMethod(Rr),entries:getIterationMethod(kr)},I)for(S in T)(Ar||C||!(S in b))&&defineBuiltIn(b,S,T[S]);else _export({target:a,proto:!0,forced:Ar||C},T);return I&&b[Nr]!==N&&defineBuiltIn(b,Nr,N,{name:h}),Gt[a]=N,T};Ge.f;var Or="Array Iterator",Pr=rr.set,xr=rr.getterFor(Or);iteratorDefine(Array,"Array",(function(t,a){Pr(this,{type:Or,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=xr(this),a=t.target,c=t.kind,m=t.index++;return!a||m>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==c?{value:m,done:!1}:"values"==c?{value:a[m],done:!1}:{value:[m,a[m]],done:!1}}),"values"),Gt.Arguments=Gt.Array;var Vr=wellKnownSymbol("toStringTag");for(var Lr in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Dr=h[Lr],Ur=Dr&&Dr.prototype;Ur&&Mr(Ur)!==Vr&&He(Ur,Vr,Lr),Gt[Lr]=Gt.Array}var Fr=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},Br=N(Function.toString);isCallable(se.inspectSource)||(se.inspectSource=function(t){return Br(t)});var qr=se.inspectSource,noop$1=function(){},Gr=[],Hr=getBuiltIn("Reflect","construct"),jr=/^\s*(?:class|function)\b/,Yr=N(jr.exec),$r=!jr.exec(noop$1),Wr=function isConstructor(t){if(!isCallable(t))return!1;try{return Hr(noop$1,Gr,t),!0}catch(t){return!1}},zr=function isConstructor(t){if(!isCallable(t))return!1;switch(Mr(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return $r||!!Yr(jr,qr(t))}catch(t){return!0}};zr.sham=!0;var Kr=!Hr||fails((function(){var t;return Wr(Wr.call)||!Wr(Object)||!Wr((function(){t=!0}))||t}))?zr:Wr,Qr=wellKnownSymbol("species"),Jr=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return Fr(t)&&(a=t.constructor,(Kr(a)&&(a===Jr||Fr(a.prototype))||H(a)&&null===(a=a[Qr]))&&(a=void 0)),void 0===a?Jr:a}(t))(0===a?0:a)},Xr=N([].push),createMethod$4=function(t){var a=1==t,c=2==t,m=3==t,h=4==t,g=6==t,I=7==t,M=5==t||g;return function(T,S,E,C){for(var b,A,N=toObject(T),R=B(N),w=functionBindContext(S,E),k=lengthOfArrayLike(R),O=0,P=C||arraySpeciesCreate,x=a?P(T,k):c||I?P(T,0):void 0;k>O;O++)if((M||O in R)&&(A=w(b=R[O],O,N),t))if(a)x[O]=A;else if(A)switch(t){case 3:return!0;case 5:return b;case 6:return O;case 2:Xr(x,b)}else switch(t){case 4:return!1;case 7:Xr(x,b)}return g?-1:m||h?h:x}},Zr={forEach:createMethod$4(0),map:createMethod$4(1),filter:createMethod$4(2),some:createMethod$4(3),every:createMethod$4(4),find:createMethod$4(5),findIndex:createMethod$4(6),filterReject:createMethod$4(7)},arrayMethodIsStrict=function(t,a){var c=[][t];return!!c&&fails((function(){c.call(null,a||function(){return 1},1)}))},en=Zr.forEach,tn=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return en(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=tn},{forEach:tn});var rn=entryVirtual("Array").forEach,nn=Array.prototype,an={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===nn||Y(nn,t)&&a===nn.forEach||de(an,Mr(t))?rn:a},sn=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return J>=51||!fails((function(){var a=[];return(a.constructor={})[sn]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},cn=Zr.filter,ln=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!ln},{filter:function filter(t){return cn(this,t,arguments.length>1?arguments[1]:void 0)}});var un=entryVirtual("Array").filter,dn=Array.prototype,filter=function(t){var a=t.filter;return t===dn||Y(dn,t)&&a===dn.filter?un:a},pn=fails((function(){lt(1)}));_export({target:"Object",stat:!0,forced:pn},{keys:function keys(t){return lt(toObject(t))}});var mn=j.Object.keys,hn=ct.concat("length","prototype"),gn={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,hn)}},vn=N([].concat),fn=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=gn.f(anObject(t)),c=Pt.f;return c?vn(a,c(t)):a},yn=Error,_n=N("".replace),In=String(yn("zxcasd").stack),Mn=/\n\s*at [^:]*:[^\n]*/,Tn=Mn.test(In),errorStackClear=function(t,a){if(Tn&&"string"==typeof t&&!yn.prepareStackTrace)for(;a--;)t=_n(t,Mn,"");return t},installErrorCause=function(t,a){H(a)&&"cause"in a&&He(t,"cause",a.cause)},Sn=wellKnownSymbol("iterator"),En=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(Gt.Array===t||En[Sn]===t)},Cn=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,Cn)||getMethod(t,"@@iterator")||Gt[Mr(t)]},bn=TypeError,getIterator=function(t,a){var c=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(c))return anObject(k(c,t));throw bn(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,c){var m,h;anObject(t);try{if(!(m=getMethod(t,"return"))){if("throw"===a)throw c;return c}m=k(m,t)}catch(t){h=!0,m=t}if("throw"===a)throw c;if(h)throw m;return anObject(m),c},An=TypeError,Result=function(t,a){this.stopped=t,this.result=a},Nn=Result.prototype,iterate=function(t,a,c){var m,h,g,I,M,T,S,E=c&&c.that,C=!(!c||!c.AS_ENTRIES),b=!(!c||!c.IS_RECORD),A=!(!c||!c.IS_ITERATOR),N=!(!c||!c.INTERRUPTED),R=functionBindContext(a,E),stop=function(t){return m&&iteratorClose(m,"normal",t),new Result(!0,t)},callFn=function(t){return C?(anObject(t),N?R(t[0],t[1],stop):R(t[0],t[1])):N?R(t,stop):R(t)};if(b)m=t.iterator;else if(A)m=t;else{if(!(h=getIteratorMethod$5(t)))throw An(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(h)){for(g=0,I=lengthOfArrayLike(t);I>g;g++)if((M=callFn(t[g]))&&Y(Nn,M))return M;return new Result(!1)}m=getIterator(t,h)}for(T=b?t.next:m.next;!(S=k(T,m)).done;){try{M=callFn(S.value)}catch(t){iteratorClose(m,"throw",t)}if("object"==typeof M&&M&&Y(Nn,M))return M}return new Result(!1)},Rn=String,toString$1=function(t){if("Symbol"===Mr(t))throw TypeError("Cannot convert a Symbol value to a string");return Rn(t)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString$1(t)},wn=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),kn=wellKnownSymbol("toStringTag"),On=Error,Pn=[].push,xn=function AggregateError(t,a){var c,m=arguments.length>2?arguments[2]:void 0,h=Y(Vn,this);It?c=It(On(),h?dr(this):Vn):(c=h?this:gt(Vn),He(c,kn,"Error")),void 0!==a&&He(c,"message",normalizeStringArgument(a)),wn&&He(c,"stack",errorStackClear(c.stack,1)),installErrorCause(c,m);var g=[];return iterate(t,Pn,{that:g}),He(c,"errors",g),c};It?It(xn,On):function(t,a,c){for(var m=fn(a),h=Ge.f,g=Ce.f,I=0;I<m.length;I++){var M=m[I];de(t,M)||c&&de(c,M)||h(t,M,g(a,M))}}(xn,On,{name:!0});var Vn=xn.prototype=gt(On.prototype,{constructor:createPropertyDescriptor(1,xn),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:xn});var Ln,Dn,Un,Fn,Bn="process"==classofRaw(h.process),qn=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),c=Ge.f;R&&a&&!a[qn]&&c(a,qn,{configurable:!0,get:function(){return this}})},Gn=TypeError,anInstance=function(t,a){if(Y(a,t))return t;throw Gn("Incorrect invocation")},Hn=TypeError,aConstructor=function(t){if(Kr(t))return t;throw Hn(tryToString(t)+" is not a constructor")},jn=wellKnownSymbol("species"),speciesConstructor=function(t,a){var c,m=anObject(t).constructor;return void 0===m||isNullOrUndefined(c=anObject(m)[jn])?a:aConstructor(c)},Yn=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw Yn("Not enough arguments");return t},$n=/(?:ipad|iphone|ipod).*applewebkit/i.test($),Wn=h.setImmediate,zn=h.clearImmediate,Kn=h.process,Qn=h.Dispatch,Jn=h.Function,Xn=h.MessageChannel,Zn=h.String,ea=0,ta={},ra="onreadystatechange";try{Ln=h.location}catch(t){}var run=function(t){if(de(ta,t)){var a=ta[t];delete ta[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){h.postMessage(Zn(t),Ln.protocol+"//"+Ln.host)};Wn&&zn||(Wn=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:Jn(t),c=Tt(arguments,1);return ta[++ea]=function(){S(a,void 0,c)},Dn(ea),ea},zn=function clearImmediate(t){delete ta[t]},Bn?Dn=function(t){Kn.nextTick(runner(t))}:Qn&&Qn.now?Dn=function(t){Qn.now(runner(t))}:Xn&&!$n?(Fn=(Un=new Xn).port2,Un.port1.onmessage=listener,Dn=functionBindContext(Fn.postMessage,Fn)):h.addEventListener&&isCallable(h.postMessage)&&!h.importScripts&&Ln&&"file:"!==Ln.protocol&&!fails(post)?(Dn=post,h.addEventListener("message",listener,!1)):Dn=ra in documentCreateElement("script")?function(t){pt.appendChild(documentCreateElement("script")).onreadystatechange=function(){pt.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var na,aa,ia,oa,sa,ca,la,ua,da={set:Wn,clear:zn},pa=/ipad|iphone|ipod/i.test($)&&void 0!==h.Pebble,ma=/web0s(?!.*chrome)/i.test($),ha=Ce.f,ga=da.set,va=h.MutationObserver||h.WebKitMutationObserver,fa=h.document,ya=h.process,_a=h.Promise,Ia=ha(h,"queueMicrotask"),Ma=Ia&&Ia.value;Ma||(na=function(){var t,a;for(Bn&&(t=ya.domain)&&t.exit();aa;){a=aa.fn,aa=aa.next;try{a()}catch(t){throw aa?oa():ia=void 0,t}}ia=void 0,t&&t.enter()},$n||Bn||ma||!va||!fa?!pa&&_a&&_a.resolve?((la=_a.resolve(void 0)).constructor=_a,ua=functionBindContext(la.then,la),oa=function(){ua(na)}):Bn?oa=function(){ya.nextTick(na)}:(ga=functionBindContext(ga,h),oa=function(){ga(na)}):(sa=!0,ca=fa.createTextNode(""),new va(na).observe(ca,{characterData:!0}),oa=function(){ca.data=sa=!sa}));var Ta=Ma||function(t){var a={fn:t,next:void 0};ia&&(ia.next=a),aa||(aa=a,oa()),ia=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Sa,Ea,Ca=Queue,ba=h.Promise,Aa="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Na=!Aa&&!Bn&&"object"==typeof window&&"object"==typeof document,Ra=ba&&ba.prototype,wa=wellKnownSymbol("species"),ka=!1,Oa=isCallable(h.PromiseRejectionEvent),Pa=ke("Promise",(function(){var t=qr(ba),a=t!==String(ba);if(!a&&66===J)return!0;if(!Ra.catch||!Ra.finally)return!0;if(!J||J<51||!/native code/.test(t)){var c=new ba((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((c.constructor={})[wa]=FakePromise,!(ka=c.then((function(){}))instanceof FakePromise))return!0}return!a&&(Na||Aa)&&!Oa})),xa={CONSTRUCTOR:Pa,REJECTION_EVENT:Oa,SUBCLASSING:ka},Va=TypeError,PromiseCapability=function(t){var a,c;this.promise=new t((function(t,m){if(void 0!==a||void 0!==c)throw Va("Bad Promise constructor");a=t,c=m})),this.resolve=aCallable(a),this.reject=aCallable(c)},La={f:function(t){return new PromiseCapability(t)}},Da=da.set,Ua="Promise",Fa=xa.CONSTRUCTOR,Ba=xa.REJECTION_EVENT,qa=rr.getterFor(Ua),Ga=rr.set,Ha=ba&&ba.prototype,ja=ba,Ya=Ha,$a=h.TypeError,Wa=h.document,za=h.process,Ka=La.f,Qa=Ka,Ja=!!(Wa&&Wa.createEvent&&h.dispatchEvent),Xa="unhandledrejection",isThenable=function(t){var a;return!(!H(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var c,m,h,g=a.value,I=1==a.state,M=I?t.ok:t.fail,T=t.resolve,S=t.reject,E=t.domain;try{M?(I||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===M?c=g:(E&&E.enter(),c=M(g),E&&(E.exit(),h=!0)),c===t.promise?S($a("Promise-chain cycle")):(m=isThenable(c))?k(m,c,T,S):T(c)):S(g)}catch(t){E&&!h&&E.exit(),S(t)}},notify=function(t,a){t.notified||(t.notified=!0,Ta((function(){for(var c,m=t.reactions;c=m.get();)callReaction(c,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,c){var m,g;Ja?((m=Wa.createEvent("Event")).promise=a,m.reason=c,m.initEvent(t,!1,!0),h.dispatchEvent(m)):m={promise:a,reason:c},!Ba&&(g=h["on"+t])?g(m):t===Xa&&function(t,a){var c=h.console;c&&c.error&&(1==arguments.length?c.error(t):c.error(t,a))}("Unhandled promise rejection",c)},onUnhandled=function(t){k(Da,h,(function(){var a,c=t.facade,m=t.value;if(isUnhandled(t)&&(a=perform((function(){Bn?za.emit("unhandledRejection",m,c):dispatchEvent(Xa,c,m)})),t.rejection=Bn||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){k(Da,h,(function(){var a=t.facade;Bn?za.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,c){return function(m){t(a,m,c)}},internalReject=function(t,a,c){t.done||(t.done=!0,c&&(t=c),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,c){if(!t.done){t.done=!0,c&&(t=c);try{if(t.facade===a)throw $a("Promise can't be resolved itself");var m=isThenable(a);m?Ta((function(){var c={done:!1};try{k(m,a,bind(internalResolve,c,t),bind(internalReject,c,t))}catch(a){internalReject(c,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};Fa&&(Ya=(ja=function Promise(t){anInstance(this,Ya),aCallable(t),k(Sa,this);var a=qa(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(Sa=function Promise(t){Ga(this,{type:Ua,done:!1,notified:!1,parent:!1,reactions:new Ca,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn(Ya,"then",(function then(t,a){var c=qa(this),m=Ka(speciesConstructor(this,ja));return c.parent=!0,m.ok=!isCallable(t)||t,m.fail=isCallable(a)&&a,m.domain=Bn?za.domain:void 0,0==c.state?c.reactions.add(m):Ta((function(){callReaction(m,c)})),m.promise})),Ea=function(){var t=new Sa,a=qa(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},La.f=Ka=function(t){return t===ja||undefined===t?new Ea(t):Qa(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:Fa},{Promise:ja}),setToStringTag(ja,Ua,!1,!0),setSpecies(Ua);var Za=wellKnownSymbol("iterator"),ei=!1;try{var ti=0,ri={next:function(){return{done:!!ti++}},return:function(){ei=!0}};ri[Za]=function(){return this},Array.from(ri,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!ei)return!1;var c=!1;try{var m={};m[Za]=function(){return{next:function(){return{done:c=!0}}}},t(m)}catch(t){}return c},ni=xa.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){ba.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:ni},{all:function all(t){var a=this,c=La.f(a),m=c.resolve,h=c.reject,g=perform((function(){var c=aCallable(a.resolve),g=[],I=0,M=1;iterate(t,(function(t){var T=I++,S=!1;M++,k(c,a,t).then((function(t){S||(S=!0,g[T]=t,--M||m(g))}),h)})),--M||m(g)}));return g.error&&h(g.value),c.promise}});var ai=xa.CONSTRUCTOR;ba&&ba.prototype,_export({target:"Promise",proto:!0,forced:ai,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:ni},{race:function race(t){var a=this,c=La.f(a),m=c.reject,h=perform((function(){var h=aCallable(a.resolve);iterate(t,(function(t){k(h,a,t).then(c.resolve,m)}))}));return h.error&&m(h.value),c.promise}}),_export({target:"Promise",stat:!0,forced:xa.CONSTRUCTOR},{reject:function reject(t){var a=La.f(this);return k(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),H(a)&&a.constructor===t)return a;var c=La.f(t);return(0,c.resolve)(a),c.promise},oi=xa.CONSTRUCTOR,si=getBuiltIn("Promise"),ci=!oi;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(ci&&this===si?ba:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,c=La.f(a),m=c.resolve,h=c.reject,g=perform((function(){var c=aCallable(a.resolve),h=[],g=0,I=1;iterate(t,(function(t){var M=g++,T=!1;I++,k(c,a,t).then((function(t){T||(T=!0,h[M]={status:"fulfilled",value:t},--I||m(h))}),(function(t){T||(T=!0,h[M]={status:"rejected",reason:t},--I||m(h))}))})),--I||m(h)}));return g.error&&h(g.value),c.promise}});var li="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,c=getBuiltIn("AggregateError"),m=La.f(a),h=m.resolve,g=m.reject,I=perform((function(){var m=aCallable(a.resolve),I=[],M=0,T=1,S=!1;iterate(t,(function(t){var E=M++,C=!1;T++,k(m,a,t).then((function(t){C||S||(S=!0,h(t))}),(function(t){C||S||(C=!0,I[E]=t,--T||g(new c(I,li)))}))})),--T||g(new c(I,li))}));return I.error&&g(I.value),m.promise}});var ui=ba&&ba.prototype,di=!!ba&&fails((function(){ui.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:di},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),c=isCallable(t);return this.then(c?function(c){return promiseResolve(a,t()).then((function(){return c}))}:t,c?function(c){return promiseResolve(a,t()).then((function(){throw c}))}:t)}});var pi=N("".charAt),mi=N("".charCodeAt),hi=N("".slice),createMethod$3=function(t){return function(a,c){var m,h,g=toString$1(requireObjectCoercible(a)),I=toIntegerOrInfinity(c),M=g.length;return I<0||I>=M?t?"":void 0:(m=mi(g,I))<55296||m>56319||I+1===M||(h=mi(g,I+1))<56320||h>57343?t?pi(g,I):m:t?hi(g,I,I+2):h-56320+(m-55296<<10)+65536}},gi={codeAt:createMethod$3(!1),charAt:createMethod$3(!0)},vi=gi.charAt,fi="String Iterator",yi=rr.set,_i=rr.getterFor(fi);iteratorDefine(String,"String",(function(t){yi(this,{type:fi,string:toString$1(t),index:0})}),(function next(){var t,a=_i(this),c=a.string,m=a.index;return m>=c.length?{value:void 0,done:!0}:(t=vi(c,m),a.index+=t.length,{value:t,done:!1})}));var Ii=j.Promise;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=La.f(this),c=perform(t);return(c.error?a.reject:a.resolve)(c.value),a.promise}});var Mi=Ii,Ti=x.f,Si=N(Ti),Ei=N([].push),createMethod$2=function(t){return function(a){for(var c,m=toIndexedObject(a),h=lt(m),g=h.length,I=0,M=[];g>I;)c=h[I++],R&&!Si(m,c)||Ei(M,t?[c,m[c]]:m[c]);return M}},Ci={entries:createMethod$2(!0),values:createMethod$2(!1)},bi=Ci.values;_export({target:"Object",stat:!0},{values:function values(t){return bi(t)}});var Ai=j.Object.values,Ni=Date,Ri=N(Ni.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return Ri(new Ni)}});var wi=j.Date.now,ki=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw ki("Maximum allowed index exceeded");return t},createProperty=function(t,a,c){var m=toPropertyKey(a);m in t?Ge.f(t,m,createPropertyDescriptor(0,c)):t[m]=c},Oi=wellKnownSymbol("isConcatSpreadable"),Pi=J>=51||!fails((function(){var t=[];return t[Oi]=!1,t.concat()[0]!==t})),xi=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!H(t))return!1;var a=t[Oi];return void 0!==a?!!a:Fr(t)};_export({target:"Array",proto:!0,arity:1,forced:!Pi||!xi},{concat:function concat(t){var a,c,m,h,g,I=toObject(this),M=arraySpeciesCreate(I,0),T=0;for(a=-1,m=arguments.length;a<m;a++)if(isConcatSpreadable(g=-1===a?I:arguments[a]))for(h=lengthOfArrayLike(g),doesNotExceedSafeInteger(T+h),c=0;c<h;c++,T++)c in g&&createProperty(M,T,g[c]);else doesNotExceedSafeInteger(T+1),createProperty(M,T++,g);return M.length=T,M}});var Vi=entryVirtual("Array").concat,Li=Array.prototype,concat=function(t){var a=t.concat;return t===Li||Y(Li,t)&&a===Li.concat?Vi:a},Di=/MSIE .\./.test($),Ui=h.Function,wrap$1=function(t){return Di?function(a,c){var m=validateArgumentsLength(arguments.length,1)>2,h=isCallable(a)?a:Ui(a),g=m?Tt(arguments,2):void 0;return t(m?function(){S(h,this,g)}:h,c)}:t},Fi={setTimeout:wrap$1(h.setTimeout),setInterval:wrap$1(h.setInterval)},Bi=Fi.setInterval;_export({global:!0,bind:!0,forced:h.setInterval!==Bi},{setInterval:Bi});var qi=Fi.setTimeout;_export({global:!0,bind:!0,forced:h.setTimeout!==qi},{setTimeout:qi});var Gi=j.setTimeout,Hi=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,c="~";function Events(){}function EE(t,a,c){this.fn=t,this.context=a,this.once=c||!1}function addListener(t,a,m,h,g){if("function"!=typeof m)throw new TypeError("The listener must be a function");var I=new EE(m,h||t,g),M=c?c+a:a;return t._events[M]?t._events[M].fn?t._events[M]=[t._events[M],I]:t._events[M].push(I):(t._events[M]=I,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(c=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,m,h=[];if(0===this._eventsCount)return h;for(m in t=this._events)a.call(t,m)&&h.push(c?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(t)):h},EventEmitter.prototype.listeners=function listeners(t){var a=c?c+t:t,m=this._events[a];if(!m)return[];if(m.fn)return[m.fn];for(var h=0,g=m.length,I=new Array(g);h<g;h++)I[h]=m[h].fn;return I},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=c?c+t:t,m=this._events[a];return m?m.fn?1:m.length:0},EventEmitter.prototype.emit=function emit(t,a,m,h,g,I){var M=c?c+t:t;if(!this._events[M])return!1;var T,S,E=this._events[M],C=arguments.length;if(E.fn){switch(E.once&&this.removeListener(t,E.fn,void 0,!0),C){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,a),!0;case 3:return E.fn.call(E.context,a,m),!0;case 4:return E.fn.call(E.context,a,m,h),!0;case 5:return E.fn.call(E.context,a,m,h,g),!0;case 6:return E.fn.call(E.context,a,m,h,g,I),!0}for(S=1,T=new Array(C-1);S<C;S++)T[S-1]=arguments[S];E.fn.apply(E.context,T)}else{var b,A=E.length;for(S=0;S<A;S++)switch(E[S].once&&this.removeListener(t,E[S].fn,void 0,!0),C){case 1:E[S].fn.call(E[S].context);break;case 2:E[S].fn.call(E[S].context,a);break;case 3:E[S].fn.call(E[S].context,a,m);break;case 4:E[S].fn.call(E[S].context,a,m,h);break;default:if(!T)for(b=1,T=new Array(C-1);b<C;b++)T[b-1]=arguments[b];E[S].fn.apply(E[S].context,T)}}return!0},EventEmitter.prototype.on=function on(t,a,c){return addListener(this,t,a,c,!1)},EventEmitter.prototype.once=function once(t,a,c){return addListener(this,t,a,c,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,m,h){var g=c?c+t:t;if(!this._events[g])return this;if(!a)return clearEvent(this,g),this;var I=this._events[g];if(I.fn)I.fn!==a||h&&!I.once||m&&I.context!==m||clearEvent(this,g);else{for(var M=0,T=[],S=I.length;M<S;M++)(I[M].fn!==a||h&&!I[M].once||m&&I[M].context!==m)&&T.push(I[M]);T.length?this._events[g]=1===T.length?T[0]:T:clearEvent(this,g)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=c?c+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=c,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter}));_export({global:!0},{globalThis:h});var ji=h,Yi=at.includes,$i=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:$i},{includes:function includes(t){return Yi(this,t,arguments.length>1?arguments[1]:void 0)}});var Wi=entryVirtual("Array").includes,zi=wellKnownSymbol("match"),Ki=TypeError,notARegexp=function(t){if(function(t){var a;return H(t)&&(void 0!==(a=t[zi])?!!a:"RegExp"==classofRaw(t))}(t))throw Ki("The method doesn't accept regular expressions");return t},Qi=wellKnownSymbol("match"),correctIsRegexpLogic=function(t){var a=/./;try{"/./"[t](a)}catch(c){try{return a[Qi]=!1,"/./"[t](a)}catch(t){}}return!1},Ji=N("".indexOf);_export({target:"String",proto:!0,forced:!correctIsRegexpLogic("includes")},{includes:function includes(t){return!!~Ji(toString$1(requireObjectCoercible(this)),toString$1(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var Xi=entryVirtual("String").includes,Zi=Array.prototype,eo=String.prototype,includes=function(t){var a=t.includes;return t===Zi||Y(Zi,t)&&a===Zi.includes?Wi:"string"==typeof t||t===eo||Y(eo,t)&&a===eo.includes?Xi:a},to=arrayMethodHasSpeciesSupport("slice"),ro=wellKnownSymbol("species"),no=Array,ao=Math.max;_export({target:"Array",proto:!0,forced:!to},{slice:function slice(t,a){var c,m,h,g=toIndexedObject(this),I=lengthOfArrayLike(g),M=toAbsoluteIndex(t,I),T=toAbsoluteIndex(void 0===a?I:a,I);if(Fr(g)&&(c=g.constructor,(Kr(c)&&(c===no||Fr(c.prototype))||H(c)&&null===(c=c[ro]))&&(c=void 0),c===no||void 0===c))return Tt(g,M,T);for(m=new(void 0===c?no:c)(ao(T-M,0)),h=0;M<T;M++,h++)M in g&&createProperty(m,h,g[M]);return m.length=h,m}});var io=entryVirtual("Array").slice,oo=Array.prototype,slice$1=function(t){var a=t.slice;return t===oo||Y(oo,t)&&a===oo.slice?io:a},so=createCommonjsModule((function(t,a){t.exports=function(){function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var c=0;c<a.length;c++){var m=a[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),ze(t,m.key,m)}}function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),ze(t,"prototype",{writable:!1}),t}var t={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:6e5},a=function emptyFn(){},c=function(){function Reporter(a){_classCallCheck(this,Reporter),this.isUploadEnable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.traceMsgCache={},this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=wi(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(a),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){var a=qt({},this.reportConfig.common,t.common);this.reportConfig=qt({},this.reportConfig,t),this.reportConfig.common=a,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function reportImmediately(t,a){var c=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(t,qt({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,m;null===(m=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(a,c){var m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(m.priority||(m.priority=this.getEventPriority(a,c)),this.reportConfig.isDataReportEnable&&a){if("login"===a&&!1===c.succeed&&c.process_id){var h=this.lastFailLogin[c.process_id]||0;if(c.start_time-h<t.loginFailIgnoreInterval)return;this.lastFailLogin[c.process_id]=c.start_time}var g=wi();"HIGH"===m.priority?this.highPriorityMsgList.push({module:a,msg:c,createTime:g}):"NORMAL"===m.priority?this.msgList.push({module:a,msg:c,createTime:g}):"LOW"===m.priority&&this.lowPriorityMsgList.push({module:a,msg:c,createTime:g}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(this.reportConfig.isDataReportEnable&&t&&!this.traceMsgCache[t]){var c=qt(qt({start_time:wi()},a),{extension:[]});this.traceMsgCache[t]=c}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a,c){var m,h=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t]){var g=this.traceMsgCache[t].extension,I=g.length,M=(new Date).getTime();0===I?a.duration=M-this.traceMsgCache[t].start_time:g[I-1].end_time?a.duration=M-g[I-1].end_time:a.duration=M-this.traceMsgCache[t].start_time,g.push(qt({end_time:M},a));var T=g.length-1;(null==c?void 0:c.asyncParams)&&((m=this.traceMsgCache[t]).asyncPromiseArray||(m.asyncPromiseArray=[]),this.traceMsgCache[t].asyncPromiseArray.push(c.asyncParams.then((function(a){h.traceMsgCache[t]&&h.traceMsgCache[t].extension[T]&&qt(h.traceMsgCache[t].extension[T],a)}))))}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a,c,m=this,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t])if("nos"!==t||!1===h){"boolean"==typeof h?this.traceMsgCache[t].succeed=!!h:this.traceMsgCache[t].state=h,this.traceMsgCache[t].duration=wi()-this.traceMsgCache[t].start_time,forEach$1(a=this.traceMsgCache[t].extension).call(a,(function(t){delete t.end_time}));var g=this.traceMsgCache[t];if(this.traceMsgCache[t]=null,g.asyncPromiseArray){(c=this.endedAsyncMsgByModule)[t]||(c[t]=[]),this.endedAsyncMsgByModule[t].push(g);var I=function asyncCallback(){var a;m.endedAsyncMsgByModule[t]&&includes(a=m.endedAsyncMsgByModule[t]).call(a,g)&&(delete g.asyncPromiseArray,m.report(t,g,{priority:m.getEventPriority(t,g)}))};Mi.all(g.asyncPromiseArray).then(I).catch(I)}else this.report(t,g,{priority:this.getEventPriority(t,g)})}else this.traceMsgCache[t]=null}},{key:"getEventPriority",value:function getEventPriority(t,a){if("exceptions"===t){if(0===a.action)return"HIGH";if(2===a.action)return"HIGH";if(1===a.action&&0!==a.exception_service)return"HIGH"}else{if("msgReceive"===t)return"LOW";if("nim_api_trace"===t)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function reportTraceCancel(t){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[t]=[],this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function restore(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function destroy(){var t,c=this;this.reportConfig.isDataReportEnable&&(forEach$1(t=mn(this.traceMsgCache)).call(t,(function(t){c.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=a,this.report=a,this.reportTraceStart=a,this.reportTraceUpdate=a,this.reportTraceEnd=a,this.pause=a,this.restore=a,this.destroy=a,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function initUploadConfig(){var t,a,c=this;if(!this.loading){this.loading=!0;var m=this.reportConfig.common||{};try{this.reportConfig.request(this.reportConfig.reportConfigUrl,{method:"GET",dataType:"json",params:{deviceId:m.dev_id,sdkVer:m.sdk_ver,platform:m.platform,appkey:m.app_key},timeout:this.reportConfig.timeout}).then((function(t){var a,m;if(!c.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){var h=t.data.data||{};c.reportConfig.maxSize=h.maxSize>1e3?1e3:h.maxSize,c.reportConfig.maxInterval=h.maxInterval>1e4?1e4:h.maxInterval,c.reportConfig.maxInterval=h.maxInterval<10?10:h.maxInterval,c.reportConfig.minInterval=h.minInterval<2?2:h.minInterval,c.reportConfig.maxDelay=h.maxDelay||300,c.reportConfig.maxInterval=1e3*c.reportConfig.maxInterval,c.reportConfig.minInterval=1e3*c.reportConfig.minInterval,c.reportConfig.maxDelay=1e3*c.reportConfig.maxDelay,c.isUploadEnable=!0,c.initConfigLoaded=!0,c.loading=!1,c.reportHeartBeat()}null===(m=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.log("Get reporter upload config success")}})).catch((function(t){var a,m;c.loading=!1,null===(m=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.error("Get reporter upload config failed",t)}))}catch(c){this.loading=!1,null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.error("Exec reporter request failed",c)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=Gi((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;wi()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t,a,c,m,h,g,I=this,M={},T=wi();this.highPriorityMsgList=filter(t=this.highPriorityMsgList).call(t,(function(t){return T-t.createTime<I.reportConfig.maxDelay})),this.msgList=filter(a=this.msgList).call(a,(function(t){return T-t.createTime<I.reportConfig.maxDelay})),this.lowPriorityMsgList=filter(c=this.lowPriorityMsgList).call(c,(function(t){return T-t.createTime<I.reportConfig.maxDelay})),this.cacheMsgList=filter(m=this.cacheMsgList).call(m,(function(t){return T-t.createTime<I.reportConfig.maxDelay}));var S=slice$1(h=this.highPriorityMsgList).call(h,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=slice$1(g=this.highPriorityMsgList).call(g,S.length),S.length<this.reportConfig.maxSize){var E,C,b=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice$1(E=this.msgList).call(E,0,b)),this.msgList=slice$1(C=this.msgList).call(C,b)}if(S.length<this.reportConfig.maxSize){var A,N,R=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice$1(A=this.lowPriorityMsgList).call(A,0,R)),this.lowPriorityMsgList=slice$1(N=this.lowPriorityMsgList).call(N,R)}if(S.length<this.reportConfig.maxSize){var w,k,O=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice$1(w=this.cacheMsgList).call(w,0,O)),this.cacheMsgList=slice$1(k=this.cacheMsgList).call(k,O)}return forEach$1(S).call(S,(function(t){M[t.module]?M[t.module].push(t.msg):M[t.module]=[t.msg]})),{uploadMsgArr:S,uploadMsg:M}}},{key:"upload",value:function upload(){var t,a,c=this;if(this.isUploadEnable&&!(this.lastReportTime&&wi()-this.lastReportTime<this.reportConfig.minInterval)){var m=this.getUploadMsg(),h=m.uploadMsgArr,g=m.uploadMsg;if(h.length){this.lastReportTime=wi();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:g},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,m,g,I;c.cacheMsgList=slice$1(a=concat(m=c.cacheMsgList).call(m,h)).call(a,0,c.reportConfig.cacheMaxSize),null===(I=null===(g=c.reportConfig)||void 0===g?void 0:g.logger)||void 0===I||I.warn("Reporter upload failed",t)}))}catch(c){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",c)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return c}()})),co=Array.isArray,lo="object"==typeof a&&a&&a.Object===Object&&a,uo="object"==typeof self&&self&&self.Object===Object&&self,po=lo||uo||Function("return this")(),mo=po.Symbol,ho=Object.prototype,go=ho.hasOwnProperty,vo=ho.toString,fo=mo?mo.toStringTag:void 0;var yo=function getRawTag(t){var a=go.call(t,fo),c=t[fo];try{t[fo]=void 0;var m=!0}catch(t){}var h=vo.call(t);return m&&(a?t[fo]=c:delete t[fo]),h},_o=Object.prototype.toString;var Io=function objectToString(t){return _o.call(t)},Mo=mo?mo.toStringTag:void 0;var To=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Mo&&Mo in Object(t)?yo(t):Io(t)};var So=function isObjectLike(t){return null!=t&&"object"==typeof t};var Eo=function isSymbol(t){return"symbol"==typeof t||So(t)&&"[object Symbol]"==To(t)},Co=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bo=/^\w*$/;var Ao=function isKey(t,a){if(co(t))return!1;var c=typeof t;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=t&&!Eo(t))||(bo.test(t)||!Co.test(t)||null!=a&&t in Object(a))};var No=function isObject$1(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var Ro=function isFunction(t){if(!No(t))return!1;var a=To(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},wo=po["__core-js_shared__"],ko=function(){var t=/[^.]+$/.exec(wo&&wo.keys&&wo.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Oo=function isMasked(t){return!!ko&&ko in t},Po=Function.prototype.toString;var xo=function toSource(t){if(null!=t){try{return Po.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Vo=/^\[object .+?Constructor\]$/,Lo=Function.prototype,Do=Object.prototype,Uo=Lo.toString,Fo=Do.hasOwnProperty,Bo=RegExp("^"+Uo.call(Fo).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var qo=function baseIsNative(t){return!(!No(t)||Oo(t))&&(Ro(t)?Bo:Vo).test(xo(t))};var Go=function getValue(t,a){return null==t?void 0:t[a]};var Ho=function getNative(t,a){var c=Go(t,a);return qo(c)?c:void 0},jo=Ho(Object,"create");var Yo=function hashClear(){this.__data__=jo?jo(null):{},this.size=0};var $o=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},Wo=Object.prototype.hasOwnProperty;var zo=function hashGet(t){var a=this.__data__;if(jo){var c=a[t];return"__lodash_hash_undefined__"===c?void 0:c}return Wo.call(a,t)?a[t]:void 0},Ko=Object.prototype.hasOwnProperty;var Qo=function hashHas(t){var a=this.__data__;return jo?void 0!==a[t]:Ko.call(a,t)};var Jo=function hashSet(t,a){var c=this.__data__;return this.size+=this.has(t)?0:1,c[t]=jo&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}Hash.prototype.clear=Yo,Hash.prototype.delete=$o,Hash.prototype.get=zo,Hash.prototype.has=Qo,Hash.prototype.set=Jo;var Xo=Hash;var Zo=function listCacheClear(){this.__data__=[],this.size=0};var es=function eq(t,a){return t===a||t!=t&&a!=a};var ts=function assocIndexOf(t,a){for(var c=t.length;c--;)if(es(t[c][0],a))return c;return-1},rs=Array.prototype.splice;var ns=function listCacheDelete(t){var a=this.__data__,c=ts(a,t);return!(c<0)&&(c==a.length-1?a.pop():rs.call(a,c,1),--this.size,!0)};var as=function listCacheGet(t){var a=this.__data__,c=ts(a,t);return c<0?void 0:a[c][1]};var is=function listCacheHas(t){return ts(this.__data__,t)>-1};var os=function listCacheSet(t,a){var c=this.__data__,m=ts(c,t);return m<0?(++this.size,c.push([t,a])):c[m][1]=a,this};function ListCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}ListCache.prototype.clear=Zo,ListCache.prototype.delete=ns,ListCache.prototype.get=as,ListCache.prototype.has=is,ListCache.prototype.set=os;var ss=ListCache,cs=Ho(po,"Map");var ls=function mapCacheClear(){this.size=0,this.__data__={hash:new Xo,map:new(cs||ss),string:new Xo}};var us=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var ds=function getMapData(t,a){var c=t.__data__;return us(a)?c["string"==typeof a?"string":"hash"]:c.map};var ps=function mapCacheDelete(t){var a=ds(this,t).delete(t);return this.size-=a?1:0,a};var ms=function mapCacheGet(t){return ds(this,t).get(t)};var hs=function mapCacheHas(t){return ds(this,t).has(t)};var gs=function mapCacheSet(t,a){var c=ds(this,t),m=c.size;return c.set(t,a),this.size+=c.size==m?0:1,this};function MapCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}MapCache.prototype.clear=ls,MapCache.prototype.delete=ps,MapCache.prototype.get=ms,MapCache.prototype.has=hs,MapCache.prototype.set=gs;var vs=MapCache;function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var c=arguments,m=a?a.apply(this,c):c[0],h=memoized.cache;if(h.has(m))return h.get(m);var g=t.apply(this,c);return memoized.cache=h.set(m,g)||h,g};return memoized.cache=new(memoize.Cache||vs),memoized}memoize.Cache=vs;var fs=memoize;var ys=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_s=/\\(\\)?/g,Is=function memoizeCapped(t){var a=fs(t,(function(t){return 500===c.size&&c.clear(),t})),c=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(ys,(function(t,c,m,h){a.push(m?h.replace(_s,"$1"):c||t)})),a})),Ms=Is;var Ts=function arrayMap(t,a){for(var c=-1,m=null==t?0:t.length,h=Array(m);++c<m;)h[c]=a(t[c],c,t);return h},Ss=mo?mo.prototype:void 0,Es=Ss?Ss.toString:void 0;var Cs=function baseToString(t){if("string"==typeof t)return t;if(co(t))return Ts(t,baseToString)+"";if(Eo(t))return Es?Es.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var bs=function toString(t){return null==t?"":Cs(t)};var As=function castPath(t,a){return co(t)?t:Ao(t,a)?[t]:Ms(bs(t))};var Ns=function toKey(t){if("string"==typeof t||Eo(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Rs=function baseGet(t,a){for(var c=0,m=(a=As(a,t)).length;null!=t&&c<m;)t=t[Ns(a[c++])];return c&&c==m?t:void 0};var ws=function get(t,a,c){var m=null==t?void 0:Rs(t,a);return void 0===m?c:m},ks=Array,Os=Math.max,arraySliceSimple=function(t,a,c){for(var m=lengthOfArrayLike(t),h=toAbsoluteIndex(a,m),g=toAbsoluteIndex(void 0===c?m:c,m),I=ks(Os(g-h,0)),M=0;h<g;h++,M++)createProperty(I,M,t[h]);return I.length=M,I},Ps=gn.f,xs="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Vs={f:function getOwnPropertyNames(t){return xs&&"Window"==classofRaw(t)?function(t){try{return Ps(t)}catch(t){return arraySliceSimple(xs)}}(t):Ps(toIndexedObject(t))}},Ls={f:wellKnownSymbol},Ds=Ge.f,wellKnownSymbolDefine=function(t){var a=j.Symbol||(j.Symbol={});de(a,t)||Ds(a,t,{value:Ls.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,c=a&&a.valueOf,m=wellKnownSymbol("toPrimitive");a&&!a[m]&&defineBuiltIn(a,m,(function(t){return k(c,this)}),{arity:1})},Us=Zr.forEach,Fs=sharedKey("hidden"),Bs="Symbol",qs=rr.set,Gs=rr.getterFor(Bs),Hs=Object.prototype,js=h.Symbol,Ys=js&&js.prototype,$s=h.TypeError,Ws=h.QObject,zs=Ce.f,Ks=Ge.f,Qs=Vs.f,Js=x.f,Xs=N([].push),Zs=ce("symbols"),ec=ce("op-symbols"),tc=ce("wks"),rc=!Ws||!Ws.prototype||!Ws.prototype.findChild,nc=R&&fails((function(){return 7!=gt(Ks({},"a",{get:function(){return Ks(this,"a",{value:7}).a}})).a}))?function(t,a,c){var m=zs(Hs,a);m&&delete Hs[a],Ks(t,a,c),m&&t!==Hs&&Ks(Hs,a,m)}:Ks,wrap=function(t,a){var c=Zs[t]=gt(Ys);return qs(c,{type:Bs,tag:t,description:a}),R||(c.description=a),c},ac=function defineProperty(t,a,c){t===Hs&&ac(ec,a,c),anObject(t);var m=toPropertyKey(a);return anObject(c),de(Zs,m)?(c.enumerable?(de(t,Fs)&&t[Fs][m]&&(t[Fs][m]=!1),c=gt(c,{enumerable:createPropertyDescriptor(0,!1)})):(de(t,Fs)||Ks(t,Fs,createPropertyDescriptor(1,{})),t[Fs][m]=!0),nc(t,m,c)):Ks(t,m,c)},ic=function defineProperties(t,a){anObject(t);var c=toIndexedObject(a),m=lt(c).concat($getOwnPropertySymbols(c));return Us(m,(function(a){R&&!k(oc,c,a)||ac(t,a,c[a])})),t},oc=function propertyIsEnumerable(t){var a=toPropertyKey(t),c=k(Js,this,a);return!(this===Hs&&de(Zs,a)&&!de(ec,a))&&(!(c||!de(this,a)||!de(Zs,a)||de(this,Fs)&&this[Fs][a])||c)},sc=function getOwnPropertyDescriptor(t,a){var c=toIndexedObject(t),m=toPropertyKey(a);if(c!==Hs||!de(Zs,m)||de(ec,m)){var h=zs(c,m);return!h||!de(Zs,m)||de(c,Fs)&&c[Fs][m]||(h.enumerable=!0),h}},cc=function getOwnPropertyNames(t){var a=Qs(toIndexedObject(t)),c=[];return Us(a,(function(t){de(Zs,t)||de(it,t)||Xs(c,t)})),c},$getOwnPropertySymbols=function(t){var a=t===Hs,c=Qs(a?ec:toIndexedObject(t)),m=[];return Us(c,(function(t){!de(Zs,t)||a&&!de(Hs,t)||Xs(m,Zs[t])})),m};X||(js=function Symbol(){if(Y(Ys,this))throw $s("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString$1(arguments[0]):void 0,a=uid(t),setter=function(t){this===Hs&&k(setter,ec,t),de(this,Fs)&&de(this[Fs],a)&&(this[Fs][a]=!1),nc(this,a,createPropertyDescriptor(1,t))};return R&&rc&&nc(Hs,a,{configurable:!0,set:setter}),wrap(a,t)},Ys=js.prototype,defineBuiltIn(Ys,"toString",(function toString(){return Gs(this).tag})),defineBuiltIn(js,"withoutSetter",(function(t){return wrap(uid(t),t)})),x.f=oc,Ge.f=ac,dt.f=ic,Ce.f=sc,gn.f=Vs.f=cc,Pt.f=$getOwnPropertySymbols,Ls.f=function(t){return wrap(wellKnownSymbol(t),t)},R&&Ks(Ys,"description",{configurable:!0,get:function description(){return Gs(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!X,sham:!X},{Symbol:js}),Us(lt(tc),(function(t){wellKnownSymbolDefine(t)})),_export({target:Bs,stat:!0,forced:!X},{useSetter:function(){rc=!0},useSimple:function(){rc=!1}}),_export({target:"Object",stat:!0,forced:!X,sham:!R},{create:function create(t,a){return void 0===a?gt(t):ic(gt(t),a)},defineProperty:ac,defineProperties:ic,getOwnPropertyDescriptor:sc}),_export({target:"Object",stat:!0,forced:!X},{getOwnPropertyNames:cc}),symbolDefineToPrimitive(),setToStringTag(js,Bs),it[Fs]=!0;var lc=X&&!!Symbol.for&&!!Symbol.keyFor,uc=ce("string-to-symbol-registry"),dc=ce("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!lc},{for:function(t){var a=toString$1(t);if(de(uc,a))return uc[a];var c=getBuiltIn("Symbol")(a);return uc[a]=c,dc[c]=a,c}});var pc=ce("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!lc},{keyFor:function keyFor(t){if(!te(t))throw TypeError(tryToString(t)+" is not a symbol");if(de(pc,t))return pc[t]}});var mc=getBuiltIn("JSON","stringify"),hc=N(/./.exec),gc=N("".charAt),vc=N("".charCodeAt),fc=N("".replace),yc=N(1..toString),_c=/[\uD800-\uDFFF]/g,Ic=/^[\uD800-\uDBFF]$/,Mc=/^[\uDC00-\uDFFF]$/,Tc=!X||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=mc([t])||"{}"!=mc({a:t})||"{}"!=mc(Object(t))})),Sc=fails((function(){return'"\\udf06\\ud834"'!==mc("\udf06\ud834")||'"\\udead"'!==mc("\udead")})),stringifyWithSymbolsFix=function(t,a){var c=Tt(arguments),m=a;if((H(a)||void 0!==t)&&!te(t))return Fr(a)||(a=function(t,a){if(isCallable(m)&&(a=k(m,this,t,a)),!te(a))return a}),c[1]=a,S(mc,null,c)},fixIllFormed=function(t,a,c){var m=gc(c,a-1),h=gc(c,a+1);return hc(Ic,t)&&!hc(Mc,h)||hc(Mc,t)&&!hc(Ic,m)?"\\u"+yc(vc(t,0),16):t};mc&&_export({target:"JSON",stat:!0,arity:3,forced:Tc||Sc},{stringify:function stringify(t,a,c){var m=Tt(arguments),h=S(Tc?stringifyWithSymbolsFix:mc,null,m);return Sc&&"string"==typeof h?fc(h,_c,fixIllFormed):h}});var Ec=!X||fails((function(){Pt.f(1)}));_export({target:"Object",stat:!0,forced:Ec},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=Pt.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(h.JSON,"JSON",!0);var Cc=j.Symbol;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var bc=Cc,Ac=Ls.f("iterator"),Nc=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof bc&&"symbol"==typeof Ac?function(t){return typeof t}:function(t){return t&&"function"==typeof bc&&t.constructor===bc&&t!==bc.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),Rc=fails((function(){dr(1)}));_export({target:"Object",stat:!0,forced:Rc,sham:!sr},{getPrototypeOf:function getPrototypeOf(t){return dr(toObject(t))}});var wc=j.Object.getPrototypeOf,kc=N([].reverse),Oc=[1,2];_export({target:"Array",proto:!0,forced:String(Oc)===String(Oc.reverse())},{reverse:function reverse(){return Fr(this)&&(this.length=this.length),kc(this)}});var Pc=entryVirtual("Array").reverse,xc=Array.prototype,reverse$1=function(t){var a=t.reverse;return t===xc||Y(xc,t)&&a===xc.reverse?Pc:a},Vc=createCommonjsModule((function(t){var a=Nc.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return c},t.exports.__esModule=!0,t.exports.default=t.exports;var c={},m=Object.prototype,h=m.hasOwnProperty,g="function"==typeof bc?bc:{},I=g.iterator||"@@iterator",M=g.asyncIterator||"@@asyncIterator",T=g.toStringTag||"@@toStringTag";function define(t,a,c){return ze(t,a,{value:c,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,c){return t[a]=c}}function wrap(t,a,c,m){var h=a&&a.prototype instanceof Generator?a:Generator,g=ft(h.prototype),I=new Context(m||[]);return g._invoke=function(t,a,c){var m="suspendedStart";return function(h,g){if("executing"===m)throw new Error("Generator is already running");if("completed"===m){if("throw"===h)throw g;return doneResult()}for(c.method=h,c.arg=g;;){var I=c.delegate;if(I){var M=maybeInvokeDelegate(I,c);if(M){if(M===S)continue;return M}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===m)throw m="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);m="executing";var T=tryCatch(t,a,c);if("normal"===T.type){if(m=c.done?"completed":"suspendedYield",T.arg===S)continue;return{value:T.arg,done:c.done}}"throw"===T.type&&(m="completed",c.method="throw",c.arg=T.arg)}}}(t,c,I),g}function tryCatch(t,a,c){try{return{type:"normal",arg:t.call(a,c)}}catch(t){return{type:"throw",arg:t}}}c.wrap=wrap;var S={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var E={};define(E,I,(function(){return this}));var C=wc&&wc(wc(values([])));C&&C!==m&&h.call(C,I)&&(E=C);var b=GeneratorFunctionPrototype.prototype=Generator.prototype=ft(E);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,c){function invoke(m,g,I,M){var T=tryCatch(t[m],t,g);if("throw"!==T.type){var S=T.arg,E=S.value;return E&&"object"==a(E)&&h.call(E,"__await")?c.resolve(E.__await).then((function(t){invoke("next",t,I,M)}),(function(t){invoke("throw",t,I,M)})):c.resolve(E).then((function(t){S.value=t,I(S)}),(function(t){return invoke("throw",t,I,M)}))}M(T.arg)}var m;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new c((function(c,m){invoke(t,a,c,m)}))}return m=m?m.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var c=t.iterator[a.method];if(void 0===c){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return S;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var m=tryCatch(c,t.iterator,a.arg);if("throw"===m.type)return a.method="throw",a.arg=m.arg,a.delegate=null,S;var h=m.arg;return h?h.done?(a[t.resultName]=h.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,S):h:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,S)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[I];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var c=-1,m=function next(){for(;++c<t.length;)if(h.call(t,c))return next.value=t[c],next.done=!1,next;return next.value=void 0,next.done=!0,next};return m.next=m}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(b,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,T,"GeneratorFunction"),c.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},c.mark=function(t){return Mt?Mt(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,T,"GeneratorFunction")),t.prototype=ft(b),t},c.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,M,(function(){return this})),c.AsyncIterator=AsyncIterator,c.async=function(t,a,m,h,g){void 0===g&&(g=Mi);var I=new AsyncIterator(wrap(t,a,m,h),g);return c.isGeneratorFunction(a)?I:I.next().then((function(t){return t.done?t.value:I.next()}))},defineIteratorMethods(b),define(b,T,"Generator"),define(b,I,(function(){return this})),define(b,"toString",(function(){return"[object Generator]"})),c.keys=function(t){var a=[];for(var c in t)a.push(c);return reverse$1(a).call(a),function next(){for(;a.length;){var c=a.pop();if(c in t)return next.value=c,next.done=!1,next}return next.done=!0,next}},c.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var c in this)"t"===c.charAt(0)&&h.call(this,c)&&!isNaN(+slice$1(c).call(c,1))&&(this[c]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(c,m){return g.type="throw",g.arg=t,a.next=c,m&&(a.method="next",a.arg=void 0),!!m}for(var c=this.tryEntries.length-1;c>=0;--c){var m=this.tryEntries[c],g=m.completion;if("root"===m.tryLoc)return handle("end");if(m.tryLoc<=this.prev){var I=h.call(m,"catchLoc"),M=h.call(m,"finallyLoc");if(I&&M){if(this.prev<m.catchLoc)return handle(m.catchLoc,!0);if(this.prev<m.finallyLoc)return handle(m.finallyLoc)}else if(I){if(this.prev<m.catchLoc)return handle(m.catchLoc,!0)}else{if(!M)throw new Error("try statement without catch or finally");if(this.prev<m.finallyLoc)return handle(m.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var c=this.tryEntries.length-1;c>=0;--c){var m=this.tryEntries[c];if(m.tryLoc<=this.prev&&h.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var g=m;break}}g&&("break"===t||"continue"===t)&&g.tryLoc<=a&&a<=g.finallyLoc&&(g=null);var I=g?g.completion:{};return I.type=t,I.arg=a,g?(this.method="next",this.next=g.finallyLoc,S):this.complete(I)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),S},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.finallyLoc===t)return this.complete(c.completion,c.afterLoc),resetTryEntry(c),S}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.tryLoc===t){var m=c.completion;if("throw"===m.type){var h=m.arg;resetTryEntry(c)}return h}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,c){return this.delegate={iterator:values(t),resultName:a,nextLoc:c},"next"===this.method&&(this.arg=void 0),S}},c}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),Lc=Vc(),Dc=Lc;try{regeneratorRuntime=Lc}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Lc:Function("r","regeneratorRuntime = r")(Lc)}j.JSON||(j.JSON={stringify:JSON.stringify});var Uc=function stringify(t,a,c){return S(j.JSON.stringify,null,arguments)},Fc=Uc;function __rest(t,a){var c={};for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&a.indexOf(m)<0&&(c[m]=t[m]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(m=Object.getOwnPropertySymbols(t);h<m.length;h++)a.indexOf(m[h])<0&&Object.prototype.propertyIsEnumerable.call(t,m[h])&&(c[m[h]]=t[m[h]])}return c}function __awaiter(t,a,c,m){return new(c||(c=Promise))((function(h,g){function fulfilled(t){try{step(m.next(t))}catch(t){g(t)}}function rejected(t){try{step(m.throw(t))}catch(t){g(t)}}function step(t){t.done?h(t.value):function adopt(t){return t instanceof c?t:new c((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((m=m.apply(t,a||[])).next())}))}var Bc=Zr.map,qc=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!qc},{map:function map(t){return Bc(this,t,arguments.length>1?arguments[1]:void 0)}});var Gc=entryVirtual("Array").map,Hc=Array.prototype,map$6=function(t){var a=t.map;return t===Hc||Y(Hc,t)&&a===Hc.map?Gc:a};_export({target:"Array",stat:!0},{isArray:Fr});var jc=j.Array.isArray,callWithSafeIterationClosing=function(t,a,c,m){try{return m?a(anObject(c)[0],c[1]):a(c)}catch(a){iteratorClose(t,"throw",a)}},Yc=Array,$c=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:$c},{from:function from(t){var a=toObject(t),c=Kr(this),m=arguments.length,h=m>1?arguments[1]:void 0,g=void 0!==h;g&&(h=functionBindContext(h,m>2?arguments[2]:void 0));var I,M,T,S,E,C,b=getIteratorMethod$5(a),A=0;if(!b||this===Yc&&isArrayIteratorMethod(b))for(I=lengthOfArrayLike(a),M=c?new this(I):Yc(I);I>A;A++)C=g?h(a[A],A):a[A],createProperty(M,A,C);else for(E=(S=getIterator(a,b)).next,M=c?new this:[];!(T=k(E,S)).done;A++)C=g?callWithSafeIterationClosing(S,h,[T.value,A],!0):T.value,createProperty(M,A,C);return M.length=A,M}});var Wc=j.Array.from,zc=getIteratorMethod$5;var Kc=function isUndefined(t){return void 0===t},Qc=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Jc=Object.isExtensible,Xc=fails((function(){Jc(1)}))||Qc?function isExtensible(t){return!!H(t)&&((!Qc||"ArrayBuffer"!=classofRaw(t))&&(!Jc||Jc(t)))}:Jc,Zc=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),el=createCommonjsModule((function(t){var a=Ge.f,c=!1,m=uid("meta"),h=0,setMetadata=function(t){a(t,m,{value:{objectID:"O"+h++,weakData:{}}})},g=t.exports={enable:function(){g.enable=function(){},c=!0;var t=gn.f,a=N([].splice),h={};h[m]=1,t(h).length&&(gn.f=function(c){for(var h=t(c),g=0,I=h.length;g<I;g++)if(h[g]===m){a(h,g,1);break}return h},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Vs.f}))},fastKey:function(t,a){if(!H(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!de(t,m)){if(!Xc(t))return"F";if(!a)return"E";setMetadata(t)}return t[m].objectID},getWeakData:function(t,a){if(!de(t,m)){if(!Xc(t))return!0;if(!a)return!1;setMetadata(t)}return t[m].weakData},onFreeze:function(t){return Zc&&c&&Xc(t)&&!de(t,m)&&setMetadata(t),t}};it[m]=!0})),tl=Ge.f,rl=Zr.forEach,nl=rr.set,al=rr.getterFor,collection=function(t,a,c){var m,g=-1!==t.indexOf("Map"),I=-1!==t.indexOf("Weak"),M=g?"set":"add",T=h[t],S=T&&T.prototype,E={};if(R&&isCallable(T)&&(I||S.forEach&&!fails((function(){(new T).entries().next()})))){var C=(m=a((function(a,c){nl(anInstance(a,C),{type:t,collection:new T}),null!=c&&iterate(c,a[M],{that:a,AS_ENTRIES:g})}))).prototype,b=al(t);rl(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in S)||I&&"clear"==t||He(C,t,(function(c,m){var h=b(this).collection;if(!a&&I&&!H(c))return"get"==t&&void 0;var g=h[t](0===c?0:c,m);return a?this:g}))})),I||tl(C,"size",{configurable:!0,get:function(){return b(this).collection.size}})}else m=c.getConstructor(a,t,g,M),el.enable();return setToStringTag(m,t,!1,!0),E[t]=m,_export({global:!0,forced:!0},E),I||c.setStrong(m,t,g),m},defineBuiltIns=function(t,a,c){for(var m in a)c&&c.unsafe&&t[m]?t[m]=a[m]:defineBuiltIn(t,m,a[m],c);return t},il=Ge.f,ol=el.fastKey,sl=rr.set,cl=rr.getterFor,ll={getConstructor:function(t,a,c,m){var h=t((function(t,h){anInstance(t,g),sl(t,{type:a,index:gt(null),first:void 0,last:void 0,size:0}),R||(t.size=0),isNullOrUndefined(h)||iterate(h,t[m],{that:t,AS_ENTRIES:c})})),g=h.prototype,I=cl(a),define=function(t,a,c){var m,h,g=I(t),M=getEntry(t,a);return M?M.value=c:(g.last=M={index:h=ol(a,!0),key:a,value:c,previous:m=g.last,next:void 0,removed:!1},g.first||(g.first=M),m&&(m.next=M),R?g.size++:t.size++,"F"!==h&&(g.index[h]=M)),t},getEntry=function(t,a){var c,m=I(t),h=ol(a);if("F"!==h)return m.index[h];for(c=m.first;c;c=c.next)if(c.key==a)return c};return defineBuiltIns(g,{clear:function clear(){for(var t=I(this),a=t.index,c=t.first;c;)c.removed=!0,c.previous&&(c.previous=c.previous.next=void 0),delete a[c.index],c=c.next;t.first=t.last=void 0,R?t.size=0:this.size=0},delete:function(t){var a=this,c=I(a),m=getEntry(a,t);if(m){var h=m.next,g=m.previous;delete c.index[m.index],m.removed=!0,g&&(g.next=h),h&&(h.previous=g),c.first==m&&(c.first=h),c.last==m&&(c.last=g),R?c.size--:a.size--}return!!m},forEach:function forEach(t){for(var a,c=I(this),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:c.first;)for(m(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(g,c?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),R&&il(g,"size",{get:function(){return I(this).size}}),h},setStrong:function(t,a,c){var m=a+" Iterator",h=cl(a),g=cl(m);iteratorDefine(t,a,(function(t,a){sl(this,{type:m,target:t,state:h(t),kind:a,last:void 0})}),(function(){for(var t=g(this),a=t.kind,c=t.last;c&&c.removed;)c=c.previous;return t.target&&(t.last=c=c?c.next:t.state.first)?"keys"==a?{value:c.key,done:!1}:"values"==a?{value:c.value,done:!1}:{value:[c.key,c.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),c?"entries":"values",!c,!0),setSpecies(a)}};collection("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),ll);var ul=j.Map,dl=[].push,pl=function from(t){var a,c,m,h,g=arguments.length,I=g>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==I)&&aCallable(I),isNullOrUndefined(t)?new this:(c=[],a?(m=0,h=functionBindContext(I,g>2?arguments[2]:void 0),iterate(t,(function(t){k(dl,c,h(t,m++))}))):iterate(t,dl,{that:c}),new this(c))};_export({target:"Map",stat:!0,forced:!0},{from:pl});var ml=function of(){return new this(Tt(arguments))};_export({target:"Map",stat:!0,forced:!0},{of:ml});var hl=function deleteAll(){for(var t,a=anObject(this),c=aCallable(a.delete),m=!0,h=0,g=arguments.length;h<g;h++)t=k(c,a,arguments[h]),m=m&&t;return!!m};_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:hl});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var c,m,h=anObject(this),g=aCallable(h.get),I=aCallable(h.has),M=aCallable(h.set);return k(I,h,t)?(c=k(g,h,t),"update"in a&&(c=a.update(c,t,h),k(M,h,t,c)),c):(m=a.insert(t,h),k(M,h,t,m),m)}});var gl=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c,h){if(!m(c,t,a))return h()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(h.set);return iterate(c,(function(t,c){m(c,t,a)&&k(g,h,t,c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,h){if(m(c,t,a))return h(c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,h){if(m(c,t,a))return h(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var vl=N([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var c=getIterator(t),m=new this,h=aCallable(m.has),g=aCallable(m.get),I=aCallable(m.set);return iterate(c,(function(t){var c=a(t);k(h,m,c)?vl(k(g,m,c),t):k(I,m,c,[t])}),{IS_ITERATOR:!0}),m}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(gl(anObject(this)),(function(a,c,m){if((h=c)===(g=t)||h!=h&&g!=g)return m();var h,g}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var c=new this;aCallable(a);var m=aCallable(c.set);return iterate(t,(function(t){k(m,c,a(t),t)})),c}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(gl(anObject(this)),(function(a,c,m){if(c===t)return m(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(h.set);return iterate(c,(function(t,c){k(g,h,m(c,t,a),c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(h.set);return iterate(c,(function(t,c){k(g,h,t,m(c,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),c=aCallable(a.set),m=arguments.length,h=0;h<m;)iterate(arguments[h++],c,{that:a,AS_ENTRIES:!0});return a}});var fl=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=gl(a),m=arguments.length<2,h=m?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c,g){m?(m=!1,h=g):h=t(h,g,c,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m)throw fl("Reduce of empty map with no initial value");return h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=gl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,h){if(m(c,t,a))return h()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var yl=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var c=anObject(this),m=aCallable(c.get),h=aCallable(c.has),g=aCallable(c.set),I=arguments.length;aCallable(a);var M=k(h,c,t);if(!M&&I<3)throw yl("Updating absent value");var T=M?k(m,c,t):aCallable(I>2?arguments[2]:void 0)(t,c);return k(g,c,t,a(T,t,c)),c}});var _l=TypeError,Il=function upsert(t,a){var c,m=anObject(this),h=aCallable(m.get),g=aCallable(m.has),I=aCallable(m.set),M=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(M))throw _l("At least one callback required");return k(g,m,t)?(c=k(h,m,t),isCallable(a)&&(c=a(c),k(I,m,t,c))):isCallable(M)&&(c=M(),k(I,m,t,c)),c};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:Il}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:Il});var Ml=ul,Tl=createCommonjsModule((function(t){function _getPrototypeOf(a){var c;return t.exports=_getPrototypeOf=Mt?bind$1(c=wc).call(c):function _getPrototypeOf(t){return t.__proto__||wc(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Sl=at.indexOf,El=N([].indexOf),Cl=!!El&&1/El([1],1,-0)<0,bl=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:Cl||!bl},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return Cl?El(this,t,a)||0:Sl(this,t,a)}});var Al=entryVirtual("Array").indexOf,Nl=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===Nl||Y(Nl,t)&&a===Nl.indexOf?Al:a},Rl=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),wl=getBuiltIn("Reflect","construct"),kl=Object.prototype,Ol=[].push,Pl=fails((function(){function F(){}return!(wl((function(){}),[],F)instanceof F)})),xl=!fails((function(){wl((function(){}))})),Vl=Pl||xl;_export({target:"Reflect",stat:!0,forced:Vl,sham:Vl},{construct:function construct(t,a){aConstructor(t),anObject(a);var c=arguments.length<3?t:aConstructor(arguments[2]);if(xl&&!Pl)return wl(t,a,c);if(t==c){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var m=[null];return S(Ol,m,a),new(S(At,t,m))}var h=c.prototype,g=gt(H(h)?h:kl),I=S(t,g,a);return H(I)?I:g}});var Ll=j.Reflect.construct,Dl=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Ll)return!1;if(Ll.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Ll(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),Ul=createCommonjsModule((function(t){function _construct(a,c,m){var h;Dl()?(t.exports=_construct=bind$1(h=Ll).call(h),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,c){var m=[null];m.push.apply(m,a);var h=new(bind$1(Function).apply(t,m));return c&&wt(h,c.prototype),h},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),Fl=createCommonjsModule((function(t){function _wrapNativeSuper(a){var c="function"==typeof Ml?new Ml:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!Rl(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(t))return c.get(t);c.set(t,Wrapper)}function Wrapper(){return Ul(t,arguments,Tl(this).constructor)}return Wrapper.prototype=ft(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),wt(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),Bl=getDefaultExportFromCjs(Fl),ql=TypeError,createMethod$1=function(t){return function(a,c,m,h){aCallable(c);var g=toObject(a),I=B(g),M=lengthOfArrayLike(g),T=t?M-1:0,S=t?-1:1;if(m<2)for(;;){if(T in I){h=I[T],T+=S;break}if(T+=S,t?T<0:M<=T)throw ql("Reduce of empty array with no initial value")}for(;t?T>=0:M>T;T+=S)T in I&&(h=c(h,I[T],T,g));return h}},Gl={left:createMethod$1(!1),right:createMethod$1(!0)}.left,Hl=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!Hl||!Bn&&J>79&&J<83},{reduce:function reduce(t){var a=arguments.length;return Gl(this,t,a,a>1?arguments[1]:void 0)}});var jl,Yl,$l,Wl,zl,Kl,Ql,Jl,Xl,Zl,eu,tu,ru,nu,au,iu,ou,su,cu,lu,uu,du,pu,mu,hu,gu,vu,fu,yu,_u,Iu,Mu,Tu,Su,Eu,Cu,bu,Au,Nu,Ru,wu,ku,Ou,Pu,xu,Vu,Lu,Du,Uu=entryVirtual("Array").reduce,Fu=Array.prototype,reduce=function(t){var a=t.reduce;return t===Fu||Y(Fu,t)&&a===Fu.reduce?Uu:a};!function(t){t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(jl||(jl={})),function(t){t[t.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",t[t.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",t[t.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Yl||(Yl={})),function(t){t[t.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",t[t.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",t[t.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}($l||($l={})),function(t){t[t.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",t[t.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",t[t.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",t[t.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(Wl||(Wl={})),function(t){t[t.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",t[t.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",t[t.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(zl||(zl={})),function(t){t[t.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",t[t.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(Kl||(Kl={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(Ql||(Ql={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Jl||(Jl={})),function(t){t[t.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",t[t.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(Xl||(Xl={})),function(t){t[t.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",t[t.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",t[t.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",t[t.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(Zl||(Zl={})),function(t){t[t.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",t[t.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",t[t.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(eu||(eu={})),function(t){t[t.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",t[t.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",t[t.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",t[t.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(tu||(tu={})),function(t){t[t.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",t[t.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",t[t.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",t[t.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",t[t.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",t[t.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",t[t.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",t[t.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",t[t.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(ru||(ru={})),function(t){t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",t[t.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(nu||(nu={})),function(t){t[t.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(au||(au={})),function(t){t[t.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",t[t.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(iu||(iu={})),function(t){t[t.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",t[t.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",t[t.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(ou||(ou={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(su||(su={})),function(t){t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(cu||(cu={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(lu||(lu={})),function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(uu||(uu={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(du||(du={})),function(t){t[t.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(pu||(pu={})),function(t){t[t.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(mu||(mu={})),function(t){t[t.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",t[t.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(hu||(hu={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(gu||(gu={})),function(t){t[t.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",t[t.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(vu||(vu={})),function(t){t[t.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",t[t.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",t[t.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",t[t.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",t[t.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",t[t.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",t[t.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",t[t.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(fu||(fu={})),function(t){t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(yu||(yu={})),function(t){t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(_u||(_u={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(Iu||(Iu={})),function(t){t[t.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",t[t.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",t[t.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(Mu||(Mu={})),function(t){t[t.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",t[t.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",t[t.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(Tu||(Tu={})),function(t){t[t.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",t[t.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(Su||(Su={})),function(t){t[t.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",t[t.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(Eu||(Eu={})),function(t){t[t.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(Cu||(Cu={})),function(t){t[t.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(bu||(bu={})),function(t){t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(Au||(Au={})),function(t){t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL=0]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER=1]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE=2]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE"}(Nu||(Nu={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",t[t.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(Ru||(Ru={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(wu||(wu={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(ku||(ku={})),function(t){t[t.teamApply=0]="teamApply",t[t.teamApplyReject=1]="teamApplyReject",t[t.teamInvite=2]="teamInvite",t[t.teamInviteReject=3]="teamInviteReject",t[t.tlistUpdate=4]="tlistUpdate",t[t.superTeamApply=15]="superTeamApply",t[t.superTeamApplyReject=16]="superTeamApplyReject",t[t.superTeamInvite=17]="superTeamInvite",t[t.superTeamInviteReject=18]="superTeamInviteReject"}(Ou||(Ou={})),function(t){t[t.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",t[t.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",t[t.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",t[t.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(Pu||(Pu={})),function(t){t.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",t.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",t.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(xu||(xu={})),function(t){t[t.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",t[t.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",t[t.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",t[t.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(Vu||(Vu={})),function(t){t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(Lu||(Lu={})),function(t){t[t.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",t[t.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",t[t.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",t[t.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(Du||(Du={}));var Bu={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failedï¼use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},qu=mn(Bu),Gu=reduce(qu).call(qu,(function(t,a){var c=Bu[a];return t[a]=c.code,t}),{}),Hu=reduce(qu).call(qu,(function(t,a){var c=Bu[a];return t[c.code]=c.message,t}),{}),ju=Object.freeze({__proto__:null,V2NIMErrorCode:Gu,V2NIMErrorDesc:Hu,get V2NIMDataSyncLevel(){return jl},get V2NIMDataSyncType(){return Yl},get V2NIMDataSyncState(){return $l},get V2NIMConversationType(){return Wl},get V2NIMLastMessageState(){return zl},get V2NIMFriendAddMode(){return Kl},get V2NIMFriendAddApplicationType(){return Ql},get V2NIMFriendAddApplicationStatus(){return Jl},get V2NIMFriendDeletionType(){return Xl},get V2NIMFriendVerifyType(){return Zl},get V2NIMLoginAuthType(){return eu},get V2NIMLoginStatus(){return tu},get V2NIMLoginClientType(){return ru},get V2NIMKickedOfflineReason(){return nu},get V2NIMLoginClientChange(){return au},get V2NIMConnectStatus(){return iu},get V2NIMMessageType(){return su},get V2NIMMessageNotificationType(){return cu},get V2NIMMessageAttachmentUploadState(){return lu},get V2NIMMessageSendingState(){return uu},get V2NIMQueryDirection(){return du},get V2NIMMessageRevokeType(){return pu},get V2NIMMessagePinState(){return mu},get V2NIMMessageQuickCommentType(){return hu},get V2NIMClientAntispamOperateType(){return gu},get V2NIMSortOrder(){return vu},get V2NIMSystemMessageType(){return fu},get V2NIMTeamMessageMuteMode(){return yu},get V2NIMP2PMessageMuteMode(){return _u},get V2NIMTeamMemberRoleQueryType(){return Iu},get V2NIMTeamType(){return Mu},get V2NIMTeamJoinMode(){return Tu},get V2NIMTeamAgreeMode(){return Su},get V2NIMTeamInviteMode(){return Eu},get V2NIMTeamUpdateInfoMode(){return Cu},get V2NIMTeamChatBannedMode(){return bu},get V2NIMTeamUpdateExtensionMode(){return Au},get V2NIMTeamMessageNotifyMode(){return Nu},get V2NIMTeamJoinActionType(){return wu},get V2NIMTeamJoinActionStatus(){return ku},get V2NIMTeamNotificationType(){return Ou},get V2NIMTeamMemberRole(){return Ru},get V2NIMAIModelRoleType(){return xu},get V2NIMAIModelType(){return Pu},get V2NIMSignallingChannelType(){return Lu},get V2NIMSignallingEventType(){return Vu},get V2NIMUserStatusType(){return Du}}),Yu=function(t){function V2NIMErrorImpl(a){var c;return(c=t.call(this,a.desc)||this).name="V2NIMError",c.code=a.code||0,c.desc=a.desc||Hu[c.code]||Ju[c.code]||"",c.message=c.desc,c.detail=a.detail||{},c}return kt(V2NIMErrorImpl,t),V2NIMErrorImpl.prototype.toString=function toString(){var t,a=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?Fc(this.detail):"");return(null===(t=null==this?void 0:this.detail)||void 0===t?void 0:t.rawError)&&(a+="\n rawError: "+this.detail.rawError.message),a},V2NIMErrorImpl}(Bl(Error));var $u=function(t){function ValidateError(a,c,m){var h;return void 0===c&&(c={}),(h=t.call(this,{code:Gu.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:a,rules:m,data:c}})||this).name="validateError",h.message=h.message+"\n"+Fc(h.detail,null,2),h.data=c,h.rules=m,h}return kt(ValidateError,t),ValidateError}(Yu),Wu=function(t){function ValidateErrorV2(a){var c,m,h,g;return(c=t.call(this,{code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(m=a.detail)||void 0===m?void 0:m.reason,rules:null===(h=a.detail)||void 0===h?void 0:h.rules,data:null===(g=a.detail)||void 0===g?void 0:g.data}})||this).name="ValidateErrorV2",c}return kt(ValidateErrorV2,t),ValidateErrorV2}(Yu),zu=function(t){function FormatError(a,c,m){var h;return(h=t.call(this,{code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:a,key:c,rules:m}})||this).name="formatError",h}return kt(FormatError,t),FormatError}(Yu),Ku=function(t){function UploadError(a){var c;return(c=t.call(this,qt({code:400},a))||this).desc=c.desc||"upload file error",c.message=c.desc,c.name="uploadError",c}return kt(UploadError,t),UploadError}(Yu),Qu=function(t){function CustomError(a,c,m){var h;return void 0===c&&(c={}),void 0===m&&(m=400),(h=t.call(this,{code:m,desc:a,detail:c})||this).name="customError",h.data=c,h}return kt(CustomError,t),CustomError}(Yu),Ju={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};var Xu=function stackClear(){this.__data__=new ss,this.size=0};var Zu=function stackDelete(t){var a=this.__data__,c=a.delete(t);return this.size=a.size,c};var ed=function stackGet(t){return this.__data__.get(t)};var td=function stackHas(t){return this.__data__.has(t)};var rd=function stackSet(t,a){var c=this.__data__;if(c instanceof ss){var m=c.__data__;if(!cs||m.length<199)return m.push([t,a]),this.size=++c.size,this;c=this.__data__=new vs(m)}return c.set(t,a),this.size=c.size,this};function Stack(t){var a=this.__data__=new ss(t);this.size=a.size}Stack.prototype.clear=Xu,Stack.prototype.delete=Zu,Stack.prototype.get=ed,Stack.prototype.has=td,Stack.prototype.set=rd;var nd=Stack,ad=function(){try{var t=Ho(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var id=function baseAssignValue(t,a,c){"__proto__"==a&&ad?ad(t,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):t[a]=c};var od=function assignMergeValue(t,a,c){(void 0!==c&&!es(t[a],c)||void 0===c&&!(a in t))&&id(t,a,c)};var sd=function createBaseFor(t){return function(a,c,m){for(var h=-1,g=Object(a),I=m(a),M=I.length;M--;){var T=I[t?M:++h];if(!1===c(g[T],T,g))break}return a}}(),cd=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,m=c&&t&&!t.nodeType&&t,h=m&&m.exports===c?po.Buffer:void 0,g=h?h.allocUnsafe:void 0;t.exports=function cloneBuffer(t,a){if(a)return t.slice();var c=t.length,m=g?g(c):new t.constructor(c);return t.copy(m),m}})),ld=po.Uint8Array;var ud=function cloneArrayBuffer(t){var a=new t.constructor(t.byteLength);return new ld(a).set(new ld(t)),a};var dd=function cloneTypedArray(t,a){var c=a?ud(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.length)};var pd=function copyArray(t,a){var c=-1,m=t.length;for(a||(a=Array(m));++c<m;)a[c]=t[c];return a},md=Object.create,hd=function(){function object(){}return function(t){if(!No(t))return{};if(md)return md(t);object.prototype=t;var a=new object;return object.prototype=void 0,a}}();var gd=function overArg(t,a){return function(c){return t(a(c))}},vd=gd(Object.getPrototypeOf,Object),fd=Object.prototype;var yd=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||fd)};var _d=function initCloneObject(t){return"function"!=typeof t.constructor||yd(t)?{}:hd(vd(t))};var Id=function baseIsArguments(t){return So(t)&&"[object Arguments]"==To(t)},Md=Object.prototype,Td=Md.hasOwnProperty,Sd=Md.propertyIsEnumerable,Ed=Id(function(){return arguments}())?Id:function(t){return So(t)&&Td.call(t,"callee")&&!Sd.call(t,"callee")},Cd=Ed;var bd=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var Ad=function isArrayLike(t){return null!=t&&bd(t.length)&&!Ro(t)};var Nd=function isArrayLikeObject(t){return So(t)&&Ad(t)};var Rd=function stubFalse(){return!1},wd=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,m=c&&t&&!t.nodeType&&t,h=m&&m.exports===c?po.Buffer:void 0,g=(h?h.isBuffer:void 0)||Rd;t.exports=g})),kd=Function.prototype,Od=Object.prototype,Pd=kd.toString,xd=Od.hasOwnProperty,Vd=Pd.call(Object);var Ld=function isPlainObject(t){if(!So(t)||"[object Object]"!=To(t))return!1;var a=vd(t);if(null===a)return!0;var c=xd.call(a,"constructor")&&a.constructor;return"function"==typeof c&&c instanceof c&&Pd.call(c)==Vd},Dd={};Dd["[object Float32Array]"]=Dd["[object Float64Array]"]=Dd["[object Int8Array]"]=Dd["[object Int16Array]"]=Dd["[object Int32Array]"]=Dd["[object Uint8Array]"]=Dd["[object Uint8ClampedArray]"]=Dd["[object Uint16Array]"]=Dd["[object Uint32Array]"]=!0,Dd["[object Arguments]"]=Dd["[object Array]"]=Dd["[object ArrayBuffer]"]=Dd["[object Boolean]"]=Dd["[object DataView]"]=Dd["[object Date]"]=Dd["[object Error]"]=Dd["[object Function]"]=Dd["[object Map]"]=Dd["[object Number]"]=Dd["[object Object]"]=Dd["[object RegExp]"]=Dd["[object Set]"]=Dd["[object String]"]=Dd["[object WeakMap]"]=!1;var Ud=function baseIsTypedArray(t){return So(t)&&bd(t.length)&&!!Dd[To(t)]};var Fd=function baseUnary(t){return function(a){return t(a)}},Bd=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,m=c&&t&&!t.nodeType&&t,h=m&&m.exports===c&&lo.process,g=function(){try{var t=m&&m.require&&m.require("util").types;return t||h&&h.binding&&h.binding("util")}catch(t){}}();t.exports=g})),qd=Bd&&Bd.isTypedArray,Gd=qd?Fd(qd):Ud;var Hd=function safeGet(t,a){if(("constructor"!==a||"function"!=typeof t[a])&&"__proto__"!=a)return t[a]},jd=Object.prototype.hasOwnProperty;var Yd=function assignValue(t,a,c){var m=t[a];jd.call(t,a)&&es(m,c)&&(void 0!==c||a in t)||id(t,a,c)};var $d=function copyObject(t,a,c,m){var h=!c;c||(c={});for(var g=-1,I=a.length;++g<I;){var M=a[g],T=m?m(c[M],t[M],M,c,t):void 0;void 0===T&&(T=t[M]),h?id(c,M,T):Yd(c,M,T)}return c};var Wd=function baseTimes(t,a){for(var c=-1,m=Array(t);++c<t;)m[c]=a(c);return m},zd=/^(?:0|[1-9]\d*)$/;var Kd=function isIndex(t,a){var c=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==c||"symbol"!=c&&zd.test(t))&&t>-1&&t%1==0&&t<a},Qd=Object.prototype.hasOwnProperty;var Jd=function arrayLikeKeys(t,a){var c=co(t),m=!c&&Cd(t),h=!c&&!m&&wd(t),g=!c&&!m&&!h&&Gd(t),I=c||m||h||g,M=I?Wd(t.length,String):[],T=M.length;for(var S in t)!a&&!Qd.call(t,S)||I&&("length"==S||h&&("offset"==S||"parent"==S)||g&&("buffer"==S||"byteLength"==S||"byteOffset"==S)||Kd(S,T))||M.push(S);return M};var Xd=function nativeKeysIn(t){var a=[];if(null!=t)for(var c in Object(t))a.push(c);return a},Zd=Object.prototype.hasOwnProperty;var ep=function baseKeysIn(t){if(!No(t))return Xd(t);var a=yd(t),c=[];for(var m in t)("constructor"!=m||!a&&Zd.call(t,m))&&c.push(m);return c};var tp=function keysIn(t){return Ad(t)?Jd(t,!0):ep(t)};var rp=function toPlainObject(t){return $d(t,tp(t))};var np=function baseMergeDeep(t,a,c,m,h,g,I){var M=Hd(t,c),T=Hd(a,c),S=I.get(T);if(S)od(t,c,S);else{var E=g?g(M,T,c+"",t,a,I):void 0,C=void 0===E;if(C){var b=co(T),A=!b&&wd(T),N=!b&&!A&&Gd(T);E=T,b||A||N?co(M)?E=M:Nd(M)?E=pd(M):A?(C=!1,E=cd(T,!0)):N?(C=!1,E=dd(T,!0)):E=[]:Ld(T)||Cd(T)?(E=M,Cd(M)?E=rp(M):No(M)&&!Ro(M)||(E=_d(T))):C=!1}C&&(I.set(T,E),h(E,T,m,g,I),I.delete(T)),od(t,c,E)}};var ap=function baseMerge(t,a,c,m,h){t!==a&&sd(a,(function(g,I){if(h||(h=new nd),No(g))np(t,a,I,c,baseMerge,m,h);else{var M=m?m(Hd(t,I),g,I+"",t,a,h):void 0;void 0===M&&(M=g),od(t,I,M)}}),tp)};var ip=function identity(t){return t};var op=function apply(t,a,c){switch(c.length){case 0:return t.call(a);case 1:return t.call(a,c[0]);case 2:return t.call(a,c[0],c[1]);case 3:return t.call(a,c[0],c[1],c[2])}return t.apply(a,c)},sp=Math.max;var cp=function overRest(t,a,c){return a=sp(void 0===a?t.length-1:a,0),function(){for(var m=arguments,h=-1,g=sp(m.length-a,0),I=Array(g);++h<g;)I[h]=m[a+h];h=-1;for(var M=Array(a+1);++h<a;)M[h]=m[h];return M[a]=c(I),op(t,this,M)}};var lp=function constant(t){return function(){return t}},up=ad?function(t,a){return ad(t,"toString",{configurable:!0,enumerable:!1,value:lp(a),writable:!0})}:ip,dp=Date.now;var pp=function shortOut(t){var a=0,c=0;return function(){var m=dp(),h=16-(m-c);if(c=m,h>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}},mp=pp(up);var hp=function baseRest(t,a){return mp(cp(t,a,ip),t+"")};var gp=function isIterateeCall(t,a,c){if(!No(c))return!1;var m=typeof a;return!!("number"==m?Ad(c)&&Kd(a,c.length):"string"==m&&a in c)&&es(c[a],t)};var vp=function createAssigner(t){return hp((function(a,c){var m=-1,h=c.length,g=h>1?c[h-1]:void 0,I=h>2?c[2]:void 0;for(g=t.length>3&&"function"==typeof g?(h--,g):void 0,I&&gp(c[0],c[1],I)&&(g=h<3?void 0:g,h=1),a=Object(a);++m<h;){var M=c[m];M&&t(a,M,m,g)}return a}))},fp=vp((function(t,a,c){ap(t,a,c)})),yp=Zr.some,_p=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!_p},{some:function some(t){return yp(this,t,arguments.length>1?arguments[1]:void 0)}});var Ip,Mp,Tp=entryVirtual("Array").some,Sp=Array.prototype,some=function(t){var a=t.some;return t===Sp||Y(Sp,t)&&a===Sp.some?Tp:a};!function(t){t[t.Unset=0]="Unset",t[t.RN=2]="RN",t[t.UNIAPP=3]="UNIAPP",t[t.Electron=5]="Electron",t[t.WeiXin=6]="WeiXin",t[t.BROWSER=100]="BROWSER",t[t.H5=101]="H5",t[t.Ali=102]="Ali",t[t.Baidu=103]="Baidu",t[t.Tiktok=104]="Tiktok"}(Ip||(Ip={})),function(t){t[t.kStatNetTypeUnkonw=0]="kStatNetTypeUnkonw",t[t.kStatNetTypeEthernet=1]="kStatNetTypeEthernet",t[t.kStatNetTypeWifi=2]="kStatNetTypeWifi",t[t.kStatNetType2G=3]="kStatNetType2G",t[t.kStatNetType3G=4]="kStatNetType3G",t[t.kStatNetType4G=5]="kStatNetType4G",t[t.kStatNetType5G=6]="kStatNetType5G"}(Mp||(Mp={}));var Ep={wifi:Mp.kStatNetTypeWifi,"2g":Mp.kStatNetType2G,"3g":Mp.kStatNetType3G,"4g":Mp.kStatNetType4G,"5g":Mp.kStatNetType5G,ethernet:Mp.kStatNetTypeEthernet,unknown:Mp.kStatNetTypeUnkonw,none:Mp.kStatNetTypeUnkonw,notreachable:Mp.kStatNetTypeUnkonw,wwan:Mp.kStatNetTypeUnkonw};function isMobile(){if(!navigator||!navigator.userAgent)return!1;var t=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return some(t).call(t,(function(t){return navigator.userAgent.match(t)}))}function isElectron(){var t;return!(!navigator||!navigator.userAgent)&&("object"==typeof navigator&&"string"==typeof navigator.userAgent&&indexOf(t=navigator.userAgent).call(t,"Electron")>=0)}function isBrowser(){return navigator&&navigator.userAgent}var Cp={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")},getFileUploadInformation:function getFileUploadInformation(t){throw new Error("Function not implemented.")},net:{__getEnv:function __getEnv(){return null},__onNetworkStatusChangeFn:null,getNetworkStatus:function getNetworkStatus(){var t=this.__getEnv();return new Mi((function(a,c){t.getNetworkType({success:function success(t){var c=!1;c="boolean"==typeof t.networkAvailable?t.networkAvailable:"none"!==t.networkType.toLowerCase(),a({net_type:Ep[t.networkType.toLowerCase()],net_connect:c})},fail:function fail(){c(new Error("getNetworkType failed"))}})}))},onNetworkStatusChange:function onNetworkStatusChange(t){var a=this.__getEnv();this.offNetworkStatusChange(),a.onNetworkStatusChange&&(this.__onNetworkStatusChangeFn=function(a){var c=a.networkType.toLowerCase();t({isConnected:a.isConnected||"none"!==c,networkType:Ep[c]})},a.onNetworkStatusChange(this.__onNetworkStatusChangeFn))},offNetworkStatusChange:function offNetworkStatusChange(){var t=this.__getEnv();t.offNetworkStatusChange&&(this.__onNetworkStatusChangeFn&&t.offNetworkStatusChange(this.__onNetworkStatusChangeFn),this.__onNetworkStatusChangeFn=null)}}};function getPromiseWithAbort(t){var a={},c=new Mi((function(t,c){a.abort=c}));return a.promise=Mi.race([t,c]),a}Mi.reject;var bp=function(){function PromiseManager(){this.abortFns=[]}var t=PromiseManager.prototype;return t.add=function add(t){var a=getPromiseWithAbort(t);return this.abortFns.push(a.abort),a.promise},t.clear=function clear(t){var a;forEach$1(a=this.abortFns).call(a,(function(a){return a(t||new Yu({code:Gu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function destroy(){this.clear()},PromiseManager}(),Ap={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},Np={timestamp:0,rtt:0,baseClock:0,baseTime:0},Rp=function(){function TimeOrigin(t,a,c){void 0===c&&(c="getServerTime"),this.serverOrigin=Np,this.config=Ap,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=t,this.logger=t.logger,this.promiseManager=new bp,this.cmdName=c,a&&this.setOptions(a)}var t=TimeOrigin.prototype;return t.setOptions=function setOptions(t){this.config=qt({},Ap,this.config,t)},t.reset=function reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=Np,this.currentChance=0},t.setOriginTimetick=function setOriginTimetick(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t,a,c,m,h,g,I,M,T,S;return Dc.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:if(this.config.enable){E.next=2;break}return E.abrupt("return");case 2:if(!this.isSettingNTP){E.next=4;break}return E.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){E.next=6;break}return E.abrupt("return");case 6:if(t=ws(this.core,"auth.status"),a=ws(this.core,"status"),c=ws(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===a||c===tu.V2NIM_LOGIN_STATUS_LOGINED){E.next=11;break}return E.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,m="TimeOrigin::setOriginTimetick:",h=wi(),this.core.logger.log(m+" getServerTime start, times "+this.currentChance),E.prev=18,E.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:I=E.sent,g=ws(I,"content.time"),this.isSettingNTP=!1,E.next=33;break;case 26:return E.prev=26,E.t0=E.catch(18),M=E.t0,this.isSettingNTP=!1,this.logger.warn(m+" Calculate Delay time, getServerTime error",M),M.code!==Gu.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=Gi(bind$1(T=this.setOriginTimetick).call(T,this),this.failedDelay)),E.abrupt("return");case 33:if(g){E.next=37;break}return this.core.logger.warn(m+" Calculate Delay time incorrect format"),this.config.enable=!1,E.abrupt("return");case 37:S=wi()-h,this.doSet(g,S);case 39:case"end":return E.stop()}}),_callee,this,[[18,26]])})))},t.doSet=function doSet(t,a){var c,m="TimeOrigin::setOriginTimetick:";if(a>this.config.tolerantRTT)this.logger.warn(m+" Denied, cause of exceeding the maximum tolerance range of RTT: "+a),this.timer=Gi(bind$1(c=this.setOriginTimetick).call(c,this),this.failedDelay);else if(a>this.config.bestRTT){var h;this.serverOrigin.rtt&&a>=this.serverOrigin.rtt?this.logger.log(m+" Denied, cause of current.RTT >= serverOrigin.RTT: "+a):(this.setServerOrigin(a,t),this.logger.log(m+" Accept within maximum tolerance range of RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime)),this.timer=Gi(bind$1(h=this.setOriginTimetick).call(h,this),this.failedDelay)}else{var g;this.setServerOrigin(a,t),this.logger.log(m+" Accept within best RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime),this.currentChance=0,this.timer=Gi(bind$1(g=this.setOriginTimetick).call(g,this),this.successDelay)}},t.getNTPTime=function getNTPTime(t){if(void 0===t&&(t=this.getTimeNode()),this.checkNodeReliable(t)){var a=Math.floor(t.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+a}return wi()},t.checkNodeReliable=function checkNodeReliable(t){if(void 0===t&&(t=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var a=t.clock-this.serverOrigin.baseClock,c=t.time-this.serverOrigin.baseTime;return Math.abs(c-a)<500}return!1},t.checkPerformance=function checkPerformance(){return"BROWSER"===Cp.platform&&!("undefined"==typeof performance||!performance.now)},TimeOrigin.checkPerformance=function checkPerformance(){return"BROWSER"===Cp.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:wi()}},TimeOrigin.getTimeNode=function getTimeNode(){return{clock:TimeOrigin.checkPerformance()?performance.now():0,time:wi()}},t.setServerOrigin=function setServerOrigin(t,a){this.serverOrigin={timestamp:a+Math.floor(t/2),rtt:t,baseClock:this.checkPerformance()?performance.now():0,baseTime:wi()}},TimeOrigin}();function _createForOfIteratorHelperLoose$b(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$b(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$b(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$b(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$b(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var wp={},kp={};function createCmd(t,a,c,m){var h=wp[t];if(!h)return c.error("createCmd:: can not find cmd config: ",t),null;var g,I={SER:a,SID:h.sid,CID:h.cid,Q:[]};h.params&&m&&forEach$1(g=h.params).call(g,(function(t){var a=m[t.name];if(null!=a){var c=t.type,h=t.reflectMapper,g=t.select;switch(t.type){case"PropertyArray":c="ArrayMable",a=map$6(a).call(a,(function(t){return{t:"Property",v:h?serialize(t,h,g):t}}));break;case"Property":a=h?serialize(a,h,g):a;break;case"Bool":a=a?"true":"false"}I.Q.push({t:c,v:a})}}));return{packet:I,hasPacketResponse:"boolean"!=typeof h.hasPacketResponse||h.hasPacketResponse,hasPacketTimer:"boolean"!=typeof h.hasPacketTimer||h.hasPacketTimer}}function parseCmd(t,a){var c,m;try{m=JSON.parse(t)}catch(c){return void a.error('Parse command error:"'+t+'"')}var h=m.sid+"_"+m.cid,g=m.r;if(includes(c=["4_1","4_2","4_10","4_11"]).call(c,h)){var I=m.r[1].headerPacket;h=I.sid+"_"+I.cid,m.sid=I.sid,m.cid=I.cid,g=m.r[1].body}var M=kp[h],T=[];if(M){for(var S,E=_createForOfIteratorHelperLoose$b(M);!(S=E()).done;){var C=S.value;T.push(parseEachCmd(m,C.config,C.cmd,g,a))}return T}a.error("parseCmd:: mapper not exist",h,m.code)}function parseEachCmd(t,a,c,m,h){var g,I={cmd:c,raw:t,error:null,service:null==a?void 0:a.service,content:{},__receiveTimeNode:Rp.getTimeNode()};if(!c||!a)return I.notFound=!0,I;(18===a.sid||a.sid>=26&&a.sid<100)&&(t.code=function toReadableCode(t){if("number"!=typeof t||t!=t)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+t}});if(t<0||t>=0&&t<1e3||t>=2e4&&t<=20099)return t;var a=(65535&t)>>9;a-=a<=38?1:2;return 1e5+1e3*a+(511&t)}(t.code));var M,T=function genCmdError(t,a){var c=Hu[t],m=Ju[t];return null===m?null:new Yu({code:t,desc:c||m||t,detail:{cmd:a,timetag:wi()}})}(t.code,c);if(I.error=T,I.error){if(I.error.detail.cmd=c,!(null===(g=null==a?void 0:a.ignoreErrCodes)||void 0===g?void 0:includes(g).call(g,t.code)))return I;h.warn("parseCmd:: ignore error ",I.error),I.error.detail.ignore=!0}a.response&&forEach$1(M=a.response).call(M,(function(t,a){var c=m[a],h=t.type,g=t.name,M=t.reflectMapper;if(!Kc(c))switch(h){case"Property":I.content[g]=M?deserialize(c,M):c;break;case"PropertyArray":I.content[g]=map$6(c).call(c,(function(t){return M?deserialize(t,M):t}));break;case"Int":case"Long":case"Byte":I.content[g]=+c;break;case"Bool":I.content[g]="true"===c||!0===c||1===c;break;default:I.content[g]=c}}));return I}function serialize(t,a,c){var m={};for(var h in t=function flattenObjByMapper(t,a){var c={};for(var m in a){for(var h,g=a[m],I="number"==typeof g?m:g.access?g.access:m,M=t,T=_createForOfIteratorHelperLoose$b(I.split("."));!(h=T()).done;){var S=h.value;if(void 0===M[S]||null===M[S]){M=void 0;break}M=M[S]}void 0!==M&&(c[I]=M)}return c}(t,a),a){var g=a[h],I="number"==typeof g?h:g.access?g.access:h;if(!c||includes(c).call(c,h))if(I in t){if("number"==typeof g)m[g]=t[I];else if("object"==typeof g)if(g.converter){var M=g.converter(t[I],t);void 0!==M&&(m[g.id]=M)}else m[g.id]=t[I]}else"object"==typeof g&&g.def&&("function"==typeof g.def?m[g.id]=g.def(t):m[g.id]=g.def)}return m}function deserialize(t,a){var c={};for(var m in t){var h=a[m];if("string"==typeof h)c[h]=t[m];else if("object"==typeof h&&"prop"in h){var g=h.access?h.access:h.prop;if(h.converter){var I=h.converter(t[m],t);void 0!==I&&(c[g]=I)}else h.type&&"number"===h.type?c[g]=+t[m]:h.type&&"boolean"===h.type?c[g]=!("0"===t[m]||!t[m]):c[g]=t[m]}}for(var M in a){var T=a[M];if(T&&void 0!==T.def){var S=T.access?T.access:T.prop;S in c||("function"==typeof T.def?c[S]=T.def(t):c[S]=T.def)}}return c=function unflattenObj(t){var a={},c=function _loop(c){var m=c.split(".");reduce(m).call(m,(function(a,h,g){return a[h]||(a[h]=isNaN(Number(m[g+1]))?m.length-1==g?t[c]:{}:[])}),a)};for(var m in t)c(m);return a}(c),c}function registerParser(t){for(var a in qt(wp,t.cmdConfig),t.cmdMap){var c=t.cmdMap[a],m=t.cmdConfig[c];if(m)if(jc(kp[a])){for(var h,g=!1,I=_createForOfIteratorHelperLoose$b(kp[a]);!(h=I()).done;){var M=h.value;if(M.cmd===c&&M.config.service===m.service){g=!0;break}}g||kp[a].push({config:m,cmd:c})}else kp[a]=[{config:m,cmd:c}]}}function invertSerializeMap(t){var a,c={};return forEach$1(a=mn(t)).call(a,(function(a){c[a]=invertSerializeItem(t[a])})),c}function invertSerializeItem(t){var a={};for(var c in t){var m=t[c];"number"==typeof m?a[m]=c:"object"==typeof m&&(a[m.id]={prop:c,type:m.retType,access:m.retAccess?m.retAccess:m.access?m.access:c,def:m.retDef,converter:m.retConverter})}return a}function boolToInt(t){return t?1:0}function objectToJSONString(t){if(t&&"object"==typeof t)try{return Fc(t)}catch(t){return}}function stringToJSONObject(t){if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){return}}var Op={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},Pp={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},xp=invertSerializeMap(Pp),Vp={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:Pp.login}],response:[{type:"Property",name:"loginRes",reflectMapper:xp.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:xp.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:xp.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:xp.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}},Lp="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Dp=N("".replace),Up="["+Lp+"]",Fp=RegExp("^"+Up+Up+"*"),Bp=RegExp(Up+Up+"*$"),createMethod=function(t){return function(a){var c=toString$1(requireObjectCoercible(a));return 1&t&&(c=Dp(c,Fp,"")),2&t&&(c=Dp(c,Bp,"")),c}},qp={start:createMethod(1),end:createMethod(2),trim:createMethod(3)},Gp=qp.trim,Hp=h.parseInt,jp=h.Symbol,Yp=jp&&jp.iterator,$p=/^[+-]?0x/i,Wp=N($p.exec),zp=8!==Hp(Lp+"08")||22!==Hp(Lp+"0x16")||Yp&&!fails((function(){Hp(Object(Yp))}))?function parseInt(t,a){var c=Gp(toString$1(t));return Hp(c,a>>>0||(Wp($p,c)?16:10))}:Hp;_export({global:!0,forced:parseInt!=zp},{parseInt:zp});var Kp,Qp,Jp,Xp,Zp,em=j.parseInt;!function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(Kp||(Kp={})),function(t){t[t.p2p=0]="p2p",t[t.team=1]="team",t[t.superTeam=5]="superTeam"}(Qp||(Qp={})),function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(Jp||(Jp={})),function(t){t[t.unread=1]="unread",t[t.read=2]="read",t[t.deleted=3]="deleted",t[t.sending=4]="sending",t[t.sendFailed=5]="sendFailed",t[t.sent=6]="sent",t[t.receipt=7]="receipt",t[t.refused=10]="refused"}(Xp||(Xp={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(Zp||(Zp={}));var tm=Math.min,rm=[].lastIndexOf,nm=!!rm&&1/[1].lastIndexOf(1,-0)<0,am=arrayMethodIsStrict("lastIndexOf"),im=nm||!am?function lastIndexOf(t){if(nm)return S(rm,this,arguments)||0;var a=toIndexedObject(this),c=lengthOfArrayLike(a),m=c-1;for(arguments.length>1&&(m=tm(m,toIntegerOrInfinity(arguments[1]))),m<0&&(m=c+m);m>=0;m--)if(m in a&&a[m]===t)return m||0;return-1}:rm;_export({target:"Array",proto:!0,forced:im!==[].lastIndexOf},{lastIndexOf:im});var om=entryVirtual("Array").lastIndexOf,sm=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===sm||Y(sm,t)&&a===sm.lastIndexOf?om:a},cm=Zr.findIndex,lm="findIndex",um=!0;lm in[]&&Array(1).findIndex((function(){um=!1})),_export({target:"Array",proto:!0,forced:um},{findIndex:function findIndex(t){return cm(this,t,arguments.length>1?arguments[1]:void 0)}});var dm=entryVirtual("Array").findIndex,pm=Array.prototype,findIndex$1=function(t){var a=t.findIndex;return t===pm||Y(pm,t)&&a===pm.findIndex?dm:a},mm=gd(Object.keys,Object),hm=Object.prototype.hasOwnProperty;var gm=function baseKeys(t){if(!yd(t))return mm(t);var a=[];for(var c in Object(t))hm.call(t,c)&&"constructor"!=c&&a.push(c);return a};var vm,fm=function keys$7(t){return Ad(t)?Jd(t):gm(t)},ym=vp((function(t,a,c,m){$d(a,fm(a),t,m)})),_m=(vm=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return vm()+vm()+vm()+vm()+vm()+vm()+vm()+vm()});function getEnumKeys(t){var a;return filter(a=mn(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumValues(t){var a,c;return map$6(a=filter(c=mn(t)).call(c,(function(t){return+t>=0}))).call(a,(function(t){return em(t)}))}function getEnumKeyByEnumValue(t,a){var c,m=filter(c=mn(t)).call(c,(function(c){return t[c]==a}));return m.length>0?m[0]:void 0}function getAccountFromSessionId(t,a){if(void 0===a&&(a="-"),!t)throw new Qu("No sessionId",{},400);var c=indexOf(t).call(t,a);if(-1===c)throw new Qu("Can not find conjunctions",{},400);var m=slice$1(t).call(t,0,c);return{accid:slice$1(t).call(t,c+1),scene:"super_team"===m?"superTeam":m}}function getMiniappEnv(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}function assignOptions(t,a){return ym({},t,a,(function(t,a){return Kc(a)?t:a}))}function emptyFuncWithPromise(){return Mi.resolve()}function emptyFunc$1(){}function getFileExtension(t){var a=lastIndexOf(t).call(t,".");return a>-1?slice$1(t).call(t,a):""}function findIndexWithinTargetValue(t,a,c){return 0===t.length||t[0][a]<=c?0:t[t.length-1][a]>c?t.length:findIndex$1(t).call(t,(function(m,h){if(t[h-1]&&t[h-1][a]>c&&c>=m[a])return!0}))}var Im=entryVirtual("Array").values,Mm=Array.prototype,Tm={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===Mm||Y(Mm,t)&&a===Mm.values||de(Tm,Mr(t))?Im:a};function format(t,a){if(!Ld(a))return{};var c=JSON.parse(Fc(a)),m=doFormat(t,c);return JSON.parse(Fc(qt(qt({},c),m)))}function doFormat(t,a){if(!Ld(a))return{};var c={},m=mn(t);return forEach$1(m).call(m,(function(m){var h=t[m].type;if("string"!=typeof h){var g=doFormat(t[m],a);mn(g).length>0&&(c[m]=g)}else{var I=t[m],M=I.rawKey||m,T=Sm[h](a,M,I);void 0!==T&&(a[M]=void 0,c[m]=T)}})),c}var Sm={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,c){return values(c)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!Ld(a))return{};var c=JSON.parse(Fc(a)),m=doFormatReverse(t,c);return JSON.parse(Fc(qt(qt({},c),m)))}function doFormatReverse(t,a){var c;if(!Ld(a))return reduce(c=mn(t)).call(c,(function(a,c){return a[t[c].rawKey||c]=void 0,a}),{});var m={},h=mn(t);return forEach$1(h).call(h,(function(c){var h=t[c].type;if("string"!=typeof h){var g=doFormatReverse(t[c],a[c]);return qt(m,g),void(a[c]=void 0)}var I=t[c],M=I.rawKey||c,T=Em[h](a,c,I);a[M]=void 0,m[M]=T})),m}var Em={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,c){return values(c)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return Fc(t[a])}catch(t){return""}}},Cm=Em;function formatMultiPortLoginInfo(t,a){return t&&t.length>0?map$6(t).call(t,(function(t){return qt(qt({},t),{account:t.account,connectionId:t.connectionId,deviceId:t.deviceId,ip:t.ip,mac:t.mac,os:t.os,type:getEnumKeyByEnumValue(Jp,t.type)||t.type,time:em(t.time),online:3!==a})})):[]}var bm={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var Am=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),c=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-c:t+c}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var Nm=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Rm=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,c=null==t?0:t.length;for(this.__data__=new vs;++a<c;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=Nm,SetCache.prototype.has=Rm;var wm=SetCache;var km=function baseFindIndex(t,a,c,m){for(var h=t.length,g=c+(m?1:-1);m?g--:++g<h;)if(a(t[g],g,t))return g;return-1};var Om=function baseIsNaN(t){return t!=t};var Pm=function strictIndexOf(t,a,c){for(var m=c-1,h=t.length;++m<h;)if(t[m]===a)return m;return-1};var xm=function baseIndexOf(t,a,c){return a==a?Pm(t,a,c):km(t,Om,c)};var Vm=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&xm(t,a,0)>-1};var Lm=function arrayIncludesWith(t,a,c){for(var m=-1,h=null==t?0:t.length;++m<h;)if(c(a,t[m]))return!0;return!1};var Dm=function cacheHas(t,a){return t.has(a)},Um=Ho(po,"Set");var Fm=function noop(){};var Bm=function setToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t){c[++a]=t})),c},qm=Um&&1/Bm(new Um([,-0]))[1]==1/0?function(t){return new Um(t)}:Fm,Gm=qm;var Hm=function baseUniq(t,a,c){var m=-1,h=Vm,g=t.length,I=!0,M=[],T=M;if(c)I=!1,h=Lm;else if(g>=200){var S=a?null:Gm(t);if(S)return Bm(S);I=!1,h=Dm,T=new wm}else T=a?[]:M;e:for(;++m<g;){var E=t[m],C=a?a(E):E;if(E=c||0!==E?E:0,I&&C==C){for(var b=T.length;b--;)if(T[b]===C)continue e;a&&T.push(C),M.push(E)}else h(T,C,c)||(T!==M&&T.push(C),M.push(E))}return M};var jm=function uniq(t){return t&&t.length?Hm(t):[]},Ym=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],$m=["transport not supported","client not handshaken","unauthorized"],Wm=["reconnect"],zm=function(t){function BaseWebsocket(a,c){var m;return(m=t.call(this)||this).url=c,m.websocket=null,m.socketConnectTimer=0,m.core=a,m.url=c,m.status="disconnected",m.logger=a.logger,m.connect(),m}kt(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+wi(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(a){if("connecting"===t.status){var c=a.data.split(":"),m=c[0];return c[1],t.sessionId=m,t.logger.log("imsocket::XHR success. status "+t.status+", "+("connecting"===t.status?"continue websocket connection":"stop websocket connection")),t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+m)}})).catch((function(a){if("connecting"===t.status){var c='imsocket::XHR fail. raw message: "'+(a=a||{}).message+'", code: "'+a.code+'"',m=a.code;m="v2"===ws(t.core,"options.apiVersion")?a.code===Gu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Gu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Gu.V2NIM_ERROR_CODE_CONNECT_FAILED:408===a.code?408:415;var h=new Yu({code:m,detail:{reason:c,rawError:a}});t.logger.error(c),t.status="disconnected",t.emit("handshakeFailed",h)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(t){this.logger.warn("imsocket::attempt to send encodePacket error",t)}try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=Gi((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("handshakeFailed",new Yu({code:"v2"===ws(c.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new Cp.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(t){var a=(null==t?void 0:t.reason)||(null==t?void 0:t.message)||(null==t?void 0:t.errMsg)||"websocket.onclose";c.logger.log("imsocket::Websocket onclose done. code is "+(null==t?void 0:t.code)+" and reason is "+a),c.clean(),c.emit("disconnect",{code:(null==t?void 0:t.code)||0,reason:a})},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"logined"===c.core.status&&c.core.clientSocket.ping()}},a.onMessage=function onMessage(t){var a,c=this.decodePacket(t.data);if(c)switch(c.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",c.data);break;case"event":c.name&&this.emit(c.name,c.args);break;case"error":"unauthorized"===c.reason?this.emit("connect_failed",c.reason):this.emit("error",c.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new Yu({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",c.type)}},a.encodePacket=function encodePacket(t){var a,c,m=t.type,h=t.id,g=void 0===h?"":h,I=t.endpoint,M=void 0===I?"":I,T=t.ack,S=null;if(!m)return"";switch(m){case"error":a=t.reason?indexOf($m).call($m,t.reason):"",c=t.advice?indexOf(Wm).call(Wm,t.advice):"",""===a&&""===c||(S=a+(""!==c?"+"+c:""));break;case"message":""!==t.data&&(S=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},S=Fc(a);break;case"json":S=Fc(t.data);break;case"connect":t.qs&&(S=t.qs);break;case"ack":S=t.ackId+(t.args&&t.args.length?"+"+Fc(t.args):"")}var E=[indexOf(Ym).call(Ym,m),g+("data"===T?"+":""),M];return null!=S&&E.push(S),E.join(":")},a.decodePacket=function decodePacket(t){if(t)if("ï¿½"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var c,m=a[1],h=a[2],g=a[3],I=a[4],M=a[5],T={type:Ym[+m],endpoint:I};switch(h&&(T.id=h,T.ack=!g||"data"),T.type){case"error":c=M.split("+"),T.reason=$m[+c[0]]||"";break;case"message":T.data=M||"";break;case"connect":T.qs=M||"";break;case"event":try{var S=JSON.parse(M);T.name=S.name,T.args=S.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}T.args=T.args||[];break;case"json":try{T.data=JSON.parse(M)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((c=M.match(/^([0-9]+)(\+)?(.*)/))&&(T.ackId=c[1],T.args=[],c[3]))try{T.args=c[3]?JSON.parse(c[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return T}}else this.logger.error("imsocket::unrecognize dataStr",slice$1(t).call(t,0,20))},a.send=function send(t){var a,c={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(c))},BaseWebsocket}(Hi),Km=Zr.every,Qm=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Qm},{every:function every(t){return Km(this,t,arguments.length>1?arguments[1]:void 0)}});var Jm=entryVirtual("Array").every,Xm=Array.prototype,every=function(t){var a=t.every;return t===Xm||Y(Xm,t)&&a===Xm.every?Jm:a};var Zm=function baseIsRegExp(t){return So(t)&&"[object RegExp]"==To(t)},eh=Bd&&Bd.isRegExp,th=eh?Fd(eh):Zm;var rh=function baseDifference(t,a,c,m){var h=-1,g=Vm,I=!0,M=t.length,T=[],S=a.length;if(!M)return T;c&&(a=Ts(a,Fd(c))),m?(g=Lm,I=!1):a.length>=200&&(g=Dm,I=!1,a=new wm(a));e:for(;++h<M;){var E=t[h],C=null==c?E:c(E);if(E=m||0!==E?E:0,I&&C==C){for(var b=S;b--;)if(a[b]===C)continue e;T.push(E)}else g(a,C,m)||T.push(E)}return T},nh=hp((function(t,a){return Nd(t)?rh(t,a):[]})),ah=nh;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,c,m){var h;void 0===a&&(a={}),void 0===m&&(m=!1);var g={};return forEach$1(h=mn(t)).call(h,(function(h){var I=t[h].type,M=c?"In "+c+", ":"";if(null==a){var T=M+"param is null or undefined";throw m?new Wu({detail:{reason:T,data:{key:h},rules:"required"}}):new $u(T,{key:h},"required")}if(void 0===a[h]){if(!1===t[h].required)return void(g[h]=a[h]);var S=M+"param '"+h+"' is required";throw m?new Wu({detail:{reason:S,data:{key:h},rules:"required"}}):new $u(S,{key:h},"required")}var E=ih[I];if(E&&!E(a,h,t[h],m)){var C=M+"param '"+h+"' unexpected",b={key:h,value:a[h]};throw m?new Wu({detail:{reason:C,data:b,rules:Fc(t[h],replacer)}}):new $u(C,b,Fc(t[h],replacer))}g[h]=a[h]})),g}var ih={string:function string(t,a,c){var m=c.allowEmpty,h=c.max,g=c.min,I=c.regExp,M=t[a];return"string"==typeof M&&((!1!==m||""!==M)&&(!("number"==typeof h&&M.length>h)&&(!("number"==typeof g&&M.length<g)&&!(th(I)&&!I.test(M)))))},number:function number(t,a,c){var m=c.min,h=c.max,g=t[a];return"number"==typeof g&&(!("number"==typeof m&&g<m)&&!("number"==typeof h&&g>h))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},file:function file(t,a){return!0},enum:function _enum(t,a,c){var m=values(c),h=t[a];return!m||indexOf(m).call(m,h)>-1},jsonstr:function jsonstr(t,a){try{var c=JSON.parse(t[a]);return"object"==typeof c&&null!==c}catch(t){return!1}},func:function func(t,a){return"function"==typeof t[a]},array:function array(t,a,c,m){var h;void 0===m&&(m=!1);var g=c.itemType,I=c.rules,M=c.min,T=c.max,S=values(c),E=t[a];return!!jc(E)&&(!("number"==typeof T&&E.length>T)&&(!("number"==typeof M&&E.length<M)&&(!(g&&"enum"!==g&&!every(E).call(E,(function(t){return typeof t===g})))&&(("enum"!==g||!S||!ah.apply(void 0,concat(h=[E]).call(h,S)).length)&&(I&&forEach$1(E).call(E,(function(t,c){return validate(I,t,a+"["+c+"]",m)})),!0)))))},object:function object(t,a,c,m){void 0===m&&(m=!1);var h=c.rules,g=c.allowEmpty,I=t[a];if("object"!=typeof I||null===I)return!1;if(h){var M=mn(h),T=mn(I),S=filter(T).call(T,(function(t){return indexOf(M).call(M,t)>-1}));if(!1===g&&0===S.length)return!1;validate(h,I,a,m)}return!0}};function validateConversationId(t,a){if(!t)throw new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE});validate({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp("^"+t+"\\|[1-3]\\|")}},{conversationId:a},"",!0)}var oh,sh="weblink.netease.im:443",ch=["https://lbs.netease.im/lbs/webconf.jsp"],lh="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",uh="imElite_sdk_abtest_web";function _createForOfIteratorHelperLoose$a(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$a(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$a(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$a(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$a(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(oh||(oh={}));var dh=function(){function V1ClientSocket(t,a){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new Am({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Ml,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,a&&(this.auth=a),this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager}var t=V1ClientSocket.prototype;return t.setSessionId=function setSessionId(t){},t.connect=function connect(t,a){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I,M;return Dc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.core.status)){T.next=5;break}return c="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(c),T.abrupt("return",Mi.reject(c));case 5:this.core.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(m=t.linkUrls).call(m,this.linkUrls),this.linkUrls=jm(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(sh),h=0;case 9:if(!(h<this.linkUrls.length)){T.next=31;break}return g=this.linkUrls[h],I=(new Date).getTime(),T.prev=12,T.next=15,this.doConnect(g);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+g),T.abrupt("return",g);case 20:T.prev=20,T.t0=T.catch(12),M=T.t0,a&&a(M,g),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:I,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof M.code?M.code:0,description:M.message||""+M.code,operation_type:0,target:g},{asyncParams:Cp.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+g,T.t0);case 28:h++,T.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(oh.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(oh.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return T.stop()}}),_callee,this,[[12,20]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new Mi((function(m,h){var g;a.socket=new zm(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV1::on connect",t),a.core.reporterHookLinkKeep&&(a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t})),c=!0,m()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",m),!this.core.reporterHookLinkKeep){a.next=5;break}return a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:c=!0,this.doDisconnect(oh.OFFLINE,"SocketOnDisconnect");case 7:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){c?a.ping():(a.logger.error('clientsocketV1::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,h(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function beforeConnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a,c){var m,h,g,I,M;if(this.logger.log("doDisconnect: type "+t+", description "+a),"unconnected"!==this.core.status){var T={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Yu({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:T}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var S=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(t===oh.ACTIVE||S)this.logger.log("doDisconnect: emit disconnect, type "+t,S),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(m=this.auth)||void 0===m||m.emit("disconnect"),this.destroyOnlineListener();else if(t===oh.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var E="string"==typeof a?{reason:"unknow",message:a}:a;this.core.eventBus.emit("kicked",E),this.core.emit("kicked",E),null===(h=this.auth)||void 0===h||h.emit("kicked",E),this.destroyOnlineListener()}else t===oh.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):t===oh.OFFLINE&&(null===(I=null===(g=this.auth)||void 0===g?void 0:g.authenticator)||void 0===I?void 0:I.checkLoginTerminalCode(null==c?void 0:c.code))?(this.logger.log("doDisconnect: login terminal code "+(null==c?void 0:c.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(M=this.auth)||void 0===M||M.emit("disconnect")):t===oh.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},t.attempToReconnect=function attempToReconnect(){var t,a,c=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(t=this.auth)||void 0===t||t.emit("disconnect"));var m=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+m),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:m}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:m}),null===(a=this.auth)||void 0===a||a.emit("willReconnect",{retryCount:this.retryCount,duration:m}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=Gi((function(){return __awaiter(c,void 0,void 0,Dc.mark((function _callee3(){var t=this;return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if("waitReconnect"===this.core.status){a.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),a.abrupt("return");case 3:return a.next=5,Cp.net.getNetworkStatus();case 5:!1===a.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(oh.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return a.stop()}}),_callee3,this)})))}),m)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function sendCmd(t,a,c){var m=this;if("logined"!==this.core.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+t),Mi.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return Mi.reject("No_socket");var h="heartbeat"!==t,g=h?this.packetSer++:0,I=createCmd(t,g,this.logger,a);if(!I){var M="SendCmd "+g+" "+t+" error";return this.logger.error(M),Mi.reject(new Error(M))}var T=I.packet,S=I.hasPacketResponse,E=I.hasPacketTimer,C=Fc(T);h&&("debug"===this.core.options.debugLevel?this.logger.debug("clientsocketV1::sendCmd",t,"ser:"+g,C):this.logger.log("clientsocketV1::sendCmd",t,"ser:"+g));var b=(new Date).getTime();return new Mi((function(h,I){S&&m.sendingCmdMap.set(g,{cmd:t,params:a,callback:[h,I],timer:E?Gi((function(){var a=new Yu({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:t,ser:g,timetag:wi()}});m.markCmdInvalid(g,a,t)}),c&&c.timeout?c.timeout:m.core.config.timeout):null});try{m.socket.send(C),S||h(T)}catch(a){var M=new Yu({code:415,detail:{reason:a&&a.message||"Unable to send packet",cmd:t,ser:g,timetag:wi(),rawError:a}});m.markCmdInvalid(g,M,t),I(a)}})).catch((function(t){var a,c=[408,415];if(!includes(c).call(c,t.code))return Mi.reject(t);m.reporter.reportTraceStart("exceptions",{user_id:m.core.options.account,trace_id:null===(a=m.socket)||void 0===a?void 0:a.sessionId,start_time:b,action:2,exception_service:6});var h=ws(t,"data.disconnect_reason")||"",g=408===t.code?"Send failed due to timeout":"Send failed. Reason unknown";return g=415===t.code?Fc({disconnect_reason:h}):g,m.reporter.reportTraceUpdateV2("exceptions",{code:t.code||415,description:g,operation_type:1,target:T.SID+"-"+T.CID,context:""+T.SER},{asyncParams:Cp.net.getNetworkStatus()}),m.reporter.reportTraceEnd("exceptions",1),Mi.reject(t)}))},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,m=_createForOfIteratorHelperLoose$a(a);!(c=m()).done;){var h=c.value,g=h.raw.ser;if(h.error&&this.logger.error("core:onMessage packet error",h.raw.sid+"_"+h.raw.cid+", ser:"+g+",",h.error),h.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",h.raw.sid+"_"+h.raw.cid+", ser:"+g);"heartbeat"!==h.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:"+g,h.cmd,h.content):this.logger.log("imsocket::recvCmd ser:"+g,h.cmd)),this.packetHandler(h)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var m=t.raw.ser,h=this.sendingCmdMap.get(m);if(h&&h.cmd===t.cmd){var g=h.callback,I=h.timer,M=h.params;if(clearTimeout(I),t.params=M,this.sendingCmdMap.delete(m),"heartbeat"===t.cmd)return void g[0]();var T=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);T&&"function"==typeof T.then?T.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",t.service,t.cmd),g[0]())}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var m=this.sendingCmdMap.get(t);if(m){var h=m.callback,g=m.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+c+" is invalid:",a),h[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,h=a.timer,g=a.cmd;c.logger.debug('markAllCmdInvaild:: cmd "'+g+'"'),h&&clearTimeout(h),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a=this;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=18;break;case 6:return c.prev=6,c.t0=c.catch(1),c.next=10,this.testHeartBeat5Timeout();case 10:if(!c.sent){c.next=18;break}if(!this.core.reporterHookLinkKeep){c.next=16;break}return c.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(oh.OFFLINE,"PingError"),c.abrupt("return");case 18:this.pingTimer=Gi((function(){a.ping()}),3e4);case 19:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var t;return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,Cp.net.onNetworkStatusChange((function(a){t.logger.log("clientsocketV1::onlineListener:network change",a),a.isConnected&&"logined"===t.core.status?t.ping():a.isConnected&&"waitReconnect"===t.core.status?(t.reconnectTimer&&clearTimeout(t.reconnectTimer),t.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}))):a.isConnected||t.doDisconnect(oh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientsocketV1::onlineListener:destroy"),Cp.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function disconnect(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(oh.ACTIVE,"UserActiveDisconnect"),Mi.resolve();default:return Mi.resolve()}},V1ClientSocket}(),ph=function(){function V1NIMLoginLbs(t){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=t,this.auth=t.V1NIMLoginService,this.logger=this.core.logger}var t=V1NIMLoginLbs.prototype;return t.getLbsInfos=function getLbsInfos(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t,a,c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.socketLinkUrls.length>0)){h.next=5;break}return t=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",t),h.abrupt("return",Mi.resolve(t));case 5:return this.core.reporterHookLBS.start(this.core.account),a=jm(this.auth.config.lbsUrls),h.prev=7,h.next=10,this.ladderLoad(a);case 10:if(200===(c=h.sent).status&&c.data){h.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",c.status,c),new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+c.status}});case 14:this.success(c),h.next=25;break;case 17:if(h.prev=17,h.t0=h.catch(7),m=h.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",h.t0),this.reportForFail(a[0],m.code,m.message),!this.checkTerminator(m.code)){h.next=24;break}throw h.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return h.abrupt("return",this.socketLinkUrls);case 26:case"end":return h.stop()}}),_callee,this,[[7,17]])})))},t.checkTerminator=function checkTerminator(t){return t===Gu.V2NIM_ERROR_CODE_CANCELLED||t===Gu.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function generateUrl(t){return t+(indexOf(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function requstLbs(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function setLadderTimer(t,a,c,m){var h=this;this.timer&&clearTimeout(this.timer);var g=t[a];this.timer=Gi((function(){g&&(h.setLadderTimer(t,a+1,c,m),h.core.logger.log("V1NIMLoginService::getLbsInfos "+a+":",g),h.reportForLbsStart(g,a),h.requstLbs(g).then((function(t){h.reset(),c(qt(qt({},t),{url:g}))})).catch((function(c){var I;if(h.core.logger.warn("V1NIMLoginService::getLbsInfos "+a+" failed:",c),h.failedCount+=1,h.reportForFailOnce(g,c.code,(null===(I=c.detail)||void 0===I?void 0:I.reason)||c.message),h.failedCount>=t.length||h.checkTerminator(c.code))return h.reset(),void m(c)})))}),2e3)},t.ladderLoad=function ladderLoad(t){var a=this;return new Mi((function(c,m){t.length>1&&a.setLadderTimer(t,1,c,m);var h=t[0];a.core.logger.log("V1NIMLoginService::getLbsInfos 0:",h),a.reportForLbsStart(h,0),a.requstLbs(h).then((function(t){a.reset(),c(qt(qt({},t),{url:h}))})).catch((function(c){var g;a.failedCount+=1,a.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",c),a.reportForFailOnce(h,c.code,(null===(g=c.detail)||void 0===g?void 0:g.reason)||c.message),(a.failedCount>=t.length||a.checkTerminator(c.code))&&(a.reset(),m(c))}))}))},t.success=function success(t){var a,c,m,h,g=t.data,I=[this.auth.config.linkUrl];ws(g,"common.link")&&(I=concat(h=ws(g,"common.link")).call(h,I));ws(g,'common["link.default"]')&&(I=concat(I).call(I,ws(g,'common["link.default"]'))),this.socketLinkUrls=jm(I),g["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",g["nos-chunk"]),null===(c=this.core.cloudStorage)||void 0===c||c.setOptions({chunkUploadHost:g["nos-chunk"]})),jc(g.nosup)&&g.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",g.nosup),null===(m=this.core.cloudStorage)||void 0===m||m.setOptions({commonUploadHostBackupList:g.nosup,commonUploadHost:g.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",slice$1(a=this.socketLinkUrls).call(a,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},t.reportForLbsStart=function reportForLbsStart(t,a){this.core.reporterHookLBS.updateBegin({target:t,index:a})},t.reportForLbsSuccess=function reportForLbsSuccess(t,a){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:Fc(a)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()})},t.reportForFailOnce=function reportForFailOnce(t,a,c){this.core.reporterHookLBS.updateComplete({target:t,code:a,body:c})},t.reportForFail=function reportForFail(t,a,c){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:c,code:a,succeed:!1},{asyncParams:Cp.net.getNetworkStatus()})},t.reset=function reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},V1NIMLoginLbs}(),mh=function(){function V1NIMLoginAuthenticator(t){this.core=t}var t=V1NIMLoginAuthenticator.prototype;return t.verifyAuthentication=function verifyAuthentication(t){var a,c,m;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){var h,g,I,M,T,S,E,C,b,A,N,R;return Dc.wrap((function _callee$(w){for(;;)switch(w.prev=w.next){case 0:return g=this.core.options,I=Cp.getSystemInfo(),M=qt(qt({},g),{appLogin:t?0:1,appkey:g.appkey,account:g.account,token:g.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100400,sdkHumanVersion:"10.4.0",os:I.os,browser:I.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.4.0":slice$1(h=I.userAgent).call(h,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:I.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:I.hostEnvEnum}),T=I.os.toLowerCase(),"UNIAPP"!==Cp.platform||"ios"!==T&&"android"!==T||(M.isReactNative=1,M.clientType="ios"===T?2:1,S=!!(null===(a=this.core.offlinePush.authConfig)||void 0===a?void 0:a.honorCertificateName),I.pushDeviceInfo&&I.pushDeviceInfo.MANUFACTURER&&(M.deviceInfo=Fc(qt({IS_SUPPORT_HONOR:S},I.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login ",g.account,null===(m=null===(c=this.core.clientSocket)||void 0===c?void 0:c.socket)||void 0===m?void 0:m.sessionId),w.next=8,this.core.clientSocket.sendCmd("login",{login:M});case 8:if(!(E=w.sent).error){w.next=11;break}throw E.error;case 11:return C=E.content,b=C.loginRes,A=C.loginPorts,N=C.aosPushInfo,R=formatMultiPortLoginInfo(A,2),(R=filter(R).call(R,(function(t){return t.connectionId!==b.connectionId}))).length>0&&this.core.emit("multiPortLogin",R),w.abrupt("return",qt(qt({},b),{aosPushInfo:N}));case 16:case"end":return w.stop()}}),_callee,this)})))},t.checkLoginTerminalCode=function checkLoginTerminalCode(t){if(void 0===t)return!1;var a=[201,302,317,403,404,417,422];return includes(a).call(a,t)},V1NIMLoginAuthenticator}(),gh=function(t){function V2Service(a,c){var m;return(m=t.call(this)||this).name=a,m.logger=c.logger,m.core=c,m}kt(V2Service,t);var a=V2Service.prototype;return a.checkV2=function checkV2(){var t=this.core.options.apiVersion;if("v2"===t)return!0;throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+t+'" of client is not supported.'}})},a.checkLogin=function checkLogin(){if(this.core.V2NIMLoginService.getLoginStatus()!==tu.V2NIM_LOGIN_STATUS_LOGINED)throw new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"The client is not logged in."}})},a.emit=function emit(a){var c=this;try{for(var m,h,g=arguments.length,I=new Array(g>1?g-1:0),M=1;M<g;M++)I[M-1]=arguments[M];this.logger.debug(this.name+'::emit event: "'+a.toString()+'",',void 0!==I[0]?I[0]:"",void 0!==I[1]?I[1]:"",void 0!==I[2]?I[2]:"");var T=(m=t.prototype.emit).call.apply(m,concat(h=[this,a]).call(h,I));return T}catch(t){return Gi((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a){if(t.error)return this.logger.error(t.cmd+"::recvError",t.error),Mi.reject(t.error);try{var c=a.call(this,t);return Mi.resolve(c)}catch(t){return Mi.reject(t)}}var m=ws(t,"error.detail.ignore");return t.error&&!m?Mi.reject(t.error):Mi.resolve(t)},V2Service}(Hi),vh={needReconnect:!0,reconnectionAttempts:Ot,lbsUrls:ch,linkUrl:sh,xhrConnectTimeout:8e3,socketConnectTimeout:8e3},fh=function(t){function V1NIMLoginServiceImpl(a,c){var m;(m=t.call(this,"V1NIMLoginService",a)||this).account="",m.token="",m.deviceId="",m.processId="",m.clientSession="",m.status="unconnected",m.config=vh,m.isManualLoginAttempt=!1,registerParser({cmdMap:Op,cmdConfig:Vp}),a.V1NIMLoginService=Qe(m),c&&m.setOptions(c);var h=new dh(m.core,Qe(m));return m.clientSocket=h,"v1"===m.core.options.apiVersion&&(m.core.clientSocket=h,m.core.auth=Qe(m)),m.lbs=new ph(a),m.authenticator=new mh(a),m.doLoginStepsManager=new bp,m}kt(V1NIMLoginServiceImpl,t);var a=V1NIMLoginServiceImpl.prototype;return a.reset=function reset(){this.lbs.reset()},a.setOptions=function setOptions(t){t&&mn(t).length>0?(this.config=assignOptions(this.config,t),this.account=t.account||this.core.options.account,this.token=t.token||this.core.options.token,this.core.options=qt(qt({},this.core.options),this.config)):(this.config=assignOptions(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token);var a="",c="";this.config.isFixedDeviceId?(a=Cp.localStorage.getItem("__NIM_DEVC_ID__")||_m(),c=Cp.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||_m(),Cp.localStorage.setItem("__NIM_DEVC_ID__",a),Cp.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",c)):(a=_m(),c=_m()),this.deviceId=a,this.clientSession=c,this.core.reporter.setConfig({common:{dev_id:a}})},a.connect=function connect(t){return void 0===t&&(t={}),this.login(t)},a.login=function login(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkApiVersion(),t.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=_m()),a.next=4,this._connect(t);case 4:return this.core.abtest.abtRequest(),a.prev=5,a.next=8,this.doLogin(t.isAutoReconnect);case 8:this.processId=_m(),this.isManualLoginAttempt=!1,a.next=16;break;case 12:throw a.prev=12,a.t0=a.catch(5),this.isManualLoginAttempt=!1,a.t0;case 16:case"end":return a.stop()}}),_callee,this,[[5,12]])})))},a._connect=function _connect(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h=this;return Dc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){g.next=4;break}return a="NIM status is "+this.core.status+", and would not connect",this.logger.warn(a),g.abrupt("return",Mi.reject(a));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:t.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Fc(qt(qt({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Cp.net.getNetworkStatus()}),g.next=10,this.lbs.getLbsInfos();case 10:return c=g.sent,g.prev=11,g.next=14,this.clientSocket.connect({linkUrls:c,isAutoReconnect:t.isAutoReconnect},(function(t,a){h.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:a,code:t.code||408,description:"ws_handshake_failed:"+t.message,succeed:!1},{asyncParams:Cp.net.getNetworkStatus()})}));case 14:(m=g.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:m,code:200,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()}),g.next=22;break;case 18:throw g.prev=18,g.t0=g.catch(11),this.core.reporter.reportTraceEnd("login",!1),g.t0;case 22:case"end":return g.stop()}}),_callee2,this,[[11,18]])})))},a.doLogin=function doLogin(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m,h;return Dc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.authenticator.verifyAuthentication(t);case 3:a=g.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",g.next=21;break;case 9:if(g.prev=9,g.t0=g.catch(0),c=g.t0,m=ws(c,"data.disconnect_reason")||"",h=415===c.code?Fc({disconnect_reason:m}):c.message,this.core.logger.warn("nim login:: login failed",g.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:c.code||0,succeed:!1,description:h},{asyncParams:Cp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(oh.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",g.t0),!this.isManualLoginAttempt){g.next=20;break}throw g.t0;case 20:return g.abrupt("return");case 21:return g.prev=21,g.next=24,this.core.cloudStorage.init();case 24:g.next=29;break;case 26:g.prev=26,g.t1=g.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",g.t1);case 29:this.core.eventBus.emit("logined",a),this.core.emit("logined",a),this.emit("logined",a),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 35:case"end":return g.stop()}}),_callee3,this,[[0,9],[21,26]])})))},a.disconnect=function disconnect(){return this.logout()},a.logout=function logout(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),t.t0=this.status,t.next="logined"===t.t0?5:"connected"===t.t0||"connecting"===t.t0||"waitReconnect"===t.t0?18:"unconnected"===t.t0||"destroyed"===t.t0?21:22;break;case 5:return t.prev=5,t.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(oh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),t.next=17;break;case 12:t.prev=12,t.t1=t.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",t.t1),this.clientSocket.doDisconnect(oh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return t.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(oh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),t.abrupt("return",Mi.resolve());case 21:return t.abrupt("return",Mi.resolve());case 22:case"end":return t.stop()}}),_callee4,this,[[5,12]])})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var c;return Dc.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return this._checkApiVersion(),m.next=3,this.clientSocket.sendCmd("kick",t);case 3:return c=m.sent,m.abrupt("return",null===(a=c.content)||void 0===a?void 0:a.deviceIds);case 5:case"end":return m.stop()}}),_callee5,this)})))},a._checkApiVersion=function _checkApiVersion(){if("v1"!==this.core.options.apiVersion)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},a.nimLoginClientChangeHandler=function nimLoginClientChangeHandler(t){if(t.error)this.logger.error("nimLoginClientChangeHandler:: error, ",t.error);else{var a=t.content,c=formatMultiPortLoginInfo(a.datas,a.state);c.length>0&&(this.core.emit("multiPortLogin",c),this.emit("multiPortLogin",c))}},a.kickedHandler=function kickedHandler(t){if(t.error)this.logger.error("kickedHandler:: error, ",t.error);else{var a=function formatBeKickedTag$1(t){var a=format({clientType:{type:"enum",values:Jp},customClientType:{type:"number"}},t),c=bm[a.reason];return qt(a,c=c||{reason:"unknow",message:"Unknown reason"})}(t.content);this.logger.warn("kicked::",a),this.clientSocket.doDisconnect(oh.KICKED,a),this.core._clearModuleData()}},a.getConnectStatus=function getConnectStatus(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},a.getLoginStatus=function getLoginStatus(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},a.getLoginUser=function getLoginUser(){return this.core.options.account},V1NIMLoginServiceImpl}(gh);function formatLoginInfo(t){return format({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timetag:{type:"number"},loginType:{type:"number"}},t)}var yh=TypeError,_h=Object.getOwnPropertyDescriptor,Ih=R&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(Fr(t)&&!_h(t,"length").writable)throw yh("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},Mh=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw Mh("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},Th=arrayMethodHasSpeciesSupport("splice"),Sh=Math.max,Eh=Math.min;_export({target:"Array",proto:!0,forced:!Th},{splice:function splice(t,a){var c,m,h,g,I,M,T=toObject(this),S=lengthOfArrayLike(T),E=toAbsoluteIndex(t,S),C=arguments.length;for(0===C?c=m=0:1===C?(c=0,m=S-E):(c=C-2,m=Eh(Sh(toIntegerOrInfinity(a),0),S-E)),doesNotExceedSafeInteger(S+c-m),h=arraySpeciesCreate(T,m),g=0;g<m;g++)(I=E+g)in T&&createProperty(h,g,T[I]);if(h.length=m,c<m){for(g=E;g<S-m;g++)M=g+c,(I=g+m)in T?T[M]=T[I]:deletePropertyOrThrow(T,M);for(g=S;g>S-m+c;g--)deletePropertyOrThrow(T,g-1)}else if(c>m)for(g=S-m;g>E;g--)M=g+c-1,(I=g+m-1)in T?T[M]=T[I]:deletePropertyOrThrow(T,M);for(g=0;g<c;g++)T[g+E]=arguments[g+2];return Ih(T,S-m+c),h}});var Ch=entryVirtual("Array").splice,bh=Array.prototype,splice$1=function(t){var a=t.splice;return t===bh||Y(bh,t)&&a===bh.splice?Ch:a};function _createForOfIteratorHelperLoose$9(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$9(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$9(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$9(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$9(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var Ah=function(){function TimerManager(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,c){void 0===a&&(a=0),void 0===c&&(c=1);var m=(new Date).getTime(),h=this.id;return this.timerList.push({id:h,loop:c,count:0,timeout:m+a,interval:a,callback:t}),this.id++,this.checkTimer(m),h},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,c,m=0,h=_createForOfIteratorHelperLoose$9(this.timerList);!(a=h()).done;){var g=a.value;(0===m||m>g.timeout)&&(m=g.timeout)}if(0!==this.timerList.length)if(null===this.timer||m<this.timeout||this.timeout<t)this.timer=Gi(bind$1(c=this.nowTime).call(c,this),m-t),this.timeout=m}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose$9(this.timerList);!(t=a()).done;){var c=t.value;nowTime>=c.timeout&&(c.callback(),c.count++,c.timeout=nowTime+c.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var c;if(this.timerList[a].id===t)splice$1(c=this.timerList).call(c,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,c=this.timerList[t];if(c.loop>=0&&c.count>=c.loop)splice$1(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},TimerManager}();var Nh=function baseForOwn(t,a){return t&&sd(t,a,fm)};var Rh=function baseInverter(t,a,c,m){return Nh(t,(function(t,h,g){a(m,c(t),h,g)})),m};var wh=function createInverter(t,a){return function(c,m){return Rh(c,t,a(m),{})}},kh=Object.prototype.toString,Oh=wh((function(t,a,c){null!=a&&"function"!=typeof a.toString&&(a=kh.call(a)),t[a]=c}),lp(ip)),Ph={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},xh={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},Vh={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,ip:3,port:4,type:5,customClientType:6,timetag:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,ip:103,port:104,timetag:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,ip:103,port:104,type:6,customClientType:13,timetag:105,os:30,pushType:100,hasTokenPreviously:101}},Lh={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:Vh.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:Oh(Vh.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:Oh(Vh.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Oh(Vh.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},Dh={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Oh(Vh.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:Oh(Vh.qchatAuthRepTag)}]}},Uh=gi.codeAt;_export({target:"String",proto:!0},{codePointAt:function codePointAt(t){return Uh(this,t)}});var Fh=entryVirtual("String").codePointAt,Bh=String.prototype,codePointAt=function(t){var a=t.codePointAt;return"string"==typeof t||t===Bh||Y(Bh,t)&&a===Bh.codePointAt?Fh:a},qh=RangeError,Gh=String.fromCharCode,Hh=String.fromCodePoint,jh=N([].join),Yh=!!Hh&&1!=Hh.length;_export({target:"String",stat:!0,arity:1,forced:Yh},{fromCodePoint:function fromCodePoint(t){for(var a,c=[],m=arguments.length,h=0;m>h;){if(a=+arguments[h++],toAbsoluteIndex(a,1114111)!==a)throw qh(a+" is not a valid code point");c[h]=a<65536?Gh(a):Gh(55296+((a-=65536)>>10),a%1024+56320)}return jh(c,"")}});var $h=j.String.fromCodePoint,Wh=function abs(t){var a;if(void 0!==t)return(a=BigNumber(t)).sign=1,a},zh=function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)},Kh=function isValidType(t){var a;return some(a=["number"==typeof t,"string"==typeof t&&t.length>0,zh(t)&&t.length>0,t instanceof BigNumber]).call(a,(function(t){return!0===t}))},Qh="Invalid Number",Jh="Invalid Number - Division By Zero";function BigNumber(t){var a;if(!(this instanceof BigNumber))return new BigNumber(t);if(this.number=[],this.sign=1,this.rest=0,Kh(t)){if(zh(t)){for((t.length&&"-"===t[0]||"+"===t[0])&&(this.sign="+"===t[0]?1:-1,t.shift(0)),a=t.length-1;a>=0;a--)if(!this.addDigit(t[a]))return}else for("-"!==(t=t.toString()).charAt(0)&&"+"!==t.charAt(0)||(this.sign="+"===t.charAt(0)?1:-1,t=t.substring(1)),a=t.length-1;a>=0;a--)if(!this.addDigit(em(t.charAt(a),10)))return}else this.number=Qh}BigNumber.prototype.addDigit=function(t){return function testDigit(t){return/^\d$/.test(t)}(t)?(this.number.push(t),this):(this.number=Qh,!1)},BigNumber.prototype._compare=function(t){var a,c;if(!Kh(t))return null;if(a=BigNumber(t),this.sign!==a.sign)return this.sign;if(this.number.length>a.number.length)return this.sign;if(this.number.length<a.number.length)return-1*this.sign;for(c=this.number.length-1;c>=0;c--){if(this.number[c]>a.number[c])return this.sign;if(this.number[c]<a.number[c])return-1*this.sign}return 0},BigNumber.prototype.gt=function(t){return this._compare(t)>0},BigNumber.prototype.gte=function(t){return this._compare(t)>=0},BigNumber.prototype.equals=function(t){return 0===this._compare(t)},BigNumber.prototype.lte=function(t){return this._compare(t)<=0},BigNumber.prototype.lt=function(t){return this._compare(t)<0},BigNumber.prototype.subtract=function(t){var a;return void 0===t?this:(a=BigNumber(t),this.sign!==a.sign?(this.number=BigNumber._add(this,a),this):(this.sign=this.lt(a)?-1:1,this.number=Wh(this).lt(Wh(a))?BigNumber._subtract(a,this):BigNumber._subtract(this,a),this))},BigNumber._add=function(t,a){var c,m=0,h=Math.max(t.number.length,a.number.length);for(c=0;c<h||m>0;c++)t.number[c]=(m+=(t.number[c]||0)+(a.number[c]||0))%10,m=Math.floor(m/10);return t.number},BigNumber._subtract=function(t,a){var c,m,h=0,g=t.number.length;for(c=0;c<g;c++)t.number[c]-=(a.number[c]||0)+h,t.number[c]+=10*(h=t.number[c]<0?1:0);for(c=0,g=t.number.length-1;0===t.number[g-c]&&g-c>0;)c++;c>0&&splice$1(m=t.number).call(m,-c);return t.number},BigNumber.prototype.multiply=function(t){if(void 0===t)return this;var a,c,m=BigNumber(t),h=0,g=[];if(this.isZero()||m.isZero())return BigNumber(0);for(this.sign*=m.sign,a=0;a<this.number.length;a++)for(h=0,c=0;c<m.number.length||h>0;c++)g[a+c]=(h+=(g[a+c]||0)+this.number[a]*(m.number[c]||0))%10,h=Math.floor(h/10);return this.number=g,this},BigNumber.prototype.divide=function(t){if(void 0===t)return this;var a,c,m=BigNumber(t),h=[],g=BigNumber(0);if(m.isZero())return this.number=Jh,this;if(this.isZero())return this.rest=BigNumber(0),this;if(this.sign*=m.sign,m.sign=1,1===m.number.length&&1===m.number[0])return this.rest=BigNumber(0),this;for(a=this.number.length-1;a>=0;a--)for(g.multiply(10),g.number[0]=this.number[a],h[a]=0;m.lte(g);)h[a]++,g.subtract(m);for(a=0,c=h.length-1;0===h[c-a]&&c-a>0;)a++;return a>0&&splice$1(h).call(h,-a),this.rest=g,this.number=h,this},BigNumber.prototype.mod=function(t){return this.divide(t).rest},BigNumber.prototype.isZero=function(){var t;for(t=0;t<this.number.length;t++)if(0!==this.number[t])return!1;return!0},BigNumber.prototype.toString=function(){var t,a="";if("string"==typeof this.number)return this.number;for(t=this.number.length-1;t>=0;t--)a+=this.number[t];return this.sign>0?a:"-"+a};var Xh=Math.pow(2,32);function varintToBytes(t){var a=new Uint8Array(4),c=new DataView(a.buffer),m=0;do{var h=127&t;(t>>>=7)>0&&(h|=128),c.setUint8(m++,h)}while(t>0);return slice$1(a).call(a,0,m)}function encodeText(t){if("function"==typeof TextEncoder)return(new TextEncoder).encode(t);var a=function textEncoder(t){for(var a=[],c=t.length,m=0;m<c;){var h=codePointAt(t).call(t,m),g=0,I=0;for(h<=127?(g=0,I=0):h<=2047?(g=6,I=192):h<=65535?(g=12,I=224):h<=2097151&&(g=18,I=240),a.push(I|h>>g),g-=6;g>=0;)a.push(128|h>>g&63),g-=6;m+=h>=65536?2:1}return a}(t);return new Uint8Array(a)}function decodeText(t){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(t):function textDecoder(t){for(var a="",c=0;c<t.length;){var m=t[c],h=0,g=0;if(m<=127?(h=0,g=255&m):m<=223?(h=1,g=31&m):m<=239?(h=2,g=15&m):m<=244&&(h=3,g=7&m),t.length-c-h>0)for(var I=0;I<h;)g=g<<6|63&(m=t[c+I+1]),I+=1;else g=65533,h=t.length-c;a+=$h(g),c+=h+1}return a}(t)}var Zh=function(){function Unpack(t){this.offset=0,this.buffer=new Uint8Array(t),this.view=new DataView(t)}var t=Unpack.prototype;return t.checkBufferBoundaryAccess=function checkBufferBoundaryAccess(){return this.offset>=this.buffer.byteLength},t.length=function length(){var t;return(null===(t=this.view)||void 0===t?void 0:t.byteLength)||0},t.getBuffer=function getBuffer(){return this.view.buffer},t.popRaw=function popRaw(t){try{var a,c=slice$1(a=this.buffer).call(a,this.offset,this.offset+t);return this.offset+=t,c}catch(t){throw new Error("UnpackException raw")}},t.popByte=function popByte(){try{var t=this.view.getUint8(this.offset);return this.offset+=1,t}catch(t){throw new Error("UnpackException byte")}},t.popVarbin=function popVarbin(){return this.popRaw(this.popVarInt())},t.popString=function popString(){try{return decodeText(this.popVarbin())}catch(t){throw new Error("UnpackException string")}},t.popInt=function popInt(){try{var t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}catch(t){throw new Error("UnpackException int")}},t.popVarInt=function popVarInt(){var t=1,a=0,c=0;do{a+=(127&(c=this.popByte()))*t,t*=128}while(0!=(128&c));return a},t.popLong=function popLong(){try{var t,a=function getBigUint64(t,a){void 0===a&&(a=!1);var c=new DataView(t.buffer),m=a?[4,0]:[0,4],h=m[0],g=m[1],I=c.getUint32(h,a),M=c.getUint32(g,a);return I>0?I*Xh+M:M}(slice$1(t=this.buffer).call(t,this.offset,this.offset+8),!0);return this.offset+=8,Number(a)}catch(t){throw new Error("UnpackException long")}},t.popShort=function popShort(){try{var t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}catch(t){throw new Error("UnpackException short")}},t.popBoolean=function popBoolean(){return this.popByte()>0},t.toString=function toString(){return Wc(new Uint8Array(this.buffer)).toString()},t.reset=function reset(){this.offset=0,this.buffer=null,this.view=null},Unpack}(),eg=function(){function PacketDecoder(t){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.unpack=new Zh(t)}var t=PacketDecoder.prototype;return t.reset=function reset(){this.innerHeader=null,this.unpack.reset()},t.unmarshalHeader=function unmarshalHeader(){var t,a=this._unmarshalHeader();this.packetLength=a.packetLength,this.serviceId=a.serviceId,this.commandId=a.commandId,this.serialId=a.serialId,this.tag=a.tag,this.resCode=a.resCode,4===a.serviceId&&includes(t=[1,2,10,11]).call(t,a.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},t._unmarshalHeader=function _unmarshalHeader(){var t=this.unpack.popVarInt(),a=this.unpack.popByte(),c=this.unpack.popByte(),m=this.unpack.popShort(),h=this.unpack.popByte(),g=200;return this.hasRescode(h)&&(g=this.unpack.popShort()),{packetLength:t,serviceId:a,commandId:c,serialId:m,tag:h,resCode:g}},t.hasRescode=function hasRescode(t){return 0!=((t=t||this.tag)&PacketDecoder.RES_CODE)},t.getHeader=function getHeader(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},t.getInnerHeader=function getInnerHeader(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},t.unmarshalProperty=function unmarshalProperty(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popVarInt(),h=this.unpack.popString();a[m]=h}return a},t.unmarshalPropertyArray=function unmarshalPropertyArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unmarshalProperty());return a},t.unmarshalLong=function unmarshalLong(){return this.unpack.popLong()},t.unmarshalLongArray=function unmarshalLongArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unpack.popLong());return a},t.unmarshalStrArray=function unmarshalStrArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unpack.popString());return a},t.unmarshalStrLongMap=function unmarshalStrLongMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popString(),h=this.unpack.popLong();a[m]=h}return a},t.unmarshalStrStrMap=function unmarshalStrStrMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popString(),h=this.unpack.popString();a[m]=h}return a},t.unmarshalLongLongMap=function unmarshalLongLongMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popLong(),h=this.unpack.popLong();a[m]=h}return{m_map:a}},t.unmarshalKVArray=function unmarshalKVArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unmarshalStrStrMap());return a},t.unmarshal=function unmarshal(t){var a,c=this,m=qt(qt({},this.getHeader()),{r:[]});if(this.innerHeader&&(m.r[0]=this.msgId,m.r[1]={body:[],headerPacket:this.getInnerHeader()}),!includes(a=[200,406,808,810,7101]).call(a,m.code))return Fc(m);var h=[];return t&&forEach$1(t).call(t,(function(t){if(!c.unpack.checkBufferBoundaryAccess())switch(t.type){case"PropertyArray":h.push(c.unmarshalPropertyArray());break;case"Property":h.push(c.unmarshalProperty());break;case"Byte":h.push(c.unpack.popByte());break;case"Int":h.push(c.unpack.popInt());break;case"Bool":h.push(c.unpack.popBoolean());break;case"Long":h.push(c.unmarshalLong());break;case"LongArray":h.push(c.unmarshalLongArray());break;case"String":h.push(c.unpack.popString());break;case"StrArray":h.push(c.unmarshalStrArray());break;case"StrStrMap":h.push(c.unmarshalStrStrMap());break;case"StrLongMap":h.push(c.unmarshalStrLongMap());break;case"LongLongMap":h.push(c.unmarshalLongLongMap());break;case"KVArray":h.push(c.unmarshalKVArray())}})),this.innerHeader?m.r[1].body=h:m.r=h,Fc(m)},PacketDecoder}();eg.RES_CODE=2;var tg=function(){function Pack(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var t=Pack.prototype;return t.reset=function reset(){this.offset=0,this.buffer=null,this.view=null},t.size=function size(){return this.offset},t.getBuffer=function getBuffer(){var t;return slice$1(t=this.buffer).call(t,0,this.offset).buffer},t.ensureCapacity=function ensureCapacity(t){var a=this.offset+t;if(a>this.capacity)throw new Error("PackException over limit");if(a>this.buffer.byteLength){var c=Math.ceil(a/this.pageSize)*this.pageSize,m=new Uint8Array(c);m.set(this.buffer),this.buffer=m,this.view=new DataView(this.buffer.buffer)}},t.putRaw=function putRaw(t){this.ensureCapacity(t.length);try{this.buffer.set(t,this.offset),this.offset+=t.length}catch(t){throw new Error("PackException raw")}},t.putByte=function putByte(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t)}catch(t){throw new Error("PackException byte")}},t.putString=function putString(t){try{var a=encodeText(t);this.putVarbin(a)}catch(t){throw new Error("PackException string")}},t.putInt=function putInt(t){this.ensureCapacity(4);try{this.view.setInt32(this.offset,t,!0),this.offset+=4}catch(t){throw new Error("PackException int")}},t.putVarInt=function putVarInt(t){var a=varintToBytes(t);this.putRaw(a)},t.putBoolean=function putBoolean(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t?1:0)}catch(t){throw new Error("PackException boolean")}},t.putLong=function putLong(t){this.ensureCapacity(8);try{var a=function setBigUint64(t,a){void 0===a&&(a=!1);var c=new Uint8Array(8),m=new DataView(c.buffer),h=Number(t>Xh-1?t/Xh:0),g=Number(4294967295&t),I=a?[4,0]:[0,4],M=I[0],T=I[1];return m.setUint32(M,h,a),m.setUint32(T,g,a),c}(t,!0);this.buffer.set(a,this.offset),this.offset+=8}catch(t){throw new Error("PackException long")}},t.putStringAsLong=function putStringAsLong(t){this.ensureCapacity(8);try{var a=function setBigUint64ForNumberOverflow(t,a){var c,m;void 0===a&&(a=!1);var h=new Uint8Array(8),g=new DataView(h.buffer),I=reverse$1(c=BigNumber(t).divide(Xh).number).call(c).join(""),M=reverse$1(m=BigNumber(t).mod(Xh).number).call(m).join(""),T=Number(I),S=Number(M),E=a?[4,0]:[0,4],C=E[0],b=E[1];return g.setUint32(C,T,a),g.setUint32(b,S,a),h}(t,!0);this.buffer.set(a,this.offset),this.offset+=8}catch(t){throw new Error("PackException stringAsLong")}},t.putShort=function putShort(t){this.ensureCapacity(2);try{this.view.setInt16(this.offset,t,!0),this.offset+=2}catch(t){throw new Error("PackException short")}},t.putVarbin=function putVarbin(t){if(!t)return this.ensureCapacity(1),this.putVarInt(0);if(t.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var a=varintToBytes(t.length);this.ensureCapacity(a.length+t.length);try{this.buffer.set(a,this.offset),this.offset+=a.length,this.buffer.set(t,this.offset),this.offset+=t.length}catch(t){throw new Error("PackException varbin")}},Pack}();function isConvertibleToNumber(t){if("number"!=typeof t){if(null==t)return!1;t=Number(t)}if(isNaN(t))throw new Error("Number type conversion error");return!0}function isUndefinedOrNull(t){return null==t}var rg,ng=function(){function PacketEncoder(t,a,c){this.pack=new tg,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=t,this.commandId=a,this.serialId=c}var t=PacketEncoder.prototype;return t.marshalHeader=function marshalHeader(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},t.marshalProperty=function marshalProperty(t){var a=this,c=mn(t),m=filter(c).call(c,(function(t){return!isUndefinedOrNull(t)}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){a.pack.putVarInt(Number(c)),jc(t[c])||"[object Object]"===Object.prototype.toString.call(t[c])?a.pack.putString(Fc(t[c])):a.pack.putString(String(t[c]))}))},t.marshalPropertyArray=function marshalPropertyArray(t){var a=this,c=t.length;this.pack.putVarInt(c),forEach$1(t).call(t,(function(t){a.marshalProperty(null==t?void 0:t.v)}))},t.marshalStrArray=function marshalStrArray(t){var a=this,c=filter(t).call(t,(function(t){return!isUndefinedOrNull(t)})),m=c.length;this.pack.putVarInt(m),forEach$1(c).call(c,(function(t){a.pack.putString(String(t))}))},t.marshalLongArray=function marshalLongArray(t){var a=this,c=filter(t).call(t,(function(t){return isConvertibleToNumber(t)})),m=c.length;this.pack.putVarInt(m),forEach$1(c).call(c,(function(t){a.putLong(t)}))},t.marshalStrStrMap=function marshalStrStrMap(t){var a=this,c=mn(t),m=filter(c).call(c,(function(a){return!isUndefinedOrNull(t[a])&&!isUndefinedOrNull(a)}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){a.pack.putString(String(c)),a.pack.putString(String(t[c]))}))},t.marshalStrLongMap=function marshalStrLongMap(t){var a=this,c=mn(t),m=filter(c).call(c,(function(a){return isConvertibleToNumber(t[a])&&!isUndefinedOrNull(a)}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){a.pack.putString(String(c)),a.putLong(t[c])}))},t.marshalLongLongMap=function marshalLongLongMap(t){var a=this,c=mn(t),m=filter(c).call(c,(function(a){var c=Number(a);return isConvertibleToNumber(c)&&isConvertibleToNumber(t[c])}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){var m=Number(c);a.putLong(m),a.putLong(t[m])}))},t.marshalKVArray=function marshalKVArray(t){var a=this,c=t.length;this.pack.putVarInt(c),forEach$1(t).call(t,(function(t){a.marshalStrStrMap(t)}))},t.putLong=function putLong(t){"string"==typeof t&&t.length>15?this.pack.putStringAsLong(t):this.pack.putLong(Number(t))},t.marshal=function marshal(t,a){var c=this;return this.marshalHeader(),a&&forEach$1(a).call(a,(function(a,m){var h,g=a.type,I=null===(h=t[m])||void 0===h?void 0:h.v;if(!isUndefinedOrNull(I))switch(g){case"PropertyArray":c.marshalPropertyArray(I);break;case"Property":c.marshalProperty(I);break;case"Byte":if(!isConvertibleToNumber(I))return;c.pack.putByte(Number(I));break;case"Int":if(!isConvertibleToNumber(I))return;c.pack.putInt(Number(I));break;case"Bool":"false"===I?I=!1:"true"===I&&(I=!0),c.pack.putBoolean(I);break;case"Long":if(!isConvertibleToNumber(I))return;c.putLong(I);break;case"LongArray":c.marshalLongArray(I);break;case"String":c.pack.putString(String(I));break;case"StrArray":c.marshalStrArray(I);break;case"StrStrMap":c.marshalStrStrMap(I);break;case"StrLongMap":c.marshalStrLongMap(I);break;case"LongLongMap":c.marshalLongLongMap(I);break;case"KVArray":c.marshalKVArray(I)}})),this.pack.getBuffer()},t.reset=function reset(){this.pack.reset()},PacketEncoder}(),ag=function(t){function BaseWebsocket(a,c){var m;return(m=t.call(this)||this).url=c,m.websocket=null,m.socketConnectTimer=0,m.core=a,m.url=c,m.status="disconnected",m.logger=a.logger,m.connect(),m}kt(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket("wss://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect")}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=Gi((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("connectFailed",new Yu({code:"v2"===ws(c.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new Cp.WebSocket(t),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(){c.logger.log("imsocket::Websocket onclose done"),"connected"===c.status?(c.clean(),c.emit("disconnect")):(c.clean(),c.emit("connectFailed",new Yu({code:"v2"===ws(c.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"connected"===c.status?(c.clean(),c.emit("disconnect")):(c.clean(),c.emit("connectFailed",new Yu({code:"v2"===ws(c.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){c.onConnect()}},a.onMessage=function onMessage(t){if(t.data){var a=new eg(t.data),c={sid:-1,cid:-1,ser:-1,packetLength:-1},m=null;try{a.unmarshalHeader(),c=a.getHeader(),m=a.getInnerHeader()}catch(a){this.reportBinaryError({err:a,sid:m?m.sid:null==c?void 0:c.sid,cid:m?m.cid:null==c?void 0:c.cid,rawBuf:t.data,type:"decode"})}var h=m?m.sid:c.sid,g=m?m.cid:c.cid,I=h+"_"+g,M=kp[I];if(M&&M.length>0){var T,S=M[0].config;try{T=a.unmarshal(S.response)}catch(m){this.reportBinaryError({err:m,rawBuf:t.data,sid:h,cid:g,type:"decode"}),a.reset();var E=qt(qt({},c),{sid:h,cid:g,code:Gu.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+E.sid+"_"+E.cid+'", ser '+E.ser+", packetLength "+E.packetLength+" unmarshal error",m),void this.emit("message",Fc(E))}this.emit("message",T)}else this.core.logger.warn("imsocket::onMessage cmd not found",I);a.reset()}},a.send=function send(t,a,c,m,h){var g,I,M=new ng(t,a,c),T=wp[m],S="";try{S=Fc(h),I=M.marshal(JSON.parse(S),T.params)}catch(m){throw this.reportBinaryError({err:m,sid:t,cid:a,rawStr:S,type:"encode"}),M.reset(),new Yu({code:Gu.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:t+"-"+a+", ser "+c+" marshal error",rawError:m}})}null===(g=this.websocket)||void 0===g||g.send(I),M.reset()},a.reportBinaryError=function reportBinaryError(t){var a,c,m,h=t.err,g=t.rawStr,I=t.sid,M=t.cid,T=t.type,S=t.rawBuf;if(S){try{m=function arrayBufferToBase64(t){if("function"!=typeof btoa)return"";for(var a="",c=new Uint8Array(t),m=c.byteLength,h=0;h<m;h++)a+=String.fromCharCode(c[h]);return c=null,btoa(a)}(S)}catch(t){m="reportBinaryError::arrayBufferToBase64 parsing failed, error: "+(null==t?void 0:t.message)+", sid: "+I+", cid: "+M,this.core.logger.error(m)}S=null}this.core.reporter.reportTraceStart("exceptions",{user_id:null===(a=this.core.auth)||void 0===a?void 0:a.account,trace_id:null===(c=this.core.clientSocket.socket)||void 0===c?void 0:c.sessionId,start_time:wi(),action:2,exception_service:9}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===T?Gu.V2NIM_ERROR_CODE_PACK_ERROR:Gu.V2NIM_ERROR_CODE_UNPACK_ERROR,description:h&&(h.message||""+h.code)+(g?" rawStr: "+g:"")+(m?" rawBuf: "+m:""),operation_type:"encode"===T?3:4,target:I+"-"+M},{asyncParams:Cp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},BaseWebsocket}(Hi);function _createForOfIteratorHelperLoose$8(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$8(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$8(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$8(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$8(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(rg||(rg={}));var ig,og=function(){function V2BinaryClientSocket(t){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new Am({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Ml,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,this.auth=t.auth,this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager,this.eventBus=t.eventBus,this.setListener()}var t=V2BinaryClientSocket.prototype;return t.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.isReconnect=!0}))},t.setSessionId=function setSessionId(t){this.socket&&(this.socket.sessionId=t)},t.connect=function connect(t,a){var c,m;return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){var h,g,I,M;return Dc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(this.isReconnect=a,(h=this.core.auth.getConnectStatus())!==iu.V2NIM_CONNECT_STATUS_CONNECTED){T.next=7;break}return g="clientSocket::connect status is "+h+", and would not repeat connect",I=new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:g}}),this.logger.warn(g),T.abrupt("return",Mi.reject(I));case 7:return this.auth.lifeCycle.processEvent("connect"),T.prev=8,T.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+a),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),T.next=28;break;case 16:if(T.prev=16,T.t0=T.catch(8),M=T.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:M.code||0,description:"connectFailed:"+M.message,mixlink:!0,succeed:!1},{asyncParams:Cp.net.getNetworkStatus()}),M.code!==Gu.V2NIM_ERROR_CODE_CANCELLED&&M.code!==Gu.V2NIM_ERROR_CODE_TIMEOUT){T.next=25;break}throw null===(c=this.socket)||void 0===c||c.close(),null===(m=this.socket)||void 0===m||m.removeAllListeners(),this.socket=void 0,T.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,M),this.auth.lifeCycle.processEvent("connectFail",M),T.t0;case 28:case"end":return T.stop()}}),_callee,this,[[8,16]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new Mi((function(m,h){var g;a.socket=new ag(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV2::socket on connect",t),a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t}),c=!0,m()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,this.logger.log("clientSocketV2::socket on disconnect",m),a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(rg.OFFLINE,"SocketOnDisconnect");case 6:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("connectFailed",(function(t){c?a.ping():(a.logger.error('clientSocketV2::connectFailed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,h(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",a),this.core.auth.getConnectStatus()!==iu.V2NIM_CONNECT_STATUS_DISCONNECTED){var c={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Yu({code:Gu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===rg.ACTIVE||t===rg.KICKED?this.destroyOnlineListener():t===rg.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Yu({code:Gu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function sendCmd(t,a,c){var m=this,h=this.core.auth.getLoginStatus(),g=["v2Login","login","chatroomLogin","v2ChatroomLogin"],I={cmd:t};if(h!==tu.V2NIM_LOGIN_STATUS_LOGINED&&!includes(g).call(g,t))return this.logger.warn("clientSocketV2::NIM login status is "+h+", so can not sendCmd "+t),Mi.reject(new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:qt({reason:"Can not sendCmd due to no logined"},I)}));var M="heartbeat"!==t,T=M?this.packetSer++:0,S=createCmd(t,T,this.logger,a);if(!S){var E=new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:qt(qt({},I),{reason:"SendCmd::createCmd error: "+T+" "+t})});return this.logger.error(E),Mi.reject(E)}var C=S.packet,b=S.hasPacketResponse,A=S.hasPacketTimer,N=Fc(C);M&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::sendCmd",t,"ser:"+T,N):this.logger.log("clientSocketV2::sendCmd",t,"ser:"+T));var R=(new Date).getTime();return new Mi((function(h,g){b&&m.sendingCmdMap.set(T,{cmd:t,params:a,callback:[h,g],timer:A?Gi((function(){var a=new Yu({code:Gu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:qt({ser:T,reason:"Packet Timeout: ser "+T+" cmd "+t,timetag:(new Date).getTime()},I)});m.markCmdInvalid(T,a,t)}),c&&c.timeout?c.timeout:m.packetTimeout):null});try{m.socket.send(C.SID,C.CID,T,t,C.Q),b||h(C)}catch(a){var M=new Yu({code:Gu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:qt({ser:T,reason:"Unable to send packet"+(a&&a.message?": "+a.message:""),timetag:(new Date).getTime(),rawError:a},I)});m.markCmdInvalid(T,M,t),g(M)}})).catch((function(t){return __awaiter(m,void 0,void 0,Dc.mark((function _callee3(){var a,c;return Dc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t,c=[Gu.V2NIM_ERROR_CODE_DISCONNECT,Gu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Gu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],includes(c).call(c,a.code)){m.next=4;break}return m.abrupt("return",Mi.reject(a));case 4:return this.reportSendCmdFailed(a,{sid:C.SID,cid:C.CID,ser:T},R),m.abrupt("return",Mi.reject(a));case 6:case"end":return m.stop()}}),_callee3,this)})))}))},t.reportSendCmdFailed=function reportSendCmdFailed(t,a,c){var m;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(m=this.socket)||void 0===m?void 0:m.sessionId,start_time:c,action:2,exception_service:6});var h=ws(t,"detail.disconnect_reason")||"",g=t.code===Gu.V2NIM_ERROR_CODE_DISCONNECT?Fc({disconnect_reason:h}):t.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:t.code,description:g,operation_type:1,target:a.sid+"-"+a.cid,context:""+a.ser},{asyncParams:Cp.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a){var c=a[0],m=c.raw.ser;"heartbeat"!==c.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::recvCmd ser:"+m+" "+c.raw.sid+"_"+c.raw.cid+". "+t):this.logger.log("clientSocketV2::recvCmd ser:"+m+" "+c.raw.sid+"_"+c.raw.cid));for(var h,g=_createForOfIteratorHelperLoose$8(a);!(h=g()).done;){var I=h.value;if(I.error&&this.logger.error("clientSocketV2::onMessage packet error",I.raw.sid+"_"+I.raw.cid+", ser:"+m+",",I.error),I.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",I.raw.sid+"_"+I.raw.cid+", ser:"+m);this.packetHandler(I)}}},t.packetHandler=function packetHandler(t){var a,c;if(t){var m=t.raw.ser,h=this.sendingCmdMap.get(m);if(h&&h.cmd===t.cmd){var g=h.callback,I=h.timer,M=h.params;if(clearTimeout(I),t.params=M,this.sendingCmdMap.delete(m),"heartbeat"===t.cmd)return void g[0]();var T=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);T&&"function"==typeof T.then?T.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),g[0](t))}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var m=this.sendingCmdMap.get(t);if(m){var h=m.callback,g=m.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+c+" is invalid:",a),h[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,h=a.timer,g=a.cmd;c.logger.debug("clientSocketV2::markAllCmdInvaild:cmd "+g),h&&clearTimeout(h),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a=this;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=20;break;case 6:if(c.prev=6,c.t0=c.catch(1),c.t0.code!==Gu.V2NIM_ERROR_CODE_DISCONNECT){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,this.testHeartBeat5Timeout();case 13:if(!c.sent){c.next=20;break}return c.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(rg.OFFLINE,"PingError"),c.abrupt("return");case 20:this.pingTimer=Gi((function(){a.ping()}),3e4);case 21:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var t;return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Cp.net.onNetworkStatusChange((function(a){t.logger.log("clientSocketV2::onlineListener:network change",a);var c=t.auth.getConnectStatus(),m=t.auth.getLoginStatus();a.isConnected&&m===tu.V2NIM_LOGIN_STATUS_LOGINED?t.ping():a.isConnected&&c===iu.V2NIM_CONNECT_STATUS_WAITING?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):a.isConnected||t.doDisconnect(rg.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),Cp.net.offNetworkStatusChange(),this.hasNetworkListener=!1},V2BinaryClientSocket}();function _createForOfIteratorHelperLoose$7(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$7(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$7(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$7(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$7(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(ig||(ig={}));var sg=function(){function V2ClientSocket(t){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new Am({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Ml,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,this.auth=t.auth,this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager,this.eventBus=t.eventBus,this.setListener()}var t=V2ClientSocket.prototype;return t.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.isReconnect=!0}))},t.setSessionId=function setSessionId(t){this.socket&&(this.socket.sessionId=t)},t.connect=function connect(t,a){var c,m;return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){var h,g,I,M;return Dc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(this.isReconnect=a,(h=this.core.auth.getConnectStatus())!==iu.V2NIM_CONNECT_STATUS_CONNECTED){T.next=7;break}return g="clientSocket::connect status is "+h+", and would not repeat connect",I=new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:g}}),this.logger.warn(g),T.abrupt("return",Mi.reject(I));case 7:return this.auth.lifeCycle.processEvent("connect"),T.prev=8,T.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+a),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),T.next=28;break;case 16:if(T.prev=16,T.t0=T.catch(8),M=T.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:M.code||0,description:"connectFailed:"+M.message,mixlink:!0,succeed:!1},{asyncParams:Cp.net.getNetworkStatus()}),M.code!==Gu.V2NIM_ERROR_CODE_CANCELLED&&M.code!==Gu.V2NIM_ERROR_CODE_TIMEOUT){T.next=25;break}throw null===(c=this.socket)||void 0===c||c.close(),null===(m=this.socket)||void 0===m||m.removeAllListeners(),this.socket=void 0,T.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,M),this.auth.lifeCycle.processEvent("connectFail",M),T.t0;case 28:case"end":return T.stop()}}),_callee,this,[[8,16]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new Mi((function(m,h){var g;a.socket=new zm(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV2::socket on connect",t),a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t}),c=!0,m()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,this.logger.log("clientSocketV2::socket on disconnect",m),a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(ig.OFFLINE,"SocketOnDisconnect");case 6:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){c?a.ping():(a.logger.error('clientSocketV2::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,h(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",a),this.core.auth.getConnectStatus()!==iu.V2NIM_CONNECT_STATUS_DISCONNECTED){var c={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Yu({code:Gu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===ig.ACTIVE||t===ig.KICKED?this.destroyOnlineListener():t===ig.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Yu({code:Gu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function sendCmd(t,a,c){var m=this,h=this.core.auth.getLoginStatus(),g=["v2Login","login","chatroomLogin","v2ChatroomLogin"],I={cmd:t};if(h!==tu.V2NIM_LOGIN_STATUS_LOGINED&&!includes(g).call(g,t))return this.logger.warn("clientSocketV2::NIM login status is "+h+", so can not sendCmd "+t),Mi.reject(new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:qt({reason:"Can not sendCmd due to no logined"},I)}));var M="heartbeat"!==t,T=M?this.packetSer++:0,S=createCmd(t,T,this.logger,a);if(!S){var E=new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:qt(qt({},I),{reason:"SendCmd::createCmd error: "+T+" "+t})});return this.logger.error(E),Mi.reject(E)}var C=S.packet,b=S.hasPacketResponse,A=S.hasPacketTimer,N=Fc(C);M&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::sendCmd",t,"ser:"+T,N):this.logger.log("clientSocketV2::sendCmd",t,"ser:"+T));var R=(new Date).getTime();return new Mi((function(h,g){b&&m.sendingCmdMap.set(T,{cmd:t,params:a,callback:[h,g],timer:A?Gi((function(){var a=new Yu({code:Gu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:qt({ser:T,reason:"Packet Timeout: ser "+T+" cmd "+t,timetag:(new Date).getTime()},I)});m.markCmdInvalid(T,a,t)}),c&&c.timeout?c.timeout:m.packetTimeout):null});try{m.socket.send(N),b||h(C)}catch(a){var M=new Yu({code:Gu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:qt({ser:T,reason:"Unable to send packet"+(a&&a.message?": "+a.message:""),timetag:(new Date).getTime(),rawError:a},I)});m.markCmdInvalid(T,M,t),g(M)}})).catch((function(t){return __awaiter(m,void 0,void 0,Dc.mark((function _callee3(){var a,c,m,h,g;return Dc.wrap((function _callee3$(I){for(;;)switch(I.prev=I.next){case 0:if(c=t,m=[Gu.V2NIM_ERROR_CODE_DISCONNECT,Gu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Gu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],includes(m).call(m,c.code)){I.next=4;break}return I.abrupt("return",Mi.reject(c));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(a=this.socket)||void 0===a?void 0:a.sessionId,start_time:R,action:2,exception_service:6}),h=ws(c,"detail.disconnect_reason")||"",g=c.code===Gu.V2NIM_ERROR_CODE_DISCONNECT?Fc({disconnect_reason:h}):c.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:c.code,description:g,operation_type:1,target:C.SID+"-"+C.CID,context:""+C.SER},{asyncParams:Cp.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),I.abrupt("return",Mi.reject(c));case 10:case"end":return I.stop()}}),_callee3,this)})))}))},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,m=_createForOfIteratorHelperLoose$7(a);!(c=m()).done;){var h=c.value,g=h.raw.ser;if(h.error&&this.logger.error("clientSocketV2::onMessage packet error",h.raw.sid+"_"+h.raw.cid+", ser:"+g+",",h.error),h.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",h.raw.sid+"_"+h.raw.cid+", ser:"+g);"heartbeat"!==h.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::recvCmd ser:"+g,h.cmd,h.content):this.logger.log("clientSocketV2::recvCmd ser:"+g,h.cmd)),this.packetHandler(h)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var m=t.raw.ser,h=this.sendingCmdMap.get(m);if(h&&h.cmd===t.cmd){var g=h.callback,I=h.timer,M=h.params;if(clearTimeout(I),t.params=M,this.sendingCmdMap.delete(m),"heartbeat"===t.cmd)return void g[0]();var T=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);T&&"function"==typeof T.then?T.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),g[0](t))}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var m=this.sendingCmdMap.get(t);if(m){var h=m.callback,g=m.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+c+" is invalid:",a),h[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,h=a.timer,g=a.cmd;c.logger.debug("clientSocketV2::markAllCmdInvaild:cmd "+g),h&&clearTimeout(h),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a=this;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=20;break;case 6:if(c.prev=6,c.t0=c.catch(1),c.t0.code!==Gu.V2NIM_ERROR_CODE_DISCONNECT){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,this.testHeartBeat5Timeout();case 13:if(!c.sent){c.next=20;break}return c.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(ig.OFFLINE,"PingError"),c.abrupt("return");case 20:this.pingTimer=Gi((function(){a.ping()}),3e4);case 21:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var t;return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Cp.net.onNetworkStatusChange((function(a){t.logger.log("clientSocketV2::onlineListener:network change",a);var c=t.auth.getConnectStatus(),m=t.auth.getLoginStatus();a.isConnected&&m===tu.V2NIM_LOGIN_STATUS_LOGINED?t.ping():a.isConnected&&c===iu.V2NIM_CONNECT_STATUS_WAITING?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):a.isConnected||t.doDisconnect(ig.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),Cp.net.offNetworkStatusChange(),this.hasNetworkListener=!1},V2ClientSocket}(),cg=function(){function V2NIMLoginReconnect(t){this.currenRetryCount=0,this.backoff=new Am({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=t,this.auth=t.V2NIMLoginService}var t=V2NIMLoginReconnect.prototype;return t.reset=function reset(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.clearReconnectTimer=function clearReconnectTimer(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.attempToReLogin=function attempToReLogin(){var t=this,a=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var c=this.reconnectDelayProvider(a);"number"==typeof c&&c>=0&&(a=c>=1e3?c:c+200+Math.ceil(300*Math.random()))}catch(t){this.core.logger.error("reconnect::connectDelayProvider excute failed,",t)}return this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+a+" ms, current retry count is "+this.currenRetryCount),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=Gi((function(){t.core.logger.log("reconnect::reconnect timer is now triggered");var a=t.auth.getConnectStatus();a===iu.V2NIM_CONNECT_STATUS_WAITING?t.doReLogin():t.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+a)}),a),!0},t.doReLogin=function doReLogin(){var t=this;this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var a=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return a.then((function(){t.core.reporter.reportTraceEnd("login",!0)})).catch((function(a){var c=a;if(t.core.logger.warn("reconnect::try login but failed due to",c),t.core.reporter.reportTraceEnd("login",!1),t.auth.checkLoginTerminalCode(c&&c.code))return t.auth.clientSocket.doDisconnect(rg.ACTIVE,"ReloginTerminated"),void t.auth.lifeCycle.processEvent("exited",c);c&&399===c.code&&t.auth.lbs.reset(),t.auth.lifeCycle.processEvent("waiting")})),a},t._setReconnectDelayProvider=function _setReconnectDelayProvider(t){this.reconnectDelayProvider=t},V2NIMLoginReconnect}(),lg=function(){function V2NIMLoginLbs(t){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=t,this.auth=t.V2NIMLoginService}var t=V2NIMLoginLbs.prototype;return t.getLbsInfos=function getLbsInfos(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t,a,c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.socketLinkUrls.length>0)){h.next=5;break}return t=this.socketLinkUrls.shift(),this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",t),h.abrupt("return",Mi.resolve(t));case 5:return this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account),a=jm(this.auth.config.lbsUrls),h.prev=8,h.next=11,this.ladderLoad(a);case 11:if(200===(c=h.sent).status&&c.data){h.next=15;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",c.status,c),new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V2NIMLoginService::getLbsInfos failed, status "+c.status}});case 15:this.success(c),h.next=26;break;case 18:if(h.prev=18,h.t0=h.catch(8),m=h.t0,this.core.logger.error("V2NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",h.t0),this.reportForFail(a[0],m.code,m.message),!this.checkTerminator(m.code)){h.next=25;break}throw h.t0;case 25:this.socketLinkUrls=[this.auth.config.linkUrl];case 26:return h.abrupt("return",this.socketLinkUrls.shift());case 27:case"end":return h.stop()}}),_callee,this,[[8,18]])})))},t.checkTerminator=function checkTerminator(t){return t===Gu.V2NIM_ERROR_CODE_CANCELLED||t===Gu.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function generateUrl(t){return t+(indexOf(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function requstLbs(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function setLadderTimer(t,a,c,m){var h=this;this.timer&&clearTimeout(this.timer);var g=t[a];this.timer=Gi((function(){g&&(h.setLadderTimer(t,a+1,c,m),h.core.logger.log("V2NIMLoginService::getLbsInfos "+a+":",g),h.reportForLbsStart(g,a),h.requstLbs(g).then((function(t){h.reset(),c(qt(qt({},t),{url:g}))})).catch((function(c){var I;if(h.core.logger.warn("V2NIMLoginService::getLbsInfos "+a+" failed:",c),h.failedCount+=1,h.reportForFailOnce(g,c.code,(null===(I=c.detail)||void 0===I?void 0:I.reason)||c.message),h.failedCount>=t.length||h.checkTerminator(c.code))return h.reset(),void m(c)})))}),2e3)},t.ladderLoad=function ladderLoad(t){var a=this;return new Mi((function(c,m){t.length>1&&a.setLadderTimer(t,1,c,m);var h=t[0];a.core.logger.log("V2NIMLoginService::getLbsInfos 0:",h),a.reportForLbsStart(h,0),a.requstLbs(h).then((function(t){a.reset(),c(qt(qt({},t),{url:h}))})).catch((function(c){var g;a.failedCount+=1,a.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",c),a.reportForFailOnce(h,c.code,(null===(g=c.detail)||void 0===g?void 0:g.reason)||c.message),(a.failedCount>=t.length||a.checkTerminator(c.code))&&(a.reset(),m(c))}))}))},t.success=function success(t){var a,c,m,h,g,I=t.data.common;this.socketLinkUrls=jm(concat(a=concat(c=I["mix.link"]).call(c,I["link.default"])).call(a,[this.auth.config.linkUrl])),t.data["nos-chunk"]&&(null===(h=this.core.cloudStorage)||void 0===h?void 0:h.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",t.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:t.data["nos-chunk"]})),jc(t.data.nosup)&&t.data.nosup.length>0&&(this.core.logger.log("getLbsInfos success. lbs.nosup",t.data.nosup),null===(g=this.core.cloudStorage)||void 0===g||g.setOptions({commonUploadHostBackupList:t.data.nosup,commonUploadHost:t.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",slice$1(m=this.socketLinkUrls).call(m,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},t.reportForLbsStart=function reportForLbsStart(t,a){this.core.reporterHookLBS.updateBegin({target:t,index:a})},t.reportForLbsSuccess=function reportForLbsSuccess(t,a){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:Fc(a)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()})},t.reportForFailOnce=function reportForFailOnce(t,a,c){this.core.reporterHookLBS.updateComplete({target:t,code:a,body:c})},t.reportForFail=function reportForFail(t,a,c){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:c,code:a,succeed:!1},{asyncParams:Cp.net.getNetworkStatus()})},t.reset=function reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},V2NIMLoginLbs}();var ug=function arraySome(t,a){for(var c=-1,m=null==t?0:t.length;++c<m;)if(a(t[c],c,t))return!0;return!1};var dg=function equalArrays(t,a,c,m,h,g){var I=1&c,M=t.length,T=a.length;if(M!=T&&!(I&&T>M))return!1;var S=g.get(t),E=g.get(a);if(S&&E)return S==a&&E==t;var C=-1,b=!0,A=2&c?new wm:void 0;for(g.set(t,a),g.set(a,t);++C<M;){var N=t[C],R=a[C];if(m)var w=I?m(R,N,C,a,t,g):m(N,R,C,t,a,g);if(void 0!==w){if(w)continue;b=!1;break}if(A){if(!ug(a,(function(t,a){if(!Dm(A,a)&&(N===t||h(N,t,c,m,g)))return A.push(a)}))){b=!1;break}}else if(N!==R&&!h(N,R,c,m,g)){b=!1;break}}return g.delete(t),g.delete(a),b};var pg=function mapToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t,m){c[++a]=[m,t]})),c},mg=mo?mo.prototype:void 0,hg=mg?mg.valueOf:void 0;var vg=function equalByTag(t,a,c,m,h,g,I){switch(c){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!g(new ld(t),new ld(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return es(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var M=pg;case"[object Set]":var T=1&m;if(M||(M=Bm),t.size!=a.size&&!T)return!1;var S=I.get(t);if(S)return S==a;m|=2,I.set(t,a);var E=dg(M(t),M(a),m,h,g,I);return I.delete(t),E;case"[object Symbol]":if(hg)return hg.call(t)==hg.call(a)}return!1};var fg=function arrayPush(t,a){for(var c=-1,m=a.length,h=t.length;++c<m;)t[h+c]=a[c];return t};var yg=function baseGetAllKeys(t,a,c){var m=a(t);return co(t)?m:fg(m,c(t))};var _g=function arrayFilter(t,a){for(var c=-1,m=null==t?0:t.length,h=0,g=[];++c<m;){var I=t[c];a(I,c,t)&&(g[h++]=I)}return g};var Ig=function stubArray(){return[]},Mg=Object.prototype.propertyIsEnumerable,Tg=Object.getOwnPropertySymbols,Sg=Tg?function(t){return null==t?[]:(t=Object(t),_g(Tg(t),(function(a){return Mg.call(t,a)})))}:Ig,Eg=Sg;var Cg=function getAllKeys(t){return yg(t,fm,Eg)},bg=Object.prototype.hasOwnProperty;var Ag=function equalObjects(t,a,c,m,h,g){var I=1&c,M=Cg(t),T=M.length;if(T!=Cg(a).length&&!I)return!1;for(var S=T;S--;){var E=M[S];if(!(I?E in a:bg.call(a,E)))return!1}var C=g.get(t),b=g.get(a);if(C&&b)return C==a&&b==t;var A=!0;g.set(t,a),g.set(a,t);for(var N=I;++S<T;){var R=t[E=M[S]],w=a[E];if(m)var k=I?m(w,R,E,a,t,g):m(R,w,E,t,a,g);if(!(void 0===k?R===w||h(R,w,c,m,g):k)){A=!1;break}N||(N="constructor"==E)}if(A&&!N){var O=t.constructor,P=a.constructor;O==P||!("constructor"in t)||!("constructor"in a)||"function"==typeof O&&O instanceof O&&"function"==typeof P&&P instanceof P||(A=!1)}return g.delete(t),g.delete(a),A},Ng=Ho(po,"DataView"),Rg=Ho(po,"Promise"),wg=Ho(po,"WeakMap"),kg="[object Map]",Og="[object Promise]",Pg="[object Set]",xg="[object WeakMap]",Vg="[object DataView]",Lg=xo(Ng),Dg=xo(cs),Ug=xo(Rg),Fg=xo(Um),Bg=xo(wg),qg=To;(Ng&&qg(new Ng(new ArrayBuffer(1)))!=Vg||cs&&qg(new cs)!=kg||Rg&&qg(Rg.resolve())!=Og||Um&&qg(new Um)!=Pg||wg&&qg(new wg)!=xg)&&(qg=function(t){var a=To(t),c="[object Object]"==a?t.constructor:void 0,m=c?xo(c):"";if(m)switch(m){case Lg:return Vg;case Dg:return kg;case Ug:return Og;case Fg:return Pg;case Bg:return xg}return a});var Gg=qg,Hg="[object Arguments]",jg="[object Array]",Yg="[object Object]",$g=Object.prototype.hasOwnProperty;var Wg=function baseIsEqualDeep(t,a,c,m,h,g){var I=co(t),M=co(a),T=I?jg:Gg(t),S=M?jg:Gg(a),E=(T=T==Hg?Yg:T)==Yg,C=(S=S==Hg?Yg:S)==Yg,b=T==S;if(b&&wd(t)){if(!wd(a))return!1;I=!0,E=!1}if(b&&!E)return g||(g=new nd),I||Gd(t)?dg(t,a,c,m,h,g):vg(t,a,T,c,m,h,g);if(!(1&c)){var A=E&&$g.call(t,"__wrapped__"),N=C&&$g.call(a,"__wrapped__");if(A||N){var R=A?t.value():t,w=N?a.value():a;return g||(g=new nd),h(R,w,c,m,g)}}return!!b&&(g||(g=new nd),Ag(t,a,c,m,h,g))};var zg=function baseIsEqual(t,a,c,m,h){return t===a||(null==t||null==a||!So(t)&&!So(a)?t!=t&&a!=a:Wg(t,a,c,m,baseIsEqual,h))};var Kg=function baseIsMatch(t,a,c,m){var h=c.length,g=h,I=!m;if(null==t)return!g;for(t=Object(t);h--;){var M=c[h];if(I&&M[2]?M[1]!==t[M[0]]:!(M[0]in t))return!1}for(;++h<g;){var T=(M=c[h])[0],S=t[T],E=M[1];if(I&&M[2]){if(void 0===S&&!(T in t))return!1}else{var C=new nd;if(m)var b=m(S,E,T,t,a,C);if(!(void 0===b?zg(E,S,3,m,C):b))return!1}}return!0};var Qg=function isStrictComparable(t){return t==t&&!No(t)};var Jg=function getMatchData(t){for(var a=fm(t),c=a.length;c--;){var m=a[c],h=t[m];a[c]=[m,h,Qg(h)]}return a};var Xg=function matchesStrictComparable(t,a){return function(c){return null!=c&&(c[t]===a&&(void 0!==a||t in Object(c)))}};var Zg=function baseMatches(t){var a=Jg(t);return 1==a.length&&a[0][2]?Xg(a[0][0],a[0][1]):function(c){return c===t||Kg(c,t,a)}};var ev=function baseHasIn(t,a){return null!=t&&a in Object(t)};var tv=function hasPath(t,a,c){for(var m=-1,h=(a=As(a,t)).length,g=!1;++m<h;){var I=Ns(a[m]);if(!(g=null!=t&&c(t,I)))break;t=t[I]}return g||++m!=h?g:!!(h=null==t?0:t.length)&&bd(h)&&Kd(I,h)&&(co(t)||Cd(t))};var rv=function hasIn(t,a){return null!=t&&tv(t,a,ev)};var nv=function baseMatchesProperty(t,a){return Ao(t)&&Qg(a)?Xg(Ns(t),a):function(c){var m=ws(c,t);return void 0===m&&m===a?rv(c,t):zg(a,m,3)}};var av=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var iv=function basePropertyDeep(t){return function(a){return Rs(a,t)}};var ov=function property(t){return Ao(t)?av(Ns(t)):iv(t)};var sv=function baseIteratee(t){return"function"==typeof t?t:null==t?ip:"object"==typeof t?co(t)?nv(t[0],t[1]):Zg(t):ov(t)};var cv=function last(t){var a=null==t?0:t.length;return a?t[a-1]:void 0};var lv=function baseSlice(t,a,c){var m=-1,h=t.length;a<0&&(a=-a>h?0:h+a),(c=c>h?h:c)<0&&(c+=h),h=a>c?0:c-a>>>0,a>>>=0;for(var g=Array(h);++m<h;)g[m]=t[m+a];return g};var uv=function parent(t,a){return a.length<2?t:Rs(t,lv(a,0,-1))};var dv=function baseUnset(t,a){return a=As(a,t),null==(t=uv(t,a))||delete t[Ns(cv(a))]},pv=Array.prototype.splice;var mv=function basePullAt(t,a){for(var c=t?a.length:0,m=c-1;c--;){var h=a[c];if(c==m||h!==g){var g=h;Kd(h)?pv.call(t,h,1):dv(t,h)}}return t};var hv=function remove(t,a){var c=[];if(!t||!t.length)return c;var m=-1,h=[],g=t.length;for(a=sv(a);++m<g;){var I=t[m];a(I,m,t)&&(c.push(I),h.push(m))}return mv(t,h),c},gv=function(){function V2NIMLoginAuthenticator(t){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=t,this.auth=t.V2NIMLoginService}var t=V2NIMLoginAuthenticator.prototype;return t.verifyAuthentication=function verifyAuthentication(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I,M,T,S,E,C;return Dc.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account));case 2:return c=b.sent,b.next=5,this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));case 5:return m=b.sent,this.auth.token=c,h=Cp.getSystemInfo(),g={appkey:this.core.options.appkey,account:this.auth.account,token:c,authType:this.auth.loginOption.authType,appLogin:t?0:1,clientType:ru.V2NIM_LOGIN_CLIENT_TYPE_WEB,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100400,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.4.0":slice$1(a=h.userAgent).call(a,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:h.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:h.hostEnvEnum,sdkHumanVersion:"10.4.0",os:h.os,browser:h.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:m},I=h.os.toLowerCase(),"UNIAPP"!==Cp.platform||"ios"!==I&&"android"!==I||(g.isReactNative=1,g.clientType="ios"===I?ru.V2NIM_LOGIN_CLIENT_TYPE_IOS:ru.V2NIM_LOGIN_CLIENT_TYPE_ANDROID,h.pushDeviceInfo&&h.pushDeviceInfo.MANUFACTURER&&(g.deviceInfo=Fc(qt({IS_SUPPORT_HONOR:!0},h.pushDeviceInfo)))),this.core.logger.log("V2NIMLoginService::do login ",g.account,g.clientSession,g.appLogin),b.prev=12,b.next=15,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:g}));case 15:M=b.sent,b.next=26;break;case 18:if(b.prev=18,b.t0=b.catch(12),T=b.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:T.code||0,succeed:!1,description:T.message},{asyncParams:Cp.net.getNetworkStatus()}),T.code!==Gu.V2NIM_ERROR_CODE_CANCELLED&&T.code!==Gu.V2NIM_ERROR_CODE_TIMEOUT){b.next=24;break}throw T;case 24:throw this.processLoginFailed(T),T;case 26:return S=M.content,E=S.data,C=S.loginClients,this.changeLoginClient(au.V2NIM_LOGIN_CLIENT_CHANGE_LIST,C),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:Cp.net.getNetworkStatus()}),this.loginClientOfThisConnection=formatLoginInfo(E),this.core.clientSocket.setSessionId(E.consid),Cp.localStorage.setItem(this.lastLoginClientKey,Fc(qt({account:this.auth.account},this.loginClientOfThisConnection))),b.abrupt("return",this.loginClientOfThisConnection);case 33:case"end":return b.stop()}}),_callee,this,[[12,18]])})))},t.refreshLoginToken=function refreshLoginToken(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m;return Dc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(this.auth.loginOption.authType!==eu.V2NIM_LOGIN_AUTH_TYPE_DEFAULT){h.next=2;break}return h.abrupt("return",this.auth.token);case 2:if("function"==typeof this.auth.loginOption.tokenProvider){h.next=4;break}return h.abrupt("return",this.auth.token);case 4:return h.prev=4,h.next=7,this.auth.loginOption.tokenProvider(t);case 7:if("string"!=typeof(a=h.sent)){h.next=12;break}return h.abrupt("return",a);case 12:throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",a),new Yu({code:Gu.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:a}});case 14:h.next=23;break;case 16:throw h.prev=16,h.t0=h.catch(4),c=h.t0,m=c,c.code!==Gu.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",c),m=new Yu({code:Gu.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:h.t0}})),this.processLoginFailed(c),m;case 23:case"end":return h.stop()}}),_callee2,this,[[4,16]])})))},t.refreshThirdPartyExt=function refreshThirdPartyExt(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if("function"==typeof this.auth.loginOption.loginExtensionProvider){h.next=2;break}return h.abrupt("return","");case 2:return h.prev=2,h.next=5,this.auth.loginOption.loginExtensionProvider(t);case 5:if("string"!=typeof(a=h.sent)){h.next=10;break}return h.abrupt("return",a);case 10:throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",a),new Yu({code:Gu.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:a}});case 12:h.next=25;break;case 14:if(h.prev=14,h.t0=h.catch(2),c=h.t0,m=c,c.code!==Gu.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",c),m=new Yu({code:Gu.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:h.t0}})),this.auth.loginOption.authType!==eu.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY){h.next=24;break}throw this.processLoginFailed(c),m;case 24:return h.abrupt("return","");case 25:case"end":return h.stop()}}),_callee3,this,[[2,14]])})))},t.processLoginFailed=function processLoginFailed(t){this.auth.clientSocket.doDisconnect(rg.ACTIVE,t),this.checkLoginTerminalCode(t.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",t)},t.changeLoginClient=function changeLoginClient(t,a){var c=this,m=map$6(a).call(a,(function(t){return formatLoginInfo(t)}));if(t===au.V2NIM_LOGIN_CLIENT_CHANGE_LIST)this.loginClients=m,this.auth.emit("onLoginClientChanged",t,this.loginClients);else if(t===au.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN){var h=filter(m).call(m,(function(t){var a,m=filter(a=c.loginClients).call(a,(function(a){return a.clientId===t.clientId}));return c.loginClients.push(t),0===m.length}));h.length>0&&this.auth.emit("onLoginClientChanged",t,h)}else if(t===au.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT){var g=filter(m).call(m,(function(t){var a;return hv(c.loginClients,(function(a){return a.clientId===t.clientId&&a.consid===t.consid})),0===filter(a=c.loginClients).call(a,(function(a){return a.clientId===t.clientId})).length}));g.length>0&&this.auth.emit("onLoginClientChanged",t,g)}},t.checkAutoLogin=function checkAutoLogin(t){if(t)return!1;var a=Cp.localStorage.getItem(this.lastLoginClientKey);if(!a)return!1;var c="",m="";try{var h=JSON.parse(a);c=ws(h,"clientId"),m=ws(h,"account")}catch(t){return!1}return c===this.auth.deviceId&&m===this.auth.account},t.checkLoginTerminalCode=function checkLoginTerminalCode(t){var a=[Gu.V2NIM_ERROR_CODE_CANCELLED,Gu.V2NIM_ERROR_CODE_TIMEOUT,Gu.V2NIM_ERROR_CODE_HANDSHAKE,302,317,Gu.V2NIM_ERROR_CODE_FORBIDDEN,Gu.V2NIM_ERROR_CODE_NOT_FOUND,Gu.V2NIM_ERROR_CODE_PARAMETER_ERROR,Gu.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,Gu.V2NIM_ERROR_CODE_IM_DISABLED,Gu.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,Gu.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,Gu.V2NIM_ERROR_CODE_APPKEY_BLOCKED,Gu.V2NIM_ERROR_CODE_INVALID_TOKEN,Gu.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,Gu.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,Gu.V2NIM_ERROR_CODE_ACCOUNT_BANNED,Gu.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST];return includes(a).call(a,t)},t.reset=function reset(){this.loginClients=[],this.loginClientOfThisConnection={}},t.clearLastLoginClient=function clearLastLoginClient(){Cp.localStorage.removeItem(this.lastLoginClientKey)},V2NIMLoginAuthenticator}(),vv=function(){function V2NIMLoginLifeCycle(t){this.name="V2NIMLoginLifeCycle",this.loginStatus=tu.V2NIM_LOGIN_STATUS_LOGOUT,this.connectStatus=iu.V2NIM_CONNECT_STATUS_DISCONNECTED,this.core=t,this.auth=t.V2NIMLoginService,this.logger=t.logger}var t=V2NIMLoginLifeCycle.prototype;return t.processEvent=function processEvent(t,a,c){var m=this.getConnectStatus();switch(t){case"addressing":this.logger.log(this.name+"::addressing"),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGINING),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_CONNECTING);break;case"connect":this.logger.log(this.name+"::connecting"),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGINING),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_CONNECTING);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGINING),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_CONNECTED);break;case"connectFail":this.logger.log(this.name+"::connect fail",a),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_DISCONNECTED,a);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken:",a),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_DISCONNECTED,a),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",a);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGINED),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",c);break;case"loginFail":if(this.logger.log(this.name+"::login fail due to verify authentication failed:",a),!a)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(a.code)?tu.V2NIM_LOGIN_STATUS_LOGOUT:tu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_DISCONNECTED,a),this.auth.emit("onLoginFailed",a);break;case"logout":this.logger.log(this.name+"::logout"),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGOUT),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_DISCONNECTED),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",c),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGOUT),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_DISCONNECTED,a),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(this.name+"::exited",a),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_LOGOUT),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_DISCONNECTED,a);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setLoginStatus(tu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(iu.V2NIM_CONNECT_STATUS_WAITING),m!==iu.V2NIM_CONNECT_STATUS_CONNECTING&&this.auth.reconnect.attempToReLogin()}},t.getConnectStatus=function getConnectStatus(){return this.connectStatus},t.getLoginStatus=function getLoginStatus(){return this.loginStatus},t.setLoginStatus=function setLoginStatus(t){t!==this.loginStatus&&(this.loginStatus=t,this.logger.log('V2NIMLoginService::emit event "onLoginStatus", means '+tu[t]),this.auth.emit("onLoginStatus",t))},t.setConnectStatus=function setConnectStatus(t,a){if(t!==this.connectStatus){var c=this.connectStatus;this.connectStatus=t,this.logger.log('V2NIMLoginService::emit event "onConnectStatus", means '+iu[t]),this.auth.emit("onConnectStatus",t),this.delegateConnectEvent(c,t,a)}},t.delegateConnectEvent=function delegateConnectEvent(t,a,c){t===iu.V2NIM_CONNECT_STATUS_CONNECTED&&a===iu.V2NIM_CONNECT_STATUS_DISCONNECTED&&c&&this.auth.emit("onDisconnected",c),t===iu.V2NIM_CONNECT_STATUS_CONNECTING&&a===iu.V2NIM_CONNECT_STATUS_DISCONNECTED&&c&&this.auth.emit("onConnectFailed",c)},V2NIMLoginLifeCycle}(),fv=function(){function V2NIMLoginDataSync(t){this.core=t,this.auth=t.V2NIMLoginService,this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1}var t=V2NIMLoginDataSync.prototype;return t.switchDataSync=function switchDataSync(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I,M;return Dc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:c=t.type,m=t.state,h=t.error,g=t.subType,c===Yl.V2NIM_DATA_SYNC_TYPE_MAIN&&m===$l.V2NIM_DATA_SYNC_STATE_COMPLETED&&("mainSync"===g?this.mainSyncFlag=!0:"conversationSync"===g&&(this.conversationSyncFlag=!0)),I=filter(a=this.datas).call(a,(function(t){return t.type===c})),(M=I.length>0?I[0]:null)?(M.state=m,M.error=h):this.datas.push({type:c,state:m,error:h}),this.core.logger.log('V2NIMLoginService::emit event "onDataSync", means '+Yl[c]+" and "+$l[m],h),c===Yl.V2NIM_DATA_SYNC_TYPE_MAIN&&(m===$l.V2NIM_DATA_SYNC_STATE_SYNCING?this.auth.emit("onDataSync",c,m,h):m===$l.V2NIM_DATA_SYNC_STATE_COMPLETED&&this.mainSyncFlag&&this.conversationSyncFlag&&(this.auth.emit("onDataSync",c,m,h),this.mainSyncFlag=!1,this.conversationSyncFlag=!1));case 7:case"end":return T.stop()}}),_callee,this)})))},t.reset=function reset(){this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1},V2NIMLoginDataSync}();var yv,_v,Iv=function uniqBy(t,a){return t&&t.length?Hm(t,sv(a)):[]},Mv=["https://lbs.netease.im/lbs/webconf.jsp"],Tv={retryCount:3,timeout:6e4,forceMode:!1,authType:eu.V2NIM_LOGIN_AUTH_TYPE_DEFAULT,syncLevel:0},Sv=function(t){function V2NIMLoginServiceImpl(a,c){var m;void 0===c&&(c={}),(m=t.call(this,"V2NIMLoginService",a)||this).account="",m.previousLoginAccount="",m.token="",m.deviceId="",m.clientSession="",m.processId="",m.kickedDetail=null,m.binaryWebsocket=!0,registerParser({cmdMap:Ph,cmdConfig:Lh}),"v2"===a.options.apiVersion&&(registerParser({cmdMap:xh,cmdConfig:Dh}),m.core.auth=Qe(m)),m.previousLoginManager=new bp,m.doLoginStepsManager=new bp,m.loginTimerManager=new Ah,m.loginOption=qt({},Tv),m.config={lbsUrls:Mv,linkUrl:"weblink05.netease.im:443"},m.setOptions(c),a.V2NIMLoginService=Qe(m);var h,g=m.core.options.binaryWebsocket,I="BROWSER"===Cp.platform&&"function"==typeof TextDecoder&&"function"==typeof TextEncoder&&"function"==typeof Uint8Array;return"boolean"==typeof g&&(I=I&&g),I?(m.binaryWebsocket=!0,h=new og(m.core)):(m.binaryWebsocket=!1,h=new sg(m.core)),m.clientSocket=h,"v2"===m.core.options.apiVersion&&(m.core.clientSocket=h),m.lifeCycle=new vv(a),m.reconnect=new cg(a),m.lbs=new lg(a),m.authenticator=new gv(a),m.dataSync=new fv(a),m}kt(V2NIMLoginServiceImpl,t);var a=V2NIMLoginServiceImpl.prototype;return a.setOptions=function setOptions(t){validate({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t,"",!0),this.config=assignOptions(this.config,t);var a="",c="";this.config.isFixedDeviceId?(a=Cp.localStorage.getItem("__NIM_DEVC_ID__")||_m(),c=Cp.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||_m(),Cp.localStorage.setItem("__NIM_DEVC_ID__",a),Cp.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",c)):(a=_m(),c=_m()),this.deviceId=a,this.clientSession=c,this.core.reporter.setConfig({common:{dev_id:a}})},a.reset=function reset(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()},a.login=function login(t,a,c){return void 0===c&&(c={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){var m=this;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(this._checkApiVersion(),t){h.next=3;break}throw new Wu({detail:{reason:"Empty account"}});case 3:if(validate({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:getEnumValues(eu),required:!1},syncLevel:{type:"enum",values:getEnumValues(jl),required:!1}},c,"",!0),0!==c.authType||a){h.next=6;break}throw new Wu({detail:{reason:"When authType is 0, token cannot be empty"}});case 6:if(""!==this.previousLoginAccount&&this.previousLoginAccount!==t&&this.core._clearModuleData(),this.getLoginStatus()!==tu.V2NIM_LOGIN_STATUS_LOGOUT){h.next=11;break}this.logger.log("V2NIMLoginService::login:allowLogin:"+t,c),h.next=17;break;case 11:if(this.getLoginStatus()!==tu.V2NIM_LOGIN_STATUS_LOGINED){h.next=15;break}return h.abrupt("return",this.smoothForLogined(t,a,c));case 15:if(this.getLoginStatus()!==tu.V2NIM_LOGIN_STATUS_LOGINING){h.next=17;break}return h.abrupt("return",this.smoothForLogining(t,a,c));case 17:return this.account=t,this.previousLoginAccount=t,this.token=a,this.processId=_m(),this.loginOption=assignOptions(Tv,c),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer((function(){var t=new Yu({code:Gu.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});m.doLoginStepsManager.clear(t),m.previousLoginManager.clear(t),m.originLoginPromise=void 0,m.lifeCycle.processEvent("exited",t)}),this.loginOption.timeout>0?this.loginOption.timeout:6e4,1),h.prev=25,h.next=28,this.multiTryDoLogin();case 28:this.loginTimerManager.destroy(),h.next=35;break;case 31:throw h.prev=31,h.t0=h.catch(25),this.loginTimerManager.destroy(),h.t0;case 35:case"end":return h.stop()}}),_callee,this,[[25,31]])})))},a.getChatroomLinkAddress=function getChatroomLinkAddress(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m;return Dc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return validate({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:t,miniProgram:a},"",!0),c="unknow environment"!==getMiniappEnv(),a=void 0===a?c:a,h.next=5,this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:t,miniProgram:a});case 5:return m=h.sent,h.abrupt("return",m.content.linkAddress);case 7:case"end":return h.stop()}}),_callee2,this)})))},a.multiTryDoLogin=function multiTryDoLogin(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m,h;return Dc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:a=new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),c=0;case 2:if(!(c<=this.loginOption.retryCount)){g.next=32;break}return m="V2NIMLoginService::times of login try: "+c,c>0?this.logger.warn(m):this.logger.log(m),g.prev=5,this.originLoginPromise=t||this.doLogin(!1),t=void 0,g.next=10,this.previousLoginManager.add(this.originLoginPromise);case 10:return h=g.sent,this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,g.abrupt("return",h);case 18:if(g.prev=18,g.t0=g.catch(5),a=g.t0||a,this.logger.error("V2NIMLoginService::login failed, times of login try: "+c+", err.code: "+(null==a?void 0:a.code)+', err.message: "'+(null==a?void 0:a.message)+'"'),a.code!==Gu.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),!this.checkLoginTerminalCode(a&&a.code)){g.next=28;break}throw this.lifeCycle.processEvent("exited",a),a;case 28:a&&399===a.code&&this.lbs.reset();case 29:c++,g.next=2;break;case 32:throw this.lifeCycle.processEvent("exited",a),a;case 34:case"end":return g.stop()}}),_callee3,this,[[5,18]])})))},a.doLogin=function doLogin(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m;return Dc.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return a=!!t||this.authenticator.checkAutoLogin(this.loginOption.forceMode),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",a?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Fc(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Cp.net.getNetworkStatus()}),h.next=6,this.doLoginStepsManager.add(this.lbs.getLbsInfos());case 6:return c=h.sent,h.next=9,this.doLoginStepsManager.add(this.clientSocket.connect(c,t));case 9:return h.next=11,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(a));case 11:return m=h.sent,this.lifeCycle.processEvent("loginSucc",void 0,qt(qt({},m),{isReconnect:t})),this.processId=_m(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.clientSocket.ping(),this.core.abtest.abtRequest(),this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),h.prev=19,h.next=22,this.core.cloudStorage.init();case 22:h.next=27;break;case 24:h.prev=24,h.t0=h.catch(19),this.logger.warn("doLogin::cloudStorage init error",h.t0);case 27:return h.abrupt("return",m);case 28:case"end":return h.stop()}}),_callee4,this,[[19,24]])})))},a.smoothForLogined=function smoothForLogined(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var m;return Dc.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:if(m=this.checkIsSameLogin(t,a,c),this.logger.warn("V2NIMLoginService::smoothForLogined:Logined, isSameLogin "+m),!m){h.next=6;break}return h.abrupt("return");case 6:return h.next=8,this.logout();case 8:return h.abrupt("return",this.login(t,a,c));case 9:case"end":return h.stop()}}),_callee5,this)})))},a.smoothForLogining=function smoothForLogining(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var m;return Dc.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:if(m=this.checkIsSameLogin(t,a,c),this.logger.warn("V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin "+m),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=t,this.previousLoginAccount=t,this.token=a,this.loginOption=assignOptions(this.loginOption,c),!m){h.next=18;break}if(this.originLoginPromise){h.next=11;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 11:return this.reconnect.reset(),h.next=14,Mi.resolve();case 14:return h.next=16,this.multiTryDoLogin(this.originLoginPromise);case 16:h.next=25;break;case 18:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(rg.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),h.next=24,Mi.resolve();case 24:return h.abrupt("return",this.login(t,a,c));case 25:case"end":return h.stop()}}),_callee6,this)})))},a.checkIsSameLogin=function checkIsSameLogin(t,a,c){return this.account===t&&this.loginOption.authType===c.authType&&(c.authType!==eu.V2NIM_LOGIN_AUTH_TYPE_DEFAULT||this.token===a)},a.logout=function logout(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var t,a;return Dc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,t=this.getConnectStatus(),a=this.getLoginStatus(),c.t0=a,c.next=c.t0===tu.V2NIM_LOGIN_STATUS_LOGINED?10:c.t0===tu.V2NIM_LOGIN_STATUS_LOGINING?25:c.t0===tu.V2NIM_LOGIN_STATUS_UNLOGIN?29:c.t0===tu.V2NIM_LOGIN_STATUS_LOGOUT?33:35;break;case 10:return c.prev=10,c.next=13,this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(rg.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),c.next=24;break;case 18:c.prev=18,c.t1=c.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",c.t1),this.clientSocket.doDisconnect(rg.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");case 24:return c.abrupt("break",37);case 25:case 29:return this.clientSocket.doDisconnect(rg.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),c.abrupt("break",37);case 33:throw this.core._clearModuleData(),new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+a+". connectStatus "+t}});case 35:throw this.core._clearModuleData(),new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+a+". connectStatus "+t}});case 37:case"end":return c.stop()}}),_callee7,this,[[10,18]])})))},a.getConnectStatus=function getConnectStatus(){return this.lifeCycle.getConnectStatus()},a.getLoginStatus=function getLoginStatus(){return this.lifeCycle.getLoginStatus()},a.getLoginUser=function getLoginUser(){return this.account},a.getLoginClients=function getLoginClients(){return Iv(this.authenticator.loginClients,"clientId")},a.getDataSync=function getDataSync(){var t=this.dataSync.datas;return t&&t.length>0?map$6(t).call(t,(function(t){return{type:t.type,state:t.state}})):null},a.setReconnectDelayProvider=function setReconnectDelayProvider(t){this.reconnect._setReconnectDelayProvider(t)},a.kickOffline=function kickOffline(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a;return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return this._checkApiVersion(),validate({clientId:{type:"string",allowEmpty:!1}},t,"",!0),c.next=4,this.clientSocket.sendCmd("v2KickOffline",{clientIds:[t.clientId]});case 4:if(a=c.sent,0!==ws(a,"content.clientIds.length")){c.next=8;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_REQUEST_FAILED});case 8:case"end":return c.stop()}}),_callee8,this)})))},a.getKickedOfflineDetail=function getKickedOfflineDetail(){return this.kickedDetail},a.checkLoginTerminalCode=function checkLoginTerminalCode(t){return this.authenticator.checkLoginTerminalCode(t)},a.checkIllegalState=function checkIllegalState(){if(!this.getLoginUser())throw new Yu({code:Gu.V2NIM_ERROR_CODE_ILLEGAL_STATE})},a._checkApiVersion=function _checkApiVersion(){if("v2"!==this.core.options.apiVersion)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})},a.v2LoginHandler=function v2LoginHandler(t){if(t.error)throw this.clientSocket.doDisconnect(rg.ACTIVE,t.error),t.error;return t},a.v2LoginClientChangeHandler=function v2LoginClientChangeHandler(t){this.authenticator.changeLoginClient(em(t.content.state),t.content.datas)},a.nimLoginClientChangeHandler=function nimLoginClientChangeHandler(t){this.authenticator.changeLoginClient(em(t.content.state),t.content.datas)},a.qchatLoginClientChangeHandler=function qchatLoginClientChangeHandler(t){var a=em(t.content.state);a=1===a?au.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN:au.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT,this.authenticator.changeLoginClient(a,[t.content.data])},a.v2BeKickedHandler=function v2BeKickedHandler(t){if(t.error)this.core.logger.error("v2BeKickedHandler error, ",t.error);else{var a=function formatBeKickedTag(t){return format({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},t)}(t.content);this.core.logger.warn("v2Bekicked::",a),this.kickedDetail=a,this.clientSocket.doDisconnect(rg.KICKED,a),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new Yu({code:Gu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),a),this.emit("onKickedOffline",a)}},V2NIMLoginServiceImpl}(gh),Ev=function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var c=ws(t,"error.detail.ignore");return t.error&&!c?Mi.reject(t.error):Mi.resolve(t)},Service}(),Cv={"5_1":"sync"},bv={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},Av=function(t){function SyncService(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"sync",a)||this).syncDoneFlag=!1,m.config={myInfo:!!a.user.name,offlineMsgs:!!a.msg.name,teams:!!a.team.name,myTeamMembers:!!a.team.name,roamingMsgs:!!a.msg.name,relations:!!a.user.name,friends:!!a.friend.name,friendUsers:!!a.user.name,msgReceipts:!!a.msg.name,broadcastMsgs:!!a.msg.name,recallMsg:!!a.msg.name,sessionAck:!!a.session.name,superTeamSessionAck:!!a.session.name,superTeams:!!a.superTeam.name,mySuperTeamMembers:!!a.superTeam.name,superTeamRoamingMsgs:!!a.superTeam.name,deleteSuperTeamMsg:!!a.superTeam.name,deleteSelfMsgs:!!a.msg.name,sessionHistoryMsgsDelete:!!a.msgLog.name,avSignal:!!a.signaling.name},m.setOptions(c),m.timetags={},m.initEventListeners(),registerParser({cmdMap:Cv,cmdConfig:bv}),m}kt(SyncService,t);var a=SyncService.prototype;return a.setOptions=function setOptions(t){qt(this.config,t)},a.reset=function reset(){this.timetags={},this.syncDoneFlag=!1},a.getSyncDoneFlag=function getSyncDoneFlag(){return this.syncDoneFlag},a.doSync=function doSync(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return a=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",a),m.prev=2,m.next=5,this.core.clientSocket.sendCmd("sync",{sync:a});case 5:c=m.sent,this.core.logger.log("sync::doSyncV1 done in",null===(t=c.content)||void 0===t?void 0:t.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),m.next=17;break;case 11:return m.prev=11,m.t0=m.catch(2),this.core.logger.error("sync::doSyncV1 error",m.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),m.abrupt("return");case 17:case"end":return m.stop()}}),_callee,this,[[2,11]])})))},a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("logined",(function(){t.syncDoneFlag=!1,t.doSync()})),this.core.eventBus.on("sync/updateTimetag",(function(a){var c;forEach$1(c=mn(a)).call(c,(function(c){a[c]>(t.timetags[c]||0)&&(t.timetags[c]=a[c])}))}))},a.genSyncParams=function genSyncParams(){var t,a,c=this;return reduce(t=filter(a=mn(this.config)).call(a,(function(t){var a=t;return c.config[a]}))).call(t,(function(t,a){var m=a;return t[m]=c.timetags[m]||0,t}),{})},a.handleImmediate=function handleImmediate(t){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Mi.resolve(t)},a.delaySyncDone=function delaySyncDone(t){var a=this;return"ALI"===getMiniappEnv()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Mi((function(c){Gi((function(){a.handleImmediate(t).then((function(){c(t)}))}),100)}))):this.handleImmediate(t)},a.syncHandler=function syncHandler(t){return this.delaySyncDone(t)},SyncService}(Ev),Nv=["error","warn","log","debug"],Rv=function emptyFunc(){},wv=["off","error","warn","log","debug"],kv=function(){function Logger(t){this.strategies={debug:{name:"debug",func:console.log},log:{name:"  log",func:console.log},warn:{name:" warn",func:console.warn},error:{name:"error",func:console.error}},this.debug=Rv,this.log=Rv,this.warn=Rv,this.error=Rv,includes(wv).call(wv,t)||(t="off"),this.setLogFunc(t)}var t=Logger.prototype;return t.setLogFunc=function setLogFunc(t){var a=this,c=findIndex$1(Nv).call(Nv,(function(a){return a===t}));forEach$1(Nv).call(Nv,(function(t,m){m<=c&&(a[t]=function(){var a=slice$1(Array.prototype).call(arguments),c=this.strategies[t],m=this.formatArgs(a,c.name);c.func(m)})}))},t.formatArgs=function formatArgs(t,a){var c=new Date;return"[NIM "+a+" "+(c.getMonth()+1+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds())+"] "+map$6(t).call(t,(function(t){return t instanceof Yu?t.toString():t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?Fc(t):t})).join(" ")},t.destroy=function destroy(){this.debug=Rv,this.log=Rv,this.warn=Rv,this.error=Rv},Logger}(),Ov=function(){function CoreAdapters(t){this.lastCommonHost="",this.core=t}var t=CoreAdapters.prototype;return t.getFileUploadInformation=function getFileUploadInformation(t){return Cp.getFileUploadInformation(t)},t.request=function request(t,a,c){var m=this,h=(new Date).getTime(),g=(null==c?void 0:c.exception_service)||0;return Cp.request(t,a).catch((function(c){var I,M,T,S,E=c;throw m.core.reporter.reportTraceStart("exceptions",{user_id:m.core.options.account||(null===(M=null===(I=m.core)||void 0===I?void 0:I.auth)||void 0===M?void 0:M.account),trace_id:null===(S=null===(T=m.core.clientSocket)||void 0===T?void 0:T.socket)||void 0===S?void 0:S.sessionId,start_time:h,action:1,exception_service:g}),m.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof E.code?E.code:0,description:E.message||""+E.code,operation_type:0,target:t,context:a?Fc(a):""},{asyncParams:Cp.net.getNetworkStatus()}),m.core.reporter.reportTraceEnd("exceptions",1),c}))},t.uploadFile=function uploadFile(t){var a,c,m,h;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var g,I,M,T,S,E,C,b,A,N,R,w,k,O;return Dc.wrap((function _callee$(P){for(;;)switch(P.prev=P.next){case 0:E=indexOf(g=t.commonUploadHostBackupList).call(g,t.commonUploadHost),C=-1===E?concat(I=[t.commonUploadHost]).call(I,t.commonUploadHostBackupList):concat(M=[t.commonUploadHost]).call(M,slice$1(T=t.commonUploadHostBackupList).call(T,0,E),slice$1(S=t.commonUploadHostBackupList).call(S,E+1)),b=Math.max(indexOf(C).call(C,this.lastCommonHost),0),A="BROWSER"===Cp.platform?1:C.length,N=null,R=0;case 6:if(!(R<A)){P.next=26;break}return w=(new Date).getTime(),this.lastCommonHost=C[(R+b)%C.length],P.prev=9,P.next=12,Cp.uploadFile(qt(qt({},t),{commonUploadHost:this.lastCommonHost}));case 12:return P.abrupt("return",P.sent);case 15:P.prev=15,P.t0=P.catch(9),N=P.t0,k=P.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(c=null===(a=this.core)||void 0===a?void 0:a.auth)||void 0===c?void 0:c.account),trace_id:null===(h=null===(m=this.core.clientSocket)||void 0===m?void 0:m.socket)||void 0===h?void 0:h.sessionId,start_time:w,action:1,exception_service:3}),O="BROWSER"===Cp.platform?t.chunkUploadHost:this.lastCommonHost+"/"+(t.nosToken&&t.nosToken.bucket),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof k.code?k.code:0,description:k.message||""+k.code,operation_type:1,target:O},{asyncParams:Cp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1);case 23:R++,P.next=6;break;case 26:throw N;case 27:case"end":return P.stop()}}),_callee,this,[[9,15]])})))},CoreAdapters}(),Pv=function(){function ABTest(t,a){this.abtInfo={},this.core=t,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:lh,abtestProjectKey:uh},a)}var t=ABTest.prototype;return t.setOptions=function setOptions(t){this.config=assignOptions(this.config,t)},t.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(this.config.isAbtestEnable){m.next=2;break}return m.abrupt("return");case 2:if(!this.abtInfo.experiments){m.next=4;break}return m.abrupt("return");case 4:if(this.config.abtestUrl){m.next=6;break}return m.abrupt("return");case 6:return m.prev=6,m.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.4.0",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:c=m.sent,m.next=15;break;case 12:m.prev=12,m.t0=m.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==c?void 0:c.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{};case 16:case"end":return m.stop()}}),_callee,this,[[6,12]])})))},ABTest}();!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(yv||(yv={})),function(t){t.Destroy="destroy",t.Logout="logout"}(_v||(_v={}));var xv={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},Vv=function(){function ReporterHookLinkKeep(t,a){this.traceData=xv,this.core=t,this.traceData=qt({},xv,a),this.traceData.extension=[]}var t=ReporterHookLinkKeep.prototype;return t.reset=function reset(){this.traceData=qt({},xv),this.traceData.extension=[]},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function update(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,Cp.net.getNetworkStatus();case 2:a=h.sent,c=a.net_type,m=a.net_connect,this.traceData.extension.push(qt({code:0,foreground:!0,foreg_backg_switch:!1,net_type:c,net_connect:m},t));case 6:case"end":return h.stop()}}),_callee,this)})))},t.end=function end(t){var a=this.traceData.extension[0],c=this.traceData.extension[1];if(a&&0===a.operation_type&&c&&1===c.operation_type){var m=a.net_type!==c.net_type||a.net_connect!==c.net_connect;if(t||!m)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},ReporterHookLinkKeep}(),Lv={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},Dv=function(){function ReporterHookLBS(t){this.traceData=Lv,this.core=t,this.reset()}var t=ReporterHookLBS.prototype;return t.reset=function reset(){this.traceData=qt({},Lv),this.traceData.history=[]},t.start=function start(t){this.reset(),this.traceData.user_id=t,this.traceData.start_time=wi()},t.updateBegin=function updateBegin(t){this.traceData.history.push(qt({head:"",body:"",start_time:wi(),httpdns:!1,index:0},t))},t.updateComplete=function updateComplete(t){var a;forEach$1(a=this.traceData.history).call(a,(function(a){a.target===t.target&&(qt(a,t),a.duration=wi()-a.start_time)}))},t.end=function end(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h;return Dc.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:if(this.traceData.succeed=t,this.traceData.history=filter(a=this.traceData.history).call(a,(function(t){return void 0!==t.code})),0!==this.traceData.history.length){g.next=5;break}return this.reset(),g.abrupt("return");case 5:return this.traceData.duration=wi()-this.traceData.start_time,g.next=8,Cp.net.getNetworkStatus();case 8:c=g.sent,m=c.net_type,h=c.net_connect,this.traceData.net_type=m,this.traceData.net_connect=h,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return g.stop()}}),_callee,this)})))},ReporterHookLBS}(),Uv={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},Fv="ReporterHook::setMonitorForResources:",Bv=function(){function ReporterHookCloudStorage(t,a){this.traceData=Uv,this.core=t,this.traceData=qt({},Uv,a)}var t=ReporterHookCloudStorage.prototype;return t.reset=function reset(){this.traceData=qt({},Uv)},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():wi()},t.update=function update(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.traceData.user_id){a.next=2;break}return a.abrupt("return");case 2:this.core.logger.log(Fv+" upload update",t),qt(this.traceData,t);case 4:case"end":return a.stop()}}),_callee,this)})))},t.end=function end(t){this.traceData.user_id&&(this.core.logger.log(Fv+" upload end cause of "+t),this.traceData.state=t,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():wi())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=Uv)},ReporterHookCloudStorage}(),qv=N("".endsWith),Gv=N("".slice),Hv=Math.min,jv=correctIsRegexpLogic("endsWith");_export({target:"String",proto:!0,forced:!jv},{endsWith:function endsWith(t){var a=toString$1(requireObjectCoercible(this));notARegexp(t);var c=arguments.length>1?arguments[1]:void 0,m=a.length,h=void 0===c?m:Hv(toLength(c),m),g=toString$1(t);return qv?qv(a,g,h):Gv(a,h-g.length,h)===g}});var Yv=entryVirtual("String").endsWith,$v=String.prototype,endsWith=function(t){var a=t.endsWith;return"string"==typeof t||t===$v||Y($v,t)&&a===$v.endsWith?Yv:a};function getIsDataReportEnable(t){var a,c,m=!0;return"boolean"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.enableCompass)?m=t.reporterConfig.enableCompass:"boolean"==typeof(null===(c=null==t?void 0:t.reporterConfig)||void 0===c?void 0:c.isDataReportEnable)&&(m=t.reporterConfig.isDataReportEnable),m}function getReportConfigUrl(t){var a,c,m="https://statistic.live.126.net/dispatcher/req";return"string"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.compassDataEndpoint)?(m=t.reporterConfig.compassDataEndpoint,endsWith(m).call(m,"/")&&(m=slice$1(m).call(m,0,-1)),m+="/dispatcher/req"):"string"==typeof(null===(c=null==t?void 0:t.reporterConfig)||void 0===c?void 0:c.reportConfigUrl)&&(m=t.reporterConfig.reportConfigUrl),m}function getReportUrl(t){var a,c,m="https://statistic.live.126.net/statics/report/common/form";return"string"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.compassDataEndpoint)?(m=t.reporterConfig.compassDataEndpoint,endsWith(m).call(m,"/")&&(m=slice$1(m).call(m,0,-1)),m+="/statics/report/common/form"):"string"==typeof(null===(c=null==t?void 0:t.reporterConfig)||void 0===c?void 0:c.reportUrl)&&(m=t.reporterConfig.reportUrl),m}var Wv={},zv={},Kv={},Qv={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Ot,lbsUrls:ch,linkUrl:sh,abtestUrl:lh,isAbtestEnable:!0},Jv=function(t){function NIM(a,c){var m,h,g,I,M;void 0===c&&(c={}),(M=t.call(this)||this).instanceName="NIM",M.pluginMap={},M.eventBus=new Hi,M.options={},M.V2NIMConversationIdUtil={},M.V2NIMMessageCreator={},M.V2NIMMessageAttachmentCreator={},M.V2NIMClientAntispamUtil={},M.DataStructureConverter={},M.V2NIMMessageConverter={},M.V2NIMMessageLogUtil={},M.V2NIMMessageExtendUtil={},M.V2NIMStorageUtil={},M.V2NIMNotificationService={},M.V2NIMStorageService={},M.V1NIMLoginService={},M.V2NIMLoginService={},M.clientSocket={},M.V2NIMSyncService={},M.V2NIMConversationService={},M.V2NIMConversationGroupService={},M.V2NIMMessageService={},M.V2NIMTeamService={},M.V2NIMUserService={},M.V2NIMFriendService={},M.V2NIMSettingService={},M.V2NIMAIService={},M.V2NIMSignallingService={},M.V2NIMSubscriptionService={},M.offlinePush={},M.sync={},M.msg={},M.msgLog={},M.session={},M.cloudSession={},M.misc={},M.user={},M.friend={},M.systemMessage={},M.team={},M.event={},M.msgExtend={},M.cloudStorage={},M.passThrough={},M.superTeam={},M.plugin={},M.signaling={},M.qchatChannel={},M.qchatMedia={},M.qchatMsg={},M.qchatRole={},M.qchatServer={},M.pluginMap=Kv,M.logger=new kv(a.debugLevel),M.setInitOptions(a),M.otherOptions=qt(qt({},c),{cloudStorageConfig:qt({storageKeyPrefix:"NIM"},c.cloudStorageConfig)}),M.timerManager=new Ah,M.timeOrigin=new Rp(Qe(M)),M.adapters=new Ov(Qe(M)),M.abtest=new Pv(Qe(M),{isAbtestEnable:M.options.isAbtestEnable,abtestUrl:M.options.abtestUrl,abtestProjectKey:uh});var T=Cp.getSystemInfo();return M.reporter=new so({reportConfigUrl:getReportConfigUrl(c),reportUrl:getReportUrl(c),isDataReportEnable:getIsDataReportEnable(c),common:{app_key:a.appkey,dev_id:"",platform:"Web",sdk_ver:"10.4.0",env:"online",os_name:T.os,os_ver:T.osVer,lib_env:T.libEnv,host_env:T.hostEnv,host_env_ver:T.hostEnvVer,manufactor:T.manufactor,model:T.model,v2:"v1"!==M.options.apiVersion},request:Cp.request,logger:M.logger,autoStart:!0}),M.reporterHookLinkKeep=new Vv(Qe(M)),M.reporterHookCloudStorage=new Bv(Qe(M)),M.reporterHookLBS=new Dv(Qe(M)),Cp.setLogger(M.logger),"v1"===M.options.apiVersion?M.auth=new fh(Qe(M),M.options):M.auth=new Sv(Qe(M),M.otherOptions.V2NIMLoginServiceConfig),forEach$1(m=filter(h=mn(Wv)).call(h,(function(t){return"V1NIMLoginService"!==t&&"V2NIMLoginService"!==t&&"sync"!==t}))).call(m,(function(t){var a=Wv[t];M[t]=new a(Qe(M))})),Wv.sync&&(M.sync=new Av(Qe(M),M.otherOptions.syncOptions)),forEach$1(g=mn(Wv)).call(g,(function(t){var a=t+"Config",c=M.otherOptions[a]||{},m=ws(Qe(M),t+".setOptions");"function"==typeof m&&("cloudStorage"===t&&(c=M.otherOptions[a]||M.otherOptions.serverConfig||{}),m.call(M[t],c))})),forEach$1(I=mn(zv)).call(I,(function(t){var a=zv[t];void 0!==a&&(M[t]=new a(Qe(M)))})),NIM.instance=Qe(M),M.logger.log("NIM init, version ","10.4.0"," sdk version ",100400," appkey ",a.appkey),M}kt(NIM,t),NIM.getInstance=function getInstance(t,a){if(!NIM.instance){if(t)return new NIM(t,a);throw new Error("Instance not exist, please input options")}if(t){if(NIM.instance.options.account===t.account&&NIM.instance.options.appkey===t.appkey)return NIM.instance.setOptions(t),NIM.instance;throw new Error("Unexpected login")}return NIM.instance};var a=NIM.prototype;return a.setInitOptions=function setInitOptions(t){validate({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.logger.log("NIM::setInitOptions options is",t),this.options=qt(qt({},Qv),t)},a.connect=function connect(t){return void 0===t&&(t={}),this.V1NIMLoginService.login(t)},a.setOptions=function setOptions(t){if("object"==typeof t&&null!==t){if(Object.prototype.hasOwnProperty.call(t,"account")&&t.account!==this.options.account||Object.prototype.hasOwnProperty.call(t,"appkey")&&t.appkey!==this.options.appkey)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(t,"apiVersion")&&t.apiVersion!==this.options.apiVersion)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(t,"binaryWebsocket")&&t.binaryWebsocket!==this.options.binaryWebsocket)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});validate({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.logger.log("NIM::setOptions options is",t),this.options=qt(qt({},this.options),t),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},a.disconnect=function disconnect(){return this.V1NIMLoginService.logout()},a._disconnect=function _disconnect(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?ws(this.V2NIMLoginService,"lifeCycle.connectStatus")===iu.V2NIM_CONNECT_STATUS_DISCONNECTED&&ws(this.V2NIMLoginService,"lifeCycle.loginStatus")===tu.V2NIM_LOGIN_STATUS_LOGOUT?Mi.resolve():this.V2NIMLoginService.logout():Mi.resolve()},a.destroy=function destroy(){var t=this;return NIM.instance=void 0,this._disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.eventBus.removeAllListeners(),t.logger.destroy(),t.reporter.destroy(),t.timerManager.destroy(),t._clearModuleData(_v.Destroy),t._removeAllModuleListeners(),t.connect=emptyFuncWithPromise,t.disconnect=emptyFuncWithPromise,t._disconnect=emptyFuncWithPromise,t.destroy=emptyFuncWithPromise}))},a._clearModuleData=function _clearModuleData(t){void 0===t&&(t=_v.Logout);var a=Ai(this);forEach$1(a).call(a,(function(a){a&&"function"==typeof a.reset&&a.reset(t)}))},a._removeAllModuleListeners=function _removeAllModuleListeners(){var t=Ai(this);forEach$1(t).call(t,(function(t){t&&"function"==typeof t.removeAllListeners&&t.removeAllListeners()}))},a.kick=function kick(t){return this.V1NIMLoginService.kick(t)},a.sendCmd=function sendCmd(t,a,c){return this.clientSocket.sendCmd(t,a,c)},a.emit=function emit(a){var c=this;try{for(var m,h,g=wi(),I=arguments.length,M=new Array(I>1?I-1:0),T=1;T<I;T++)M[T-1]=arguments[T];var S=(m=t.prototype.emit).call.apply(m,concat(h=[this,a]).call(h,M)),E=wi()-g;return E>=10&&this.logger.warn("Core::emit event: "+a+" process takes: "+E+"ms"),S}catch(t){return this.logger.error("Core::emit event: "+a+". Error: "+t),Gi((function(){throw c.logger.error("Core::emit throw error in setTimeout. event: "+a+". Error: "+t),t}),0),!1}},NIM.registerService=function registerService(t,a){Wv[a]=t},NIM.registerPrivateService=function registerPrivateService(t,a){zv[a]=t},NIM.registerPlugin=function registerPlugin(t,a){Kv[a]=t},Ke(NIM,[{key:"account",get:function get(){return this.auth.account}},{key:"status",get:function get(){return this.V1NIMLoginService.status},set:function set(t){this.V1NIMLoginService.status=t}},{key:"config",get:function get(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),NIM}(Hi),Xv=createCommonjsModule((function(t,c){(function(){var m={function:!0,object:!0}[typeof window]&&window||this,h=c,g=t&&!t.nodeType&&t,I=h&&g&&"object"==typeof a&&a;!I||I.global!==I&&I.window!==I&&I.self!==I||(m=I);var M=Math.pow(2,53)-1,T=/\bOpera/,S=Object.prototype,E=S.hasOwnProperty,C=S.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var c in t)E.call(t,c)&&a(t[c],c,t)}function getClassOf(t){return null==t?capitalize(t):C.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var c=null;return function each(t,a){var c=-1,m=t?t.length:0;if("number"==typeof m&&m>-1&&m<=M)for(;++c<m;)a(t[c],c,t);else forOwn(t,a)}(t,(function(m,h){c=a(c,m,h,t)})),c}function trim(t){return String(t).replace(/^ +| +$/g,"")}var b=function parse(t){var a=m,c=t&&"object"==typeof t&&"String"!=getClassOf(t);c&&(a=t,t=null);var h=a.navigator||{},g=h.userAgent||"";t||(t=g);var I,M,S=c?!!h.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(C.toString()),E="Object",b=c?E:"ScriptBridgingProxyObject",A=c?E:"Environment",N=c&&a.java?"JavaPackage":getClassOf(a.java),R=c?E:"RuntimeObject",w=/\bJava/.test(N)&&a.java,k=w&&getClassOf(a.environment)==A,O=w?"a":"Î±",P=w?"b":"Î²",x=a.document||{},V=a.operamini||a.opera,L=T.test(L=c&&V?V["[[Class]]"]:getClassOf(V))?L:V=null,D=t,U=[],B=null,q=t==g,G=q&&V&&"function"==typeof V.version&&V.version(),H=function getLayout(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),j=function getName(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Y=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),$=function getManufacturer(a){return reduce(a,(function(a,c,m){return a||(c[Y]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Y)]||RegExp("\\b"+qualify(m)+"(?:\\b|\\w*\\d)","i").exec(t))&&m}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=function getOS(a){return reduce(a,(function(a,c){var m=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+m+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,c){var m={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&c&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(m=m[/[\d.]+$/.exec(t)])&&(t="Windows "+m),t=String(t),a&&c&&(t=t.replace(RegExp(a,"i"),c)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,m,c.label||c)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,c){var m=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+m+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+m+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+m+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(c.label&&!RegExp(m,"i").test(c.label)?c.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),c=c.label||c,a=format(a[0].replace(RegExp(m,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,c){return a||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(H&&(H=[H]),/\bAndroid\b/.test(W)&&!Y&&(I=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(Y=trim(I[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),$&&!Y?Y=getProduct([$]):$&&Y&&(Y=Y.replace(RegExp("^("+qualify($)+")[-_.\\s]","i"),$+" ").replace(RegExp("^("+qualify($)+")[-_.]?(\\w)","i"),$+" $2")),(I=/\bGoogle TV\b/.exec(Y))&&(Y=I[0]),/\bSimulator\b/i.test(t)&&(Y=(Y?Y+" ":"")+"Simulator"),"Opera Mini"==j&&/\bOPiOS\b/.test(t)&&U.push("running in Turbo/Uncompressed mode"),"IE"==j&&/\blike iPhone OS\b/.test(t)?($=(I=parse(t.replace(/like iPhone OS/,""))).manufacturer,Y=I.product):/^iP/.test(Y)?(j||(j="Safari"),W="iOS"+((I=/ OS ([\d_]+)/i.exec(t))?" "+I[1].replace(/_/g,"."):"")):"Konqueror"==j&&/^Linux\b/i.test(W)?W="Kubuntu":$&&"Google"!=$&&(/Chrome/.test(j)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(Y))||/\bAndroid\b/.test(W)&&/^Chrome/.test(j)&&/\bVersion\//i.test(t)?(j="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==j?(/\bMobi/i.test(t)||(W="Android",U.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&U.unshift("accelerated")):"UC Browser"==j&&/\bUCWEB\b/.test(t)?U.push("speed mode"):"PaleMoon"==j&&(I=/\bFirefox\/([\d.]+)\b/.exec(t))?U.push("identifying as Firefox "+I[1]):"Firefox"==j&&(I=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),Y||(Y=I[1])):!j||(I=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(j))?(j&&!Y&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(I+"/")+8))&&(j=null),(I=Y||$||W)&&(Y||$||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(j=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:I)+" Browser")):"Electron"==j&&(I=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&U.push("Chromium "+I),G||(G=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(j),"(?:Firefox|Minefield|NetFront)"])),(I=("iCab"==H&&parseFloat(G)>3?"WebKit":/\bOpera\b/.test(j)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(H)&&"WebKit"||!H&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==H&&/\bPlayStation\b(?! Vita\b)/i.test(j)&&"NetFront")&&(H=[I]),"IE"==j&&(I=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(j+=" Mobile",W="Windows Phone "+(/\+$/.test(I)?I:I+".x"),U.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(j="IE Mobile",W="Windows Phone 8.x",U.unshift("desktop mode"),G||(G=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=j&&"Trident"==H&&(I=/\brv:([\d.]+)/.exec(t))&&(j&&U.push("identifying as "+j+(G?" "+G:"")),j="IE",G=I[1]),q){if(function isHostType(t,a){var c=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(c)||"object"==c&&!t[a])}(a,"global"))if(w&&(D=(I=w.lang.System).getProperty("os.arch"),W=W||I.getProperty("os.name")+" "+I.getProperty("os.version")),k){try{G=a.require("ringo/engine").version.join("."),j="RingoJS"}catch(t){(I=a.system)&&I.global.system==a.system&&(j="Narwhal",W||(W=I[0].os||null))}j||(j="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(I=a.process)&&("object"==typeof I.versions&&("string"==typeof I.versions.electron?(U.push("Node "+I.versions.node),j="Electron",G=I.versions.electron):"string"==typeof I.versions.nw&&(U.push("Chromium "+G,"Node "+I.versions.node),j="NW.js",G=I.versions.nw)),j||(j="Node.js",D=I.arch,W=I.platform,G=(G=/[\d.]+/.exec(I.version))?G[0]:null));else getClassOf(I=a.runtime)==b?(j="Adobe AIR",W=I.flash.system.Capabilities.os):getClassOf(I=a.phantom)==R?(j="PhantomJS",G=(I=I.version||null)&&I.major+"."+I.minor+"."+I.patch):"number"==typeof x.documentMode&&(I=/\bTrident\/(\d+)/i.exec(t))?(G=[G,x.documentMode],(I=+I[1]+4)!=G[1]&&(U.push("IE "+G[1]+" mode"),H&&(H[1]=""),G[1]=I),G="IE"==j?String(G[1].toFixed(1)):G[0]):"number"==typeof x.documentMode&&/^(?:Chrome|Firefox)\b/.test(j)&&(U.push("masking as "+j+" "+G),j="IE",G="11.0",H=["Trident"],W="Windows");W=W&&format(W)}if(G&&(I=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(G)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(q&&h.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(B=/b/i.test(I)?"beta":"alpha",G=G.replace(RegExp(I+"\\+?$"),"")+("beta"==B?P:O)+(/\d+\+?/.exec(I)||"")),"Fennec"==j||"Firefox"==j&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))j="Firefox Mobile";else if("Maxthon"==j&&G)G=G.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Y))"Xbox 360"==Y&&(W=null),"Xbox 360"==Y&&/\bIEMobile\b/.test(t)&&U.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(j)&&(!j||Y||/Browser|Mobi/.test(j))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==j&&q)try{null===a.external&&U.unshift("platform preview")}catch(t){U.unshift("embedded")}else(/\bBlackBerry\b/.test(Y)||/\bBB10\b/.test(t))&&(I=(RegExp(Y.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||G)?(W=((I=[I,/BB10/.test(t)])[1]?(Y=null,$="BlackBerry"):"Device Software")+" "+I[0],G=null):this!=forOwn&&"Wii"!=Y&&(q&&V||/Opera/.test(j)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==j&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==j&&(W&&!/^Win/.test(W)&&G>5.5||/\bWindows XP\b/.test(W)&&G>8||8==G&&!/\bTrident\b/.test(t)))&&!T.test(I=parse.call(forOwn,t.replace(T,"")+";"))&&I.name&&(I="ing as "+I.name+((I=I.version)?" "+I:""),T.test(j)?(/\bIE\b/.test(I)&&"Mac OS"==W&&(W=null),I="identify"+I):(I="mask"+I,j=L?format(L.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(I)&&(W=null),q||(G=null)),H=["Presto"],U.push(I));else j+=" Mobile";(I=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(I=[parseFloat(I.replace(/\.(\d)$/,".0$1")),I],"Safari"==j&&"+"==I[1].slice(-1)?(j="WebKit Nightly",B="alpha",G=I[1].slice(0,-1)):G!=I[1]&&G!=(I[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(G=null),I[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==I[0]&&537.36==I[2]&&parseFloat(I[1])>=28&&"WebKit"==H&&(H=["Blink"]),q&&(S||I[1])?(H&&(H[1]="like Chrome"),I=I[1]||((I=I[0])<530?1:I<532?2:I<532.05?3:I<533?4:I<534.03?5:I<534.07?6:I<534.1?7:I<534.13?8:I<534.16?9:I<534.24?10:I<534.3?11:I<535.01?12:I<535.02?"13+":I<535.07?15:I<535.11?16:I<535.19?17:I<536.05?18:I<536.1?19:I<537.01?20:I<537.11?"21+":I<537.13?23:I<537.18?24:I<537.24?25:I<537.36?26:"Blink"!=H?"27":"28")):(H&&(H[1]="like Safari"),I=(I=I[0])<400?1:I<500?2:I<526?3:I<533?4:I<534?"4+":I<535?5:I<537?6:I<538?7:I<601?8:I<602?9:I<604?10:I<606?11:I<608?12:"12"),H&&(H[1]+=" "+(I+="number"==typeof I?".x":/[.+]/.test(I)?"":"+")),"Safari"==j&&(!G||parseInt(G)>45)?G=I:"Chrome"==j&&/\bHeadlessChrome/i.test(t)&&U.unshift("headless")),"Opera"==j&&(I=/\bzbov|zvav$/.exec(W))?(j+=" ",U.unshift("desktop mode"),"zvav"==I?(j+="Mini",G=null):j+="Mobile",W=W.replace(RegExp(" *"+I+"$"),"")):"Safari"==j&&/\bChrome\b/.exec(H&&H[1])?(U.unshift("desktop mode"),j="Chrome Mobile",G=null,/\bOS X\b/.test(W)?($="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(j)&&!G&&(G=getVersion("Chrome")),G&&0==G.indexOf(I=/[\d.]+$/.exec(W))&&t.indexOf("/"+I+"-")>-1&&(W=trim(W.replace(I,""))),W&&-1!=W.indexOf(j)&&!RegExp(j+" OS").test(W)&&(W=W.replace(RegExp(" *"+qualify(j)+" *"),"")),H&&!/\b(?:Avant|Nook)\b/.test(j)&&(/Browser|Lunascape|Maxthon/.test(j)||"Safari"!=j&&/^iOS/.test(W)&&/\bSafari\b/.test(H[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(j)&&H[1])&&(I=H[H.length-1])&&U.push(I),U.length&&(U=["("+U.join("; ")+")"]),$&&Y&&Y.indexOf($)<0&&U.push("on "+$),Y&&U.push((/^on /.test(U[U.length-1])?"":"on ")+Y),W&&(I=/ ([\d.+]+)$/.exec(W),M=I&&"/"==W.charAt(W.length-I[0].length-1),W={architecture:32,family:I&&!M?W.replace(I[0],""):W,version:I?I[1]:null,toString:function(){var t=this.version;return this.family+(t&&!M?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(I=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+I),"")),j&&(/\bWOW64\b/i.test(t)||q&&/\w(?:86|32)$/.test(h.cpuClass||h.platform)&&!/\bWin64; x64\b/i.test(t))&&U.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==j&&parseFloat(G)>=39&&(W.architecture=64),t||(t=null);var z={};return z.description=t,z.layout=H&&H[0],z.manufacturer=$,z.name=j,z.prerelease=B,z.product=Y,z.ua=t,z.version=j&&G,z.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},z.parse=parse,z.toString=function toStringPlatform(){return this.description||""},z.version&&U.unshift(G),z.name&&U.unshift(j),W&&j&&(W!=String(W).split(" ")[0]||W!=j.split(" ")[0]&&!Y)&&U.push(Y?"("+W+")":"on "+W),U.length&&(z.description=U.join(" ")),z}();h&&g?forOwn(b,(function(t,a){h[a]=t})):m.platform=b}).call(a)})),Zv=Math.floor,mergeSort=function(t,a){var c=t.length,m=Zv(c/2);return c<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,m),a),mergeSort(arraySliceSimple(t,m),a),a)},insertionSort=function(t,a){for(var c,m,h=t.length,g=1;g<h;){for(m=g,c=t[g];m&&a(t[m-1],c)>0;)t[m]=t[--m];m!==g++&&(t[m]=c)}return t},merge=function(t,a,c,m){for(var h=a.length,g=c.length,I=0,M=0;I<h||M<g;)t[I+M]=I<h&&M<g?m(a[I],c[M])<=0?a[I++]:c[M++]:I<h?a[I++]:c[M++];return t},ef=mergeSort,tf=$.match(/firefox\/(\d+)/i),rf=!!tf&&+tf[1],nf=/MSIE|Trident/.test($),af=$.match(/AppleWebKit\/(\d+)\./),sf=!!af&&+af[1],cf=[],lf=N(cf.sort),uf=N(cf.push),df=fails((function(){cf.sort(void 0)})),pf=fails((function(){cf.sort(null)})),mf=arrayMethodIsStrict("sort"),hf=!fails((function(){if(J)return J<70;if(!(rf&&rf>3)){if(nf)return!0;if(sf)return sf<603;var t,a,c,m,h="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:c=3;break;case 68:case 71:c=4;break;default:c=2}for(m=0;m<47;m++)cf.push({k:a+m,v:c})}for(cf.sort((function(t,a){return a.v-t.v})),m=0;m<cf.length;m++)a=cf[m].k.charAt(0),h.charAt(h.length-1)!==a&&(h+=a);return"DGBEFHACIJK"!==h}}));_export({target:"Array",proto:!0,forced:df||!pf||!mf||!hf},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if(hf)return void 0===t?lf(a):lf(a,t);var c,m,h=[],g=lengthOfArrayLike(a);for(m=0;m<g;m++)m in a&&uf(h,a[m]);for(ef(h,function(t){return function(a,c){return void 0===c?-1:void 0===a?1:void 0!==t?+t(a,c)||0:toString$1(a)>toString$1(c)?1:-1}}(t)),c=lengthOfArrayLike(h),m=0;m<c;)a[m]=h[m++];for(;m<g;)deletePropertyOrThrow(a,m++);return a}});var gf=entryVirtual("Array").sort,vf=Array.prototype,sort=function(t){var a=t.sort;return t===vf||Y(vf,t)&&a===vf.sort?gf:a},yf=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function d(a,c){for(var m in c)t.o(c,m)&&!t.o(a,m)&&ze(a,m,{enumerable:!0,get:c[m]})},o:function o(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function _default(){return C}});var c=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(t){},this.onProgress=function(t){},this.onUploadProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var c=void 0!==bc&&zc(t)||t["@@iterator"];if(!c){if(jc(t)||(c=function(t,a){if(t){var c;if("string"==typeof t)return r(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wc(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var m=0,h=function i(){};return{s:h,n:function n(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}},e:function e(t){throw t},f:h}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var g,I=!0,M=!1;return{s:function s(){c=c.call(t)},n:function n(){var t=c.next();return I=t.done,t},e:function e(t){M=!0,g=t},f:function f(){try{I||null==c.return||c.return()}finally{if(M)throw g}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var m={privateObj:{},setItem:function setItem(t,a){m.privateObj[t]=a},getItem:function getItem(t){return m.privateObj[t]},removeItem:function removeItem(t){delete m.privateObj[t]},getKeys:function getKeys(){return mn(m.privateObj)}},h={getFileKey:function getFileKey(t){var a=t.size.toString(),c=t.lastModified.toString();return"_NosUploader_"+t.name+slice$1(a).call(a,a.length-5)+slice$1(c).call(c,c.length-5)},getFileInfo:function getFileInfo(t){var a=m.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function initFile(t,a,c){h.clearExpiredInfo();var g=this.getFileKey(a),I={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:wi(),end:!1};return t.payload&&(I.payload=t.payload),c&&m.setItem(g,Fc(I)),g},setUploadContext:function setUploadContext(t,a,c){var h=this.getFileInfo(t);h&&(h.ctx=a,c&&m.setItem(t,Fc(h)))},setComplete:function setComplete(t,a){var c=this.getFileInfo(t);c&&(c.modifyAt=wi(),c.end=!0,a&&m.setItem(t,Fc(c)))},getUploadContext:function getUploadContext(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function removeFileInfo(t){0===indexOf(t).call(t,"_NosUploader_")&&m.removeItem(t)},clearExpiredInfo:function clearExpiredInfo(){var t,a="function"==typeof m.getKeys?m.getKeys():mn(m),c=wi(),g=[],I=n(a);try{for(I.s();!(t=I.n()).done;){var M=t.value;if(0===indexOf(M).call(M,"_NosUploader_")){var T=h.getFileInfo(M);null===T||c-T.modifyAt>C.expireTime?m.removeItem(M):g.push({fileInfo:T,key:M})}}}catch(t){I.e(t)}finally{I.f()}if(g.length>C.maxFileCache){var S,E,b=n(slice$1(S=sort(g).call(g,(function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt}))).call(S,C.maxFileCache));try{for(b.s();!(E=b.n()).done;){var A,N=E.value;0===indexOf(A=N.key).call(A,"_NosUploader_")&&m.removeItem(N.key)}}catch(t){b.e(t)}finally{b.f()}}}},g=h;function u(t){return(u="function"==typeof bc&&"symbol"==typeof Ac?function(t){return typeof t}:function(t){return t&&"function"==typeof bc&&t.constructor===bc&&t!==bc.prototype?"symbol":typeof t})(t)}function f(t,a){return!a||"object"!==u(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function l(t){var a="function"==typeof Ml?new Ml:void 0;return(l=function l(t){var c,m;if(null===t||(m=t,-1===indexOf(c=Function.toString.call(m)).call(c,"[native code]")))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return s(t,arguments,y(this).constructor)}return n.prototype=ft(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function s(t,a,c){return(s=p()?Ll:function(t,a,c){var m=[null];m.push.apply(m,a);var h=new(bind$1(Function).apply(t,m));return c&&d(h,c.prototype),h}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Ll)return!1;if(Ll.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Ll(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=Mt||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=Mt?wc:function(t){return t.__proto__||wc(t)})(t)}var I=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=ft(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,c,m=(a=r,c=p(),function(){var t,m=y(a);if(c){var h=y(this).constructor;t=Ll(m,arguments,h)}else t=m.apply(this,arguments);return f(this,t)});function r(t,a){var c;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(c=m.call(this,"NosUploadError:"+t)).errCode=a,c.errMsg=t,c}return r}(l(Error)),M=function e(t,a,c){if("uploading"===t.uploadState){var m=t.config,h=t.param,M=g.getUploadContext(t.fileKey);if(!M)return c(0);var T=new XMLHttpRequest,S=m.directUploadAddr+"/".concat(h.bucketName)+"/".concat(encodeURIComponent(h.objectName))+"?uploadContext"+"&context=".concat(M)+"&version=".concat(m.version);T.onreadystatechange=function(){var h;if("abort"!==t.uploadState&&4===T.readyState){var M,E,C,b;try{b=JSON.parse(T.responseText)}catch(t){b={errMsg:"JsonParseError in getOffset",errCode:500}}200===T.status?b.errCode?t.config.onError(new I(b.errMsg,b.errCode)):c(b.offset):T.status.toString().match(/^5/)?e(t,a-1,c):a>0?("function"==typeof(null===(h=m.logger)||void 0===h?void 0:h.error)&&m.logger.error(concat(M="getOffset(".concat(S,") error. retry after 3 seconds. ")).call(M,(new Date).toTimeString())),Gi((function(){e(t,a-1,c)}),3500)):T.status?(g.removeFileInfo(t.fileKey),m.onError(new I(concat(E=concat(C="getOffset(".concat(S,") error: ")).call(C,T.status," ")).call(E,T.statusText)))):m.onError(new I("getOffset(".concat(S,") error. no Error Code")))}},T.open("get",S),T.setRequestHeader("x-nos-token",h.token),T.timeout=m.getOffsetTimeout,T.send()}},T=function e(t,a,c,m){if("uploading"===t.uploadState){var h=t.param,M=t.config,T=slice$1(File.prototype),S=void 0!==h.ctx?h.ctx:"",E=a+M.trunkSize>t.file.size,C=E?t.file.size:a+M.trunkSize,b=new XMLHttpRequest,A=M.directUploadAddr+"/".concat(h.bucketName)+"/".concat(encodeURIComponent(h.objectName));if(b.upload.onprogress=function(c){if("abort"!==t.uploadState){var m=0;c.lengthComputable?(m=(a+c.loaded)/t.file.size,M.onProgress(m),M.onUploadProgress({loaded:c.loaded,total:t.file.size,percentage:m,percentageText:(100*m).toFixed(2)+"%"})):M.onError(new I("browser does not support query upload progress"))}},b.onreadystatechange=function(){var h,T;if("abort"!==t.uploadState&&4===b.readyState){var S,C,N,R;try{R=JSON.parse(b.responseText)}catch(t){"function"==typeof(null===(h=M.logger)||void 0===h?void 0:h.error)&&M.logger.error("JsonParseError in uploadTrunk",t),R={errMsg:"JsonParseError in uploadTrunk"}}200===b.status?(t.setContext(R.context),E?(m(),t.setComplete()):e(t,R.offset,M.retryCount,m)):b.status.toString().match(/^5/)?c>0?e(t,a,c-1,m):(g.removeFileInfo(t.fileKey),M.onError(new I(R.errMsg,R.errCode))):c>0?("function"==typeof(null===(T=M.logger)||void 0===T?void 0:T.error)&&M.logger.error(concat(S="uploadTrunk(".concat(A,") error. retry after 3 seconds. ")).call(S,(new Date).toTimeString())),Gi((function(){e(t,a,c-1,m)}),3500)):b.status?(g.removeFileInfo(t.fileKey),M.onError(new I(concat(C=concat(N="uploadTrunk(".concat(A,") error: ")).call(N,b.status," ")).call(C,b.statusText)))):M.onError(new I("uploadTrunk(".concat(A,") error. no Error Code. Please check your network")))}},b.open("post",A+"?offset=".concat(a)+"&complete=".concat(E)+"&context=".concat(S)+"&version=".concat(M.version)),b.setRequestHeader("x-nos-token",h.token),h.md5&&b.setRequestHeader("content-md5",h.md5),t.file.type&&b.setRequestHeader("content-type",t.file.type),b.timeout=M.trunkUploadTimeout,"undefined"!=typeof FileReader){var N=new FileReader;N.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)instanceof ArrayBuffer&&t.target.result.byteLength>0?b.send(t.target.result):M.onError(new I("Read ArrayBuffer failed",194003))})),N.addEventListener("error",(function(t){var a=t.target.error;M.onError(new I("Read ArrayBuffer error. ".concat(a.toString()),194003))})),N.readAsArrayBuffer(T.call(t.file,a,C))}else b.send(T.call(t.file,a,C))}};function v(t,a){for(var c=0;c<a.length;c++){var m=a[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),ze(t,m.key,m)}}var S=function(){function e(t,a,c){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=c,this.file=t,this.param=a,this.fileKey=g.initFile(a,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function value(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;M(this,a.retryCount,(function(c){T(t,c,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function value(){this.setUploadState("paused")}},{key:"abort",value:function value(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new I("Upload Aborted",10499)))}},{key:"setUploadState",value:function value(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function value(t){g.setUploadContext(this.fileKey,t,this.config.enableCache),this.param.ctx=t}},{key:"setComplete",value:function value(){g.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&v(e.prototype,t),e}(),E={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function getFileUploadInformation(t){var a=g.getFileKey(t),c=g.getFileInfo(a);return null===c?null:wi()-c.modifyAt>E.expireTime?(g.removeFileInfo(a),null):{uploadInfo:qt({bucketName:c.bucket,objectName:c.obj,token:c.token,ctx:c.ctx},c.payload?{payload:c.payload}:{}),complete:c.end}},setMaxFileCache:function setMaxFileCache(t){E.maxFileCache=t},setExpireTime:function setExpireTime(t){E.expireTime=t},printCaches:function printCaches(){if("undefined"!=typeof localStorage)for(var t=0,a=mn(localStorage);t<a.length;t++){var c=a[t],m=g.getFileInfo(c);m&&console.log(m,"modifiedAt",new Date(m.modifyAt).toTimeString())}},createConfig:function createConfig(t){return new c(t)},createTask:function createTask(t,a,c){return new S(t,a,c)}},C=E;return a.default}()})),_f=createCommonjsModule((function(t,a){t.exports=function(){function object2String(t){if(t){var a,c="";return forEach$1(a=mn(t)).call(a,(function(a,m){c+=0===m?"?":"&",c+=a+"="+t[a]})),c}return""}var t=function(t){function V2NIMError(a,c,m,h){var g;return(g=t.call(this,m)||this).source=a,g.code=c,g.desc=m,g.detail=h||{},g}return kt(V2NIMError,t),V2NIMError}(Bl(Error));function request(a,c){void 0===c&&(c={dataType:"json",method:"GET",timeout:5e3});var m="text"===c.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",h="GET"===c.method?object2String(c.params):"";return new Mi((function(g,I){if(window.XMLHttpRequest){var M,T=new XMLHttpRequest;if(T.onreadystatechange=function(){if(4===T.readyState)if(200===T.status){try{M=JSON.parse(T.response||"{}")}catch(t){M=T.response}g({status:T.status,data:M})}else Gi((function(){I(new t(1,T.status,"readyState: "+T.readyState+"; statusText: "+T.statusText))}),0)},T.open(c.method,""+a+h),T.timeout=c.timeout||5e3,T.setRequestHeader("Content-Type",m),c.headers)for(var S in c.headers)T.setRequestHeader(S,c.headers[S]);T.ontimeout=function(a){I(new t(1,408,a&&a.message?a.message:"request timeout"))},T.send(Fc(c.data))}else I(new t(2,10400,"request no suppout"))}))}return request}()})),If=console;function uploadFile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I;return Dc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(t.fileInput||t.file){M.next=2;break}throw new Error("File not exist");case 2:if(!t.file){M.next=6;break}h=t.file,M.next=20;break;case 6:if("string"!=typeof t.fileInput){M.next=15;break}if(!((g=document.getElementById(t.fileInput))&&g.files&&g.files[0])){M.next=12;break}h=g.files[0],M.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:M.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){M.next=19;break}h=t.fileInput.files[0],M.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(!(t.maxSize&&h.size>t.maxSize)){M.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+h.size);case 22:return M.next=24,new Mi((function(a,c){var m,g=yf.getFileUploadInformation(h),I=yf.createConfig({enableCache:!0,retryCount:0,directUploadAddr:t.chunkUploadHost,onError:function onError(t){c(t)},onUploadProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}});if(g)if(g.complete)t.onUploadProgress&&t.onUploadProgress({total:h.size,loaded:h.size,percentage:1,percentageText:"100%"}),a(g.uploadInfo);else{m=yf.createTask(h,g.uploadInfo,I);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){If.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),c(t)}}else{m=yf.createTask(h,qt(qt({bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},t.md5?{md5:t.md5}:{}),t.payload?{payload:t.payload}:{}),I);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){If.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),c(t)}}}));case 24:return(I=M.sent).name=h.name,I.size=h.size,I.type=h.type,I.ext=lastIndexOf(a=I.name).call(a,".")>-1?slice$1(c=I.name).call(c,lastIndexOf(m=I.name).call(m,".")+1).toLowerCase():"",M.abrupt("return",I);case 30:case"end":return M.stop()}}),_callee)})))}function getFileUploadInformation(t){var a;if(t.file)a=t.file;else if("string"==typeof t.fileInput){var c=document.getElementById(t.fileInput);if(!(c&&c.files&&c.files[0]))throw new Error("Can not get file from fileInput");a=c.files[0]}else{if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0]))throw new Error("Can not get file from fileInput "+t.fileInput);a=t.fileInput.files[0]}return yf.getFileUploadInformation(a)}function getSystemInfo(){var t,a,c=Xv.version||"";if(isElectron())try{var m=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);m&&m[1]&&"string"==typeof m[1]&&(c=m[1])}catch(t){}return{os:(null===(t=Xv.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=Xv.os)||void 0===a?void 0:a.version)||"",browser:Xv.name||"",browserVer:Xv.version||"",libEnv:"BROWSER",hostEnv:isElectron()?"Electron":isMobile()?"H5":isBrowser()?"BROWSER":"Unset",hostEnvEnum:isElectron()?Ip.Electron:isMobile()?Ip.H5:isBrowser()?Ip.BROWSER:Ip.Unset,hostEnvVer:c,userAgent:navigator&&navigator.userAgent,model:c,manufactor:Xv.name||""}}var Mf=null,Tf=null,Sf=Ci.entries;_export({target:"Object",stat:!0},{entries:function entries(t){return Sf(t)}});var Ef=j.Object.entries,Cf=function(){function V2NIMConversationModelImpl(){this.map=new Ml,this.readTimeMap=new Ml}var t=V2NIMConversationModelImpl.prototype;return t.set=function set(t){var a=this;forEach$1(t).call(t,(function(t){t=a.processConversation(t),map$6(a).set(t.conversationId,t)}))},t.reset=function reset(){map$6(this).clear()},t.count=function count(){return map$6(this).size},t.sort=function sort$1(){var t,a=this,c=Wc(values(t=map$6(this)).call(t));sort(c).call(c,(function(t,a){return a.sortOrder-t.sortOrder})),map$6(this).clear(),forEach$1(c).call(c,(function(t){map$6(a).set(t.conversationId,t)}))},t.processConversation=function processConversation(t){return"string"==typeof t.lastMessage&&delete t.lastMessage,void 0===t.localExtension&&(t.localExtension=""),t},t.getById=function getById(t){return map$6(this).get(t)},t.getAll=function getAll(){var t,a=Wc(values(t=map$6(this)).call(t));return sort(a).call(a,(function(t,a){return a.sortOrder-t.sortOrder}))},t.getByOption=function getByOption(t,a,c){var m,h=c.conversationTypes,g=c.onlyUnread,I=c.conversationGroupIds,M=[];forEach$1(m=map$6(this)).call(m,(function(t){if((!(h&&h.length>0)||includes(h).call(h,t.type))&&(!g||t.unreadCount)&&(!c.ignoreMuted||!t.mute)){if(I){var a=t.groupIds,m=(null==a?void 0:a.length)||0;if(0===I.length&&m>0)return;if(I.length>0&&0===m)return;if(I.length>0&&m>0&&!some(I).call(I,(function(t){return a&&includes(a).call(a,t)})))return}M.push(t)}})),M=sort(M).call(M,(function(t,a){return a.sortOrder-t.sortOrder}));var T=0;t>0&&(T=findIndexWithinTargetValue(M,"sortOrder",t),M[T]&&M[T].sortOrder===t&&(T+=1));var S=slice$1(M).call(M,T).length;return(M=slice$1(M).call(M,T,T+a)).length>0?{offset:S>a?M[M.length-1].sortOrder:0,finished:!(S>a),conversationList:M}:{offset:0,finished:!0,conversationList:M}},t.upsert=function upsert(t){var a=t.conversationId,c=map$6(this).get(a);if(!c)return t=this.processConversation(qt({},t)),map$6(this).set(a,t),t.unreadCount>0;var m=t.unreadCount!==c.unreadCount,h=qt({},c,t);return h=this.processConversation(h),map$6(this).set(a,h),m},t.bulkUpsert=function bulkUpsert(t){var a=this,c=!1;return forEach$1(t).call(t,(function(t){a.upsert(t)&&(c=!0)})),c},t.deleteById=function deleteById(t){var a=this.getById(t);if(a)return map$6(this).delete(t),a},t.updateReadTime=function updateReadTime(t,a){this.readTimeMap.set(t,a)},t.getReadTime=function getReadTime(t){return this.readTimeMap.get(t)||0},V2NIMConversationModelImpl}(),bf=N("".startsWith),Af=N("".slice),Nf=Math.min,Rf=correctIsRegexpLogic("startsWith");_export({target:"String",proto:!0,forced:!Rf},{startsWith:function startsWith(t){var a=toString$1(requireObjectCoercible(this));notARegexp(t);var c=toLength(Nf(arguments.length>1?arguments[1]:void 0,a.length)),m=toString$1(t);return bf?bf(a,m,c):Af(a,c,c+m.length)===m}});var wf=entryVirtual("String").startsWith,kf=String.prototype,startsWith=function(t){var a=t.startsWith;return"string"==typeof t||t===kf||Y(kf,t)&&a===kf.startsWith?wf:a},Of=function(){function V2NIMConversationIdUtilImpl(t){this.core=t}var t=V2NIMConversationIdUtilImpl.prototype;return t.p2pConversationId=function p2pConversationId(t){return this.core.account+"|"+Wl.V2NIM_CONVERSATION_TYPE_P2P+"|"+t},t.teamConversationId=function teamConversationId(t){return this.core.account+"|"+Wl.V2NIM_CONVERSATION_TYPE_TEAM+"|"+t},t.superTeamConversationId=function superTeamConversationId(t){return this.core.account+"|"+Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM+"|"+t},t.messageConversationId=function messageConversationId(t){return t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?t.senderId===this.core.account?this.p2pConversationId(t.receiverId):this.p2pConversationId(t.senderId):t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_TEAM?this.teamConversationId(t.receiverId):this.superTeamConversationId(t.receiverId)},t.parseConversationType=function parseConversationType(t){try{if(t&&startsWith(t).call(t,this.core.account+"|")){var a=t.replace(this.core.account+"|","");return Number(a[0])}return this.core.logger.warn("conversationId is not start with "+this.core.account),Wl.V2NIM_CONVERSATION_TYPE_UNKNOWN}catch(t){return Wl.V2NIM_CONVERSATION_TYPE_UNKNOWN}},t.parseConversationTargetId=function parseConversationTargetId(t){try{if(t&&startsWith(t).call(t,this.core.account+"|")){var a=t.replace(this.core.account+"|","");return slice$1(a).call(a,2)}return this.core.logger.warn("conversationId is not start with "+this.core.account),""}catch(t){return""}},t.convertToV1ConversationId=function convertToV1ConversationId(t){var a=this.parseConversationType(t),c=this.parseConversationTargetId(t);return(a===Wl.V2NIM_CONVERSATION_TYPE_P2P?"p2p":a===Wl.V2NIM_CONVERSATION_TYPE_TEAM?"team":"superTeam")+"|"+c},V2NIMConversationIdUtilImpl}();var Pf=function isEqual(t,a){return zg(t,a)},xf={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},Vf={antispamBusinessId:1},Lf="V2NIMTeamService",Df={teamId:1,name:3,teamType:{id:4,retConverter:function retConverter(t){return 0==+t?1:+t}},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:function retConverter(t,a){return 1==+t&&(void 0===a[13]||1==+a[13])}},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},Uf={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14},Ff={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"}},Bf={v2TeamCreate:{sid:31,cid:1,service:Lf,params:[{type:"Property",name:"team",reflectMapper:Df},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Vf}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:Lf,params:[{type:"Property",name:"team",reflectMapper:Df},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Vf}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:Lf,params:[{type:"Property",name:"team",reflectMapper:Df},{type:"Property",name:"antispamConfig",reflectMapper:Vf}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:Lf,params:[{type:"Property",name:"team",reflectMapper:Df},{type:"Property",name:"antispamConfig",reflectMapper:Vf}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:Lf,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:Lf,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:Lf,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:Lf,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)}]},v2TeamGetByIds:{sid:31,cid:34,service:Lf,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:invertSerializeItem(Df)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:Lf,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:invertSerializeItem(Df)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:Lf,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:Lf,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)}]},v2TeamRejectInvite:{sid:31,cid:22,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(Df)}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:Lf,params:[{type:"Property",name:"teamMember",reflectMapper:Uf}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:Lf,params:[{type:"Property",name:"teamMember",reflectMapper:Ff}]},v2TeamUpdateMember:{sid:31,cid:20,service:Lf,params:[{type:"Property",name:"teamMember",reflectMapper:Uf}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:Lf,params:[{type:"Property",name:"teamMember",reflectMapper:Ff}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:Lf,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:Lf,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:Lf,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:Lf,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:Lf,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Uf)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:Lf,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Ff)}]},v2TeamMemberGetList:{sid:31,cid:36,service:Lf,params:[{type:"Property",name:"tag",reflectMapper:{teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:function converter(t){return+t}},nextToken:5,limit:6,direction:7}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Uf)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:Lf,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Df)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:Lf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Df)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:Lf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Uf)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:Lf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Uf)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:Lf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Df)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:Lf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Df)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:Lf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Ff)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:Lf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Ff)},{type:"Long",name:"timetag"}]}};function formatTeamNotificationAttachData(t,a){if(!t)return{};var c=t;return c.tinfo&&(c.tinfo=function formatTeamFromTinfo(t){return deserialize(t,invertSerializeItem(Df))}(c.tinfo),c.tinfo.teamType=a),c.uinfos,void 0!==c.mute&&(c.mute=em(c.mute)),c}function generateTeamByTeamId(t,a,c){return void 0===c&&(c={}),qt({teamId:t,teamType:a,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:Tu.V2NIM_TEAM_JOIN_MODE_FREE,agreeMode:Su.V2NIM_TEAM_AGREE_MODE_AUTH,inviteMode:Eu.V2NIM_TEAM_INVITE_MODE_MANAGER,updateInfoMode:Cu.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER,updateExtensionMode:Au.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER,chatBannedMode:bu.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,isValidTeam:!0,messageNotifyMode:Nu.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL},c)}function generateMemberByTeamId(t,a,c,m){return void 0===m&&(m={}),qt({teamId:t,teamType:a,accountId:c,joinTime:0,inTeam:!0,memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_NORMAL,chatBanned:!1},m)}function processTeamMembers(t,a){return void 0===a&&(a=Mu.V2NIM_TEAM_TYPE_ADVANCED),map$6(t).call(t,(function(t){return function processTeamMember(t,a){return void 0===a&&(a=Mu.V2NIM_TEAM_TYPE_ADVANCED),t.teamType=a,t.chatBanned=void 0!==t.chatBanned&&t.chatBanned,t}(t,a)}))}function completeMessage(t,a){var c,m=qt(qt({},a),{conversationId:t.V2NIMConversationIdUtil.messageConversationId(a),isSelf:a.senderId===t.account,sendingState:uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,messageStatus:{errorCode:(null===(c=null==a?void 0:a.messageStatus)||void 0===c?void 0:c.errorCode)||200}});return m.threadReply&&(m.threadReply=qt(qt({},m.threadReply),{conversationType:m.conversationType,conversationId:m.conversationId})),m.threadRoot&&(m.threadRoot=qt(qt({},m.threadRoot),{conversationType:m.conversationType,conversationId:m.conversationId})),m}function completeMessageRefer(t,a){return qt(qt({},a),{conversationId:t.V2NIMConversationIdUtil.messageConversationId(a)})}function formatMessageRefer(t,a){var c=a.createTime,m=a.senderId,h=a.receiverId,g=a.conversationType;return{conversationType:g,conversationId:t.V2NIMConversationIdUtil.messageConversationId({conversationType:g,senderId:m,receiverId:h}),senderId:a.senderId,receiverId:a.receiverId,messageServerId:a.messageServerId,createTime:c,messageClientId:a.messageClientId}}function formatRevokeMessage(t,a){var c={7:pu.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY,8:pu.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY,12:pu.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY,13:pu.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY,14:pu.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY},m={7:Wl.V2NIM_CONVERSATION_TYPE_P2P,8:Wl.V2NIM_CONVERSATION_TYPE_TEAM,12:Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM,13:Wl.V2NIM_CONVERSATION_TYPE_P2P,14:Wl.V2NIM_CONVERSATION_TYPE_TEAM}[a.sysMsgType];return{postscript:a.postscript,revokeType:c[a.sysMsgType]||pu.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED,revokeAccountId:a.opeAccount||a.senderId,callbackExtension:a.callbackExtension,serverExtension:a.attach||"",messageRefer:{conversationType:m,conversationId:t.V2NIMConversationIdUtil.messageConversationId(qt(qt({},a),{conversationType:m,senderId:a.senderId,receiverId:a.receiverId})),senderId:a.senderId,receiverId:a.receiverId,messageServerId:a.messageServerId,createTime:a.deleteMsgCreatetime,messageClientId:a.messageClientId}}}function formatClearHistoryNotification(t,a){return{conversationId:a.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?t.V2NIMConversationIdUtil.p2pConversationId(a.receiverId):a.conversationType===Wl.V2NIM_CONVERSATION_TYPE_TEAM?t.V2NIMConversationIdUtil.teamConversationId(a.teamId):t.V2NIMConversationIdUtil.superTeamConversationId(a.teamId),deleteTime:a.deleteTime,serverExtension:a.serverExtension}}function convertNotificationType(t,a){var c={0:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE,401:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE,1:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK,402:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK,2:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE,403:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE,3:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO,404:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO,4:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS,405:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS,5:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS,410:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS,6:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER,406:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER,7:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER,407:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER,8:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER,408:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER,9:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT,411:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT,10:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER,409:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER};return void 0===c[a]&&t.logger.warn("[V2NIMMessageService] undefined notification type: "+a),"number"==typeof c[a]?c[a]:cu.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED}function formatMessageAttachment(t,a){return t.messageType===su.V2NIM_MESSAGE_TYPE_NOTIFICATION?function formatNotificationMessage(t,a){var c,m,h,g,I,M=a.attachment||{};if(a.attachment&&"type"in a.attachment)return a;var T=void 0;if(null===(c=M.data)||void 0===c?void 0:c.tinfo){var S=M.id,E=M.data,C=S>400?Mu.V2NIM_TEAM_TYPE_SUPER:Mu.V2NIM_TEAM_TYPE_ADVANCED,b=formatTeamNotificationAttachData(qt({},E),C).tinfo;T={},b.teamId,T=__rest(b,["teamId"])}var A=qt(qt(qt(qt({raw:M.raw,type:convertNotificationType(t,M.id)},T?{updatedTeamInfo:T}:{}),{targetIds:(null===(m=M.data)||void 0===m?void 0:m.ids)||((null===(h=M.data)||void 0===h?void 0:h.id)?[M.data.id]:[])}),"string"==typeof(null===(g=M.data)||void 0===g?void 0:g.attach)?{serverExtension:M.data.attach}:{}),"number"==typeof(null===(I=M.data)||void 0===I?void 0:I.mute)?{chatBanned:M.data.mute!==yu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF}:{});return qt(qt({},a),{attachment:A})}(a,t):t}function attachmentToRaw(t,a){if(!a)return"";switch(t){case su.V2NIM_MESSAGE_TYPE_CUSTOM:return a.raw||"";case su.V2NIM_MESSAGE_TYPE_IMAGE:case su.V2NIM_MESSAGE_TYPE_VIDEO:case su.V2NIM_MESSAGE_TYPE_AUDIO:case su.V2NIM_MESSAGE_TYPE_FILE:return function mediaAttachmentToRaw(t){var a=t,c=a.width,m=a.height,h=a.duration;a.path,a.file,a.raw,a.ctx,a.payload,a.bucketName,a.objectName,a.token;var g=a.ext,I=__rest(a,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),M="string"==typeof g&&"."===g[0]?slice$1(g).call(g,1):g;return Fc(qt(qt(qt(qt(qt({},I),void 0===g?{}:{ext:M}),void 0===c?{}:{w:c}),void 0===m?{}:{h:m}),void 0===h?{}:{dur:h}))}(a);case su.V2NIM_MESSAGE_TYPE_LOCATION:return function locationAttachmentToRaw(t){return Fc({lat:t.latitude,lng:t.longitude,title:t.address})}(a);case su.V2NIM_MESSAGE_TYPE_CALL:return function callAttachmentToRaw(t){t.raw;var a=__rest(t,["raw"]);try{var c;return Fc(qt(qt({},a),{durations:map$6(c=t.durations).call(c,(function(t){return{accid:t.accountId,duration:t.duration}}))}))}catch(a){return Fc(t)}}(a);default:return a.raw||Fc(a)}}function rawToAttachment(t,a){var c;try{switch(c=JSON.parse(t),a){case su.V2NIM_MESSAGE_TYPE_CUSTOM:return{raw:t};case su.V2NIM_MESSAGE_TYPE_LOCATION:return function locationRawToAttachment(t,a){return{latitude:a.lat,longitude:a.lng,address:a.title,raw:t}}(t,c);case su.V2NIM_MESSAGE_TYPE_AUDIO:case su.V2NIM_MESSAGE_TYPE_VIDEO:case su.V2NIM_MESSAGE_TYPE_IMAGE:case su.V2NIM_MESSAGE_TYPE_FILE:return function mediaRawToAttachment(t,a){var c=a.w,m=a.h,h=a.dur,g=a.ext,I=__rest(a,["w","h","dur","ext"]),M="string"==typeof g&&"."!==g[0]?"."+g:g;return qt(qt(qt(qt(qt(qt({},I),void 0===g?{}:{ext:M}),void 0===c?{}:{width:c}),void 0===m?{}:{height:m}),void 0===h?{}:{duration:h}),{raw:t})}(t,c);case su.V2NIM_MESSAGE_TYPE_CALL:return function callRawToAttachment(t,a){var c;return qt(qt({},a),{durations:map$6(c=a.durations).call(c,(function(t){return{accountId:t.accid,duration:t.duration}})),raw:t})}(t,c);default:return"object"==typeof c&&c?qt(qt({},c),{raw:t}):{raw:t}}}catch(a){return"object"==typeof c&&c?qt(qt({},c),{raw:t}):{raw:t}}}var qf="V2NIMMessageService",Gf={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","30_31":"v2MessageP2pModify","31_37":"v2MessageTeamModify","32_38":"v2MessageSuperTeamModify","7_33":"v2MessageOnModified","4_27":"v2MessageSyncModified","4_28":"v2MessageSuperTeamSyncModified","4_5":"v2BatchMarkRead","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},Hf={conversationType:{id:0,converter:conversationTypeV2ToV1,retConverter:conversationTypeV1ToV2},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:function converter(t,a){return attachmentToRaw(a.messageType,t)},retConverter:function retConverter(t,a){return rawToAttachment(t,Number(a[8]))}},messageClientId:11,messageServerId:12,resend:{id:13,converter:boolToInt,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function def(t){if(t["pushConfig.forcePush"])return"#%@all@%#"},converter:function converter(t,a){if(a["pushConfig.forcePush"]){if(0===t.length)return"#%@all@%#";try{return Fc(t)}catch(t){return"#%@all@%#"}}},retConverter:function retConverter(t){if("#%@all@%#"===t)return t;if(t)try{return JSON.parse(t)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:boolToInt,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:function def(t){return ws(t,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function retConverter(){}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:boolToInt,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:boolToInt,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:boolToInt,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:boolToInt,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:objectToJSONString,retConverter:stringToJSONObject},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:objectToJSONString,retConverter:emptyFunc$1},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:objectToJSONString,retConverter:emptyFunc$1},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:emptyFunc$1},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:objectToJSONString,retConverter:emptyFunc$1},errorCode:{id:61,access:"messageStatus.errorCode",retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:boolToInt,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:boolToInt,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:boolToInt,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:boolToInt,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:boolToInt,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:boolToInt,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:boolToInt,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:boolToInt,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:objectToJSONString,retConverter:function retConverter(){}},inclusive:{id:155,access:"targetConfig.inclusive",converter:function converter(t){return t?1:2},retConverter:function retConverter(){}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:boolToInt,retConverter:function retConverter(){}}},jf=invertSerializeItem(Hf),Yf={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};invertSerializeItem(Yf);var $f={version:1,md5:2,nosurl:3,thesaurus:4},Wf={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},zf={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},Kf={v2BatchMarkRead:{sid:4,cid:5,service:qf,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},v2SendP2pMessage:{sid:30,cid:1,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},onMsg:{sid:7,cid:2,service:qf,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Hf)}]},syncOfflineMsgs:{sid:4,cid:4,service:qf,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Hf)}]},syncRoamingMsgs:{sid:4,cid:9,service:qf,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2RevokeMessage:{sid:30,cid:13,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Wf}]},v2DeleteMessage:{sid:30,cid:23,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Yf}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:qf,params:[{type:"PropertyArray",name:"tag",reflectMapper:Yf}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:qf,params:[{type:"PropertyArray",name:"tag",reflectMapper:zf}],response:[{type:"PropertyArray",name:"tag",reflectMapper:invertSerializeItem(zf)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Wf}]},syncP2PMessagReceipts:{sid:4,cid:12,service:qf,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Hf)}]},onP2PMessageReceipts:{sid:7,cid:12,service:qf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:qf,params:[{type:"PropertyArray",name:"tag",reflectMapper:zf}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(zf)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:qf,params:[{type:"Property",name:"tag",reflectMapper:zf,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(zf)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:qf,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(zf)}]},onRevokeMessage:{sid:7,cid:14,service:qf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Wf)}]},syncRevokeMessage:{sid:7,cid:15,service:qf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Wf)}]},syncOnDeleteMessages:{sid:4,cid:21,service:qf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Yf)}]},onDeleteMessage:{sid:7,cid:123,service:qf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Yf)}]},onDeleteMessages:{sid:7,cid:124,service:qf,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Yf)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:qf,params:[{type:"Property",name:"tag",reflectMapper:$f}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem($f)}]},v2MessageP2pModify:{sid:30,cid:31,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2MessageTeamModify:{sid:31,cid:37,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2MessageSuperTeamModify:{sid:32,cid:38,service:qf,params:[{type:"Property",name:"tag",reflectMapper:Hf}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2MessageOnModified:{sid:7,cid:33,service:qf,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2MessageSyncModified:{sid:4,cid:27,service:qf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Hf)},{type:"Long",name:"time"}]},v2MessageSuperTeamSyncModified:{sid:4,cid:28,service:qf,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Hf)},{type:"Long",name:"time"}]}};function conversationTypeV2ToV1(t){return t===Wl.V2NIM_CONVERSATION_TYPE_P2P?0:t===Wl.V2NIM_CONVERSATION_TYPE_TEAM?1:t===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?5:void 0}function conversationTypeV1ToV2(t){var a=em(t);return 0===a?Wl.V2NIM_CONVERSATION_TYPE_P2P:1===a?Wl.V2NIM_CONVERSATION_TYPE_TEAM:5===a?Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM:Wl.V2NIM_CONVERSATION_TYPE_UNKNOWN}var Qf={type:{type:"number"},lastMessageState:{type:"number"},unreadCount:{type:"number"},stickTop:{type:"boolean"},sortOrder:{type:"number"},version:{type:"number"},deleteFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatConversationFields(t,a){return a&&a.length>0?map$6(a).call(a,(function(a){return formatConversationField(t,a)})):[]}function formatLastMessageFromMessage(t,a,c,m){var h,g;void 0===c&&(c=zl.V2NIM_MESSAGE_STATUS_DEFAULT);var I=a=formatMessageAttachment(a,t),M=I.messageType,T=I.subType,S=I.text,E=I.attachment,C=I.serverExtension,b="";if(a.senderId!==t.account){b=ws(a,"fromNick");var A=null===(g=null===(h=t.V2NIMFriendService)||void 0===h?void 0:h.model)||void 0===g?void 0:g.getFriend(a.senderId);A&&A.alias&&(b=A.alias)}return JSON.parse(Fc({lastMessageState:c,messageRefer:formatMessageRefer(t,a),messageType:M,subType:T,text:S,attachment:E,serverExtension:C,callbackExtension:a.callbackExtension,sendingState:m,senderName:b}))}function formatLastMessageFromNotification(t,a){var c=a.messageRefer,m=a.revokeAccountId,h=a.revokeType,g=a.callbackExtension,I=a.serverExtension,M=a.postscript,T=function calcSenderNameFromNotification(t,a,c,m){var h,g,I,M,T,S;if(a!==t.account){var E=null===(g=null===(h=t.V2NIMFriendService)||void 0===h?void 0:h.model)||void 0===g?void 0:g.getFriend(a);if(E&&E.alias)return E.alias;if(c===Wl.V2NIM_CONVERSATION_TYPE_TEAM){var C=null===(M=null===(I=t.V2NIMTeamService)||void 0===I?void 0:I.memberModel)||void 0===M?void 0:M.getById(m,Mu.V2NIM_TEAM_TYPE_ADVANCED,a);if(C&&C.teamNick)return C.teamNick}else if(c===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM){var b=null===(S=null===(T=t.V2NIMTeamService)||void 0===T?void 0:T.memberModel)||void 0===S?void 0:S.getById(m,Mu.V2NIM_TEAM_TYPE_ADVANCED,a);if(b&&b.teamNick)return b.teamNick}var A=t.V2NIMUserService.model.getUser(a);return A&&A.name?A.name:void 0}}(t,a.revokeAccountId,a.messageRefer.conversationType,a.messageRefer.receiverId)||"";return JSON.parse(Fc({lastMessageState:zl.V2NIM_MESSAGE_STATUS_REVOKE,messageRefer:c,revokeAccountId:m,revokeType:h,callbackExtension:g,serverExtension:I,text:M||"",senderName:T}))}function formatConversationField(t,a){var c=format(Qf,a);if(c.groupIds?c.groupIds=JSON.parse(c.groupIds):delete c.groupIds,"string"==typeof c.lastMessage)if(""===c.lastMessage);else if(c.lastMessageState===zl.V2NIM_MESSAGE_STATUS_REVOKE){var m=formatRevokeMessage(t,deserialize(JSON.parse(c.lastMessage),invertSerializeItem(Wf)));c.lastMessage=formatLastMessageFromNotification(t,m)}else if(c.lastMessageState===zl.V2NIM_MESSAGE_STATUS_DEFAULT){var h=deserialize(JSON.parse(c.lastMessage),invertSerializeItem(Hf));c.lastMessage=formatLastMessageFromMessage(t,h,c.lastMessageState,h.senderId===t.account?uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED:void 0)}else c.lastMessageState===zl.V2NIM_MESSAGE_STATUS_BACKFILL&&delete c.lastMessage;return c}function formatConversationByField(t){var a=t.version,c=t.deleteFlag;return{conversation:__rest(t,["version","deleteFlag"]),version:a,deleteFlag:c}}var Jf={type:{type:"number"},oneClickClearUnreadType:{type:"number"},oneClickClearUnreadConversationType:{type:"object"},oneClickClearUnreadVersion:{type:"number"},deleteConversationClearMessage:{type:"boolean"}};function formatConversationNotify(t){return format(Jf,t)}var Xf=function(){function V2NIMConversationVersionCacheImpl(t,a){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=t,this.service=a}var t=V2NIMConversationVersionCacheImpl.prototype;return t.reset=function reset(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0},t.doSync=function doSync(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t,a,c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return this.isSyncing=!0,this.service.emit("onSyncStarted"),h.prev=2,h.next=5,this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}});case 5:t=h.sent,h.next=18;break;case 8:if(h.prev=8,h.t0=h.catch(2),(a=h.t0).code!==Gu.V2NIM_ERROR_CODE_CANCELLED){h.next=13;break}return h.abrupt("return");case 13:return this.isSyncing=!1,this.service.emit("onSyncFailed",a),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Yl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_COMPLETED,error:a,subType:"conversationSync"}),this.processTempPacket(),h.abrupt("return");case 18:c=0===em(ws(t,"content.info.syncType")),m=ws(t,"content.info.nextCursor"),this.doSyncAndSuccess(c,m);case 21:case"end":return h.stop()}}),_callee,this,[[2,8]])})))},t.doSyncAndSuccess=function doSyncAndSuccess(t,a){var c;t&&sort(c=this.service.model).call(c);this.isSyncing=!1,this.nextCursor=em(a)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Yl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_COMPLETED,subType:"conversationSync"}),this.processTempPacket()},t.setBackFillIds=function setBackFillIds(t){var a=this;return forEach$1(t).call(t,(function(t){var c;if(t.lastMessageState===zl.V2NIM_MESSAGE_STATUS_BACKFILL&&(null===(c=a.core.V2NIMMessageService)||void 0===c?void 0:c.model)){a.conversationIdsForBackFill[t.conversationId]=!0;var m=a.core.V2NIMMessageService.model.getLastMessageOfConversation(t.conversationId);t.lastMessage=m?formatLastMessageFromMessage(a.core,m,t.lastMessageState,m.sendingState):""}else a.conversationIdsForBackFill[t.conversationId]=!1;delete t.lastMessageState})),t},t.recvConversationFromSyncAction=function recvConversationFromSyncAction(t){var a=this,c=ws(t,"content.info").syncType,m=formatConversationFields(this.core,ws(t,"content.datas"));0===(c=em(c))?(forEach$1(m).call(m,(function(t){a.initFieldVersion(t.conversationId,t.version)})),m=this.setBackFillIds(m),this.setModel(m)):(m=this.setBackFillIds(m),this.recvConversationForCreated(m)<m.length&&this.recvConversationForChanged(m))},t.recvConversation=function recvConversation(t){var a=this;if(this.isSyncing)this.tempPacket.push(t);else{var c=formatConversationFields(this.core,ws(t,"content.datas")),m=filter(c).call(c,(function(t){return!!t.conversationId})),h=formatConversationNotify(ws(t,"content.info"));if(this.core.logger.log("V2NIMConversation::recvConversation:"+h.type,h,m),2===h.type){var g=map$6(m).call(m,(function(t){return delete a.fieldVersion[t.conversationId],a.service.model.deleteById(t.conversationId),t.conversationId}));return this.service.emit("onConversationDeleted",g),void this.service.unread.digestUnreadCountChange()}if(12!==h.type)h.type,m=this.setBackFillIds(m),this.recvConversationForCreated(m)<m.length&&this.recvConversationForChanged(m);else this.compareAndClearUnreadInModel(h.oneClickClearUnreadVersion,h.oneClickClearUnreadType,{conversationGroupIds:h.oneClickClearUnreadGroupId?[h.oneClickClearUnreadGroupId]:void 0,conversationTypes:h.oneClickClearUnreadConversationType})}},t.recvConversationForCreated=function recvConversationForCreated(t){var a=this,c=filter(t).call(t,(function(t){return!a.fieldVersion[t.conversationId]})),m=reduce(c).call(c,(function(t,c){if(!a.fieldVersion[c.conversationId]){a.initFieldVersion(c.conversationId,c.version),t=!!a.updateModel(c)||t;var m=a.service.model.getById(c.conversationId);return m&&a.service.triggerConversationCreated(m),t}return t}),!1);return m&&this.service.unread.digestUnreadCountChange(),c.length},t.recvConversationForChanged=function recvConversationForChanged(t){var a,c=this,m=this.bulkCompare(t);if(0!==m.length){this.bulkUpdateModel(m);var h=filter(a=map$6(m).call(m,(function(t){return c.service.model.getById(t.conversationId)}))).call(a,(function(t){return!!t}));this.service.triggerConversationChanged(h)}},t.processTempPacket=function processTempPacket(){var t,a=this;forEach$1(t=this.tempPacket).call(t,(function(t){a.recvConversation(t)})),this.tempPacket=[]},t.bulkCompare=function bulkCompare(t){var a,c=this;return filter(a=map$6(t).call(t,(function(t){return c.compare(t)}))).call(a,(function(t){return!!t}))},t.compare=function compare(t){var a=this,c=t.version,m=t.conversationId,h=t.deleteFlag,g=t.type,I=["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime"],M={},T=0;return forEach$1(I).call(I,(function(h){var g=h;if(void 0!==t[g]){var I=a.fieldVersion[m];I&&"number"==typeof I[g]&&I[g]>=c||(a.fieldVersion[m]=a.fieldVersion[m]||{},a.fieldVersion[m][g]=c,M[g]=t[g],T+=1)}})),T?qt(qt({},M),{conversationId:m,deleteFlag:h,version:c,type:g}):void 0},t.bulkUpdateModel=function bulkUpdateModel(t){var a=this,c=!1;forEach$1(t).call(t,(function(t){a.updateModel(t)&&(c=!0)})),c&&this.service.unread.digestUnreadCountChange()},t.initFieldVersion=function initFieldVersion(t,a){this.fieldVersion[t]={stickTop:a,groupIds:a,serverExtension:a,lastMessage:a,lastMessageState:a,unreadCount:a,sortOrder:a,createTime:a,updateTime:a}},t.initConversation=function initConversation(t,a){var c=wi();return qt({conversationId:t,type:this.core.V2NIMConversationIdUtil.parseConversationType(t),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,createTime:c,updateTime:c,sortOrder:c},a)},t.updateModel=function updateModel(t){var a=formatConversationByField(t),c=a.deleteFlag,m=a.conversation;if(c){var h=this.service.model.deleteById(m.conversationId);return!!(h&&h.unreadCount>0)}return this.service.model.upsert(m)},t.setModel=function setModel(t){var a,c=map$6(a=filter(t).call(t,(function(t){return!t.deleteFlag}))).call(a,(function(t){return formatConversationByField(t).conversation}));this.service.model.set(c)},t.updateModelWithLastMessage=function updateModelWithLastMessage(t,a,c,m){var h=this.service.model.getById(t),g=a?formatLastMessageFromMessage(this.core,a,c,m):void 0;if(!Pf(null==h?void 0:h.lastMessage,g))if(h){var I=qt(qt({},h),{sortOrder:g?h.stickTop?g.messageRefer.createTime+1e15:g.messageRefer.createTime:h.sortOrder,lastMessage:g});this.service.model.upsert(I),this.service.triggerConversationChanged([I])}else{this.initFieldVersion(t,-1);var M=this.initConversation(t,{lastMessage:g});this.service.model.upsert(M),this.service.triggerConversationCreated(M)}},t.updateModelByRevoke=function updateModelByRevoke(t){var a=this,c=[];forEach$1(t).call(t,(function(t){var m=t.postscript,h=t.messageRefer,g=__rest(t,["postscript","messageRefer"]),I=h.conversationId,M=a.service.model.getById(I);M&&M.lastMessage&&M.lastMessage.messageRefer.messageClientId===h.messageClientId&&M.lastMessage.lastMessageState!==zl.V2NIM_MESSAGE_STATUS_REVOKE&&(M.lastMessage.lastMessageState=zl.V2NIM_MESSAGE_STATUS_REVOKE,m&&(M.lastMessage.text=m),qt(M.lastMessage,g),a.service.model.upsert(M),c.push(M))})),c.length>0&&this.service.triggerConversationChanged(c)},t.compareAndUpdateModel=function compareAndUpdateModel(t){var a=this;this.core.logger.log("V2NIMConversation::compareAndUpdateModel",map$6(t).call(t,(function(t){return t.conversationId})));var c=!1,m=[];forEach$1(t).call(t,(function(t){var h=a.compare(t);if(h){var g=a.service.model.getById(t.conversationId);a.updateModel(h)&&(c=!0);var I=a.service.model.getById(t.conversationId);I&&(g?m.push(I):a.service.triggerConversationCreated(I))}})),m.length>0&&this.service.triggerConversationChanged(m),c&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteModel=function compareAndDeleteModel(t){var a=this;this.core.logger.log("V2NIMConversation::compareAndDeleteModel",t);var c=reduce(t).call(t,(function(t,c){delete a.fieldVersion[c];var m=a.service.model.deleteById(c);return!!!!(m&&m.unreadCount>0)||t}),!1);this.service.emit("onConversationDeleted",t),c&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteGroupInModel=function compareAndDeleteGroupInModel(t,a){var c,m=this;this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",t,a);var h=[];forEach$1(c=mn(this.fieldVersion)).call(c,(function(c){var g=m.fieldVersion[c];if(void 0===g.groupIds||t>g.groupIds){g.groupIds=t;var I=m.service.model.getById(c);if(I&&I.groupIds&&I.groupIds.length>0){var M,T=filter(M=I.groupIds).call(M,(function(t){return t!==a}));if(T.length!==I.groupIds.length){var S=qt(qt({},I),{groupIds:T});m.service.model.upsert(S),S&&h.push(S)}}}})),h.length>0&&this.service.triggerConversationChanged(h)},t.compareAndClearUnreadInModel=function compareAndClearUnreadInModel(t,a,c){var m=this;this.core.logger.log("V2NIMConversation::compareAndClearUnreadInModel",t,a,c);var h=[],g=[];if(1===a)g=this.service.model.getAll();else if(c){var I=this.service.model.count();g=this.service.model.getByOption(0,I,c).conversationList}forEach$1(g).call(g,(function(a){var c=a.conversationId,g=m.fieldVersion[c];if(void 0===g.unreadCount||t>g.unreadCount){g.unreadCount=t;var I=a.unreadCount,M=qt(qt({},a),{unreadCount:0});m.service.model.upsert(M),I>0&&h.push(M)}})),h.length>0&&this.service.triggerConversationChanged(h),this.service.unread.digestUnreadCountChange()},t.backfillLastMsg=function backfillLastMsg(t,a){var c=this,m=t=jm(t);(a||(m=filter(t).call(t,(function(t){return c.conversationIdsForBackFill[t]})),0!==m.length))&&forEach$1(m).call(m,(function(t){var a=c.service.model.getById(t),m=ws(a,"lastMessage.messageRefer.messageClientId"),h=c.core.V2NIMMessageService.model.getLastMessageOfConversation(t);(h&&h.messageClientId)!==m&&(c.conversationIdsForBackFill[t]=!1,h?c.updateModelWithLastMessage(t,h,zl.V2NIM_MESSAGE_STATUS_BACKFILL,h.sendingState):c.updateModelWithLastMessage(t,void 0,zl.V2NIM_MESSAGE_STATUS_BACKFILL,uu.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN))}))},V2NIMConversationVersionCacheImpl}(),Zf={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread","4_14":"syncConversationReadTime","4_20":"syncSuperTeamReadTime","30_16":"v2MarkConversationReadTime","32_25":"v2MarkSuperTeamReadTime","7_116":"v2MultiDeviceConversationReadTime","21_125":"v2MultiDeviceSuperTeamReadTime"},ey="V2NIMConversationService",ty={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},ry={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6},ny={v2ConversationCreate:{sid:28,cid:1,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Oh(ty)}]},v2ConversationDelete:{sid:28,cid:2,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:Oh(ty)}]},v2ConversationUpdate:{sid:28,cid:3,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:Oh(ty)}]},v2ConversationSetTop:{sid:28,cid:4,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:Oh(ty)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Oh(ty)}]},v2ConversationGet:{sid:28,cid:6,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Oh(ty)}]},v2ConversationGetByIds:{sid:28,cid:7,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:ey,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:ey,response:[{type:"Property",name:"info",reflectMapper:Oh(ry)},{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:ey,response:[{type:"Property",name:"info",reflectMapper:Oh(ry)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:Oh(ry)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:ey,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:Oh(ry)}]},syncConversationReadTime:{sid:4,cid:14,service:ey,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamReadTime:{sid:4,cid:20,service:ey,response:[{type:"LongLongMap",name:"superTeam"}]},v2MarkConversationReadTime:{sid:30,cid:16,service:ey,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MarkSuperTeamReadTime:{sid:32,cid:25,service:ey,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceConversationReadTime:{sid:30,cid:116,service:ey,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceSuperTeamReadTime:{sid:21,cid:125,service:ey,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]}},ay=function(){function V2NIMConversationUnreadImpl(t,a){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=t,this.service=a}var t=V2NIMConversationUnreadImpl.prototype;return t.reset=function reset(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},t.getTotalUnreadCount=function getTotalUnreadCount(){return this.totalUnreadCount},t.resetTotalAfterSyncDone=function resetTotalAfterSyncDone(){var t,a=reduce(t=this.service.model.getAll()).call(t,(function(t,a){return t+(a.unreadCount||0)}),0),c=this.totalUnreadCount;return void 0!==c&&c===a||(this.totalUnreadCount=a,this.service.emit("onTotalUnreadCountChanged",a)),a},t.digestUnreadCountChange=function digestUnreadCountChange(){this._digest()},t._digest=function _digest(){var t,a=this,c=this.totalUnreadCount,m=reduce(t=this.service.model.getAll()).call(t,(function(t,a){return t+(a.unreadCount||0)}),0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+c+", newUnreadCount "+m),c!==m&&(this.totalUnreadCount=m,this.service.emit("onTotalUnreadCountChanged",m));var h=mn(this.unreadCountByFilter);forEach$1(h).call(h,(function(t){var c=JSON.parse(t),m=a.getUnreadCountByFilter(c),h=a.unreadCountByFilter[t];a.unreadCountByFilter[t]=m,c.equals=bind$1(equals).call(equals,c),h!==m&&a.service.emit("onUnreadCountChangedByFilter",c,m)}))},t.getUnreadCountByIds=function getUnreadCountByIds(t){var a=this;return reduce(t).call(t,(function(t,c){var m=a.service.model.getById(c);return t+(m&&m.unreadCount||0)}),0)},t.getUnreadCountByFilter=function getUnreadCountByFilter(t){var a,c=this.service.model.count(),m=this.service.model.getByOption(0,c,{conversationTypes:t.conversationTypes,conversationGroupIds:t.conversationGroupId?[t.conversationGroupId]:void 0,ignoreMuted:t.ignoreMuted});return reduce(a=m.conversationList).call(a,(function(t,a){return t+(a.unreadCount||0)}),0)},t.addFilter=function addFilter(t){var a=generateFilterKey(t);if(void 0!==this.unreadCountByFilter[a])throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var c=JSON.parse(a),m=this.getUnreadCountByFilter(c);this.unreadCountByFilter[a]=m,this.service.emit("onUnreadCountChangedByFilter",c,m)},t.deleteFilter=function deleteFilter(t){var a=generateFilterKey(t);if(void 0===this.unreadCountByFilter[a])throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[a]},V2NIMConversationUnreadImpl}();function generateFilterKey(t){var a=t.conversationTypes;return a&&(a=sort(a).call(a)),Fc({conversationGroupId:t.conversationGroupId,conversationTypes:a,ignoreMuted:t.ignoreMuted})}function equals(t){return Fc(this)===generateFilterKey(t)}var iy={createTime:{type:"number"},updateTime:{type:"number"}};function formatConversationGroups(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatConversationGroup(t)})):[]}function formatConversationGroup(t){return format(iy,t)}function formatFailedMap(t){var a,c=JSON.parse(t);return map$6(a=mn(c)).call(a,(function(t){return{conversationId:t,error:new Yu({code:c[t]})}}))}var oy,sy={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function formatConversationGroupNotify(t){return format(sy,t)}!function(t){t[t.createConversationGroup=1]="createConversationGroup",t[t.deleteConversationGroup=2]="deleteConversationGroup",t[t.updateConversationGroup=3]="updateConversationGroup",t[t.addConversationToGroup=4]="addConversationToGroup",t[t.removeConversationFromGroup=5]="removeConversationFromGroup"}(oy||(oy={}));var cy=function(t){function V2NIMConversationServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMConversationService",a)||this).config={},m.core.V2NIMConversationIdUtil=new Of(m.core),m.model=new Cf,m.versionCache=new Xf(m.core,Qe(m)),m.unread=new ay(m.core,Qe(m)),"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:Zf,cmdConfig:ny}),m.setOptions(c),m.setListener(),m)}kt(V2NIMConversationServiceImpl,t);var a=V2NIMConversationServiceImpl.prototype;return a.setOptions=function setOptions(t){this.config=qt(this.config,t)},a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.versionCache.doSync()})),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",(function(a,c){var m;!1!==(null===(m=null==c?void 0:c.messageConfig)||void 0===m?void 0:m.lastMessageUpdateEnabled)&&(a.content.info=deserialize(a.content.info,Oh(ry)),a.content.data=deserialize(a.content.data,Oh(ty)),c&&(a.content.data.lastMessage=formatLastMessageFromMessage(t.core,c,zl.V2NIM_MESSAGE_STATUS_DEFAULT)),a.content.datas=[a.content.data],t.v2ConversationNotifySyncOnlineHandler.call(t,a))})),this.core.eventBus.on("V2NIMConversationService/sendMessage",(function(a,c){var m,h;c===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED&&!0===(null===(m=a.messageConfig)||void 0===m?void 0:m.historyEnabled)||!1!==(null===(h=null==a?void 0:a.messageConfig)||void 0===h?void 0:h.lastMessageUpdateEnabled)&&t.versionCache.updateModelWithLastMessage(a.conversationId,a,zl.V2NIM_MESSAGE_STATUS_BACKFILL,c)})),this.core.eventBus.on("V2NIMConversationService/deleteMessages",(function(a){var c=map$6(a).call(a,(function(t){return t.messageRefer.conversationId}));t.versionCache.backfillLastMsg(c,!0)})),this.core.eventBus.on("V2NIMConversationService/revokeMessages",(function(a){t.versionCache.updateModelByRevoke(a)})),this.core.eventBus.on("V2NIMConversationService/checkBackFill",(function(a){t.versionCache.backfillLastMsg(a,!1)})),this.core.eventBus.on("V2NIMConversationService/setMute",(function(a,c){var m=t.model.getById(a);m&&m.mute!==c&&(m.mute=c,t.model.upsert(m),t.emit("onConversationChanged",[m]))}))},a.reset=function reset(){this.versionCache.reset(),this.model.reset(),this.unread.reset()},a.getConversationList=function getConversationList(t,a){this.checkV2(),validate({offset:{type:"number",min:0}},{offset:t},"",!0),validate({limit:{type:"number",min:1}},{limit:a},"",!0),this.core.V2NIMLoginService.checkIllegalState();var c=this.model.getByOption(t,a,{});return c.conversationList=this.computedFieldForConversations(c.conversationList),Mi.resolve(c)},a.getConversationListByOption=function getConversationListByOption(t,a,c){this.checkV2(),validate({offset:{type:"number",min:0}},{offset:t},"",!0),validate({limit:{type:"number",min:1}},{limit:a},"",!0),validate({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:c},"",!0),this.core.V2NIMLoginService.checkIllegalState();var m=this.model.getByOption(t,a,c);return m.conversationList=this.computedFieldForConversations(m.conversationList),Mi.resolve(m)},a.getConversation=function getConversation(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),validateConversationId(this.core.account,t),this.core.V2NIMLoginService.checkIllegalState(),!(a=this.model.getById(t))){c.next=8;break}return c.abrupt("return",this.computedFieldForConversation(a));case 8:throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 9:case"end":return c.stop()}}),_callee,this)})))},a.getConversationListByIds=function getConversationListByIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m=this;return Dc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0),this.core.V2NIMLoginService.checkIllegalState(),c=filter(a=map$6(t).call(t,(function(t){return m.model.getById(t)}))).call(a,(function(t){return!!t})),c=this.computedFieldForConversations(c),h.abrupt("return",c);case 6:case"end":return h.stop()}}),_callee2,this)})))},a.createConversation=function createConversation(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m,h;return Dc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),g.next=4,this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:t}});case 4:if(a=g.sent,c=ws(a,"content.data"),m=formatConversationField(this.core,c),this.versionCache.compareAndUpdateModel([m]),!(h=this.model.getById(t))){g.next=13;break}return g.abrupt("return",this.computedFieldForConversation(h));case 13:throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 14:case"end":return g.stop()}}),_callee3,this)})))},a.deleteConversation=function deleteConversation(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate({clearMessage:{type:"boolean",required:!1}},{clearMessage:a},"",!0),c.prev=3,c.next=6,this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:t,clearMessage:Number(a||!1)}});case 6:c.next=13;break;case 8:if(c.prev=8,c.t0=c.catch(3),c.t0.code===Gu.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST&&this.model.getById(t)){c.next=13;break}throw c.t0;case 13:a&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[t]),this.versionCache.compareAndDeleteModel([t]);case 15:case"end":return c.stop()}}),_callee4,this,[[3,8]])})))},a.deleteConversationListByIds=function deleteConversationListByIds(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var c,m,h,g=this;return Dc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0),validate({clearMessage:{type:"boolean",required:!1}},{clearMessage:a},"",!0),I.next=5,this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:Fc(t),clearMessage:Number(a||!1)}});case 5:return c=I.sent,m=formatFailedMap(ws(c,"content.info.failedMap")),h=filter(m).call(m,(function(t){return t.error.code!==Gu.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!g.model.getById(t.conversationId)})),a&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",t),this.versionCache.compareAndDeleteModel(t),I.abrupt("return",h);case 11:case"end":return I.stop()}}),_callee5,this)})))},a.stickTopConversation=function stickTopConversation(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var c,m,h;return Dc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate({stickTop:{type:"boolean"}},{stickTop:a},"",!0),g.next=5,this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:t,stickTop:Number(a)}});case 5:c=g.sent,m=ws(c,"content.data"),h=formatConversationField(this.core,m),this.versionCache.compareAndUpdateModel([h]);case 9:case"end":return g.stop()}}),_callee6,this)})))},a.updateConversation=function updateConversation(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var c,m,h;return Dc.wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:a},"",!0),g.next=5,this.core.sendCmd("v2ConversationUpdate",{tag:qt({conversationId:t},a)});case 5:c=g.sent,m=ws(c,"content.data"),h=formatConversationField(this.core,m),this.versionCache.compareAndUpdateModel([h]);case 9:case"end":return g.stop()}}),_callee7,this)})))},a.updateConversationLocalExtension=function updateConversationLocalExtension(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var c,m;return Dc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:if(this.checkV2(),validateConversationId(this.core.account,t),validate({localExtension:{type:"string"}},{localExtension:a},"",!0),c=this.model.getById(t)){h.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 6:if(c.localExtension!==a){h.next=8;break}return h.abrupt("return");case 8:m=qt(qt({},c),{localExtension:a}),this.model.upsert(m),this.triggerConversationChanged([m]);case 11:case"end":return h.stop()}}),_callee8,this)})))},a.getTotalUnreadCount=function getTotalUnreadCount(){return this.checkV2(),this.unread.getTotalUnreadCount()||0},a.getUnreadCountByIds=function getUnreadCountByIds(t){this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0);var a=this.unread.getUnreadCountByIds(t);return Mi.resolve(a)},a.getUnreadCountByFilter=function getUnreadCountByFilter(t){this.checkV2(),this.valiteFilter(t);var a=this.unread.getUnreadCountByFilter(t);return Mi.resolve(a)},a.clearTotalUnreadCount=function clearTotalUnreadCount(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var t,a;return Dc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),c.next=3,this.core.sendCmd("v2ConversationClearTotalUnread");case 3:t=c.sent,a=formatConversationNotify(ws(t,"content.info")),this.versionCache.compareAndClearUnreadInModel(a.oneClickClearUnreadVersion,a.oneClickClearUnreadType);case 6:case"end":return c.stop()}}),_callee9,this)})))},a.clearUnreadCountByIds=function clearUnreadCountByIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a,c,m;return Dc.wrap((function _callee10$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0),h.next=4,this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:Fc(t)}});case 4:return a=h.sent,c=formatConversationFields(this.core,ws(a,"content.datas")),m=formatFailedMap(ws(a,"content.info.failedMap")),this.versionCache.compareAndUpdateModel(c),h.abrupt("return",m);case 9:case"end":return h.stop()}}),_callee10,this)})))},a.clearUnreadCountByGroupId=function clearUnreadCountByGroupId(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validate({groupId:{type:"string"}},{groupId:t},"",!0),a.next=4,this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:t}});case 4:case"end":return a.stop()}}),_callee11,this)})))},a.clearUnreadCountByTypes=function clearUnreadCountByTypes(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a,c;return Dc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate({types:{type:"array",itemType:"number",min:1}},{types:t},"",!0),m.next=4,this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:Fc(t)}});case 4:a=m.sent,c=formatConversationNotify(ws(a,"content.info")),this.versionCache.compareAndClearUnreadInModel(c.oneClickClearUnreadVersion,c.oneClickClearUnreadType,{conversationTypes:c.oneClickClearUnreadConversationType});case 7:case"end":return m.stop()}}),_callee12,this)})))},a.markConversationRead=function markConversationRead(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var m,h,g,I,M;return Dc.wrap((function _callee13$(T){for(;;)switch(T.prev=T.next){case 0:if(this.checkV2(),this.checkLogin(),validateConversationId(this.core.account,t),m=this.model.getById(t)){T.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Conversation not exist"}});case 6:if(h=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t),g=this.core.V2NIMConversationIdUtil.parseConversationType(t),I=this.model.getReadTime(t),!(null===(c=null===(a=null==m?void 0:m.lastMessage)||void 0===a?void 0:a.messageRefer)||void 0===c?void 0:c.createTime)){T.next=13;break}M=m.lastMessage.messageRefer.createTime,T.next=19;break;case 13:if(!this.core.timeOrigin.checkNodeReliable()){T.next=17;break}M=this.core.timeOrigin.getNTPTime(),T.next=19;break;case 17:return this.logger.log("markConversationRead","NTP time is not reliable",t),T.abrupt("return",I||0);case 19:if(!(I>=M)){T.next=22;break}return this.logger.log("markConversationRead","currentReadTime >= readTime",t,I,M),T.abrupt("return",I);case 22:if(g!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM){T.next=27;break}return T.next=25,this.core.sendCmd("v2MarkSuperTeamReadTime",{timetag:M,to:h});case 25:T.next=29;break;case 27:return T.next=29,this.core.sendCmd("v2MarkConversationReadTime",{scene:g===Wl.V2NIM_CONVERSATION_TYPE_P2P?0:g===Wl.V2NIM_CONVERSATION_TYPE_TEAM?1:2,timetag:M,to:h});case 29:return this.model.updateReadTime(t,M),T.abrupt("return",M);case 31:case"end":return T.stop()}}),_callee13,this)})))},a.getConversationReadTime=function getConversationReadTime(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){return Dc.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),a.abrupt("return",this.model.getReadTime(t));case 3:case"end":return a.stop()}}),_callee14,this)})))},a.subscribeUnreadCountByFilter=function subscribeUnreadCountByFilter(t){var a;this.checkV2(),this.checkLogin(),this.valiteFilter(t),0===(null===(a=t.conversationTypes)||void 0===a?void 0:a.length)&&delete t.conversationTypes,this.unread.addFilter(t)},a.unsubscribeUnreadCountByFilter=function unsubscribeUnreadCountByFilter(t){var a;this.checkV2(),this.checkLogin(),this.valiteFilter(t),0===(null===(a=t.conversationTypes)||void 0===a?void 0:a.length)&&delete t.conversationTypes,this.unread.deleteFilter(t)},a.v2ConversationNotifySyncHandler=function v2ConversationNotifySyncHandler(t){this.versionCache.recvConversationFromSyncAction(t)},a.v2ConversationNotifySyncOnlineHandler=function v2ConversationNotifySyncOnlineHandler(t){this.versionCache.recvConversation(t)},a.syncConversationReadTimeHandler=function syncConversationReadTimeHandler(t){var a,c,m;if(null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.p2p)for(var h=0,g=Ef(t.content.p2p);h<g.length;h++){var I=g[h],M=I[0],T=I[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(M),T),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(M),T)}if(null===(m=null===(c=null==t?void 0:t.content)||void 0===c?void 0:c.team)||void 0===m?void 0:m.m_map)for(var S=0,E=Ef(t.content.team.m_map);S<E.length;S++){var C=E[S],b=C[0],A=C[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(b),A),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(b),A)}},a.syncSuperTeamReadTimeHandler=function syncSuperTeamReadTimeHandler(t){var a,c;if(null===(c=null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.superTeam)||void 0===c?void 0:c.m_map)for(var m=0,h=Ef(t.content.superTeam.m_map);m<h.length;m++){var g=h[m],I=g[0],M=g[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(I),M),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(I),M)}},a.v2MultiDeviceConversationReadTimeHandler=function v2MultiDeviceConversationReadTimeHandler(t){var a;(null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.to)&&(0===t.content.scene?(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.to),t.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.to),t.content.timetag)):(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(t.content.to),t.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(t.content.to),t.content.timetag)))},a.v2MultiDeviceSuperTeamReadTimeHandler=function v2MultiDeviceSuperTeamReadTimeHandler(t){var a;(null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.to)&&(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(t.content.to),t.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(t.content.to),t.content.timetag))},a.valiteFilter=function valiteFilter(t){if(validate({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:t},"",!0),void 0===t.conversationTypes&&void 0===t.conversationGroupId&&!0!==t.ignoreMuted)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},a.computedFieldForConversations=function computedFieldForConversations(t){var a=this;return map$6(t).call(t,(function(t){return a.computedFieldForConversation(t)}))},a.computedFieldForConversation=function computedFieldForConversation(t){var a,c,m,h;if(t.type===Wl.V2NIM_CONVERSATION_TYPE_UNKNOWN)return t;var g=this.core.V2NIMConversationIdUtil.parseConversationType(t.conversationId),I=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t.conversationId),M={};if((null===(a=this.core.V2NIMSettingService)||void 0===a?void 0:a.name)&&(M.mute=this.core.V2NIMSettingService.getConversationMuteStatus(t.conversationId)),g===Wl.V2NIM_CONVERSATION_TYPE_P2P&&(null===(c=this.core.V2NIMUserService)||void 0===c?void 0:c.name)){var T=this.core.V2NIMUserService.model.getUser(I),S=this.core.V2NIMFriendService.model.getFriend(I);M.name=(null==S?void 0:S.alias)||(null==T?void 0:T.name)||I,M.avatar=(null==T?void 0:T.avatar)||""}else if(g===Wl.V2NIM_CONVERSATION_TYPE_TEAM&&(null===(m=this.core.V2NIMTeamService)||void 0===m?void 0:m.name)){var E=this.core.V2NIMTeamService.model.getById(I,Mu.V2NIM_TEAM_TYPE_ADVANCED);M.name=(null==E?void 0:E.name)||I,M.avatar=(null==E?void 0:E.avatar)||""}else if(g===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM&&(null===(h=this.core.V2NIMTeamService)||void 0===h?void 0:h.name)){var C=this.core.V2NIMTeamService.model.getById(I,Mu.V2NIM_TEAM_TYPE_SUPER);M.name=(null==C?void 0:C.name)||I,M.avatar=(null==C?void 0:C.avatar)||""}return qt(t,M),t},a.triggerConversationChanged=function triggerConversationChanged(t){t=this.computedFieldForConversations(t),t=JSON.parse(Fc(t)),forEach$1(t).call(t,(function(t){t.lastMessage||(t.lastMessage=void 0),delete t.lastMessageState})),this.emit("onConversationChanged",t)},a.triggerConversationCreated=function triggerConversationCreated(t){t=this.computedFieldForConversation(t),delete(t=JSON.parse(Fc(t))).lastMessageState,this.emit("onConversationCreated",t)},V2NIMConversationServiceImpl}(gh),ly={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},uy="V2NIMConversationGroupService",dy={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},py={v2ConversationGroupCreate:{sid:28,cid:9,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Oh(dy)},{type:"PropertyArray",name:"conversations",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Oh(dy)}]},v2ConversationGroupGet:{sid:28,cid:12,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:Oh(dy)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(dy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:uy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(dy)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:uy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Oh(ty)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:uy,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:Oh(dy)}]}},hy=function(t){function V2NIMConversationGroupServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMConversationGroupService",a)||this).config={},"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:ly,cmdConfig:py}),m.setOptions(c),m)}kt(V2NIMConversationGroupServiceImpl,t);var a=V2NIMConversationGroupServiceImpl.prototype;return a.setOptions=function setOptions(t){this.config=qt(this.config,t)},a.createConversationGroup=function createConversationGroup(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var m,h,g,I,M,T=this;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validate({name:{type:"string",allowEmpty:!1}},{name:t},"",!0),validate({serverExtension:{type:"string",required:!1}},{serverExtension:a},"",!0),validate({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:c},"",!0),S.next=6,this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:t,serverExtension:a||"",conversationIds:c&&Fc(c)}});case 6:return m=S.sent,h=formatConversationGroup(ws(m,"content.data")),g=formatConversationFields(this.core,ws(m,"content.conversations")),I=formatFailedMap(ws(m,"content.info.failedMap")),this.emit("onConversationGroupCreated",h),g.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(g),this.emit("onConversationsAddedToGroup",h.groupId,filter(M=map$6(g).call(g,(function(t){return T.core.V2NIMConversationService.model.getById(t.conversationId)}))).call(M,(function(t){return!!t})))),S.abrupt("return",{group:h,failedList:I});case 13:case"end":return S.stop()}}),_callee,this)})))},a.deleteConversationGroup=function deleteConversationGroup(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c;return Dc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),m.next=4,this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:t}});case 4:a=m.sent,c=formatConversationGroupNotify(ws(a,"content.info")),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(c.deleteVersion,t),this.emit("onConversationGroupDeleted",t);case 8:case"end":return m.stop()}}),_callee2,this)})))},a.updateConversationGroup=function updateConversationGroup(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var m,h;return Dc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),validate({name:{type:"string",required:!1}},{name:a},"",!0),validate({serverExtension:{type:"string",required:!1}},{serverExtension:c},"",!0),void 0!==a||void 0!==c){g.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return g.next=8,this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:t,name:a,serverExtension:c}});case 8:m=g.sent,h=formatConversationGroup(ws(m,"content.data")),this.emit("onConversationGroupChanged",h);case 11:case"end":return g.stop()}}),_callee3,this)})))},a.addConversationsToGroup=function addConversationsToGroup(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var c,m,h,g,I,M,T=this;return Dc.wrap((function _callee4$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),validate({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:a},"",!0),S.next=5,this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:t,conversationIds:Fc(a)}});case 5:return m=S.sent,h=ws(m,"content.info.failedMap")||"",g=[],h&&(g=formatFailedMap(h)),I=formatConversationFields(this.core,ws(m,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(I),(M=filter(c=map$6(I).call(I,(function(t){return T.core.V2NIMConversationService.model.getById(t.conversationId)}))).call(c,(function(t){return!!t}))).length>0&&this.emit("onConversationsAddedToGroup",t,M),S.abrupt("return",g);case 14:case"end":return S.stop()}}),_callee4,this)})))},a.removeConversationsFromGroup=function removeConversationsFromGroup(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var c,m,h,g;return Dc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),validate({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:a},"",!0),I.next=5,this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:t,conversationIds:Fc(a)}});case 5:return c=I.sent,m=ws(c,"content.info.failedMap")||"",h=[],m&&(h=formatFailedMap(m)),g=formatConversationFields(this.core,ws(c,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(g),this.emit("onConversationsRemovedFromGroup",t,map$6(g).call(g,(function(t){return t.conversationId}))),I.abrupt("return",h);case 13:case"end":return I.stop()}}),_callee5,this)})))},a.getConversationGroup=function getConversationGroup(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a;return Dc.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),c.next=4,this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:t}});case 4:return a=c.sent,c.abrupt("return",formatConversationGroup(ws(a,"content.data")));case 6:case"end":return c.stop()}}),_callee6,this)})))},a.getConversationGroupList=function getConversationGroupList(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var t;return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.next=3,this.core.sendCmd("v2ConversationGroupListGet");case 3:return t=a.sent,a.abrupt("return",formatConversationGroups(ws(t,"content.datas")));case 5:case"end":return a.stop()}}),_callee7,this)})))},a.getConversationGroupListByIds=function getConversationGroupListByIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a,c,m;return Dc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:t},"",!0),h.next=4,this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:t&&Fc(t)}});case 4:return c=h.sent,m=formatConversationGroups(ws(c,"content.datas")),h.abrupt("return",filter(a=map$6(t).call(t,(function(t){return filter(m).call(m,(function(a){return a.groupId===t}))[0]}))).call(a,(function(t){return!!t})));case 7:case"end":return h.stop()}}),_callee8,this)})))},a.v2ConversationGroupNotifySyncOnlineHandler=function v2ConversationGroupNotifySyncOnlineHandler(t){var a,c=this,m=formatConversationGroupNotify(ws(t,"content.info")),h=m.type,g=m.deleteVersion,I=m.conversationIds,M=formatConversationGroup(ws(t,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",m,M),h===oy.createConversationGroup)this.emit("onConversationGroupCreated",M),I&&I.length>0&&this.emit("onConversationsAddedToGroup",M.groupId,filter(a=map$6(I).call(I,(function(t){return c.core.V2NIMConversationService.model.getById(t)}))).call(a,(function(t){return!!t})));else if(h===oy.deleteConversationGroup)this.emit("onConversationGroupDeleted",M.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(g,M.groupId);else if(h===oy.updateConversationGroup)this.emit("onConversationGroupChanged",M);else if(h===oy.addConversationToGroup){var T,S=filter(T=map$6(I).call(I,(function(t){return c.core.V2NIMConversationService.model.getById(t)}))).call(T,(function(t){return!!t}));this.emit("onConversationsAddedToGroup",M.groupId,S)}else h===oy.removeConversationFromGroup&&this.emit("onConversationsRemovedFromGroup",M.groupId,I)},V2NIMConversationGroupServiceImpl}(gh),gy=function(){function V2NIMMessageModel(){this.messages=new Ml,this.maxSize=2e3}var t=V2NIMMessageModel.prototype;return t.reset=function reset(){this.messages.clear()},t.getMessageById=function getMessageById(t){if(t)return this.messages.get(t)},t.getMessagesByConversationId=function getMessagesByConversationId(t){var a,c=[];return forEach$1(a=this.messages).call(a,(function(a){a.conversationId===t&&c.push(a)})),c},t.getLastMessageOfConversation=function getLastMessageOfConversation(t){var a=this.getMessagesByConversationId(t);if(0!==a.length)return reduce(a).call(a,(function(t,a){return a.createTime>t.createTime?a:t}),a[0])},t.upsertMessages=function upsertMessages(t){var a,c,m,h=this;forEach$1(t).call(t,(function(t){h.messages.set(t.messageClientId,t)}));var g=this.messages.size;if(!(g<=this.maxSize))for(var I=sort(a=filter(c=Wc(values(m=this.messages).call(m))).call(c,(function(t){return t.sendingState!==uu.V2NIM_MESSAGE_SENDING_STATE_SENDING}))).call(a,(function(t,a){return t.createTime-a.createTime})),M=g-this.maxSize>100?g-this.maxSize:100,T=0;T<M;T++){var S=I[T];S&&this.messages.delete(S.messageClientId)}},t.deleteMessage=function deleteMessage(t){this.messages.delete(t)},t.deleteMessages=function deleteMessages(t,a){var c,m=this;forEach$1(c=this.messages).call(c,(function(c){t===c.conversationId&&(!a||a&&c.createTime<a)&&m.messages.delete(c.messageClientId)}))},V2NIMMessageModel}(),vy={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:[xu.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT,xu.V2NIM_AI_MODEL_ROLE_TYPE_USER,xu.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}}},fy=qt({requestId:{type:"string",allowEmpty:!1}},vy),yy={messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:getEnumValues(Wl)},createTime:{type:"number"}},_y={routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}},Iy={pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}},My={antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}},Ty={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:_y},pushConfig:{type:"object",required:!1,rules:Iy},antiSpamConfig:{type:"object",required:!1,rules:My},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}},aiConfig:{type:"object",required:!1,rules:vy},targetConfig:{type:"object",required:!1,rules:{receiverIds:{type:"array",itemType:"string"},inclusive:{type:"boolean"},newMemberVisible:{type:"boolean",required:!1}}},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},Sy={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:getEnumValues(su)},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:Ty,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:getEnumValues(Wl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Ey={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:getEnumValues(su)},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:Ty}},Cy={message:{type:"object",rules:yy},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},by={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:getEnumValues(su)},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:getEnumValues(du),required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Ay={conversationType:{type:"enum",values:getEnumValues(Wl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},Ny={messageRefers:{type:"array",required:!0,rules:Ay}},Ry={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:getEnumValues(Wl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},wy={messages:{type:"array",rules:Ry}},ky={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1}},Oy={serverExtension:{type:"string",required:!1}},Py={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Wl.V2NIM_CONVERSATION_TYPE_P2P]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},xy={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Wl.V2NIM_CONVERSATION_TYPE_TEAM]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},Vy={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},Ly={message:{type:"object",rules:{conversationType:{type:"enum",values:getEnumValues(Wl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},Dy={messages:{type:"array",rules:{conversationType:{type:"enum",values:getEnumValues(Wl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Uy={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},Fy={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},By={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},qy={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:getEnumValues(du)},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},Gy={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:getEnumValues(vu),required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:getEnumValues(su)},messageSubtypes:{type:"array",required:!1,itemType:"number"}},Hy={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Wl.V2NIM_CONVERSATION_TYPE_TEAM]}}}},jy={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Wl.V2NIM_CONVERSATION_TYPE_TEAM]}},min:1}},Yy={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},$y=qt(qt({},Yy),{duration:{type:"number",required:!1}}),Wy=qt(qt({},$y),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),zy=qt(qt({},Yy),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),Ky={messageRefer:{type:"object",required:!0,rules:Ay},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:getEnumValues(du),required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},Qy={senderId:{type:"string",allowEmpty:!1},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1}},Jy={subType:{type:"number",min:0,required:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1},serverExtension:{type:"string",required:!1},routeConfig:{type:"object",required:!1,rules:_y},pushConfig:{type:"object",required:!1,rules:Iy},antiSpamConfig:{type:"object",required:!1,rules:My},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},Xy=function(){function ReceiptUtil(t,a){this.p2pMessageReceipts={},this.core=t,this.service=a}var t=ReceiptUtil.prototype;return t.sendP2PMessageReceipt=function sendP2PMessageReceipt(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(validate(Py,t,"",!0),t.senderId!==this.core.account){a.next=3;break}throw new Wu({detail:{reason:"sendP2PMessageReceipt. sender: "+t.senderId+" is not allowed to send msg receipt"}});case 3:if(!(this.p2pMessageReceipts[t.conversationId]>t.createTime)){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:t.senderId,messageClientId:t.messageClientId,createTime:t.createTime}});case 7:this.p2pMessageReceipts[t.conversationId]=t.createTime;case 8:case"end":return a.stop()}}),_callee,this)})))},t.isPeerRead=function isPeerRead(t){if(t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_P2P)return!1;if(t.senderId!==this.core.account)return!1;if(t.senderId===this.core.account&&t.receiverId===this.core.account)return!0;var a=this.core.V2NIMConversationIdUtil.messageConversationId(t),c=this.p2pMessageReceipts[a]||0;return t.createTime<=c},t.getP2PMessageReceipt=function getP2PMessageReceipt(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validateConversationId(this.core.account,t),this.core.V2NIMConversationIdUtil.parseConversationType(t)===Wl.V2NIM_CONVERSATION_TYPE_P2P){a.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});case 4:return a.abrupt("return",{conversationId:t,timestamp:this.p2pMessageReceipts[t]||0});case 5:case"end":return a.stop()}}),_callee2,this)})))},t.getTeamMessageReceipts=function getTeamMessageReceipts(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m=this;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(validate(jy,{messages:t},"",!0),!some(t).call(t,(function(t){return t.senderId!==m.core.account}))){h.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!some(t).call(t,(function(a){return a.receiverId!==t[0].receiverId}))){h.next=5;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return h.next=7,this.core.sendCmd("v2GetTeamMessageReceipts",{tag:t});case 7:return c=h.sent,h.abrupt("return",map$6(a=c.content.data).call(a,(function(t){return qt(qt({},t),{conversationId:m.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId)})})));case 9:case"end":return h.stop()}}),_callee3,this)})))},t.getTeamMessageReceiptDetail=function getTeamMessageReceiptDetail(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if(validate(Hy,{message:t},"",!0),t.senderId===this.core.account){c.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceiptDetail::senderId "+t.senderId+" incorrect"}});case 3:return c.next=5,this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:t});case 5:return a=c.sent,c.abrupt("return",{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId),messageClientId:t.messageClientId,messageServerId:t.messageServerId,readCount:a.content.readAccountList.length,unreadCount:a.content.unreadAccountList.length},readAccountList:a.content.readAccountList,unreadAccountList:a.content.unreadAccountList});case 7:case"end":return c.stop()}}),_callee4,this)})))},t.sendTeamMessageReceipts=function sendTeamMessageReceipts(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a=this;return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:if(validate(xy,{messages:t},"",!0),!some(t).call(t,(function(t){return t.senderId===a.core.account}))){c.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!some(t).call(t,(function(a){return a.receiverId!==t[0].receiverId}))){c.next=5;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return c.next=7,this.core.sendCmd("v2SendTeamMessageReceipts",{tag:t});case 7:return c.abrupt("return");case 8:case"end":return c.stop()}}),_callee5,this)})))},t.syncP2PMessagReceiptsHandler=function syncP2PMessagReceiptsHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){var a=c.core.V2NIMConversationIdUtil.p2pConversationId(t.senderId),m=t.createTime;return c.p2pMessageReceipts[a]=m,{conversationId:a,timestamp:m}}));this.service.emit("onReceiveP2PMessageReadReceipts",m)},t.onP2PMessageReceiptsHandler=function onP2PMessageReceiptsHandler(t){var a=this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.data.senderId),c=t.content.data.createTime;this.p2pMessageReceipts[a]=c,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:a,timestamp:c}])},t.onTeamMessageReceiptsHandler=function onTeamMessageReceiptsHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){return{conversationId:c.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId),messageServerId:t.messageServerId,messageClientId:t.messageClientId,readCount:t.readCount,unreadCount:t.unreadCount,latestReadAccount:t.latestReadAccount}}));this.service.emit("onReceiveTeamMessageReadReceipts",m)},ReceiptUtil}(),Zy=function(){function FileUtil(t,a){this.core=t,this.service=a}var t=FileUtil.prototype;return t.doSendFile=function doSendFile(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I,M,T,S;return Dc.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return c=t.attachment,E.prev=1,E.next=4,this.core.V2NIMStorageService._uploadFile({taskId:t.messageClientId,uploadParams:{fileObj:(null==c?void 0:c.file)||(null==c?void 0:c.path),sceneName:null==c?void 0:c.sceneName}},a,{fileType:t.messageType});case 4:for(T in(h=E.sent)[0],g=h[1],I=qt(qt({},c),{uploadState:lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS}),void 0!==g.w&&(I.width=I.width||g.w),void 0!==g.h&&(I.height=I.height||g.h),void 0!==g.dur&&(I.duration=I.duration||g.dur),I.ext=I.ext&&-1===indexOf(m=I.ext).call(m,".")?"."+I.ext:I.ext,M=["w","h","dur","ext","name"],g)includes(M).call(M,T)||(I[T]=g[T]);I.raw,I.file,I.path,S=__rest(I,["raw","file","path"]),t.attachment=JSON.parse(Fc(S)),t.attachment&&(t.attachment.raw=attachmentToRaw(t.messageType,t.attachment)),E.next=23;break;case 19:throw E.prev=19,E.t0=E.catch(1),t.attachment&&(t.attachment.uploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED),E.t0;case 23:case"end":return E.stop()}}),_callee,this,[[1,19]])})))},t.cancelMessageAttachmentUpload=function cancelMessageAttachmentUpload(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({messageClientId:{type:"string",allowEmpty:!1}},t,"",!0),includes(a=[su.V2NIM_MESSAGE_TYPE_AUDIO,su.V2NIM_MESSAGE_TYPE_FILE,su.V2NIM_MESSAGE_TYPE_IMAGE,su.V2NIM_MESSAGE_TYPE_VIDEO]).call(a,t.messageType)){c.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+t.messageType+" incorrect"}});case 3:if(t.sendingState!==uu.V2NIM_MESSAGE_SENDING_STATE_FAILED&&t.sendingState!==uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){c.next=5;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return c.next=7,this.core.V2NIMStorageService._cancelUploadFile(t.messageClientId);case 7:case"end":return c.stop()}}),_callee2,this)})))},FileUtil}(),e_=function(){function SendUtil(t,a){this.uploadingMessageInfo={},this.core=t,this.service=a}var t=SendUtil.prototype;return t.prepareMessage=function prepareMessage(t,a,c,m){var h=this.checkIfResend(t),g=this.generateSendMessage({message:t,params:c,resend:h,conversationId:a,replyMessage:m}),I=qt({},c.targetConfig?{targetConfig:c.targetConfig}:{}),M=this.checkIfAntispam(c,g),T=M.clientAntispamResult,S=M.text;return g.text=S,g.clientAntispamHit=!!T&&T.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD,{messageBeforeSend:g,clientAntispamResult:T,hiddenParams:I}},t.checkIfAntispam=function checkIfAntispam(t,a){var c,m=a.text;if(t.clientAntispamEnabled&&(a.messageType===su.V2NIM_MESSAGE_TYPE_TEXT||a.messageType===su.V2NIM_MESSAGE_TYPE_TIPS))if((c=this.core.V2NIMClientAntispamUtil.checkTextAntispam(a.text||"",t.clientAntispamReplace)).operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE)m=c.replacedText;else if(c.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD)throw this.service.emit("onSendMessage",qt(qt({},a),{sendingState:uu.V2NIM_MESSAGE_SENDING_STATE_FAILED,messageStatus:{errorCode:Gu.V2NIM_ERROR_CODE_CLIENT_ANTISPAM}})),new Yu({code:Gu.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:c,text:m}},t.doMsgReceiveReport=function doMsgReceiveReport(t,a){if(t.senderId!==this.core.account){var c=ws(t,"__clientExt.statistics.apiCallingTime")||0,m=ws(t,"__clientExt.statistics.sendTime")||0,h=ws(t,"__clientExt.statistics.attachUploadDuration")||0,g=this.core.timeOrigin.getNTPTime(),I=t.createTime,M=this.core.timeOrigin.checkNodeReliable(a.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(a.__receiveTimeNode):g;this.core.reporter.report("msgReceive",{msgId:t.messageServerId,clientId:t.messageClientId,serverTime:t.createTime,receiveTime:M,fromAccid:t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?t.senderId:"",toAccid:t.receiverId,type:conversationTypeV2ToV1(t.conversationType),tid:t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?"":t.receiverId,apiCallingTime:c,sendTime:m,attachUploadDuration:h,callbackTime:g,preHandleTime:g,result:200,failReason:"",rt:g-I})}},t.checkIfResend=function checkIfResend(t){var a=this.service.model.getMessageById(t.messageClientId),c=!1;if(t.messageServerId||t.sendingState===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if((null==a?void 0:a.sendingState)===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return a&&(c=!0),c},t.doSendMessage=function doSendMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I,M,T,S,E,C,b;return Dc.wrap((function _callee$(A){for(;;)switch(A.prev=A.next){case 0:if(a=t.apiCallingTimeNode,c=t.messageBeforeSend,m=t.clientAntispamResult,h=t.hiddenParams,g=t.progress,I={},c.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_P2P){A.next=6;break}M="v2SendP2pMessage",A.next=15;break;case 6:if(c.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_TEAM){A.next=10;break}M="v2SendTeamMessage",A.next=15;break;case 10:if(c.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM){A.next=14;break}M="v2SendSuperTeamMessage",A.next=15;break;case 14:throw new Wu({detail:{reason:"conversationType: "+c.conversationType+" is not supported"}});case 15:if(this.service.sendMessageHandler(c),this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",c),!c.attachment||!("uploadState"in c.attachment)||c.attachment.url||c.attachment.uploadState!==lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN&&c.attachment.uploadState!==lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED){A.next=43;break}return T=wi(),A.prev=19,c.attachmentUploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING,c.attachment.uploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING,this.service.emit("onSendMessage",c),A.next=25,this.service.fileUtil.doSendFile(c,g);case 25:c.attachmentUploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS,c.attachment.uploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS,this.service.emit("onSendMessage",c),A.next=40;break;case 30:throw A.prev=30,A.t0=A.catch(19),c.attachmentUploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED,c.attachment.uploadState=lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED,c.sendingState=uu.V2NIM_MESSAGE_SENDING_STATE_FAILED,c.messageStatus={errorCode:A.t0.code||Gu.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",c),I.attachUploadDuration=wi()-T,this.doSendMessageFailed(a,I,c,A.t0),A.t0;case 40:I.attachUploadDuration=wi()-T,A.next=44;break;case 43:this.service.emit("onSendMessage",c);case 44:return this.core.timeOrigin.checkNodeReliable(a)&&(I.apiCallingTime=this.core.timeOrigin.getNTPTime(a),I.sendTime=this.core.timeOrigin.getNTPTime(),c.__clientExt={statistics:I}),A.prev=45,A.next=48,this.core.sendCmd(M,{tag:qt({},c,h)});case 48:S=A.sent,A.next=58;break;case 51:throw A.prev=51,A.t1=A.catch(45),this.doSendMessageFailed(a,I,c,A.t1),c.sendingState=uu.V2NIM_MESSAGE_SENDING_STATE_FAILED,c.messageStatus={errorCode:A.t1.code||Gu.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",c),A.t1;case 58:return E=ws(S,"content.data.errorCode"),C=qt(qt(qt({},c),S.content.data),{sendingState:uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,messageStatus:{errorCode:E&&200!==E?E:200}}),this.service.sendMessageHandler(C),this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",C),this.doMsgSendReport(a,I,c),(b=C.antispamResult)&&(C.messageStatus.errorCode=Gu.V2NIM_ERROR_CODE_SERVER_ANTISPAM),delete C.antispamResult,this.service.emit("onSendMessage",C),A.abrupt("return",qt(qt({message:C},b?{antispamResult:b}:{}),m?{clientAntispamResult:m}:{}));case 68:case"end":return A.stop()}}),_callee,this,[[19,30],[45,51]])})))},t.doSendMessageFailed=function doSendMessageFailed(t,a,c,m){var h=qt(qt({},c),{sendingState:uu.V2NIM_MESSAGE_SENDING_STATE_FAILED});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",h),this.service.sendMessageHandler(h),this.doMsgSendReport(t,a,c,m)},t.doMsgSendReport=function doMsgSendReport(t,a,c,m){a.apiCallingTime=this.core.timeOrigin.getNTPTime(t),a.sendTime=this.core.timeOrigin.getNTPTime();var h=this.core.timeOrigin.getNTPTime(),g=ws(m,"detail.reason");this.core.reporter.report("msgSend",{msgId:c.messageServerId,clientId:c.messageClientId,msgTime:c.createTime,fromAccid:c.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?c.senderId:"",toAccid:c.receiverId,type:conversationTypeV2ToV1(c.conversationType),tid:c.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?"":c.receiverId,result:m?m.code:200,failReason:g||(null==m?void 0:m.message)||"",rt:h-a.apiCallingTime,apiCallingTime:a.apiCallingTime,sendTime:a.sendTime,attachUploadDuration:a.attachUploadDuration,apiCallbackTime:h})},t.generateSendMessage=function generateSendMessage(t){var a=t.conversationId,c=t.replyMessage,m=t.resend,h=t.message,g=t.params,I={};if(c){var M=c.threadRoot;I={threadReply:{senderId:c.senderId,receiverId:c.receiverId,messageServerId:c.messageServerId,createTime:c.createTime,messageClientId:c.messageClientId,conversationType:c.conversationType,conversationId:c.conversationId},threadRoot:{senderId:M?M.senderId:c.senderId,receiverId:M?M.receiverId:c.receiverId,messageServerId:M?M.messageServerId:c.messageServerId,createTime:M?M.createTime:c.createTime,messageClientId:M?M.messageClientId:c.messageClientId,conversationType:M?M.conversationType:c.conversationType,conversationId:M?M.conversationId:c.conversationId}}}var T=this.core.V2NIMConversationIdUtil.parseConversationType(a),S=this.core.V2NIMConversationIdUtil.parseConversationTargetId(a);g.pushConfig&&!0!==g.pushConfig.forcePush&&(delete g.pushConfig.forcePushContent,delete g.pushConfig.forcePushAccountIds);var E={},C={};if(g.aiConfig){var b=ws(g,"aiConfig.content.msg"),A=ws(g,"aiConfig.content.type")||0;b?C={msg:b,type:A}:void 0===b&&h.messageType===su.V2NIM_MESSAGE_TYPE_TEXT&&(C={msg:h.text||"",type:A}),(E=qt({},g.aiConfig)).aiStatus=ou.V2NIM_MESSAGE_AI_STATUS_AT,void 0!==C.msg&&(E.content=C)}var N=this.core.V2NIMUserService.model.getUser(this.core.account),R=(null==N?void 0:N.updateTime)||0;return qt(qt(qt(qt(qt(qt(qt(qt({},h),I),{messageConfig:qt(qt({},h.messageConfig),g.messageConfig),routeConfig:qt(qt({},h.routeConfig),g.routeConfig),pushConfig:qt(qt({},h.pushConfig),g.pushConfig),antispamConfig:qt(qt({},h.antispamConfig),g.antispamConfig),robotConfig:qt(qt({},h.robotConfig),g.robotConfig)}),E&&E.accountId?{aiConfig:E}:{}),h.attachment?{attachment:qt({},h.attachment)}:{}),{resend:m,senderId:this.core.account,conversationType:T,receiverId:S,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:T,senderId:this.core.account,receiverId:S})}),R?{userUpdateTime:R}:{}),{sendingState:uu.V2NIM_MESSAGE_SENDING_STATE_SENDING})},SendUtil}(),t_=function(){function ModifyUtil(t,a){this.core=t,this.service=a}var t=ModifyUtil.prototype;return t.checkIfModify=function checkIfModify(t,a){var c,m;if("0"===t.messageServerId)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageServerId cannot be empty"}});if(t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P&&t.senderId!==this.core.account)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: senderId should be self"}});if(!includes(c=[su.V2NIM_MESSAGE_TYPE_TEXT,su.V2NIM_MESSAGE_TYPE_IMAGE,su.V2NIM_MESSAGE_TYPE_AUDIO,su.V2NIM_MESSAGE_TYPE_VIDEO,su.V2NIM_MESSAGE_TYPE_LOCATION,su.V2NIM_MESSAGE_TYPE_FILE,su.V2NIM_MESSAGE_TYPE_TIPS,su.V2NIM_MESSAGE_TYPE_CALL,su.V2NIM_MESSAGE_TYPE_CUSTOM]).call(c,t.messageType))throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+t.messageType+" not correct"}});if(includes(m=[su.V2NIM_MESSAGE_TYPE_TEXT,su.V2NIM_MESSAGE_TYPE_IMAGE,su.V2NIM_MESSAGE_TYPE_AUDIO,su.V2NIM_MESSAGE_TYPE_VIDEO,su.V2NIM_MESSAGE_TYPE_FILE,su.V2NIM_MESSAGE_TYPE_TIPS,su.V2NIM_MESSAGE_TYPE_CALL]).call(m,t.messageType)&&a.attachment)throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+t.messageType+" can not modify attachment"}});var h=["subType","text","serverExtension","attachment"];if(!some(h).call(h,(function(t){return void 0!==ws(a,t)})))throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: missing modified params"}});if(every(h).call(h,(function(c){return"attachment"===c?t.attachment&&a.attachment?attachmentToRaw(t.messageType,t.attachment)===attachmentToRaw(t.messageType,a.attachment):!a.attachment:ws(t,c)===ws(a,c)})))throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: no change"}})},t.prepareMessage=function prepareMessage(t,a){var c=this.generateSendMessage(t,a),m=this.checkIfAntispam(a,c),h=m.clientAntispamResult,g=m.text;return c.text=g,c.clientAntispamHit=!!h&&h.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD,{messageBeforeSend:c,clientAntispamResult:h}},t.modifyMessage=function modifyMessage(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I;return Dc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_P2P){M.next=4;break}c="v2MessageP2pModify",M.next=13;break;case 4:if(t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_TEAM){M.next=8;break}c="v2MessageTeamModify",M.next=13;break;case 8:if(t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM){M.next=12;break}c="v2MessageSuperTeamModify",M.next=13;break;case 12:throw new Wu({detail:{reason:"conversationType: "+t.conversationType+" is not supported"}});case 13:return M.next=15,this.core.sendCmd(c,{tag:t});case 15:if(m=M.sent,!a||a.operateType!==gu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD){M.next=18;break}return M.abrupt("return",{errorCode:Gu.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,clientAntispamResult:a});case 18:if(h=qt(qt({},t),m.content.data),!(g=h.antispamResult)){M.next=22;break}return M.abrupt("return",qt({errorCode:Gu.V2NIM_ERROR_CODE_SERVER_ANTISPAM,antispamResult:g},a?{clientAntispamResult:a}:{}));case 22:return delete h.antispamResult,I=completeMessage(this.core,h),this.service.model.upsertMessages([I]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",I),M.abrupt("return",qt(qt({errorCode:200,message:I},g?{antispamResult:g}:{}),a?{clientAntispamResult:a}:{}));case 27:case"end":return M.stop()}}),_callee,this)})))},t.checkIfAntispam=function checkIfAntispam(t,a){var c,m=a.text;if(t.clientAntispamEnabled&&(a.messageType===su.V2NIM_MESSAGE_TYPE_TEXT||a.messageType===su.V2NIM_MESSAGE_TYPE_TIPS))if((c=this.core.V2NIMClientAntispamUtil.checkTextAntispam(a.text||"",t.clientAntispamReplace)).operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE)m=c.replacedText;else if(c.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD)throw new Yu({code:Gu.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:c,text:m}},t.generateSendMessage=function generateSendMessage(t,a){var c;return qt(qt({messageConfig:{lastMessageUpdateEnabled:null===(c=t.messageConfig)||void 0===c?void 0:c.lastMessageUpdateEnabled},routeConfig:qt({routeEnabled:!0},a.routeConfig),pushConfig:qt({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},a.pushConfig),antispamConfig:qt({antispamEnabled:!0},a.antispamConfig)},a.attachment?{attachment:a.attachment}:{}),{conversationType:t.conversationType,senderId:t.senderId,receiverId:t.receiverId,createTime:t.createTime,messageClientId:t.messageClientId,messageServerId:t.messageServerId,messageType:t.messageType,subType:a.subType,text:a.text,serverExtension:a.serverExtension})},ModifyUtil}(),r_=entryVirtual("Array").keys,n_=Array.prototype,a_={DOMTokenList:!0,NodeList:!0},keys=function(t){var a=t.keys;return t===n_||Y(n_,t)&&a===n_.keys||de(a_,Mr(t))?r_:a},i_=function(){function V2NIMClientAntispamUtilImpl(t){this.core=t}var t=V2NIMClientAntispamUtilImpl.prototype;return t.reset=function reset(t){t===_v.Destroy&&(this.vocabInfo=void 0)},t.downloadLocalAntiSpamVocabs=function downloadLocalAntiSpamVocabs(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t;return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!this.vocabInfo){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 5:t=a.sent,this.vocabInfo=qt(qt({},t.content.data),{thesaurus:JSON.parse(t.content.data.thesaurus).thesaurus}),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(2),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",a.t0);case 12:case"end":return a.stop()}}),_callee,this,[[2,9]])})))},t.checkTextAntispam=function checkTextAntispam(t,a){if(void 0===a&&(a="**"),validate({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:t,replace:a},"",!0),!this.vocabInfo)return{operateType:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE,replacedText:t};for(var c=t,m=0;m<this.vocabInfo.thesaurus.length;m++){var h=this.filterContent(c,this.vocabInfo.thesaurus[m],a);if(c=h.replacedText,h.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD||h.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD)return h}return{operateType:c===t?gu.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:c}},t.filterContent=function filterContent(t,a,c){for(var m=0;m<keys(a).length;m++){var h=keys(a)[m],g=h.match||a.match,I=h.operate||a.operate,M=void 0;try{M=this.matchContent(t,h.key,g,I,c)}catch(t){}if(M&&(t=M.replacedText,M.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD||M.operateType===gu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD))return M}return{operateType:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:t}},t.matchContent=function matchContent(t,a,c,m,h){var g=!1,I="";if(1===c)indexOf(t).call(t,a)>=0&&(g=!0,I=a);else if(2===c){new RegExp(a,"g").test(t)&&(g=!0)}if(g&&""!==I)switch(m){case 1:return{operateType:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:t.replace(I,h)};case 2:return{operateType:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD,replacedText:t};case 3:return{operateType:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD,replacedText:t}}return{operateType:gu.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE,replacedText:t}},V2NIMClientAntispamUtilImpl}();function getFileOrPath(t){var a="object"==typeof t?t:void 0,c="string"==typeof t?t:void 0;if(!a&&!c)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof c)if(0===indexOf(c).call(c,"nim-external")){var m=document.getElementById(c);if(!(m&&m.files&&m.files[0]))throw new Yu({code:Gu.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+c}});a=m.files[0]}else if("BROWSER"===Cp.platform)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+c}});if("object"==typeof a&&void 0===a.size)throw new Yu({code:Gu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:a,path:c}}var o_=function(t){function V2NIMMessageCreatorImpl(a){var c;return(c=t.call(this,"V2NIMMessageCreator",a)||this).name="V2NIMMessageCreator",c.defaultNosSceneName="nim_default_im",c.core=a,c}kt(V2NIMMessageCreatorImpl,t);var a=V2NIMMessageCreatorImpl.prototype;return a.createMessage=function createMessage(t,a){return qt(qt(qt({messageClientId:_m(),messageType:t,createTime:wi(),sendingState:uu.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN,messageStatus:{errorCode:200},isSelf:!0},a),a.attachment?{attachment:qt(qt({},a.attachment),{raw:attachmentToRaw(t,a.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:qt({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},a.messageConfig),pushConfig:qt({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},a.pushConfig),routeConfig:qt({routeEnabled:!0},a.routeConfig),antispamConfig:qt({antispamEnabled:!0},a.antispamConfig)})},a.createTextMessage=function createTextMessage(t){return this.checkV2(),validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),this.createMessage(su.V2NIM_MESSAGE_TYPE_TEXT,{text:t})},a.createImageMessage=function createImageMessage(t,a,c,m,h){this.checkV2(),validate(zy,{name:a,sceneName:c,width:m,height:h},"",!0);var g=this.createGenericFileMessageAttachment(t,a,c,void 0,m,h);return this.createMessage(su.V2NIM_MESSAGE_TYPE_IMAGE,{attachment:g,attachmentUploadState:lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createAudioMessage=function createAudioMessage(t,a,c,m){this.checkV2(),validate($y,{name:a,sceneName:c,duration:m},"",!0);var h=this.createGenericFileMessageAttachment(t,a,c,m);return this.createMessage(su.V2NIM_MESSAGE_TYPE_AUDIO,{attachment:h,attachmentUploadState:lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createVideoMessage=function createVideoMessage(t,a,c,m,h,g){this.checkV2(),validate(Wy,{name:a,sceneName:c,duration:m,width:h,height:g},"",!0);var I=this.createGenericFileMessageAttachment(t,a,c,m,h,g);return this.createMessage(su.V2NIM_MESSAGE_TYPE_VIDEO,{attachment:I,attachmentUploadState:lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createFileMessage=function createFileMessage(t,a,c){this.checkV2(),validate(Yy,{name:a,sceneName:c},"",!0);var m=this.createGenericFileMessageAttachment(t,a,c);return this.createMessage(su.V2NIM_MESSAGE_TYPE_FILE,{attachment:m,attachmentUploadState:lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createGenericFileMessageAttachment=function createGenericFileMessageAttachment(t,a,c,m,h,g){if(c=c||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene(c))throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+c+" has not been added"}});var I=getFileOrPath(t),M=I.file,T=I.path,S=qt(qt(qt({name:a,uploadState:lu.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN,sceneName:c||this.defaultNosSceneName},m?{duration:m}:{}),h?{width:h}:{}),g?{height:g}:{});if(M){var E,C=lastIndexOf(E=M.name).call(E,"."),b=-1===C?M.name:M.name.substring(0,C);S.name=S.name||b,S.size=M.size,S.ext=getFileExtension(M.name)}else if(T){var A=lastIndexOf(T).call(T,"/"),N=lastIndexOf(T).call(T,"."),R=-1===N?T.substring(A+1):T.substring(A+1,N);S.name=S.name||R,S.ext=getFileExtension(T)}return S=JSON.parse(Fc(S)),T?S.path=T:M&&(S.file=M),S},a.createLocationMessage=function createLocationMessage(t,a,c){return this.checkV2(),validate({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:t,longitude:a,address:c},"",!0),this.createMessage(su.V2NIM_MESSAGE_TYPE_LOCATION,{attachment:{latitude:t,longitude:a,address:c}})},a.createCustomMessage=function createCustomMessage(t,a){return this.checkV2(),validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),validate({rawAttachment:{type:"string"}},{rawAttachment:a},"",!0),this.createMessage(su.V2NIM_MESSAGE_TYPE_CUSTOM,{text:t,attachment:{raw:a}})},a.createCallMessage=function createCallMessage(t,a,c,m,h){return this.checkV2(),validate({type:{type:"number",allowEmpty:!1}},{type:t},"",!0),validate({channelId:{type:"string",allowEmpty:!1}},{channelId:a},"",!0),validate({status:{type:"number",allowEmpty:!1}},{status:c},"",!0),validate({durations:{type:"array",allowEmpty:!1}},{durations:m},"",!0),this.createMessage(su.V2NIM_MESSAGE_TYPE_CALL,{text:h||"",attachment:{type:t,channelId:a,durations:m,status:c}})},a.createForwardMessage=function createForwardMessage(t){this.checkV2();var a=[su.V2NIM_MESSAGE_TYPE_ROBOT,su.V2NIM_MESSAGE_TYPE_NOTIFICATION,su.V2NIM_MESSAGE_TYPE_AVCHAT,su.V2NIM_MESSAGE_TYPE_TIPS];if(!t||includes(a).call(a,t.messageType))return null;var c={messageClientId:_m(),messageType:t.messageType};return t.text&&(c.text=t.text),t.attachment&&(c.attachment=t.attachment),t.attachment&&"uploadState"in t.attachment&&(c.attachmentUploadState=t.attachment.uploadState),this.createMessage(t.messageType,c)},a.createTipsMessage=function createTipsMessage(t){return this.checkV2(),validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),this.createMessage(su.V2NIM_MESSAGE_TYPE_TIPS,{text:t})},V2NIMMessageCreatorImpl}(gh),s_=function(t){function V2NIMMessageServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMMessageService",a)||this).config={compatibleWithV1:!0},m.emitRevokeMessage=function(t){var a=map$6(t).call(t,(function(t){return formatRevokeMessage(m.core,t)}));forEach$1(a).call(a,(function(t){m.model.deleteMessage(t.messageRefer.messageClientId)})),m.emit("onMessageRevokeNotifications",a),m.core.eventBus.emit("V2NIMConversationService/revokeMessages",a)},m.sendMessageHandler=function(t){if(t.msgAckSnapshot){var a=t.msgAckSnapshot,c={conversationId:t.conversationId,messageServerId:t.messageServerId,messageClientId:t.messageClientId,readCount:0,unreadCount:Number(a)};delete t.msgAckSnapshot,m.emit("onReceiveTeamMessageReadReceipts",[c])}t=formatMessageAttachment(t,m.core),m.model.upsertMessages([t]),m.core.eventBus.emit("V2NIMConversationService/sendMessage",t,t.sendingState)},m.revokeMessagesHandler=function(t){forEach$1(t).call(t,(function(t){m.model.deleteMessage(t.messageRefer.messageClientId)})),m.emit("onMessageRevokeNotifications",t),m.core.eventBus.emit("V2NIMConversationService/revokeMessages",t)},m.deleteMessagesHandler=function(t){forEach$1(t).call(t,(function(t){m.model.deleteMessage(t.messageRefer.messageClientId)})),m.emit("onMessageDeletedNotifications",t),m.core.eventBus.emit("V2NIMConversationService/deleteMessages",t)},m.core.V2NIMMessageCreator=new o_(m.core),m.core.V2NIMClientAntispamUtil=new i_(m.core),m.receiptUtil=new Xy(m.core,Qe(m)),m.fileUtil=new Zy(m.core,Qe(m)),m.sendUtil=new e_(m.core,Qe(m)),m.modifyUtil=new t_(m.core,Qe(m)),m.model=new gy,"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:Gf,cmdConfig:Kf}),m.setOptions(c),m.setListener(),m)}kt(V2NIMMessageServiceImpl,t);var a=V2NIMMessageServiceImpl.prototype;return a.setOptions=function setOptions(t){var a;(null===(a=this.core.msg)||void 0===a?void 0:a.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=qt(this.config,t)},a.setListener=function setListener(){var t=this;this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",this.sendMessageHandler),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",this.emitRevokeMessage),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",this.deleteMessagesHandler),this.core.eventBus.on("V2NIMConversationService/deleteConversation",(function(a){forEach$1(a).call(a,(function(a){return t.model.deleteMessages(a)}))}))},a.reset=function reset(){this.model.reset()},a.getMessageList=function getMessageList(t){return this.checkV2(),this.core.V2NIMMessageLogUtil.getMessageList(t)},a.getMessageListByRefers=function getMessageListByRefers(t){return this.checkV2(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(t)},a.clearHistoryMessage=function clearHistoryMessage(t){return this.checkV2(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(t)},a.pinMessage=function pinMessage(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.pinMessage(t,a)},a.unpinMessage=function unpinMessage(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.unpinMessage(t,a)},a.updatePinMessage=function updatePinMessage(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.updatePinMessage(t,a)},a.voiceToText=function voiceToText(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.voiceToText(t)},a.getPinnedMessageList=function getPinnedMessageList(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(t)},a.addQuickComment=function addQuickComment(t,a,c,m){return this.checkV2(),this.core.V2NIMMessageExtendUtil.addQuickComment(t,a,c,m)},a.removeQuickComment=function removeQuickComment(t,a,c){return this.checkV2(),this.core.V2NIMMessageExtendUtil.removeQuickComment(t,a,c)},a.getQuickCommentList=function getQuickCommentList(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(t)},a.addCollection=function addCollection(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.addCollection(t)},a.removeCollections=function removeCollections(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.removeCollections(t)},a.updateCollectionExtension=function updateCollectionExtension(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(t,a)},a.getCollectionListByOption=function getCollectionListByOption(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(t)},a.searchCloudMessages=function searchCloudMessages(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(t)},a.getThreadMessageList=function getThreadMessageList(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(t)},a.sendP2PMessageReceipt=function sendP2PMessageReceipt(t){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(t)},a.isPeerRead=function isPeerRead(t){return this.checkV2(),this.receiptUtil.isPeerRead(t)},a.getP2PMessageReceipt=function getP2PMessageReceipt(t){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(t)},a.getTeamMessageReceipts=function getTeamMessageReceipts(t){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(t)},a.getTeamMessageReceiptDetail=function getTeamMessageReceiptDetail(t){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(t)},a.sendTeamMessageReceipts=function sendTeamMessageReceipts(t){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(t)},a.revokeMessage=function revokeMessage(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I,M,T;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:if(this.checkV2(),validate(Cy,{message:t,params:a},"",!0),validateConversationId(this.core.account,t.conversationId),t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_P2P||t.senderId===this.core.account){S.next=7;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});case 7:if(t.messageServerId&&"0"!==t.messageServerId){S.next=9;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+t.messageServerId}});case 9:return h=t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?"v2RevokeSuperTeamMessage":"v2RevokeMessage",(c={})[Wl.V2NIM_CONVERSATION_TYPE_P2P]=fu.P2P_DELETE_MSG,c[Wl.V2NIM_CONVERSATION_TYPE_TEAM]=fu.TEAM_DELETE_MSG,c[Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM]=fu.SUPERTEAM_DELETE_MSG,g=c,I=qt(qt(qt({},t),a),{attach:a&&a.serverExtension,sysMsgType:g[t.conversationType],opeAccount:this.core.account}),S.next=14,this.core.sendCmd(h,{tag:I});case 14:(m={})[Wl.V2NIM_CONVERSATION_TYPE_P2P]=pu.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY,m[Wl.V2NIM_CONVERSATION_TYPE_TEAM]=pu.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY,m[Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM]=pu.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY,M=m,T=[JSON.parse(Fc({postscript:a&&a.postscript,revokeType:M[t.conversationType],revokeAccountId:this.core.account,serverExtension:a&&a.serverExtension,messageRefer:formatMessageRefer(this.core,t)}))],this.revokeMessagesHandler(T),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",I);case 18:case"end":return S.stop()}}),_callee,this)})))},a.deleteMessage=function deleteMessage(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m,h,g;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),validate(Ry,t,"",!0),t.sendingState!==uu.V2NIM_MESSAGE_SENDING_STATE_SENDING){I.next=6;break}this.fileUtil.cancelMessageAttachmentUpload(t),I.next=8;break;case 6:if(!t.sendingState||t.sendingState===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){I.next=8;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});case 8:if(c={messageRefer:formatMessageRefer(this.core,t),serverExtension:a},m=wi(),!t.messageServerId||"0"===t.messageServerId){I.next=15;break}return I.next=13,this.core.sendCmd("v2DeleteMessage",{tag:c});case 13:h=I.sent,m=h.content.timetag;case 15:g=[{serverExtension:a,messageRefer:formatMessageRefer(this.core,t),deleteTime:m}],this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[qt(qt({},c),{deleteTime:m})]),this.deleteMessagesHandler(g);case 18:case"end":return I.stop()}}),_callee2,this)})))},a.deleteMessages=function deleteMessages(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c,m,h,g,I,M,T,S,E,C,b=this;return Dc.wrap((function _callee3$(A){for(;;)switch(A.prev=A.next){case 0:if(this.checkV2(),validate(wy,{messages:t},"",!0),m=[],h=[],0!==t.length){A.next=8;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});case 8:g=t[0].conversationId,I=0;case 10:if(!(I<t.length)){A.next=23;break}if(t[I].sendingState!==uu.V2NIM_MESSAGE_SENDING_STATE_SENDING){A.next=15;break}this.fileUtil.cancelMessageAttachmentUpload(t[I]),A.next=17;break;case 15:if(!t[I].sendingState||t[I].sendingState===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){A.next=17;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: sendingState should be succeeded, please check message at index: "+I}});case 17:if(!(I>=1&&t[I].conversationId!==g)){A.next=19;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});case 19:t[I].messageServerId&&"0"!==t[I].messageServerId?m.push(t[I]):h.push(t[I]);case 20:I++,A.next=10;break;case 23:if(M=wi(),T=concat(c=[]).call(c,h),A.prev=25,!(m.length>0)){A.next=32;break}return A.next=29,this.core.sendCmd("v2DeleteMessages",{tag:map$6(m).call(m,(function(t){return{messageRefer:t,serverExtension:a}}))});case 29:E=A.sent,M=E.content.timetag,T=concat(S=[]).call(S,T,m);case 32:A.next=41;break;case 34:if(A.prev=34,A.t0=A.catch(25),0!==h.length){A.next=40;break}throw A.t0;case 40:this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed");case 41:C=map$6(T).call(T,(function(t){return{serverExtension:a,messageRefer:formatMessageRefer(b.core,t),deleteTime:M}})),this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",map$6(T).call(T,(function(t){return{messageRefer:t,serverExtension:a,deleteTime:M}}))),this.deleteMessagesHandler(C);case 44:case"end":return A.stop()}}),_callee3,this,[[25,34]])})))},a.cancelMessageAttachmentUpload=function cancelMessageAttachmentUpload(t){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(t)},a.markMsgsAck=function markMsgsAck(t){var a=this;if(t&&t.length>0){var c=[],m=[];forEach$1(t).call(t,(function(t){t.senderId===a.core.account&&t.senderId!==t.receiverId||(t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_P2P?c.push(t):t.conversationType===Wl.V2NIM_CONVERSATION_TYPE_TEAM&&m.push(t))})),c.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:2,ids:map$6(c).call(c,(function(t){return t.messageServerId}))}),m.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:8,cid:3,ids:map$6(m).call(m,(function(t){return t.messageServerId}))})}},a.onMsgHandler=function onMsgHandler(t){var a=t.content.msg,c=a._conversationOnlineSyncNotify,m=a._conversationOnlineSyncData,h=__rest(a,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),g=completeMessage(this.core,h),I=formatMessageAttachment(g,this.core);I.messageType!==su.V2NIM_MESSAGE_TYPE_NOTIFICATION&&this.core.V2NIMUserService.checkUserUpdate(I,I.userUpdateTime),!this.config.compatibleWithV1&&this.sendUtil.doMsgReceiveReport(I,t),delete I.__clientExt,this.emit("onReceiveMessages",[I]),this.model.upsertMessages([I]),!this.config.compatibleWithV1&&this.markMsgsAck([I]),c&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(c),data:JSON.parse(m)}},I),I.messageType===su.V2NIM_MESSAGE_TYPE_NOTIFICATION&&this.core.eventBus.emit("V2NIMTeamService/notification",g)},a.syncOfflineMsgsHandler=function syncOfflineMsgsHandler(t){var a=this,c=t.content.data,m=0;c=map$6(c).call(c,(function(t){return t.createTime>m&&(m=t.createTime),formatMessageAttachment(completeMessage(a.core,t),a.core)})),!this.config.compatibleWithV1&&this.markMsgsAck(c),this.emit("onReceiveMessages",c),this.model.upsertMessages(c),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",map$6(c).call(c,(function(t){return t.conversationId})))},a.syncRoamingMsgsHandler=function syncRoamingMsgsHandler(t){var a=this,c=t.content.data;c=map$6(c).call(c,(function(t){return formatMessageAttachment(completeMessage(a.core,t),a.core)})),this.emit("onReceiveMessages",c),this.model.upsertMessages(c),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",map$6(c).call(c,(function(t){return t.conversationId})))},a.onP2PMessageReceiptsHandler=function onP2PMessageReceiptsHandler(t){this.receiptUtil.onP2PMessageReceiptsHandler(t)},a.onTeamMessageReceiptsHandler=function onTeamMessageReceiptsHandler(t){this.receiptUtil.onTeamMessageReceiptsHandler(t)},a.syncP2PMessagReceiptsHandler=function syncP2PMessagReceiptsHandler(t){this.receiptUtil.syncP2PMessagReceiptsHandler(t)},a.syncRevokeMessageHandler=function syncRevokeMessageHandler(t){this.emitRevokeMessage(t.content.datas)},a.onRevokeMessageHandler=function onRevokeMessageHandler(t){this.emitRevokeMessage([t.content.data])},a.onDeleteMessageHandler=function onDeleteMessageHandler(t){var a=t.content.data,c={serverExtension:a.serverExtension,deleteTime:a.deleteTime,messageRefer:completeMessageRefer(this.core,a.messageRefer)};this.deleteMessagesHandler([c])},a.onDeleteMessagesHandler=function onDeleteMessagesHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){return{serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:completeMessageRefer(c.core,t.messageRefer)}}));this.deleteMessagesHandler(m)},a.syncOnDeleteMessagesHandler=function syncOnDeleteMessagesHandler(t){var a=this,c=t.content.datas,m=map$6(c).call(c,(function(t){return{serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:completeMessageRefer(a.core,t.messageRefer)}}));this.emit("onMessageDeletedNotifications",m)},a.sendMessage=function sendMessage(t,a,c,m){return void 0===c&&(c={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var h,g,I,M,T,S,E,C,b=this;return Dc.wrap((function _callee4$(A){for(;;)switch(A.prev=A.next){case 0:if(this.checkV2(),validate({message:{type:"object"}},{message:t},"",!0),t.messageClientId=t.messageClientId||_m(),!t.conversationId||t.conversationId===a){A.next=5;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});case 5:if(validate(Ey,{conversationId:a,message:t,params:c},"",!0),validateConversationId(this.core.account,a),(h=this.core.V2NIMConversationIdUtil.parseConversationType(a))!==Wl.V2NIM_CONVERSATION_TYPE_TEAM&&h!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM||!c.robotConfig||c.robotConfig.accountId){A.next=10;break}throw new Wu({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 10:if(h!==Wl.V2NIM_CONVERSATION_TYPE_TEAM&&h!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM||!c.targetConfig){A.next=20;break}if(g=c.targetConfig.receiverIds,h!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM||!1!==c.targetConfig.inclusive){A.next=14;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"setting inclusive to false for super teams is not allowed"}});case 14:if(g=filter(g).call(g,(function(t){return t&&t!==b.core.account})),0!==g.length){A.next=17;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"receiverIds cannot be empty or only contain yourself"}});case 17:c.targetConfig.receiverIds=g,A.next=21;break;case 20:c.targetConfig=void 0;case 21:return I=this.core.timeOrigin.getTimeNode(),M=this.sendUtil.prepareMessage(t,a,c),T=M.messageBeforeSend,S=M.clientAntispamResult,E=M.hiddenParams,A.next=25,this.sendUtil.doSendMessage({apiCallingTimeNode:I,messageBeforeSend:T,clientAntispamResult:S,hiddenParams:E,progress:m});case 25:return(C=A.sent).message.senderId===C.message.receiverId&&this.markMsgsAck([C.message]),A.abrupt("return",C);case 28:case"end":return A.stop()}}),_callee4,this)})))},a.replyMessage=function replyMessage(t,a,c,m){return void 0===c&&(c={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var h,g,I,M,T,S;return Dc.wrap((function _callee5$(E){for(;;)switch(E.prev=E.next){case 0:if(this.checkV2(),validate({message:{type:"object"}},{message:t},"",!0),t.messageClientId=t.messageClientId||_m(),validate(Sy,{message:t,replyMessage:a,params:c},"",!0),validateConversationId(this.core.account,a.conversationId),t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_TEAM&&t.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM||!c.robotConfig||c.robotConfig.accountId){E.next=7;break}throw new Wu({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 7:return h=this.core.timeOrigin.getTimeNode(),g=this.sendUtil.prepareMessage(t,a.conversationId,c,a),I=g.messageBeforeSend,M=g.clientAntispamResult,T=g.hiddenParams,E.next=11,this.sendUtil.doSendMessage({apiCallingTimeNode:h,messageBeforeSend:I,clientAntispamResult:M,hiddenParams:T,progress:m});case 11:return(S=E.sent).message.senderId===S.message.receiverId&&this.markMsgsAck([S.message]),E.abrupt("return",S);case 14:case"end":return E.stop()}}),_callee5,this)})))},a.modifyMessage=function modifyMessage(t,a){this.checkV2(),this.checkLogin(),validate(Qy,t,"message",!0),validate(Jy,a,"params",!0),this.modifyUtil.checkIfModify(t,a);var c=this.modifyUtil.prepareMessage(t,a),m=c.messageBeforeSend,h=c.clientAntispamResult;return this.modifyUtil.modifyMessage(m,h)},a.v2MessageOnModifiedHandler=function v2MessageOnModifiedHandler(t){var a=completeMessage(this.core,t.content.data);this.model.upsertMessages([a]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",a),this.emit("onReceiveMessagesModified",[a])},a.v2MessageSyncModifiedHandler=function v2MessageSyncModifiedHandler(t){var a,c,m=this,h=filter(a=map$6(c=t.content.datas).call(c,(function(t){return completeMessage(m.core,t)}))).call(a,(function(t){var a,c=(null===(a=m.model.getMessageById(t.messageClientId))||void 0===a?void 0:a.modifyTime)||0;return(t.modifyTime||0)>c}));h.length>0&&(this.model.upsertMessages(h),forEach$1(h).call(h,(function(t){return m.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",t)})),this.emit("onReceiveMessagesModified",h))},a.v2MessageSyncSuperTeamModifiedHandler=function v2MessageSyncSuperTeamModifiedHandler(t){this.v2MessageSyncModifiedHandler(t)},V2NIMMessageServiceImpl}(gh),c_=Zr.find,l_="find",u_=!0;l_ in[]&&Array(1).find((function(){u_=!1})),_export({target:"Array",proto:!0,forced:u_},{find:function find(t){return c_(this,t,arguments.length>1?arguments[1]:void 0)}});var d_,p_,m_,h_=entryVirtual("Array").find,g_=Array.prototype,find=function(t){var a=t.find;return t===g_||Y(g_,t)&&a===g_.find?h_:a},v_="V2NIMMessageLogUtil",f_={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},y_={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:boolToInt},teamId:3,onlineSync:{id:4,converter:boolToInt},deleteTime:{id:6,retType:"number"},serverExtension:7},__=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],I_={v2GetMessageList:{sid:30,cid:6,service:v_,params:concat(d_=[{type:"String",name:"to"}]).call(d_,__),response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Hf)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:v_,params:[{type:"PropertyArray",name:"tag",reflectMapper:Hf,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Hf)}]},v2ClearHistoryMessage:{sid:30,cid:18,service:v_,params:[{type:"Property",name:"tag",reflectMapper:y_}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:v_,params:concat(p_=[{type:"Long",name:"to"}]).call(p_,__),response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Hf)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:v_,params:concat(m_=[{type:"Long",name:"to"}]).call(m_,__),response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Hf)}]},onClearHistoryMessage:{sid:7,cid:118,service:v_,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(y_)}]},syncClearHistoryMessage:{sid:4,cid:24,service:v_,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(y_)}]}},M_=function(t){function V2NIMMessageLogUtil(a){var c;return(c=t.call(this,"V2NIMMessageLogUtil",a)||this).clearHistoryMessageHandler=function(t){var a=formatClearHistoryNotification(c.core,t);c.emitClearHistoryMessage([a])},c.core=a,c.service=c.core.V2NIMMessageService,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:f_,cmdConfig:I_}),c.setListener(),c)}kt(V2NIMMessageLogUtil,t);var a=V2NIMMessageLogUtil.prototype;return a.setListener=function setListener(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageHandler)},a.getMessageListByRefers=function getMessageListByRefers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I,M=this;return Dc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(this.checkV2(),validate(Ny,{messageRefers:t},"",!0),0!==t.length){T.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});case 4:if(m=[],h=map$6(t).call(t,(function(t){var a=M.service.model.getMessageById(t.messageClientId);return!a&&t.messageServerId&&"0"!==t.messageServerId&&m.push(t),a})),g=[],!(m.length>0)){T.next=12;break}return T.next=10,this.core.sendCmd("v2GetMessageListByRefers",{tag:m});case 10:I=T.sent,g=I.content.msgs;case 12:return T.abrupt("return",map$6(a=filter(c=map$6(h).call(h,(function(a,c){if(a)return a;var m=t[c],h=find(g).call(g,(function(t){return t.messageServerId===m.messageServerId}));return h?completeMessage(M.core,h):void 0}))).call(c,(function(t){return void 0!==t}))).call(a,(function(t){return formatMessageAttachment(t,M.core)})));case 13:case"end":return T.stop()}}),_callee,this)})))},a.getMessageList=function getMessageList(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m,h,g,I,M,T,S,E,C,b,A,N,R=this;return Dc.wrap((function _callee2$(w){for(;;)switch(w.prev=w.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){w.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:if(validate(by,t,"",!0),validateConversationId(this.core.account,t.conversationId),g=this.core.V2NIMConversationIdUtil.parseConversationType(t.conversationId),I=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t.conversationId),M=g===Wl.V2NIM_CONVERSATION_TYPE_P2P?"v2GetMessageList":g===Wl.V2NIM_CONVERSATION_TYPE_TEAM?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",T=t.beginTime||0,S=t.endTime||0,!(0!==T&&0!==S&&T>S)){w.next=12;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});case 12:if(E=void 0===t.direction?du.V2NIM_QUERY_DIRECTION_DESC:t.direction,!t.anchorMessage){w.next=29;break}if(t.direction!==du.V2NIM_QUERY_DIRECTION_DESC){w.next=23;break}if(0!==S){w.next=19;break}S=t.anchorMessage.createTime,w.next=21;break;case 19:if(S===t.anchorMessage.createTime){w.next=21;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}});case 21:w.next=29;break;case 23:if(0!==T){w.next=27;break}T=t.anchorMessage.createTime,w.next=29;break;case 27:if(T===t.anchorMessage.createTime){w.next=29;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});case 29:return C=null===(a=t.anchorMessage)||void 0===a?void 0:a.messageServerId,w.next=32,this.core.sendCmd(M,{beginTime:T,endTime:S,lastMsgId:C||0,limit:t.limit||50,direction:E,msgTypes:t.messageTypes?slice$1(c=t.messageTypes).call(c):[],to:I});case 32:return b=w.sent,A=b.content,N=[],N=map$6(m=A.msgs).call(m,(function(t){return completeMessage(R.core,t)})),C&&(N=filter(N).call(N,(function(t){return t.messageServerId!==C}))),w.abrupt("return",map$6(h=this.getMessageListMonkeyPatch(N,t)).call(h,(function(t){return formatMessageAttachment(t,R.core)})));case 38:case"end":return w.stop()}}),_callee2,this)})))},a.getMessageListMonkeyPatch=function getMessageListMonkeyPatch(t,a){var c=a.conversationId,m=t,h=reduce(m).call(m,(function(t,a){return t[a.messageClientId]=!0,t}),{}),g=this.core.V2NIMMessageService.model.getMessagesByConversationId(c);g=sort(g).call(g,(function(t,c){return a.direction===du.V2NIM_QUERY_DIRECTION_ASC?t.createTime-c.createTime:c.createTime-t.createTime}));var I=0,M=a.beginTime||0,T=a.endTime||0;a.anchorMessage&&(a.direction===du.V2NIM_QUERY_DIRECTION_DESC?T=a.anchorMessage.createTime:M=a.anchorMessage.createTime,I=findIndex$1(g).call(g,(function(t){var c;return t.messageClientId===(null===(c=a.anchorMessage)||void 0===c?void 0:c.messageClientId)})),I+=1);for(var S=I;S<g.length;S++){var E,C=g[S],b=!h[C.messageClientId],A=void 0===C.sendingState||C.sendingState===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,N=C.conversationId===c,R=C.createTime>M&&(C.createTime<T||0===T),w=!a.messageTypes||includes(E=a.messageTypes).call(E,C.messageType);b&&A&&N&&R&&w&&m.push(g[S])}return m=sort(m).call(m,(function(t,c){return a.direction===du.V2NIM_QUERY_DIRECTION_ASC?t.createTime-c.createTime:c.createTime-t.createTime})),slice$1(m).call(m,0,a.limit||50)},a.clearHistoryMessage=function clearHistoryMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m,h,g,I,M,T;return Dc.wrap((function _callee3$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validate(ky,t,"",!0),validateConversationId(this.core.account,t.conversationId),a=t.conversationId,c=t.deleteRoam,m=t.onlineSync,h=t.serverExtension,g=this.core.V2NIMConversationIdUtil.parseConversationType(a),I=this.core.V2NIMConversationIdUtil.parseConversationTargetId(a),M={deleteRoam:c,onlineSync:m,serverExtension:h,conversationType:g},g===Wl.V2NIM_CONVERSATION_TYPE_P2P?M.receiverId=I:M.teamId=I,S.next=10,this.core.sendCmd("v2ClearHistoryMessage",{tag:M});case 10:T=S.sent,this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",qt(qt({},M),{deleteTime:T.content.timetag})),this.emitClearHistoryMessage([{deleteTime:T.content.timetag,serverExtension:h,conversationId:a}]);case 13:case"end":return S.stop()}}),_callee3,this)})))},a.syncClearHistoryMessageHandler=function syncClearHistoryMessageHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){return formatClearHistoryNotification(c.core,t)}));this.emitClearHistoryMessage(m)},a.onClearHistoryMessageHandler=function onClearHistoryMessageHandler(t){var a=formatClearHistoryNotification(this.core,t.content.data);this.emitClearHistoryMessage([a])},a.emitClearHistoryMessage=function emitClearHistoryMessage(t){var a=this;forEach$1(t).call(t,(function(t){a.core.V2NIMMessageService.model.deleteMessages(t.conversationId,t.deleteTime)})),this.core.V2NIMMessageService.emit("onClearHistoryNotifications",t)},V2NIMMessageLogUtil}(gh),T_="V2NIMMessageExtendUtil",S_={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","33_1":"v2GetThreadMessageList"},E_={conversationType:{id:1,converter:conversationTypeV2ToV1,retConverter:conversationTypeV1ToV2,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},C_={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:conversationTypeV1ToV2},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:boolToInt,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:boolToInt,retType:"number"},updateTime:{id:10,converter:boolToInt,retType:"number"}},b_={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:boolToInt},needBadge:{id:6,access:"pushConfig.needBadge",converter:boolToInt},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},A_={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},N_={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},R_={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:function converter(t){return 0===t?2:1}},p2pAccountIds:{id:7,converter:function converter(t){return t.join(",")}},teamIds:{id:8,converter:function converter(t){return t.join(",")}},senderAccountIds:{id:9,converter:function converter(t){return t.join(",")}},messageTypes:{id:10,converter:function converter(t){return t.join(",")}},messageSubtypes:{id:11,converter:function converter(t){return t.join(",")}}},w_=qt(qt({},R_),{conversationLimit:4}),k_={v2PinMessage:{sid:33,cid:15,service:T_,params:[{type:"Property",name:"msg",reflectMapper:Hf,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:A_}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:T_,params:[{type:"Property",name:"msg",reflectMapper:Hf,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:A_}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:T_,params:[{type:"Property",name:"msg",reflectMapper:Hf,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:A_}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:T_,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(C_)}]},v2VoiceToText:{sid:29,cid:5,service:T_,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:T_,params:[{type:"Property",name:"message",reflectMapper:Hf,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:b_}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:T_,params:[{type:"Property",name:"message",reflectMapper:Hf,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:b_}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:T_,response:[{type:"Property",name:"message",reflectMapper:invertSerializeItem(Hf)},{type:"Property",name:"quickComment",reflectMapper:invertSerializeItem(b_)}]},onRemoveQuickComment:{sid:23,cid:6,service:T_,response:[{type:"Property",name:"message",reflectMapper:invertSerializeItem(Hf)},{type:"Property",name:"quickComment",reflectMapper:invertSerializeItem(b_)}]},v2GetQuickComment:{sid:33,cid:7,service:T_,params:[{type:"PropertyArray",name:"tag",reflectMapper:E_}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(E_)}]},onPinMessage:{sid:23,cid:18,service:T_,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Hf)},{type:"Property",name:"pinInfo",reflectMapper:invertSerializeItem(A_)}]},onUpdatePinMessage:{sid:23,cid:19,service:T_,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Hf)},{type:"Property",name:"pinInfo",reflectMapper:invertSerializeItem(A_)}]},onUnpinMessage:{sid:23,cid:20,service:T_,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Hf)},{type:"Property",name:"pinInfo",reflectMapper:invertSerializeItem(A_)}]},v2AddCollection:{sid:33,cid:8,service:T_,params:[{type:"Property",name:"tag",reflectMapper:N_}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(N_)}]},v2RemoveCollections:{sid:33,cid:9,service:T_,params:[{type:"PropertyArray",name:"tag",reflectMapper:N_,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:T_,params:[{type:"Property",name:"tag",reflectMapper:N_}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(N_)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:T_,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(N_)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:T_,params:[{type:"Property",name:"tag",reflectMapper:w_}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2SearchCloudMessages:{sid:30,cid:27,service:T_,params:[{type:"Property",name:"tag",reflectMapper:R_}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Hf)}]},v2GetThreadMessageList:{sid:33,cid:1,service:T_,params:[{type:"Property",name:"messageRefer",reflectMapper:Hf},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:invertSerializeItem(Hf)},{type:"Property",name:"replyResult",reflectMapper:invertSerializeItem({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:invertSerializeItem(Hf)}]}},O_=function(t){function V2NIMMessageExtendUtil(a){var c;return(c=t.call(this,"V2NIMMessageExtendService",a)||this).core=a,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:S_,cmdConfig:k_}),c)}kt(V2NIMMessageExtendUtil,t);var a=V2NIMMessageExtendUtil.prototype;return a.pinMessage=function pinMessage(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(Ay,t,"message",!0),validate(Oy,{serverExtension:a},"",!0),m.next=5,this.core.sendCmd("v2PinMessage",{msg:t,msgPin:{serverExtension:a}});case 5:c=m.sent,this.emitPinNotification({pinState:mu.V2NIM_MESSAGE_PIN_STATE_PINNED,message:t,serverExtension:a,createTime:c.content.timetag,updateTime:c.content.timetag,operatorId:this.core.account});case 7:case"end":return m.stop()}}),_callee,this)})))},a.unpinMessage=function unpinMessage(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c;return Dc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(Ay,t,"messageRefer",!0),validate(Oy,{serverExtension:a},"",!0),m.next=5,this.core.sendCmd("v2UnpinMessage",{msg:t,msgPin:{serverExtension:a}});case 5:c=m.sent,this.emitPinNotification({pinState:mu.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED,message:t,serverExtension:a,updateTime:c.content.timetag,operatorId:this.core.account});case 7:case"end":return m.stop()}}),_callee2,this)})))},a.updatePinMessage=function updatePinMessage(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c;return Dc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(Ay,t,"message",!0),validate(Oy,{serverExtension:a},"",!0),m.next=5,this.core.sendCmd("v2UpdatePinMessage",{msg:t,msgPin:{serverExtension:a}});case 5:c=m.sent,this.emitPinNotification({pinState:mu.V2NIM_MESSAGE_PIN_STATE_UPDATED,message:t,serverExtension:a,updateTime:c.content.timetag,operatorId:this.core.account});case 7:case"end":return m.stop()}}),_callee3,this)})))},a.getPinnedMessageList=function getPinnedMessageList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m,h,g=this;return Dc.wrap((function _callee4$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){I.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:return validateConversationId(this.core.account,t),m=(m=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(t)).replace("superTeam","super_team"),I.next=8,this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:m,timetag:0}});case 8:return h=I.sent,I.abrupt("return",sort(a=map$6(c=h.content.data).call(c,(function(t){return qt(qt({},t),{messageRefer:qt(qt({},t.messageRefer),{conversationId:g.core.V2NIMConversationIdUtil.messageConversationId(t.messageRefer)})})}))).call(a,(function(t,a){return a.updateTime-t.updateTime})));case 10:case"end":return I.stop()}}),_callee4,this)})))},a.addQuickComment=function addQuickComment(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var h,g;return Dc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(Ly,{message:t,index:a,serverExtension:c,pushConfig:m},"",!0),I.next=4,this.core.sendCmd("v2AddQuickComment",{message:t,quickComment:{index:a,serverExtension:c,pushConfig:m}});case 4:h=I.sent,g={operationType:hu.V2NIM_QUICK_COMMENT_STATE_ADD,quickComment:{messageRefer:formatMessageRefer(this.core,t),createTime:h.content.timetag,index:a,serverExtension:c||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",g);case 7:case"end":return I.stop()}}),_callee5,this)})))},a.removeQuickComment=function removeQuickComment(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var m,h;return Dc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(Ay,t,"messageRefer",!0),validate({index:{type:"number",min:1}},{index:a},"",!0),validate({serverExtension:{type:"string",required:!1}},{serverExtension:c},"",!0),g.next=6,this.core.sendCmd("v2RemoveQuickComment",{message:t,quickComment:{index:a,serverExtension:c}});case 6:m=g.sent,h={operationType:hu.V2NIM_QUICK_COMMENT_STATE_REMOVE,quickComment:{messageRefer:formatMessageRefer(this.core,t),createTime:m.content.timetag,index:a,serverExtension:c||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",h);case 9:case"end":return g.stop()}}),_callee6,this)})))},a.getQuickCommentList=function getQuickCommentList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var a,c,m,h=this;return Dc.wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(Dy,{messages:t},"",!0),c={},g.next=5,this.core.sendCmd("v2GetQuickComment",{tag:map$6(t).call(t,(function(t){return{messageRefer:t}}))});case 5:return m=g.sent,forEach$1(a=m.content.data).call(a,(function(t){var a,m;try{if(!t.detail)return void(c[a=t.messageRefer.messageClientId]||(c[a]=[]));var g=JSON.parse(t.detail);c[m=t.messageRefer.messageClientId]||(c[m]=[]),forEach$1(g).call(g,(function(a){c[t.messageRefer.messageClientId].push({messageRefer:qt(qt({},t.messageRefer),{conversationId:h.core.V2NIMConversationIdUtil.messageConversationId(t.messageRefer)}),operatorId:a[1],index:em(a[2]),createTime:em(a[3]),serverExtension:a[4]})}))}catch(a){h.logger.error("getQuickCommentList JSON Parse Error",t.detail,a)}})),g.abrupt("return",c);case 8:case"end":return g.stop()}}),_callee7,this)})))},a.voiceToText=function voiceToText(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a,c,m,h,g,I,M,T,S,E,C;return Dc.wrap((function _callee8$(b){for(;;)switch(b.prev=b.next){case 0:if(this.checkV2(),validate(Vy,t,"",!0),t.voicePath||t.voiceUrl||t.file){b.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePathãvoiceUrlãfile cannot be empty at the same time"}});case 4:if(a=t.voicePath,c=t.file,m=t.mimeType,h=t.sampleRate,g=t.duration,I=t.sceneName,M=I?this.core.V2NIMStorageService.getStorageScene(I):null,T=t.voiceUrl){b.next=14;break}return S={},c?S.file=c:0===(null==a?void 0:indexOf(a).call(a,"nim-external"))?S.fileInput=a:S.filePath=a,b.next=12,this.core.cloudStorage.uploadFile(qt({type:"audio",nosScenes:M?M.sceneName:void 0,nosSurvivalTime:M?M.expireTime:void 0},S));case 12:E=b.sent,T=E.url;case 14:return b.next=16,this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:T,mimeType:m,sampleRate:h,duration:g}});case 16:return C=b.sent,b.abrupt("return",C.content.data);case 18:case"end":return b.stop()}}),_callee8,this)})))},a.onPinMessageHandler=function onPinMessageHandler(t){return this.pinMessageChangeHandler(t,mu.V2NIM_MESSAGE_PIN_STATE_PINNED)},a.onUnpinMessageHandler=function onUnpinMessageHandler(t){return this.pinMessageChangeHandler(t,mu.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED)},a.onUpdatePinMessageHandler=function onUpdatePinMessageHandler(t){return this.pinMessageChangeHandler(t,mu.V2NIM_MESSAGE_PIN_STATE_UPDATED)},a.pinMessageChangeHandler=function pinMessageChangeHandler(t,a){var c=t.content.msg,m=t.content.pinInfo;c.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(c),this.emitPinNotification({pinState:a,message:c,serverExtension:m.serverExtension,createTime:m.createTime,updateTime:m.updateTime,operatorId:m.accid})},a.emitPinNotification=function emitPinNotification(t){var a={pinState:t.pinState,pin:qt(qt({serverExtension:t.serverExtension||"",operatorId:t.operatorId},t.createTime?{createTime:t.createTime}:{}),{updateTime:t.updateTime,messageRefer:formatMessageRefer(this.core,t.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",a)},a.onAddQuickCommentHandler=function onAddQuickCommentHandler(t){return this.onQuickCommentNotificationHandler(t,hu.V2NIM_QUICK_COMMENT_STATE_ADD)},a.onRemoveQuickCommentHandler=function onRemoveQuickCommentHandler(t){return this.onQuickCommentNotificationHandler(t,hu.V2NIM_QUICK_COMMENT_STATE_REMOVE)},a.onQuickCommentNotificationHandler=function onQuickCommentNotificationHandler(t,a){var c={operationType:a,quickComment:qt({messageRefer:qt(qt({},t.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(t.content.message)})},t.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",c)},a.addCollection=function addCollection(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a;return Dc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(Uy,{params:t},"",!0),c.next=4,this.core.sendCmd("v2AddCollection",{tag:t});case 4:return a=c.sent,c.abrupt("return",a.content.data);case 6:case"end":return c.stop()}}),_callee9,this)})))},a.removeCollections=function removeCollections(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a;return Dc.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(Fy,{collections:t},"",!0),c.next=4,this.core.sendCmd("v2RemoveCollections",{tag:t});case 4:return a=c.sent,c.abrupt("return",a.content.data);case 6:case"end":return c.stop()}}),_callee10,this)})))},a.updateCollectionExtension=function updateCollectionExtension(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var c;return Dc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(By,{collection:t,serverExtension:a},"",!0),m.next=4,this.core.sendCmd("v2UpdateCollectionExtension",{tag:qt(qt({},t),{serverExtension:a})});case 4:return c=m.sent,m.abrupt("return",c.content.data);case 6:case"end":return m.stop()}}),_callee11,this)})))},a.getCollectionListByOption=function getCollectionListByOption(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var m,h,g,I,M;return Dc.wrap((function _callee12$(T){for(;;)switch(T.prev=T.next){case 0:if(this.checkV2(),validate(qy,t,"",!0),m=t.beginTime||0,h=t.endTime||0,!(0!==m&&0!==h&&m>h)){T.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListByOption: beginTime cannot be greater than endTime"}});case 6:if(g=void 0===t.direction?du.V2NIM_QUERY_DIRECTION_DESC:t.direction,void 0===(null===(a=t.anchorCollection)||void 0===a?void 0:a.collectionId)){T.next=23;break}if(t.direction!==du.V2NIM_QUERY_DIRECTION_DESC){T.next=17;break}if(0!==h){T.next=13;break}h=t.anchorCollection.createTime,T.next=15;break;case 13:if(h===t.anchorCollection.createTime){T.next=15;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}});case 15:T.next=23;break;case 17:if(0!==m){T.next=21;break}m=t.anchorCollection.createTime,T.next=23;break;case 21:if(m===t.anchorCollection.createTime){T.next=23;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});case 23:return(I={beginTime:m,endTime:h,direction:g,limit:t.limit,collectionType:t.collectionType,excludeId:(null===(c=t.anchorCollection)||void 0===c?void 0:c.collectionId)?t.anchorCollection.collectionId:0}).collectionType||delete I.collectionType,T.next=27,this.core.sendCmd("v2GetCollectionListByOption",{tag:I});case 27:return M=T.sent,T.abrupt("return",M.content.data);case 29:case"end":return T.stop()}}),_callee12,this)})))},a.searchCloudMessages=function searchCloudMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a,c,m,h,g,I,M,T,S=this;return Dc.wrap((function _callee13$(E){for(;;)switch(E.prev=E.next){case 0:if(this.checkV2(),validate(Gy,t,"",!0),c=t.beginTime||0,m=t.endTime||0,!(0!==c&&0!==m&&c>m)){E.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});case 6:return h=void 0===t.sortOrder?vu.V2NIM_SORT_ORDER_DESC:t.sortOrder,g=t.conversationLimit||0,I=t.messageLimit||10,M=g>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",E.next=12,this.core.sendCmd(M,{tag:qt(qt({},t),{beginTime:c,endTime:m,sortOrder:h,conversationLimit:g,messageLimit:I})});case 12:return T=E.sent,E.abrupt("return",map$6(a=T.content.data).call(a,(function(t){return completeMessage(S.core,t)})));case 14:case"end":return E.stop()}}),_callee13,this)})))},a.getThreadMessageList=function getThreadMessageList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var a,c,m,h,g,I=this;return Dc.wrap((function _callee14$(M){for(;;)switch(M.prev=M.next){case 0:if(validate(Ky,t,"getThreadMessageList",!0),t.beginTime=t.beginTime||0,!(t.endTime&&t.beginTime>t.endTime)){M.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});case 4:return M.next=6,this.core.sendCmd("v2GetThreadMessageList",{messageRefer:t.messageRefer,tag:{beginTime:t.beginTime,endTime:t.endTime,limit:t.limit,reverse:t.direction===du.V2NIM_QUERY_DIRECTION_ASC?1:0,excludeMessageServerId:t.excludeMessageServerId}});case 6:return a=M.sent,c=a.content,m=c.message,h=c.replyResult,g=c.replyList,M.abrupt("return",{message:completeMessage(this.core,m),timestamp:h.timestamp,replyCount:h.total,replyList:map$6(g).call(g,(function(t){return completeMessage(I.core,t)}))});case 9:case"end":return M.stop()}}),_callee14,this)})))},V2NIMMessageExtendUtil}(gh),P_={joinMode:{type:"enum",values:getEnumValues(Tu),required:!1},agreeMode:{type:"enum",values:getEnumValues(Su),required:!1},inviteMode:{type:"enum",values:getEnumValues(Eu),required:!1},updateInfoMode:{type:"enum",values:getEnumValues(Cu),required:!1},updateExtensionMode:{type:"enum",values:getEnumValues(Au),required:!1},chatBannedMode:{type:"enum",values:[bu.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,bu.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL],required:!1}},x_={type:"object",required:!0,rules:qt({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[Mu.V2NIM_TEAM_TYPE_ADVANCED,Mu.V2NIM_TEAM_TYPE_SUPER]},memberLimit:{type:"number",min:1,required:!1}},P_)},V_={type:"array",min:1,itemType:"string"},L_={type:"boolean"},D_={type:"string"},U_={type:"string",allowEmpty:!1},F_={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},B_={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},q_={teamIds:{type:"array",itemType:"string",regExp:/^[1-9]\d*$/,min:1,allowEmpty:!1}},G_={teamType:{type:"enum",values:[Mu.V2NIM_TEAM_TYPE_ADVANCED,Mu.V2NIM_TEAM_TYPE_SUPER]}},H_={teamTypes:{type:"array",itemType:"enum",values:[Mu.V2NIM_TEAM_TYPE_ADVANCED,Mu.V2NIM_TEAM_TYPE_SUPER],required:!1}},j_={updateTeamInfoParams:{type:"object",required:!0,rules:qt({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},P_)}},Y_={type:"enum",values:[Ru.V2NIM_TEAM_MEMBER_ROLE_NORMAL,Ru.V2NIM_TEAM_MEMBER_ROLE_MANAGER]},$_={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1}}}};getEnumValues(Nu);var W_,z_={chatBannedMode:{type:"enum",values:[bu.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,bu.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL]}},K_={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:getEnumValues(Iu)},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:getEnumValues(du),required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},Q_={teamId:B_.teamId,teamType:{type:"enum",values:[Mu.V2NIM_TEAM_TYPE_ADVANCED,Mu.V2NIM_TEAM_TYPE_SUPER]},operatorAccountId:{type:"string",allowEmpty:!1}},J_={actionType:{type:"enum",values:[wu.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION]}},X_={actionType:{type:"enum",values:[wu.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION]}},Z_={types:{type:"array",itemType:"enum",values:getEnumValues(wu),required:!1},status:{type:"array",itemType:"enum",values:getEnumValues(ku),required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},eI=function(){function V2NIMTeamModelImpl(){this.teamMap=new Ml,this.superTeamMap=new Ml}var t=V2NIMTeamModelImpl.prototype;return t.set=function set(t){var a=this;forEach$1(t).call(t,(function(t){a.chooseMap(t.teamType).set(t.teamId,t)}))},t.reset=function reset(){this.teamMap.clear(),this.superTeamMap.clear()},t.count=function count(t,a){void 0===a&&(a=!0);var c=this.chooseMap(t),count=0;return forEach$1(c).call(c,(function(t){a&&t.isValidTeam&&count++,a||count++})),count},t.chooseMap=function chooseMap(t){return t===Mu.V2NIM_TEAM_TYPE_SUPER?this.superTeamMap:t===Mu.V2NIM_TEAM_TYPE_ADVANCED?this.teamMap:new Ml},t.getById=function getById(t,a,c){void 0===c&&(c=!0);var m=this.chooseMap(a).get(t);if(m){if(c&&m.isValidTeam)return m;if(!c)return m}},t.getAll=function getAll(t,a){void 0===a&&(a=!0);var c=this.chooseMap(t),m=Wc(values(c).call(c)),h=filter(m).call(m,(function(t){return!(!a||!t.isValidTeam)||(!a||void 0)}));return sort(h).call(h,(function(t,a){return a.updateTime-t.updateTime}))},t.upsert=function upsert(t){var a=t.teamId,c=t.teamType,m=this.chooseMap(c),h=m.get(a)||{},g=qt({},h,t);return m.set(a,g),g},t.deleteById=function deleteById(t,a){var c=this.getById(t,a);if(c)return c.isValidTeam=!1,c},t.searchTeamByKeyword=function searchTeamByKeyword(t){var a,c,m=[];return forEach$1(a=this.teamMap).call(a,(function(a){var c;includes(c=a.name).call(c,t)&&m.push(a)})),forEach$1(c=this.superTeamMap).call(c,(function(a){var c;includes(c=a.name).call(c,t)&&m.push(a)})),m},V2NIMTeamModelImpl}(),tI=function(){function V2NIMTeamMemberModelImpl(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}var t=V2NIMTeamMemberModelImpl.prototype;return t.reset=function reset(){this.teamMembers=[],this.superTeamMembers=[]},t.setData=function setData(t){var a=this;forEach$1(t).call(t,(function(t){a.chooseList(t.teamType).push(t)}))},t.chooseList=function chooseList(t){return t===Mu.V2NIM_TEAM_TYPE_SUPER?this.superTeamMembers:t===Mu.V2NIM_TEAM_TYPE_ADVANCED?this.teamMembers:[]},t.getById=function getById(t,a,c){var m=this.chooseList(a);return find(m).call(m,(function(a){return a.teamId===t&&a.accountId===c}))},t.upsert=function upsert(t){var a=t.teamType,c=t.teamId,m=this.chooseList(a),h=findIndex$1(m).call(m,(function(a){return a.teamId===c&&a.accountId===t.accountId}));-1===h?m.push(t):m[h]=qt(qt({},m[h]),t),m.length>this.maxSize&&m.shift()},t.deleteByAccount=function deleteByAccount(t,a,c){var m=this.chooseList(a),h=findIndex$1(m).call(m,(function(a){return a.teamId===t&&a.accountId===c}));if(-1!==h){var g=m[h];return g.inTeam=!1,splice$1(m).call(m,h,1),g}},t.deleteByTeamId=function deleteByTeamId(t,a){var c=this.chooseList(a),m=filter(c).call(c,(function(a){return a.teamId!==t}));a===Mu.V2NIM_TEAM_TYPE_SUPER?this.superTeamMembers=m:this.teamMembers=m},V2NIMTeamMemberModelImpl}(),rI=function(){function V2NIMTeamNotificationImpl(t,a){this.core=t,this.service=a}var t=V2NIMTeamNotificationImpl.prototype;return t.processNotification=function processNotification(t){var a=this,c=t.attachment,m=t.senderId,h=t.receiverId,g=c.id,I=c.data,M=g>400?Mu.V2NIM_TEAM_TYPE_SUPER:Mu.V2NIM_TEAM_TYPE_ADVANCED,T=formatTeamNotificationAttachData(I,M),S=T.id,E=T.ids,C=T.tinfo,b=T.mute,A=this.service.model.getById(h,M);switch(this.core.logger.log("v2Team::processNotification, notificationType:",g,I),g){case W_.SUPER_TEAM_INVITATION:case W_.TEAM_INVITATION:includes(E).call(E,this.core.account)&&this.onTeamJoined(C),this.onTeamMembersJoined(C,filter(E).call(E,(function(t){return t!==a.core.account})));break;case W_.SUPER_TEAM_INVITE_ACCEPT:case W_.TEAM_INVITE_ACCEPT:m===this.core.account?this.onTeamJoined(C):this.onTeamMemberJoined(C,m);break;case W_.SUPER_TEAM_APPLY_ACCEPT:case W_.TEAM_APPLY_ACCEPT:S===this.core.account?this.onTeamJoined(C):this.onTeamMemberJoined(C,S);break;case W_.SUPER_TEAM_ADD_MANAGER:case W_.TEAM_ADD_MANAGER:this.updateTeamMemberRole(h,M,E,{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_MANAGER});break;case W_.SUPER_TEAM_REMOVE_MANAGER:case W_.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(h,M,E,{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_NORMAL});break;case W_.SUPER_TEAM_KICK:case W_.TEAM_KICK:this.onTeamInfoUpdated(C),forEach$1(E).call(E,(function(t){t===a.core.account?a.onTeamLeft(h,M,!0):a.onTeamMemberKicked(m,C.teamId,C.teamType,t)}));break;case W_.SUPER_TEAM_LEAVE:case W_.TEAM_LEAVE:C?this.onTeamInfoUpdated(C):A&&m===this.core.account&&(A.isValidTeam=!1,this.onTeamInfoUpdated(A)),m===this.core.account?this.onTeamLeft(h,M,!1):this.onTeamMemberLeft(h,M,m);break;case W_.SUPER_TEAM_DISMISS:case W_.TEAM_DISMISS:this.onTeamDismissed(h,M);break;case W_.SUPER_TEAM_UPDATE:case W_.TEAM_UPDATED:this.onTeamInfoUpdated(C);break;case W_.SUPER_TEAM_TRANSFER_OWNER:case W_.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(C),this.updateTeamMemberRole(h,M,[m,C.ownerAccountId],[{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_NORMAL},{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_OWNER}]);break;case W_.SUPER_TEAM_MEMBER_MUTE:case W_.TEAM_MEMBER_MUTE:this.service.model.upsert(C),this.updateTeamMemberRole(h,M,S?[S]:E,{chatBanned:b!==yu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF})}},t.onTeamJoined=function onTeamJoined(t){if(this.service.model.upsert(t),this.service.emit("onTeamJoined",t),!this.service.memberModel.getById(t.teamId,t.teamType,this.core.account)){var a=t.updateTime||t.createTime,c=generateMemberByTeamId(t.teamId,t.teamType,this.core.account,{joinTime:a,updateTime:a});this.service.memberModel.upsert(c)}},t.onTeamLeft=function onTeamLeft(t,a,c){var m=this.service.model.deleteById(t,a)||generateTeamByTeamId(t,a,{isValidTeam:!1});this.service.memberModel.deleteByAccount(t,a,this.core.account),this.service.emit("onTeamLeft",m,c)},t.onTeamDismissed=function onTeamDismissed(t,a){var c=this.service.model.deleteById(t,a);c||(c=generateTeamByTeamId(t,a,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(t,a),this.service.emit("onTeamDismissed",c)},t.onTeamInfoUpdated=function onTeamInfoUpdated(t){var a=this.service.model.upsert(t);this.service.emit("onTeamInfoUpdated",a)},t.onTeamMemberJoined=function onTeamMemberJoined(t,a){this.service.model.upsert(t),this.service.emit("onTeamInfoUpdated",t);var c=t.updateTime||t.createTime,m=generateMemberByTeamId(t.teamId,t.teamType,a,{joinTime:c,updateTime:c});this.service.memberModel.upsert(m),this.service.emit("onTeamMemberJoined",[m])},t.onTeamMembersJoined=function onTeamMembersJoined(t,a){var c=this,m=t.updateTime||t.createTime,h=map$6(a).call(a,(function(a){return generateMemberByTeamId(t.teamId,t.teamType,a,{joinTime:m,updateTime:m})}));0!==h.length&&(this.service.model.upsert(t),this.service.emit("onTeamInfoUpdated",t),forEach$1(h).call(h,(function(t){return c.service.memberModel.upsert(t)})),this.service.emit("onTeamMemberJoined",h))},t.onTeamMemberLeft=function onTeamMemberLeft(t,a,c){var m=this.service.memberModel.deleteByAccount(t,a,c);m||(m=generateMemberByTeamId(t,a,c,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[m])},t.onTeamMemberKicked=function onTeamMemberKicked(t,a,c,m){var h=this.service.memberModel.deleteByAccount(a,c,m);h||(h=generateMemberByTeamId(a,c,m,{inTeam:!1})),this.service.emit("onTeamMemberKicked",t,[h])},t.onTeamMemberInfoUpdated=function onTeamMemberInfoUpdated(t){var a=this;forEach$1(t).call(t,(function(t){var c;if(t.accountId===a.core.account&&(null===(c=a.core.V2NIMSettingService)||void 0===c?void 0:c.name)){var m=t.teamType===Mu.V2NIM_TEAM_TYPE_ADVANCED?a.core.V2NIMConversationIdUtil.teamConversationId(t.teamId):a.core.V2NIMConversationIdUtil.superTeamConversationId(t.teamId),h=a.core.V2NIMSettingService.getConversationMuteStatus(m);a.core.eventBus.emit("V2NIMConversationService/setMute",m,h)}})),this.service.emit("onTeamMemberInfoUpdated",t)},t.updateTeamMemberRole=function updateTeamMemberRole(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var h,g,I,M,T=this;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:if(!((g=filter(c).call(c,(function(c,h){var g=T.service.memberModel.getById(t,a,c);return g&&T.service.memberModel.upsert(qt(qt({},g),jc(m)?m[h]:m)),!g}))).length>0)){S.next=12;break}return S.prev=2,S.next=5,this.service.getTeamMemberListByIds(t,a,g);case 5:I=S.sent,forEach$1(I).call(I,(function(t){return T.service.memberModel.upsert(t)})),S.next=12;break;case 9:S.prev=9,S.t0=S.catch(2),this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",S.t0);case 12:(M=filter(h=map$6(c).call(c,(function(c){return T.service.memberModel.getById(t,a,c)}))).call(h,(function(t){return!!t}))).length>0&&this.onTeamMemberInfoUpdated(M);case 14:case"end":return S.stop()}}),_callee,this,[[2,9]])})))},t.processSysNotification=function processSysNotification(t){var a=t.receiverId,c=t.postscript,m=t.senderId,h=t.timestamp;t.idServer;var g={actionType:{0:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION,1:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION,2:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION,3:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION,15:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION,16:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION,17:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION,18:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION}[t.type],teamId:a,teamType:t.type>=15?Mu.V2NIM_TEAM_TYPE_SUPER:Mu.V2NIM_TEAM_TYPE_ADVANCED,operatorAccountId:m,postscript:c,timestamp:h,actionStatus:ku.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT};this.core.logger.log("v2Team::processSysNotification, type:",t.type,g),this.service.notificationModel.create(g),this.service.emit("onReceiveTeamJoinActionInfo",g)},t.updateTeamActionStatus=function updateTeamActionStatus(t,a){this.service.notificationModel.update({teamId:t.teamId,teamType:t.teamType,operatorAccountId:t.operatorAccountId,actionType:t.actionType,actionStatus:a})},t.checkIfExpired=function checkIfExpired(t){return!!t&&(509===t||!(t>=500&&t<=599)&&!(t>=19e4))},V2NIMTeamNotificationImpl}();!function(t){t[t.TEAM_INVITATION=0]="TEAM_INVITATION",t[t.TEAM_KICK=1]="TEAM_KICK",t[t.TEAM_LEAVE=2]="TEAM_LEAVE",t[t.TEAM_UPDATED=3]="TEAM_UPDATED",t[t.TEAM_DISMISS=4]="TEAM_DISMISS",t[t.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",t[t.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",t[t.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",t[t.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",t[t.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",t[t.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",t[t.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",t[t.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",t[t.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",t[t.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",t[t.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",t[t.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",t[t.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",t[t.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",t[t.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",t[t.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",t[t.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(W_||(W_={}));var nI=function(){function V2NIMTeamNotificationModelImpl(){this.list=[],this.maxCount=1e3}var t=V2NIMTeamNotificationModelImpl.prototype;return t.reset=function reset(){this.list=[]},t.create=function create(t){this.list.push(t),this.list.length>this.maxCount&&this.list.shift()},t.update=function update(t){var a;forEach$1(a=this.list).call(a,(function(a){a.teamId===t.teamId&&a.teamType===t.teamType&&a.actionType===t.actionType&&a.operatorAccountId===t.operatorAccountId&&a.actionStatus===ku.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT&&qt(a,t)}))},t.getByOption=function getByOption(t){var a,c=t.types,m=t.status,h=t.offset,g=void 0===h?0:h,I=t.limit,M=void 0===I?50:I,T=[];forEach$1(a=this.list).call(a,(function(t){c&&c.length>0&&!includes(c).call(c,t.actionType)||m&&m.length>0&&!includes(m).call(m,t.actionStatus)||T.push(t)})),T=sort(T).call(T,(function(t,a){return a.timestamp-t.timestamp}));var S=0;g>0&&(S=findIndexWithinTargetValue(T,"timestamp",g),T[S]&&T[S].timestamp===g&&(S+=1));var E=slice$1(T).call(T,S).length;return(T=slice$1(T).call(T,S,S+M)).length>0?{offset:E>M?T[T.length-1].timestamp:0,finished:!(E>M),infos:T}:{offset:0,finished:!0,infos:T}},V2NIMTeamNotificationModelImpl}(),aI=function(t){function V2NIMTeamServiceImpl(a){var c;return(c=t.call(this,"V2NIMTeamService",a)||this).notification=new rI(a,Qe(c)),c.model=new eI,c.memberModel=new tI,c.notificationModel=new nI,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:xf,cmdConfig:Bf}),c.setListener(),c)}kt(V2NIMTeamServiceImpl,t);var a=V2NIMTeamServiceImpl.prototype;return a.setListener=function setListener(){var t,a,c,m=this;this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",(function(t){m.model.upsert(t);var a=generateMemberByTeamId(t.teamId,t.teamType,m.core.account,{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_OWNER});m.memberModel.upsert(a),m.emit("onTeamCreated",t)})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",(function(t){m.memberModel.upsert(t),m.emit("onTeamInfoUpdated",[t])})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",bind$1(t=this.notification.updateTeamActionStatus).call(t,this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",bind$1(a=this.notification.processSysNotification).call(a,this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",bind$1(c=this.notification.processNotification).call(c,this.notification)),this.core.eventBus.on("V2NIMTeamService/onSyncStarted",(function(){m.emit("onSyncStarted")})),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",(function(){m.emit("onSyncFinished")})),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",(function(t){m.emit("onSyncFailed",t)}))},a.reset=function reset(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()},a.createTeam=function createTeam(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var h,g,I,M;return Dc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:return this.checkV2(),validate({createTeamParams:x_},{createTeamParams:t},"",!0),validate({inviteeAccountIds:qt(qt({},V_),{min:0,required:!1})},{inviteeAccountIds:a},"",!0),validate({antispamConfig:F_},{antispamConfig:m},"",!0),h=t.teamType===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamCreate":"v2TeamCreate",T.next=7,this.core.sendCmd(h,{team:t,inviteeAccountIds:a||[],postscript:c||"",antispamConfig:m});case 7:return g=T.sent,I=g.content.team,this.model.upsert(I),M=generateMemberByTeamId(I.teamId,I.teamType,this.core.account,{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_OWNER}),this.memberModel.upsert(M),this.emit("onTeamCreated",I),T.abrupt("return",{team:I,failedList:g.content.failedList});case 14:case"end":return T.stop()}}),_callee,this)})))},a.updateTeamInfo=function updateTeamInfo(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var h,g;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate(j_,{updateTeamInfoParams:c},"",!0),validate({antispamConfig:F_},{antispamConfig:m},"",!0),h=qt({teamId:t,teamType:a},c),g=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo",I.next=9,this.core.sendCmd(g,{team:h,antispamConfig:m});case 9:this.model.upsert(h);case 10:case"end":return I.stop()}}),_callee2,this)})))},a.leaveTeam=function leaveTeam(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c;return Dc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),c=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamLeave":"v2TeamLeave",m.next=6,this.core.sendCmd(c,{teamId:t});case 6:this.model.deleteById(t,a);case 7:case"end":return m.stop()}}),_callee3,this)})))},a.getTeamInfo=function getTeamInfo(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var c,m,h,g;return Dc.wrap((function _callee4$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),c=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamGetInfo":"v2TeamGetInfo",!(m=this.model.getById(t,a,!1))){I.next=7;break}return I.abrupt("return",m);case 7:return I.next=9,this.core.sendCmd(c,{teamId:t});case 9:return h=I.sent,g=h.content.team,this.model.upsert(g),I.abrupt("return",g);case 13:case"end":return I.stop()}}),_callee4,this)})))},a.getJoinedTeamList=function getJoinedTeamList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a,c=this;return Dc.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(H_,{teamTypes:t},"",!0),this.core.V2NIMLoginService.checkIllegalState(),t&&0!==t.length||(t=[Mu.V2NIM_TEAM_TYPE_ADVANCED,Mu.V2NIM_TEAM_TYPE_SUPER]),a=[],forEach$1(t).call(t,(function(t){a=concat(a).call(a,c.model.getAll(t))})),m.abrupt("return",sort(a).call(a,(function(t,a){return t.createTime-a.createTime})));case 7:case"end":return m.stop()}}),_callee5,this)})))},a.getJoinedTeamCount=function getJoinedTeamCount(t){var a=this;this.checkV2(),validate(H_,{teamTypes:t},"",!0),this.core.V2NIMLoginService.checkIllegalState(),t&&0!==t.length||(t=[Mu.V2NIM_TEAM_TYPE_ADVANCED,Mu.V2NIM_TEAM_TYPE_SUPER]);var c=0;return forEach$1(t).call(t,(function(t){c+=a.model.count(t)})),c},a.getTeamInfoByIds=function getTeamInfoByIds(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var c,m,h,g,I,M,T=this;return Dc.wrap((function _callee6$(S){for(;;)switch(S.prev=S.next){case 0:if(this.checkV2(),validate(q_,{teamIds:t},"",!0),validate(G_,{teamType:a},"",!0),m=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamGetByIds":"v2TeamGetByIds",h=map$6(t).call(t,(function(t){return T.model.getById(t,a,!1)})),0!==(g=filter(t).call(t,(function(t,a){return!h[a]}))).length){S.next=8;break}return S.abrupt("return",h);case 8:return S.next=10,this.core.sendCmd(m,{teamIds:g});case 10:return I=S.sent,M=I.content.teams,S.abrupt("return",filter(c=map$6(h).call(h,(function(a,c){if(a)return a;var m=t[c],h=find(M).call(M,(function(t){return t.teamId===m}));return h&&T.model.upsert(h),h}))).call(c,(function(t){return!!t})));case 13:case"end":return S.stop()}}),_callee6,this)})))},a.dismissTeam=function dismissTeam(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var c;return Dc.wrap((function _callee7$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),c=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamDismiss":"v2TeamDismiss",m.next=6,this.core.sendCmd(c,{teamId:t});case 6:case"end":return m.stop()}}),_callee7,this)})))},a.inviteMember=function inviteMember(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var h,g;return Dc.wrap((function _callee8$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({inviteeAccountIds:V_},{inviteeAccountIds:c},"",!0),validate({postscript:qt(qt({},D_),{required:!1})},{postscript:m},"",!0),h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",I.next=8,this.core.sendCmd(h,{teamId:t,accounts:c,ps:m||""});case 8:return g=I.sent,I.abrupt("return",g.content.abortedAccidList);case 10:case"end":return I.stop()}}),_callee8,this)})))},a.acceptInvitation=function acceptInvitation(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a,c,m,h,g,I;return Dc.wrap((function _callee9$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(Q_,t,"invitationInfo",!0),validate(J_,t,"invitationInfo",!0),a=t.teamType,c=t.teamId,m=t.operatorAccountId,h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation",M.prev=5,M.next=8,this.core.sendCmd(h,{teamId:c,from:m});case 8:return g=M.sent,this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED),M.abrupt("return",g.content.team);case 13:throw M.prev=13,M.t0=M.catch(5),I=M.t0,this.notification.checkIfExpired(I.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),M.t0;case 18:case"end":return M.stop()}}),_callee9,this,[[5,13]])})))},a.rejectInvitation=function rejectInvitation(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var c,m,h,g,I;return Dc.wrap((function _callee10$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(Q_,t,"invitationInfo",!0),validate(J_,t,"invitationInfo",!0),validate({postscript:qt(qt({},D_),{required:!1})},{postscript:a},"",!0),c=t.teamType,m=t.teamId,h=t.operatorAccountId,g=c===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamRejectInvite":"v2TeamRejectInvite",M.prev=6,M.next=9,this.core.sendCmd(g,{teamId:m,from:h,ps:a||""});case 9:this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED),M.next=17;break;case 12:throw M.prev=12,M.t0=M.catch(6),I=M.t0,this.notification.checkIfExpired(I.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),M.t0;case 17:case"end":return M.stop()}}),_callee10,this,[[6,12]])})))},a.kickMember=function kickMember(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var m;return Dc.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({memberAccountIds:V_},{memberAccountIds:c},"",!0),m=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamKickMembers":"v2TeamKickMembers",h.next=7,this.core.sendCmd(m,{teamId:t,accounts:c});case 7:case"end":return h.stop()}}),_callee11,this)})))},a.applyJoinTeam=function applyJoinTeam(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var m,h;return Dc.wrap((function _callee12$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),m=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",g.next=6,this.core.sendCmd(m,{teamId:t,ps:c||""});case 6:return h=g.sent,g.abrupt("return",h.content.team);case 8:case"end":return g.stop()}}),_callee12,this)})))},a.acceptJoinApplication=function acceptJoinApplication(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a,c,m,h,g;return Dc.wrap((function _callee13$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(Q_,t,"applicationInfo",!0),validate(X_,t,"applicationInfo",!0),a=t.teamType,c=t.teamId,m=t.operatorAccountId,h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication",I.prev=5,I.next=8,this.core.sendCmd(h,{teamId:c,from:m});case 8:this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED),I.next=16;break;case 11:throw I.prev=11,I.t0=I.catch(5),g=I.t0,this.notification.checkIfExpired(g.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),I.t0;case 16:case"end":return I.stop()}}),_callee13,this,[[5,11]])})))},a.rejectJoinApplication=function rejectJoinApplication(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var c,m,h,g,I;return Dc.wrap((function _callee14$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(Q_,t,"applicationInfo",!0),validate(X_,t,"applicationInfo",!0),validate({postscript:qt(qt({},D_),{required:!1})},{postscript:a},"",!0),c=t.teamType,m=t.teamId,h=t.operatorAccountId,g=c===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication",M.prev=6,M.next=9,this.core.sendCmd(g,{teamId:m,from:h,ps:a||""});case 9:this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED),M.next=17;break;case 12:throw M.prev=12,M.t0=M.catch(6),I=M.t0,this.notification.checkIfExpired(I.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),M.t0;case 17:case"end":return M.stop()}}),_callee14,this,[[6,12]])})))},a.updateTeamMemberRole=function updateTeamMemberRole(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){var h;return Dc.wrap((function _callee15$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({memberAccountIds:V_},{memberAccountIds:c},"",!0),validate({memberRole:Y_},{memberRole:m},"",!0),h=m===Ru.V2NIM_TEAM_MEMBER_ROLE_MANAGER?"AddManagers":"RemoveManagers",h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeam"+h:"v2Team"+h,g.next=9,this.core.sendCmd(h,{teamId:t,accounts:c});case 9:case"end":return g.stop()}}),_callee15,this)})))},a.transferTeamOwner=function transferTeamOwner(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var h;return Dc.wrap((function _callee16$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({accountId:U_},{accountId:c},"",!0),validate({leave:{type:"boolean",required:!1}},{leave:m},"",!0),h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamTransferOwner":"v2TeamTransferOwner",g.next=8,this.core.sendCmd(h,{teamId:t,account:c,leave:m||!1});case 8:case"end":return g.stop()}}),_callee16,this)})))},a.updateSelfTeamMemberInfo=function updateSelfTeamMemberInfo(t,a,c){var m;return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){var h,g,I,M,T;return Dc.wrap((function _callee17$(S){for(;;)switch(S.prev=S.next){case 0:if(this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate($_,{memberInfoParams:c},"",!0),void 0!==c.teamNick||void 0!==c.serverExtension){S.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",g=qt(qt({},c),{teamId:t,accountId:this.core.account}),S.next=10,this.core.sendCmd(h,{teamMember:g});case 10:return S.next=12,this.notification.updateTeamMemberRole(t,a,[this.core.account],g);case 12:I=this.memberModel.getById(t,a,this.core.account),(null===(m=this.core.V2NIMSettingService)||void 0===m?void 0:m.name)&&(M=a===Mu.V2NIM_TEAM_TYPE_ADVANCED?this.core.V2NIMConversationIdUtil.teamConversationId(t):this.core.V2NIMConversationIdUtil.superTeamConversationId(t),T=this.core.V2NIMSettingService.getConversationMuteStatus(M),this.core.eventBus.emit("V2NIMConversationService/setMute",M,T)),this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",I);case 15:case"end":return S.stop()}}),_callee17,this)})))},a.updateTeamMemberNick=function updateTeamMemberNick(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){var h;return Dc.wrap((function _callee18$(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({accountId:U_},{accountId:c},"",!0),validate({nick:D_},{nick:m},"",!0),c!==this.core.account){g.next=7;break}return g.abrupt("return",this.updateSelfTeamMemberInfo(t,a,{teamNick:m}));case 7:return h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateMember":"v2TeamUpdateMember",g.next=10,this.core.sendCmd(h,{teamMember:{teamNick:m,teamId:t,accountId:c}});case 10:case"end":return g.stop()}}),_callee18,this)})))},a.setTeamChatBannedMode=function setTeamChatBannedMode(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){var m;return Dc.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate(z_,{chatBannedMode:c},"",!0),m=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode",h.next=7,this.core.sendCmd(m,{teamId:t,chatBannedMode:c});case 7:this.model.upsert({teamId:t,teamType:a,chatBannedMode:c});case 8:case"end":return h.stop()}}),_callee19,this)})))},a.setTeamMemberChatBannedStatus=function setTeamMemberChatBannedStatus(t,a,c,m){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){var h;return Dc.wrap((function _callee20$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({accountId:U_},{accountId:c},"",!0),validate({chatBanned:L_},{chatBanned:m},"",!0),h=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus",g.next=8,this.core.sendCmd(h,{teamId:t,accountId:a===Mu.V2NIM_TEAM_TYPE_SUPER?[c]:c,chatBanned:m?1:0});case 8:case"end":return g.stop()}}),_callee20,this)})))},a.getTeamMemberList=function getTeamMemberList(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var m,h;return Dc.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate(K_,{queryOption:c},"",!0),m=(m=void 0===c.direction?du.V2NIM_QUERY_DIRECTION_DESC:c.direction)===du.V2NIM_QUERY_DIRECTION_DESC?1:0,g.next=8,this.core.sendCmd("v2TeamMemberGetList",{tag:qt(qt({teamId:t,teamType:a,onlyChatBanned:!1,nextToken:"",limit:100},c),{direction:m})});case 8:return h=g.sent,g.abrupt("return",{nextToken:h.content.pageInfo.nextToken||"",finished:!+h.content.pageInfo.hasMore,memberList:processTeamMembers(h.content.datas,a)});case 10:case"end":return g.stop()}}),_callee21,this)})))},a.getTeamMemberListByIds=function getTeamMemberListByIds(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){var m,h,g,I,M,T,S,E=this;return Dc.wrap((function _callee22$(C){for(;;)switch(C.prev=C.next){case 0:this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({accountIds:V_},{accountIds:c},"",!0),g=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",I=map$6(m=filter(c).call(c,(function(c){return!E.memberModel.getById(t,a,c)}))).call(m,(function(a){return t+"|"+a})),M=0;case 7:if(!(M<I.length)){C.next=16;break}return C.next=10,this.core.sendCmd(g,{tag:slice$1(I).call(I,M,M+20)});case 10:T=C.sent,S=processTeamMembers(T.content.datas,a),forEach$1(S).call(S,(function(t){return E.memberModel.upsert(t)}));case 13:M+=20,C.next=7;break;case 16:return C.abrupt("return",filter(h=map$6(c).call(c,(function(c){return E.memberModel.getById(t,a,c)}))).call(h,(function(t){return!!t})));case 17:case"end":return C.stop()}}),_callee22,this)})))},a.getTeamMemberInvitor=function getTeamMemberInvitor(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee23(){var m,h;return Dc.wrap((function _callee23$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate({accountIds:V_},{accountIds:c},"",!0),m=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor",g.next=7,this.core.sendCmd(m,{teamId:t,accounts:c});case 7:return h=g.sent,g.abrupt("return",h.content.accountsMap);case 9:case"end":return g.stop()}}),_callee23,this)})))},a.searchTeamByKeyword=function searchTeamByKeyword(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){return Dc.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),this.checkLogin(),validate({keyword:U_},{keyword:t},"",!0),a.abrupt("return",this.model.searchTeamByKeyword(t));case 4:case"end":return a.stop()}}),_callee24,this)})))},a.getTeamJoinActionInfoList=function getTeamJoinActionInfoList(t){return this.checkV2(),validate(Z_,t,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),Mi.resolve(this.notificationModel.getByOption(t))},a.v2TeamSyncHandler=function v2TeamSyncHandler(t){this.model.set(t.content.datas)},a.v2SuperTeamSyncHandler=function v2SuperTeamSyncHandler(t){this.model.set(t.content.datas)},a.v2TeamCreateMultiSyncHandler=function v2TeamCreateMultiSyncHandler(t){var a=t.content.data;this.model.upsert(a);var c=generateMemberByTeamId(a.teamId,a.teamType,this.core.account,{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_OWNER});this.memberModel.upsert(c),this.emit("onTeamCreated",a)},a.v2SuperTeamCreateMultiSyncHandler=function v2SuperTeamCreateMultiSyncHandler(t){var a=t.content.data;this.model.upsert(a);var c=generateMemberByTeamId(a.teamId,a.teamType,this.core.account,{memberRole:Ru.V2NIM_TEAM_MEMBER_ROLE_OWNER});this.memberModel.upsert(c),this.emit("onTeamCreated",a)},a.v2TeamMemberUpdateMultiSyncHandler=function v2TeamMemberUpdateMultiSyncHandler(t){var a=t.content.data;a.teamType=Mu.V2NIM_TEAM_TYPE_ADVANCED;var c=this.memberModel.getById(a.teamId,a.teamType,a.accountId);this.notification.updateTeamMemberRole(a.teamId,a.teamType,[a.accountId],a),a.accountId===this.core.account&&c&&c.bits!==a.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",a.teamId,a.teamType,a.bits)},a.v2SuperTeamMemberUpdateMultiSyncHandler=function v2SuperTeamMemberUpdateMultiSyncHandler(t){var a=t.content.data;a.teamType=Mu.V2NIM_TEAM_TYPE_SUPER;var c=this.memberModel.getById(a.teamId,a.teamType,a.accountId);this.notification.updateTeamMemberRole(a.teamId,a.teamType,[a.accountId],a),a.accountId===this.core.account&&c&&c.bits!==a.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",a.teamId,a.teamType,a.bits)},a.v2TeamMembersOfSelfInSyncHandler=function v2TeamMembersOfSelfInSyncHandler(t){var a=t.content.datas;forEach$1(a).call(a,(function(t){t.teamType=Mu.V2NIM_TEAM_TYPE_ADVANCED})),this.memberModel.setData(a)},a.v2SuperTeamMembersOfSelfInSyncHandler=function v2SuperTeamMembersOfSelfInSyncHandler(t){var a=t.content.datas;forEach$1(a).call(a,(function(t){t.teamType=Mu.V2NIM_TEAM_TYPE_SUPER})),this.memberModel.setData(a)},V2NIMTeamServiceImpl}(gh),iI="V2NIMUserService",oI={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},sI={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},cI={v2UpdateBlockList:{sid:34,cid:3,service:iI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:iI,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(sI)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:iI,params:[{type:"Property",name:"tag",reflectMapper:sI}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:iI,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(sI)}]},onUpdateBlockList:{sid:3,cid:103,service:iI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:iI,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:iI,response:[{type:"Property",name:"user",reflectMapper:invertSerializeItem(sI)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:iI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:iI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}};collection("Set",(function(t){return function Set(){return t(this,arguments.length?arguments[0]:void 0)}}),ll);var lI=j.Set;_export({target:"Set",stat:!0,forced:!0},{from:pl}),_export({target:"Set",stat:!0,forced:!0},{of:ml});_export({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function addAll(){for(var t=anObject(this),a=aCallable(t.add),c=0,m=arguments.length;c<m;c++)k(a,t,arguments[c]);return t}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:hl});var uI=getIterator;_export({target:"Set",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=uI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c){if(!m(t,t,a))return c()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{difference:function difference(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a),m=aCallable(c.delete);return iterate(t,(function(t){k(m,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=uI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Set"))),g=aCallable(h.add);return iterate(c,(function(t){m(t,t,a)&&k(g,h,t)}),{IS_ITERATOR:!0}),h}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=uI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c){if(m(t,t,a))return c(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function intersection(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set"))),m=aCallable(a.has),h=aCallable(c.add);return iterate(t,(function(t){k(m,a,t)&&k(h,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function isDisjointFrom(t){var a=anObject(this),c=aCallable(a.has);return!iterate(t,(function(t,m){if(!0===k(c,a,t))return m()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function isSubsetOf(t){var a=getIterator(this),c=anObject(t),m=c.has;return isCallable(m)||(c=new(getBuiltIn("Set"))(t),m=aCallable(c.has)),!iterate(a,(function(t,a){if(!1===k(m,c,t))return a()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function isSupersetOf(t){var a=anObject(this),c=aCallable(a.has);return!iterate(t,(function(t,m){if(!1===k(c,a,t))return m()}),{INTERRUPTED:!0}).stopped}});var dI=N([].join),pI=[].push;_export({target:"Set",proto:!0,real:!0,forced:!0},{join:function join(t){var a=anObject(this),c=uI(a),m=void 0===t?",":toString$1(t),h=[];return iterate(c,pI,{that:h,IS_ITERATOR:!0}),dI(h,m)}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{map:function map(t){var a=anObject(this),c=uI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Set"))),g=aCallable(h.add);return iterate(c,(function(t){k(g,h,m(t,t,a))}),{IS_ITERATOR:!0}),h}});var mI=TypeError;_export({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=uI(a),m=arguments.length<2,h=m?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c){m?(m=!1,h=c):h=t(h,c,c,a)}),{IS_ITERATOR:!0}),m)throw mI("Reduce of empty set with no initial value");return h}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=uI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c){if(m(t,t,a))return c()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function symmetricDifference(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a),m=aCallable(c.delete),h=aCallable(c.add);return iterate(t,(function(t){k(m,c,t)||k(h,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{union:function union(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a);return iterate(t,aCallable(c.add),{that:c}),c}});var hI=lI,gI=function(){function V2NIMUserModelImpl(){this.muteList=new hI,this.userMap=new Ml,this.blockList=[]}var t=V2NIMUserModelImpl.prototype;return t.reset=function reset(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]},t.setAccountMuteMode=function setAccountMuteMode(t,a){a===_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON?this.muteList.add(t):this.muteList.delete(t)},t.setUser=function setUser(t){this.userMap.set(t.accountId,t)},t.getUser=function getUser(t){return this.userMap.get(t)},t.getUserListBySearchOption=function getUserListBySearchOption(t){var a,c;return filter(a=Wc(values(c=this.userMap).call(c))).call(a,(function(a){var c,m,h;return!(void 0!==t.searchName&&!t.searchName||!includes(c=a.name).call(c,t.keyword))||(!(!t.searchAccountId||!includes(m=a.accountId).call(m,t.keyword))||!!(a.mobile&&t.searchMobile&&includes(h=a.mobile).call(h,t.keyword)))}))},t.addToBlockList=function addToBlockList(t){var a=this;forEach$1(t).call(t,(function(t){var c;includes(c=a.blockList).call(c,t)||a.blockList.push(t)}))},t.removeFromBlockList=function removeFromBlockList(t){var a=this;forEach$1(t).call(t,(function(t){var c,m,h=indexOf(c=a.blockList).call(c,t);-1!==h&&splice$1(m=a.blockList).call(m,h,1)}))},V2NIMUserModelImpl}(),vI={type:"string",required:!0,allowEmpty:!1},fI={type:"string",required:!1,allowEmpty:!0},yI={name:{type:"string",required:!1,allowEmpty:!0},avatar:fI,sign:fI,email:fI,birthday:fI,mobile:fI,gender:{type:"number",required:!1},serverExtension:fI};function _createForOfIteratorHelperLoose$6(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$6(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$6(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$6(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$6(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var _I=function(t){function V2NIMUserServiceImpl(a){var c;return c=t.call(this,"V2NIMUserService",a)||this,registerParser({cmdMap:oI,cmdConfig:cI}),c.model=new gI,"v2"!==c.core.options.apiVersion?Qe(c):(c.setListener(),c)}kt(V2NIMUserServiceImpl,t);var a=V2NIMUserServiceImpl.prototype;return a.reset=function reset(){this.model.reset()},a.setListener=function setListener(){var t=this;this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",(function(a,c){c?t.model.addToBlockList([a]):t.model.removeFromBlockList([a]),c?t.emitBlockListAdded(a):t.emit("onBlockListRemoved",a)})),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",(function(a){t.updateUserProfileInMemory(a)}))},a.getUserList=function getUserList(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I=this;return Dc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(this.checkV2(),validate({accountIds:V_},{accountIds:t},"",!0),c=[],forEach$1(t).call(t,(function(t){I.model.getUser(t)||c.push(t)})),m=null,!(c.length>0)){M.next=9;break}return M.next=8,this.core.sendCmd("v2GetUserList",{accountIds:c});case 8:m=M.sent;case 9:return h=(null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.data)||[],forEach$1(h).call(h,(function(t){I.model.setUser(t)})),g=[],forEach$1(t).call(t,(function(t){var a=I.model.getUser(t);a&&g.push(a)})),M.abrupt("return",g);case 14:case"end":return M.stop()}}),_callee,this)})))},a.getUserListFromCloud=function getUserListFromCloud(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g=this;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:t},"",!0),I.next=4,this.core.sendCmd("v2GetUserList",{accountIds:t});case 4:return a=I.sent,c=a.content.data||[],m=[],forEach$1(c).call(c,(function(t){var a=g.model.getUser(t.accountId);g.compareUserForUpdate(a,t)&&m.push(t),g.model.setUser(t)})),h=reduce(t).call(t,(function(t,a){var c=g.model.getUser(a);return c&&t.push(c),t}),[]),m.length>0&&this.emit("onUserProfileChanged",m),I.abrupt("return",h);case 11:case"end":return I.stop()}}),_callee2,this)})))},a.compareUserForUpdate=function compareUserForUpdate(t,a){return!t||!("number"==typeof t.updateTime&&"number"==typeof a.updateTime&&t.updateTime>=a.updateTime)},a.updateSelfUserProfile=function updateSelfUserProfile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(yI,t,"",!0),c.next=4,this.core.sendCmd("v2UpdateSelfUserProfile",{tag:qt(qt({},t),{accountId:this.core.account})});case 4:return a=c.sent,c.next=7,this.updateUserProfileInMemory(qt({updateTime:a.content.updateTime},t));case 7:case"end":return c.stop()}}),_callee3,this)})))},a.addUserToBlockList=function addUserToBlockList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),t!==this.core.account){a.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});case 3:return validate({accountId:vI},{accountId:t},"",!0),a.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:t,addToBlockList:!0});case 6:this.model.addToBlockList([t]),this.emitBlockListAdded(t);case 8:case"end":return a.stop()}}),_callee4,this)})))},a.removeUserFromBlockList=function removeUserFromBlockList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),t!==this.core.account){a.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});case 3:return validate({accountId:vI},{accountId:t},"",!0),a.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:t,addToBlockList:!1});case 6:this.model.removeFromBlockList([t]),this.emit("onBlockListRemoved",t);case 8:case"end":return a.stop()}}),_callee5,this)})))},a.searchUserByOption=function searchUserByOption(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},t,"",!0),!1!==(void 0===t.searchName||t.searchName)||t.searchAccountId||t.searchMobile){a.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});case 6:return a.abrupt("return",this.model.getUserListBySearchOption(t));case 7:case"end":return a.stop()}}),_callee6,this)})))},a.getBlockList=function getBlockList(){return this.checkV2(),Mi.resolve(this.model.blockList)},a.updateUserProfileInMemory=function updateUserProfileInMemory(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var a,c;return Dc.wrap((function _callee7$(m){for(;;)switch(m.prev=m.next){case 0:if(!(a=this.model.getUser(this.core.account))){m.next=6;break}qt(a,t),this.model.setUser(a),m.next=10;break;case 6:return m.next=8,this.getUserList([this.core.account]);case 8:c=m.sent,a=c[0];case 10:a&&this.emit("onUserProfileChanged",[a]);case 11:case"end":return m.stop()}}),_callee7,this)})))},a.onUpdateUserProfileHandler=function onUpdateUserProfileHandler(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a;return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return a=t.content.data,c.next=3,this.updateUserProfileInMemory(a);case 3:case"end":return c.stop()}}),_callee8,this)})))},a.onUpdateBlockListHandler=function onUpdateBlockListHandler(t){var a=t.content.accountId;t.content.addToBlockList?(this.model.addToBlockList([a]),this.emitBlockListAdded(a)):(this.model.removeFromBlockList([a]),this.emit("onBlockListRemoved",a))},a.syncBlockAndMuteListHandler=function syncBlockAndMuteListHandler(t){var a=this,c=t.content.data;forEach$1(c).call(c,(function(t){t.isBlock?a.model.addToBlockList([t.accountId]):a.model.setAccountMuteMode(t.accountId,t.isMute?_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:_u.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF)}))},a.v2SyncSelfUserInfoHandler=function v2SyncSelfUserInfoHandler(t){var a=t.content.user;this.model.setUser(a)},a.checkUserUpdate=function checkUserUpdate(t,a){var c=t.senderId;if(c!==this.core.account){var m=this.model.getUser(c);if(m){var h=m.updateTime;"number"==typeof h&&"number"==typeof a&&!isNaN(h)&&!isNaN(a)&&h<a&&this.refreshUserInfo(c)}else this.refreshUserInfo(c)}},a.refreshUserInfo=function refreshUserInfo(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var c,m,h,g,I;return Dc.wrap((function _callee9$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.core.sendCmd("v2GetUserList",{accountIds:[t]});case 2:for(c=M.sent,m=(null===(a=null==c?void 0:c.content)||void 0===a?void 0:a.data)||[],h=_createForOfIteratorHelperLoose$6(m);!(g=h()).done;)I=g.value,this.model.setUser(I),this.emit("onUserProfileChanged",[I]);case 5:case"end":return M.stop()}}),_callee9,this)})))},a.emitBlockListAdded=function emitBlockListAdded(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a;return Dc.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.getUserList([t]);case 2:1===(a=c.sent).length&&this.emit("onBlockListAdded",a[0]);case 4:case"end":return c.stop()}}),_callee10,this)})))},a.v2OnUpdateMuteListHandler=function v2OnUpdateMuteListHandler(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var a,c,m,h;return Dc.wrap((function _callee11$(g){for(;;)switch(g.prev=g.next){case 0:a=t.content,c=a.accountId,m=a.mute,h=m?_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:_u.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF,this.core.eventBus.emit("v2NIMUserService/updateMuteList",c,h);case 3:case"end":return g.stop()}}),_callee11,this)})))},V2NIMUserServiceImpl}(gh),MI="V2NIMFriendService",TI={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},SI={accountId:4,source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},EI={v2AddFriend:{sid:35,cid:1,service:MI,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:MI,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:boolToInt}}}]},v2SetFriendInfo:{sid:35,cid:3,service:MI,params:[{type:"Property",name:"tag",reflectMapper:SI}]},v2OnAddFriend:{sid:12,cid:101,service:MI,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:invertSerializeItem({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:MI,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:MI,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(SI)}]},v2SyncFriendList:{sid:12,cid:5,service:MI,response:[{type:"PropertyArray",name:"friends",reflectMapper:invertSerializeItem(SI)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:MI,response:[{type:"PropertyArray",name:"users",reflectMapper:invertSerializeItem(sI)}]},v2IncFriendInfo:{sid:35,cid:4,service:MI,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:invertSerializeItem(SI)},{type:"Long",name:"timetag"}]}},CI={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:getEnumValues(Kl)},postscript:{type:"string",required:!1,allowEmpty:!0}}}},bI={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},AI={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},NI={applicantAccountId:{type:"string",required:!0,allowEmpty:!1},recipientAccountId:{type:"string",required:!0,allowEmpty:!1},operatorAccountId:{type:"string",required:!0,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",required:!0,values:getEnumValues(Jl)},timestamp:{type:"number",required:!1}},RI={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:getEnumValues(Jl)}},wI=function(){function V2NIMFriendNotificationImpl(t,a){this.core=t,this.service=a}return V2NIMFriendNotificationImpl.prototype.processSysNotification=function processSysNotification(t){if(6===t.type){var a=t.senderId;this.core.V2NIMFriendService.handleDeleteFriend(a,Xl.V2NIM_FRIEND_DELETION_TYPE_BY_PEER)}else if(5===t.type)try{var c=JSON.parse(t.content);if((null==c?void 0:c.vt)===Zl.V2NIM_FRIEND_VERIFY_TYPE_ADD){this.core.V2NIMFriendService.handleAddFriend(t.senderId,t.timestamp);var m={applicantAccountId:t.senderId,recipientAccountId:t.receiverId,operatorAccountId:t.senderId,postscript:t.postscript,timestamp:t.timestamp,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD,read:!0};this.service.model.appendFriendAddApplication(m),this.service.model.updateFriendAddApplicationStatus(m.applicantAccountId,Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD,m.applicantAccountId)}else if((null==c?void 0:c.vt)===Zl.V2NIM_FRIEND_VERIFY_TYPE_APPLY){var h={applicantAccountId:t.senderId,recipientAccountId:t.receiverId,operatorAccountId:t.senderId,postscript:t.postscript,timestamp:t.timestamp,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT,read:!1};this.service.handleApplyFriend(h),this.core.V2NIMFriendService.model.appendFriendAddApplication(h)}else if((null==c?void 0:c.vt)===Zl.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT){this.core.V2NIMFriendService.handleAddFriend(t.senderId,t.timestamp);var g={applicantAccountId:t.receiverId,recipientAccountId:t.senderId,operatorAccountId:t.senderId,timestamp:t.timestamp,postscript:t.postscript,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED,read:!0};this.core.V2NIMFriendService.model.appendFriendAddApplication(g)}else if((null==c?void 0:c.vt)===Zl.V2NIM_FRIEND_VERIFY_TYPE_REJECT){var I={applicantAccountId:t.receiverId,recipientAccountId:t.senderId,operatorAccountId:t.senderId,timestamp:t.timestamp,postscript:t.postscript,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED,read:!0};this.core.V2NIMFriendService.model.appendFriendAddApplication(I),this.service.emit("onFriendAddRejected",I)}}catch(t){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",t)}},V2NIMFriendNotificationImpl}();function _createForOfIteratorHelperLoose$5(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$5(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$5(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$5(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$5(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var kI=function(){function V2NIMFriendModelImpl(){this.validFriendIds=new hI,this.friendMap=new Ml,this.applicationInfoList=[],this.friendTimetag=0}var t=V2NIMFriendModelImpl.prototype;return t.getAddApplicationList=function getAddApplicationList(t){var a,c,m=void 0===t.offset||0===t.offset?Ot:t.offset,h=filter(a=this.applicationInfoList).call(a,(function(a){if(a.timestamp>=m)return!1;var c=t.status||[];return 0===c.length||!!includes(c).call(c,a.status)})),g=t.limit||50,I=Math.min(g,h.length),M=slice$1(c=reverse$1(h).call(h)).call(c,0,I),T=m;return M.length>0&&(T=M[M.length-1].timestamp),{infos:M,finished:I>=h.length,offset:I>=h.length?0:T}},t.reset=function reset(){this.friendMap.clear(),this.validFriendIds.clear(),this.applicationInfoList=[]},t.setAddApplicationRead=function setAddApplicationRead(){for(var t,a=_createForOfIteratorHelperLoose$5(this.applicationInfoList);!(t=a()).done;){t.value.read=!0}},t.getAddApplicationUnreadCount=function getAddApplicationUnreadCount(){for(var t,a=new hI,c=_createForOfIteratorHelperLoose$5(this.applicationInfoList);!(t=c()).done;){var m=t.value;m.read||m.status!==Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT||a.add(m.applicantAccountId)}return a.size},t.appendFriendAddApplication=function appendFriendAddApplication(t){this.applicationInfoList.push(t)},t.updateFriendAddApplicationStatus=function updateFriendAddApplicationStatus(t,a,c){if(a!==Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT)for(var m,h=_createForOfIteratorHelperLoose$5(this.applicationInfoList);!(m=h()).done;){var g=m.value;g.applicantAccountId===t&&g.status===Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT&&(g.status=a,g.operatorAccountId=c,g.read=!0)}},t.upsertFriend=function upsertFriend(t,a){var c=this.friendMap.get(t)||{},m=qt({accountId:t},c,a);return this.friendMap.set(t,m),this.validFriendIds.add(t),m},t.addFriend=function addFriend(t){this.validFriendIds.add(t)},t.deleteFriend=function deleteFriend(t){this.validFriendIds.delete(t)},t.getFriend=function getFriend(t){return this.validFriendIds.has(t)?this.friendMap.get(t):void 0},t.getFriendList=function getFriendList(){var t,a,c,m=this;return filter(t=map$6(a=Wc(values(c=this.validFriendIds).call(c))).call(a,(function(t){return m.getFriend(t)}))).call(t,(function(t){return!!t}))},t.getFriendListBySearchOption=function getFriendListBySearchOption(t){var a,c,m,h=this;return filter(a=map$6(c=Wc(values(m=this.validFriendIds).call(m))).call(c,(function(t){return h.getFriend(t)}))).call(a,(function(a){var c,m,h=void 0===t.searchAlias||t.searchAlias;return void 0!==a&&(!!(h&&a.alias&&includes(c=a.alias).call(c,t.keyword))||!(!t.searchAccountId||!includes(m=a.accountId).call(m,t.keyword)))}))},t.getFriendByIds=function getFriendByIds(t){var a,c=this;return filter(a=map$6(t).call(t,(function(t){return c.getFriend(t)}))).call(a,(function(t){return!!t}))},t.setFriendTimetag=function setFriendTimetag(t){this.friendTimetag=t},t.getFriendTimetag=function getFriendTimetag(){return this.friendTimetag},V2NIMFriendModelImpl}(),OI=function(t){function V2NIMUFriendServiceImpl(a){var c;return(c=t.call(this,"V2NIMFriendService",a)||this).notification=new wI(c.core,Qe(c)),c.model=new kI,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:TI,cmdConfig:EI}),c.setListener(),c)}kt(V2NIMUFriendServiceImpl,t);var a=V2NIMUFriendServiceImpl.prototype;return a.reset=function reset(){this.model.reset()},a.setListener=function setListener(){var t,a,c,m,h,g;this.core.eventBus.on("V2NIMFriendService/sysNotification",bind$1(t=this.notification.processSysNotification).call(t,this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",bind$1(a=this.handleAddFriend).call(a,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",bind$1(c=this.handleDeleteFriend).call(c,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",bind$1(m=this.handleSetFriendInfo).call(m,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",bind$1(h=this.handlePassFriendApply).call(h,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",bind$1(g=this.handleRejectFriendApply).call(g,this))},a.addFriend=function addFriend(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),t!==this.core.account){c.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});case 3:return validate(CI,{accountId:t,params:a},"",!0),c.next=6,this.core.sendCmd("v2AddFriend",{accountId:t,verifyType:a.addMode,postscript:a.postscript||""});case 6:if(a.addMode!==Kl.V2NIM_FRIEND_MODE_TYPE_ADD){c.next=9;break}return c.next=9,this.handleAddFriend(t);case 9:case"end":return c.stop()}}),_callee,this)})))},a.deleteFriend=function deleteFriend(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),t!==this.core.account){c.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});case 3:return validate(bI,{accountId:t,params:a},"",!0),c.next=6,this.core.sendCmd("v2DeleteFriend",{accountId:t,params:a});case 6:a.deleteAlias&&this.model.upsertFriend(t,{alias:""}),this.handleDeleteFriend(t);case 8:case"end":return c.stop()}}),_callee2,this)})))},a.acceptAddApplication=function acceptAddApplication(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validate(NI,t,"",!0),a.prev=2,a.next=5,this.core.sendCmd("v2AddFriend",{accountId:t.applicantAccountId,verifyType:Zl.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT,postscript:""});case 5:this.handlePassFriendApply(t.applicantAccountId),a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(2),this.handlePassFriendApply(t.applicantAccountId,a.t0),a.t0;case 12:case"end":return a.stop()}}),_callee3,this,[[2,8]])})))},a.rejectAddApplication=function rejectAddApplication(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(NI,t,"",!0),c.prev=2,c.next=5,this.core.sendCmd("v2AddFriend",{accountId:t.applicantAccountId,verifyType:Zl.V2NIM_FRIEND_VERIFY_TYPE_REJECT,postscript:a||""});case 5:this.handleRejectFriendApply({applicantAccountId:t.applicantAccountId,recipientAccountId:t.recipientAccountId,operatorAccountId:this.core.account,postscript:a||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED}),c.next=12;break;case 8:throw c.prev=8,c.t0=c.catch(2),this.handleRejectFriendApply({applicantAccountId:t.applicantAccountId,recipientAccountId:t.recipientAccountId,operatorAccountId:this.core.account,postscript:a||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED},c.t0),c.t0;case 12:case"end":return c.stop()}}),_callee4,this,[[2,8]])})))},a.setFriendInfo=function setFriendInfo(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),validate(AI,{accountId:t,params:a},"",!0),t!==this.core.account){c.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});case 4:return c.next=6,this.core.sendCmd("v2SetFriendInfo",{tag:qt({accountId:t},a)});case 6:this.handleSetFriendInfo(t,a);case 7:case"end":return c.stop()}}),_callee5,this)})))},a.getFriendList=function getFriendList(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),t.abrupt("return",Mi.resolve(this.computedFields(this.model.getFriendList())));case 3:case"end":return t.stop()}}),_callee6,this)})))},a.getFriendByIds=function getFriendByIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:t},"",!0),a.abrupt("return",Mi.resolve(this.computedFields(this.model.getFriendByIds(t))));case 4:case"end":return a.stop()}}),_callee7,this)})))},a.checkFriend=function checkFriend(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a,c=this;return Dc.wrap((function _callee8$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:t},"",!0),a={},forEach$1(t).call(t,(function(t){a[t]=!!c.model.getFriend(t)})),m.abrupt("return",Mi.resolve(a));case 6:case"end":return m.stop()}}),_callee8,this)})))},a.getAddApplicationList=function getAddApplicationList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){return Dc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate(RI,t,"",!0),a.abrupt("return",Mi.resolve(this.model.getAddApplicationList(t)));case 4:case"end":return a.stop()}}),_callee9,this)})))},a.setAddApplicationRead=function setAddApplicationRead(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(t){for(;;)switch(t.prev=t.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.setAddApplicationRead();case 3:case"end":return t.stop()}}),_callee10,this)})))},a.getAddApplicationUnreadCount=function getAddApplicationUnreadCount(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),t.abrupt("return",Mi.resolve(this.model.getAddApplicationUnreadCount()));case 3:case"end":return t.stop()}}),_callee11,this)})))},a.searchFriendByOption=function searchFriendByOption(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){return Dc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},t,"",!0),void 0===t.searchAlias||t.searchAlias||t.searchAccountId){a.next=6;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});case 6:return a.abrupt("return",this.computedFields(this.model.getFriendListBySearchOption(t)));case 7:case"end":return a.stop()}}),_callee12,this)})))},a.v2OnAddFriendHandler=function v2OnAddFriendHandler(t){var a=t.content,c=a.accountId,m=a.verifyType,h=a.postscript;if(m===Zl.V2NIM_FRIEND_VERIFY_TYPE_ADD)this.handleAddFriend(c);else if(m===Zl.V2NIM_FRIEND_VERIFY_TYPE_APPLY){var g={applicantAccountId:this.core.account,recipientAccountId:c,operatorAccountId:this.core.account,postscript:h,timestamp:this.core.timeOrigin.getNTPTime(),status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT,read:!1};this.handleApplyFriend(g)}else if(m===Zl.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT)this.handlePassFriendApply(c);else if(m===Zl.V2NIM_FRIEND_VERIFY_TYPE_REJECT){var I={applicantAccountId:c,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:h,timestamp:this.core.timeOrigin.getNTPTime(),status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED,read:!0};this.handleRejectFriendApply(I)}},a.v2OnDeleteFriendHandler=function v2OnDeleteFriendHandler(t){var a=t.content.accountId;this.handleDeleteFriend(a)},a.v2OnUpdateFriendInfoHandler=function v2OnUpdateFriendInfoHandler(t){var a=t.content.data,c=this.model.upsertFriend(a.accountId,a);this.emit("onFriendInfoChanged",c)},a.v2SyncFriendListHandler=function v2SyncFriendListHandler(t){var a=this,c=t.content,m=c.friends,h=c.timetag;this.model.setFriendTimetag(h),forEach$1(m).call(m,(function(t){t.serverExtension||(t.serverExtension=""),t.customerExtension||(t.customerExtension=""),a.model.upsertFriend(t.accountId,t)}))},a.v2SyncFriendUserListHandler=function v2SyncFriendUserListHandler(t){var a=this,c=t.content.users;this.core.V2NIMUserService.model&&forEach$1(c).call(c,(function(t){a.core.V2NIMUserService.model.setUser(t)}))},a.handleApplyFriend=function handleApplyFriend(t){this.emit("onFriendAddApplication",t)},a.handleAddFriend=function handleAddFriend(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a;return Dc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return this.model.addFriend(t),c.next=3,this.incrementSyncFriend();case 3:(a=this.model.getFriend(t))&&this.emit("onFriendAdded",this.computedField(a));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.handleDeleteFriend=function handleDeleteFriend(t,a){a=void 0===a?Xl.V2NIM_FRIEND_DELETION_TYPE_BY_SELF:a,this.emit("onFriendDeleted",t,a),this.model.deleteFriend(t)},a.handleSetFriendInfo=function handleSetFriendInfo(t,a){var c=this.model.upsertFriend(t,a);this.emit("onFriendInfoChanged",this.computedField(c))},a.handlePassFriendApply=function handlePassFriendApply(t,a){var c=a?null==a?void 0:a.code:200;if(!(c>=19e4||c===Gu.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===c||c===Gu.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(t,Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED,this.core.account),this.handleAddFriend(t);else{if(c>=500&&c<=599&&509!==c)return;this.model.updateFriendAddApplicationStatus(t,Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED,this.core.account)}},a.handleRejectFriendApply=function handleRejectFriendApply(t,a){var c=a?null==a?void 0:a.code:200;if(!(c>=19e4||c===Gu.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===c)this.emit("onFriendAddRejected",t),this.model.updateFriendAddApplicationStatus(t.applicantAccountId,Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED,this.core.account);else if(c===Gu.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(t.applicantAccountId,Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED,this.core.account);else{if(c>=500&&c<=599&&509!==c)return;this.model.updateFriendAddApplicationStatus(t.applicantAccountId,Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED,this.core.account)}},a.incrementSyncFriend=function incrementSyncFriend(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var t,a,c,m,h=this;return Dc.wrap((function _callee14$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()});case 2:t=g.sent,a=t.content,c=a.friends,m=a.timetag,this.model.setFriendTimetag(m),forEach$1(c).call(c,(function(t){h.model.upsertFriend(t.accountId,t)}));case 6:case"end":return g.stop()}}),_callee14,this)})))},a.computedFields=function computedFields(t){var a=this;return map$6(t).call(t,(function(t){return a.computedField(t)}))},a.computedField=function computedField(t){var a,c,m=null===(c=null===(a=this.core.V2NIMUserService)||void 0===a?void 0:a.model)||void 0===c?void 0:c.getUser(t.accountId);return m?qt({},t,{userProfile:m}):t},V2NIMUFriendServiceImpl}(gh),PI={muteMode:{type:"enum",values:getEnumValues(yu)}},xI={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:getEnumValues(_u)}},VI={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},LI={config:{type:"object",required:!0,rules:{apns:VI,hwPush:VI,miPush:VI,vivoPush:VI,oppoPush:VI,honorPush:VI,fcmPush:VI,mzPush:VI}}},DI="V2NIMSettingService",UI={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline"},FI={v2SetDeviceToken:{sid:34,cid:1,service:DI,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:DI,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:DI,params:[{type:"Property",name:"tag",reflectMapper:{need:{id:1,converter:function converter(t){return t?2:1}}}}]}},BI=BI||function(t){var a;"undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),void 0!==ji&&ji.crypto&&(a=ji.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&"undefined"!=typeof global&&global.crypto&&(a=global.crypto);var c=function cryptoSecureRandomInt(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=ft||function(){function F(){}return function(t){var a;return F.prototype=t,a=new F,F.prototype=null,a}}(),h={},g=h.lib={},I=g.Base={extend:function extend(t){var a=m(this);return t&&a.mixIn(t),a.hasOwnProperty("init")&&this.init!==a.init||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function create(){var t=this.extend();return t.init.apply(t,arguments),t},init:function init(){},mixIn:function mixIn(t){for(var a in t)t.hasOwnProperty(a)&&(this[a]=t[a]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function clone(){return this.init.prototype.extend(this)}},M=g.WordArray=I.extend({init:function init(t,a){t=this.words=t||[],this.sigBytes=null!=a?a:4*t.length},toString:function toString(t){return(t||S).stringify(this)},concat:function concat(t){var a=this.words,c=t.words,m=this.sigBytes,h=t.sigBytes;if(this.clamp(),m%4)for(var g=0;g<h;g++){var I=c[g>>>2]>>>24-g%4*8&255;a[m+g>>>2]|=I<<24-(m+g)%4*8}else for(var M=0;M<h;M+=4)a[m+M>>>2]=c[M>>>2];return this.sigBytes+=h,this},clamp:function clamp(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=t.ceil(c/4)},clone:function clone(){var t,clone=I.clone.call(this);return clone.words=slice$1(t=this.words).call(t,0),clone},random:function random(t){for(var a=[],m=0;m<t;m+=4)a.push(c());return new M.init(a,t)}}),T=h.enc={},S=T.Hex={stringify:function stringify(t){for(var a=t.words,c=t.sigBytes,m=[],h=0;h<c;h++){var g=a[h>>>2]>>>24-h%4*8&255;m.push((g>>>4).toString(16)),m.push((15&g).toString(16))}return m.join("")},parse:function parse(t){for(var a=t.length,c=[],m=0;m<a;m+=2)c[m>>>3]|=em(t.substr(m,2),16)<<24-m%8*4;return new M.init(c,a/2)}},E=T.Latin1={stringify:function stringify(t){for(var a=t.words,c=t.sigBytes,m=[],h=0;h<c;h++){var g=a[h>>>2]>>>24-h%4*8&255;m.push(String.fromCharCode(g))}return m.join("")},parse:function parse(t){for(var a=t.length,c=[],m=0;m<a;m++)c[m>>>2]|=(255&t.charCodeAt(m))<<24-m%4*8;return new M.init(c,a)}},C=T.Utf8={stringify:function stringify(t){try{return decodeURIComponent(escape(E.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function parse(t){return E.parse(unescape(encodeURIComponent(t)))}},b=g.BufferedBlockAlgorithm=I.extend({reset:function reset(){this._data=new M.init,this._nDataBytes=0},_append:function _append(t){var a;"string"==typeof t&&(t=C.parse(t)),concat(a=this._data).call(a,t),this._nDataBytes+=t.sigBytes},_process:function _process(a){var c,m=this._data,h=m.words,g=m.sigBytes,I=this.blockSize,T=g/(4*I),S=(T=a?t.ceil(T):t.max((0|T)-this._minBufferSize,0))*I,E=t.min(4*S,g);if(S){for(var C=0;C<S;C+=I)this._doProcessBlock(h,C);c=splice$1(h).call(h,0,S),m.sigBytes-=E}return new M.init(c,E)},clone:function clone(){var clone=I.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0});g.Hasher=b.extend({cfg:I.extend(),init:function init(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function reset(){b.reset.call(this),this._doReset()},update:function update(t){return this._append(t),this._process(),this},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(t){return function(a,c){return new t.init(c).finalize(a)}},_createHmacHelper:function _createHmacHelper(t){return function(a,c){return new A.HMAC.init(t,c).finalize(a)}}});var A=h.algo={};return h}(Math),qI=BI.enc.Utf8,GI=BI,HI=GI.lib,jI=HI.WordArray,YI=HI.Hasher,$I=GI.algo,WI=[],zI=$I.SHA1=YI.extend({_doReset:function _doReset(){this._hash=new jI.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function _doProcessBlock(t,a){for(var c=this._hash.words,m=c[0],h=c[1],g=c[2],I=c[3],M=c[4],T=0;T<80;T++){if(T<16)WI[T]=0|t[a+T];else{var S=WI[T-3]^WI[T-8]^WI[T-14]^WI[T-16];WI[T]=S<<1|S>>>31}var E=(m<<5|m>>>27)+M+WI[T];E+=T<20?1518500249+(h&g|~h&I):T<40?1859775393+(h^g^I):T<60?(h&g|h&I|g&I)-1894007588:(h^g^I)-899497514,M=I,I=g,g=h<<30|h>>>2,h=m,m=E}c[0]=c[0]+m|0,c[1]=c[1]+h|0,c[2]=c[2]+g|0,c[3]=c[3]+I|0,c[4]=c[4]+M|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,c=8*this._nDataBytes,m=8*t.sigBytes;return a[m>>>5]|=128<<24-m%32,a[14+(m+64>>>9<<4)]=Math.floor(c/4294967296),a[15+(m+64>>>9<<4)]=c,t.sigBytes=4*a.length,this._process(),this._hash},clone:function clone(){var clone=YI.clone.call(this);return clone._hash=this._hash.clone(),clone}});GI.SHA1=YI._createHelper(zI),GI.HmacSHA1=YI._createHmacHelper(zI),BI.SHA1,function(t){var a=t,c=a.lib.Base,m=a.enc.Utf8;a.algo.HMAC=c.extend({init:function init(t,a){t=this._hasher=new t.init,"string"==typeof a&&(a=m.parse(a));var c=t.blockSize,h=4*c;a.sigBytes>h&&(a=t.finalize(a)),a.clamp();for(var g=this._oKey=a.clone(),I=this._iKey=a.clone(),M=g.words,T=I.words,S=0;S<c;S++)M[S]^=1549556828,T[S]^=909522486;g.sigBytes=I.sigBytes=h,this.reset()},reset:function reset(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function update(t){return this._hasher.update(t),this},finalize:function finalize(t){var a,c=this._hasher,m=c.finalize(t);return c.reset(),c.finalize(concat(a=this._oKey.clone()).call(a,m))}})}(BI);var KI=BI,QI=KI.lib,JI=QI.Base,XI=QI.WordArray,ZI=KI.algo,eM=ZI.MD5,tM=ZI.EvpKDF=JI.extend({cfg:JI.extend({keySize:4,hasher:eM,iterations:1}),init:function init(t){this.cfg=this.cfg.extend(t)},compute:function compute(t,a){for(var c,m=this.cfg,h=m.hasher.create(),g=XI.create(),I=g.words,M=m.keySize,T=m.iterations;I.length<M;){c&&h.update(c),c=h.update(t).finalize(a),h.reset();for(var S=1;S<T;S++)c=h.finalize(c),h.reset();concat(g).call(g,c)}return g.sigBytes=4*M,g}});KI.EvpKDF=function(t,a,c){return tM.create(c).compute(t,a)},BI.EvpKDF;var rM=BI,nM=rM.lib.WordArray;rM.enc.Base64={stringify:function stringify(t){var a=t.words,c=t.sigBytes,m=this._map;t.clamp();for(var h=[],g=0;g<c;g+=3)for(var I=(a[g>>>2]>>>24-g%4*8&255)<<16|(a[g+1>>>2]>>>24-(g+1)%4*8&255)<<8|a[g+2>>>2]>>>24-(g+2)%4*8&255,M=0;M<4&&g+.75*M<c;M++)h.push(m.charAt(I>>>6*(3-M)&63));var T=m.charAt(64);if(T)for(;h.length%4;)h.push(T);return h.join("")},parse:function parse(t){var a=t.length,c=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var h=0;h<c.length;h++)m[c.charCodeAt(h)]=h}var g=c.charAt(64);if(g){var I=indexOf(t).call(t,g);-1!==I&&(a=I)}return function parseLoop(t,a,c){for(var m=[],h=0,g=0;g<a;g++)if(g%4){var I=c[t.charCodeAt(g-1)]<<g%4*2|c[t.charCodeAt(g)]>>>6-g%4*2;m[h>>>2]|=I<<24-h%4*8,h++}return nM.create(m,h)}(t,a,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},BI.enc.Base64;var aM=BI,iM=aM.lib,oM=iM.WordArray,sM=iM.Hasher,cM=aM.algo,lM=[];!function(){for(var t=0;t<64;t++)lM[t]=4294967296*Math.abs(Math.sin(t+1))|0}();var uM=cM.MD5=sM.extend({_doReset:function _doReset(){this._hash=new oM.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(t,a){for(var c=0;c<16;c++){var m=a+c,h=t[m];t[m]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}var g=this._hash.words,I=t[a+0],M=t[a+1],T=t[a+2],S=t[a+3],E=t[a+4],C=t[a+5],b=t[a+6],A=t[a+7],N=t[a+8],R=t[a+9],w=t[a+10],k=t[a+11],O=t[a+12],P=t[a+13],x=t[a+14],V=t[a+15],L=g[0],D=g[1],U=g[2],B=g[3];L=FF(L,D,U,B,I,7,lM[0]),B=FF(B,L,D,U,M,12,lM[1]),U=FF(U,B,L,D,T,17,lM[2]),D=FF(D,U,B,L,S,22,lM[3]),L=FF(L,D,U,B,E,7,lM[4]),B=FF(B,L,D,U,C,12,lM[5]),U=FF(U,B,L,D,b,17,lM[6]),D=FF(D,U,B,L,A,22,lM[7]),L=FF(L,D,U,B,N,7,lM[8]),B=FF(B,L,D,U,R,12,lM[9]),U=FF(U,B,L,D,w,17,lM[10]),D=FF(D,U,B,L,k,22,lM[11]),L=FF(L,D,U,B,O,7,lM[12]),B=FF(B,L,D,U,P,12,lM[13]),U=FF(U,B,L,D,x,17,lM[14]),L=GG(L,D=FF(D,U,B,L,V,22,lM[15]),U,B,M,5,lM[16]),B=GG(B,L,D,U,b,9,lM[17]),U=GG(U,B,L,D,k,14,lM[18]),D=GG(D,U,B,L,I,20,lM[19]),L=GG(L,D,U,B,C,5,lM[20]),B=GG(B,L,D,U,w,9,lM[21]),U=GG(U,B,L,D,V,14,lM[22]),D=GG(D,U,B,L,E,20,lM[23]),L=GG(L,D,U,B,R,5,lM[24]),B=GG(B,L,D,U,x,9,lM[25]),U=GG(U,B,L,D,S,14,lM[26]),D=GG(D,U,B,L,N,20,lM[27]),L=GG(L,D,U,B,P,5,lM[28]),B=GG(B,L,D,U,T,9,lM[29]),U=GG(U,B,L,D,A,14,lM[30]),L=HH(L,D=GG(D,U,B,L,O,20,lM[31]),U,B,C,4,lM[32]),B=HH(B,L,D,U,N,11,lM[33]),U=HH(U,B,L,D,k,16,lM[34]),D=HH(D,U,B,L,x,23,lM[35]),L=HH(L,D,U,B,M,4,lM[36]),B=HH(B,L,D,U,E,11,lM[37]),U=HH(U,B,L,D,A,16,lM[38]),D=HH(D,U,B,L,w,23,lM[39]),L=HH(L,D,U,B,P,4,lM[40]),B=HH(B,L,D,U,I,11,lM[41]),U=HH(U,B,L,D,S,16,lM[42]),D=HH(D,U,B,L,b,23,lM[43]),L=HH(L,D,U,B,R,4,lM[44]),B=HH(B,L,D,U,O,11,lM[45]),U=HH(U,B,L,D,V,16,lM[46]),L=II(L,D=HH(D,U,B,L,T,23,lM[47]),U,B,I,6,lM[48]),B=II(B,L,D,U,A,10,lM[49]),U=II(U,B,L,D,x,15,lM[50]),D=II(D,U,B,L,C,21,lM[51]),L=II(L,D,U,B,O,6,lM[52]),B=II(B,L,D,U,S,10,lM[53]),U=II(U,B,L,D,w,15,lM[54]),D=II(D,U,B,L,M,21,lM[55]),L=II(L,D,U,B,N,6,lM[56]),B=II(B,L,D,U,V,10,lM[57]),U=II(U,B,L,D,b,15,lM[58]),D=II(D,U,B,L,P,21,lM[59]),L=II(L,D,U,B,E,6,lM[60]),B=II(B,L,D,U,k,10,lM[61]),U=II(U,B,L,D,T,15,lM[62]),D=II(D,U,B,L,R,21,lM[63]),g[0]=g[0]+L|0,g[1]=g[1]+D|0,g[2]=g[2]+U|0,g[3]=g[3]+B|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,c=8*this._nDataBytes,m=8*t.sigBytes;a[m>>>5]|=128<<24-m%32;var h=Math.floor(c/4294967296),g=c;a[15+(m+64>>>9<<4)]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),a[14+(m+64>>>9<<4)]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),t.sigBytes=4*(a.length+1),this._process();for(var I=this._hash,M=I.words,T=0;T<4;T++){var S=M[T];M[T]=16711935&(S<<8|S>>>24)|4278255360&(S<<24|S>>>8)}return I},clone:function clone(){var clone=sM.clone.call(this);return clone._hash=this._hash.clone(),clone}});function FF(t,a,c,m,h,g,I){var M=t+(a&c|~a&m)+h+I;return(M<<g|M>>>32-g)+a}function GG(t,a,c,m,h,g,I){var M=t+(a&m|c&~m)+h+I;return(M<<g|M>>>32-g)+a}function HH(t,a,c,m,h,g,I){var M=t+(a^c^m)+h+I;return(M<<g|M>>>32-g)+a}function II(t,a,c,m,h,g,I){var M=t+(c^(a|~m))+h+I;return(M<<g|M>>>32-g)+a}aM.MD5=sM._createHelper(uM),aM.HmacMD5=sM._createHmacHelper(uM),BI.MD5,function(t){t.lib.Cipher||function(){var a=t,c=a.lib,m=c.Base,h=c.WordArray,g=c.BufferedBlockAlgorithm,I=a.enc;I.Utf8;var M=I.Base64,T=a.algo.EvpKDF,S=c.Cipher=g.extend({cfg:m.extend(),createEncryptor:function createEncryptor(t,a){return this.create(this._ENC_XFORM_MODE,t,a)},createDecryptor:function createDecryptor(t,a){return this.create(this._DEC_XFORM_MODE,t,a)},init:function init(t,a,c){this.cfg=this.cfg.extend(c),this._xformMode=t,this._key=a,this.reset()},reset:function reset(){g.reset.call(this),this._doReset()},process:function process(t){return this._append(t),this._process()},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(t){return"string"==typeof t?O:w}return function(t){return{encrypt:function encrypt(a,c,m){return selectCipherStrategy(c).encrypt(t,a,c,m)},decrypt:function decrypt(a,c,m){return selectCipherStrategy(c).decrypt(t,a,c,m)}}}}()});c.StreamCipher=S.extend({_doFinalize:function _doFinalize(){return this._process(!0)},blockSize:1});var E=a.mode={},C=c.BlockCipherMode=m.extend({createEncryptor:function createEncryptor(t,a){return this.Encryptor.create(t,a)},createDecryptor:function createDecryptor(t,a){return this.Decryptor.create(t,a)},init:function init(t,a){this._cipher=t,this._iv=a}}),b=E.CBC=function(){var t=C.extend();function xorBlock(t,a,c){var m,h=this._iv;h?(m=h,this._iv=void 0):m=this._prevBlock;for(var g=0;g<c;g++)t[a+g]^=m[g]}return t.Encryptor=t.extend({processBlock:function processBlock(t,a){var c=this._cipher,m=c.blockSize;xorBlock.call(this,t,a,m),c.encryptBlock(t,a),this._prevBlock=slice$1(t).call(t,a,a+m)}}),t.Decryptor=t.extend({processBlock:function processBlock(t,a){var c=this._cipher,m=c.blockSize,h=slice$1(t).call(t,a,a+m);c.decryptBlock(t,a),xorBlock.call(this,t,a,m),this._prevBlock=h}}),t}(),A=(a.pad={}).Pkcs7={pad:function pad(t,a){for(var c=4*a,m=c-t.sigBytes%c,g=m<<24|m<<16|m<<8|m,I=[],M=0;M<m;M+=4)I.push(g);var T=h.create(I,m);concat(t).call(t,T)},unpad:function unpad(t){var a=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=a}};c.BlockCipher=S.extend({cfg:S.cfg.extend({mode:b,padding:A}),reset:function reset(){var t;S.reset.call(this);var a=this.cfg,c=a.iv,m=a.mode;this._xformMode==this._ENC_XFORM_MODE?t=m.createEncryptor:(t=m.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,c&&c.words):(this._mode=t.call(m,this,c&&c.words),this._mode.__creator=t)},_doProcessBlock:function _doProcessBlock(t,a){this._mode.processBlock(t,a)},_doFinalize:function _doFinalize(){var t,a=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(a.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),a.unpad(t)),t},blockSize:4});var N=c.CipherParams=m.extend({init:function init(t){this.mixIn(t)},toString:function toString(t){return(t||this.formatter).stringify(this)}}),R=(a.format={}).OpenSSL={stringify:function stringify(t){var a,c,m,g=t.ciphertext,I=t.salt;I?a=concat(c=concat(m=h.create([1398893684,1701076831])).call(m,I)).call(c,g):a=g;return a.toString(M)},parse:function parse(t){var a,c=M.parse(t),m=c.words;return 1398893684==m[0]&&1701076831==m[1]&&(a=h.create(slice$1(m).call(m,2,4)),splice$1(m).call(m,0,4),c.sigBytes-=16),N.create({ciphertext:c,salt:a})}},w=c.SerializableCipher=m.extend({cfg:m.extend({format:R}),encrypt:function encrypt(t,a,c,m){m=this.cfg.extend(m);var h=t.createEncryptor(c,m),g=h.finalize(a),I=h.cfg;return N.create({ciphertext:g,key:c,iv:I.iv,algorithm:t,mode:I.mode,padding:I.padding,blockSize:t.blockSize,formatter:m.format})},decrypt:function decrypt(t,a,c,m){return m=this.cfg.extend(m),a=this._parse(a,m.format),t.createDecryptor(c,m).finalize(a.ciphertext)},_parse:function _parse(t,a){return"string"==typeof t?a.parse(t,this):t}}),k=(a.kdf={}).OpenSSL={execute:function execute(t,a,c,m){var g;m||(m=h.random(8));var I=T.create({keySize:a+c}).compute(t,m),M=h.create(slice$1(g=I.words).call(g,a),4*c);return I.sigBytes=4*a,N.create({key:I,iv:M,salt:m})}},O=c.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:k}),encrypt:function encrypt(t,a,c,m){var h=(m=this.cfg.extend(m)).kdf.execute(c,t.keySize,t.ivSize);m.iv=h.iv;var g=w.encrypt.call(this,t,a,h.key,m);return g.mixIn(h),g},decrypt:function decrypt(t,a,c,m){m=this.cfg.extend(m),a=this._parse(a,m.format);var h=m.kdf.execute(c,t.keySize,t.ivSize,a.salt);return m.iv=h.iv,w.decrypt.call(this,t,a,h.key,m)}})}()}(BI);var dM=BI,pM=dM.lib.StreamCipher,mM=dM.algo,hM=mM.RC4=pM.extend({_doReset:function _doReset(){for(var t=this._key,a=t.words,c=t.sigBytes,m=this._S=[],h=0;h<256;h++)m[h]=h;h=0;for(var g=0;h<256;h++){var I=h%c,M=a[I>>>2]>>>24-I%4*8&255;g=(g+m[h]+M)%256;var T=m[h];m[h]=m[g],m[g]=T}this._i=this._j=0},_doProcessBlock:function _doProcessBlock(t,a){t[a]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var t=this._S,a=this._i,c=this._j,m=0,h=0;h<4;h++){c=(c+t[a=(a+1)%256])%256;var g=t[a];t[a]=t[c],t[c]=g,m|=t[(t[a]+t[c])%256]<<24-8*h}return this._i=a,this._j=c,m}dM.RC4=pM._createHelper(hM);var gM=mM.RC4Drop=hM.extend({cfg:hM.cfg.extend({drop:192}),_doReset:function _doReset(){hM._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)generateKeystreamWord.call(this)}});dM.RC4Drop=pM._createHelper(gM);var vM=BI.RC4,fM=function(t){function V2NIMSettingServiceImpl(a){var c;return(c=t.call(this,"V2NIMSettingService",a)||this).offlinePushPlugin=void 0,c.offlinePushConfig=void 0,c.appBackgroundOptions={badge:0,isBackground:!1},c.p2pMessageMuteModeChangeHandler=function(t,a){c.emit("onP2PMessageMuteModeChanged",t,a),c.core.V2NIMUserService.model.setAccountMuteMode(t,a);var m=c.core.V2NIMConversationIdUtil.p2pConversationId(t),h=a===_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON;c.core.eventBus.emit("V2NIMConversationService/setMute",m,h)},c.setTokenAndBackgroundStateAfterLogin=function(t){c.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin"),c.offlinePushPlugin&&(c.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin plugin is provided"),c.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin pushType is: ",t&&t.pushType),c.regToken(t),c.core.sendCmd("v2SetAppBackground",{isBackground:c.appBackgroundOptions.isBackground,badge:c.appBackgroundOptions.badge||0}))},"v2"!==c.core.options.apiVersion?Qe(c):(c.setListener(),registerParser({cmdMap:UI,cmdConfig:FI}),c)}kt(V2NIMSettingServiceImpl,t);var a=V2NIMSettingServiceImpl.prototype;return a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMSettingService/updateBits",(function(a,c,m){t.emit("onTeamMessageMuteModeChanged",a,c,m)})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.setTokenAndBackgroundStateAfterLogin),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.p2pMessageMuteModeChangeHandler),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.p2pMessageMuteModeChangeHandler)},a.getConversationMuteStatus=function getConversationMuteStatus(t){if("string"!=typeof t)return!1;var a=this.core.V2NIMConversationIdUtil.parseConversationType(t),c=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t);return a===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?this.getTeamMessageMuteMode(c,Mu.V2NIM_TEAM_TYPE_SUPER)!==yu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:a===Wl.V2NIM_CONVERSATION_TYPE_TEAM?this.getTeamMessageMuteMode(c,Mu.V2NIM_TEAM_TYPE_ADVANCED)!==yu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:a===Wl.V2NIM_CONVERSATION_TYPE_P2P&&!!this.core.V2NIMUserService.model.muteList.has(c)},a.setTeamMessageMuteMode=function setTeamMessageMuteMode(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var m,h,g,I;return Dc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(B_,{teamId:t},"",!0),validate(G_,{teamType:a},"",!0),validate(PI,{muteMode:c},"",!0),m=a===Mu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",h={teamId:t,teamType:a,accountId:this.core.account,bits:c},M.next=8,this.core.sendCmd(m,{teamMember:h});case 8:this.core.V2NIMTeamService.memberModel.upsert(h),this.emit("onTeamMessageMuteModeChanged",t,a,c),g=a===Mu.V2NIM_TEAM_TYPE_ADVANCED?this.core.V2NIMConversationIdUtil.teamConversationId(t):this.core.V2NIMConversationIdUtil.superTeamConversationId(t),I=this.core.V2NIMSettingService.getConversationMuteStatus(g),this.core.eventBus.emit("V2NIMConversationService/setMute",g,I);case 13:case"end":return M.stop()}}),_callee,this)})))},a.getTeamMessageMuteMode=function getTeamMessageMuteMode(t,a){var c;return"string"!=typeof t||"number"!=typeof a?0:3&((null===(c=this.core.V2NIMTeamService.memberModel.getById(t,a,this.core.account))||void 0===c?void 0:c.bits)||0)},a.setP2PMessageMuteMode=function setP2PMessageMuteMode(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),validate(xI,{accountId:t,muteMode:a},"",!0),t!==this.core.account){c.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});case 4:return c.next=6,this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:t,muteMode:a===_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON});case 6:this.p2pMessageMuteModeChangeHandler(t,a);case 7:case"end":return c.stop()}}),_callee2,this)})))},a.getP2PMessageMuteMode=function getP2PMessageMuteMode(t){return validate({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:t},"",!0),this.core.V2NIMUserService.model.muteList.has(t)?_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:_u.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF},a.getP2PMessageMuteList=function getP2PMessageMuteList(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Mi.resolve(Wc(this.core.V2NIMUserService.model.muteList)));case 1:case"end":return t.stop()}}),_callee3,this)})))},a.setAppBackground=function setAppBackground(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:t,badge:a},"",!0),this.appBackgroundOptions={isBackground:t,badge:a||0},c.next=5,this.core.sendCmd("v2SetAppBackground",{isBackground:t,badge:a||0});case 5:case"end":return c.stop()}}),_callee4,this)})))},a.setPushMobileOnDesktopOnline=function setPushMobileOnDesktopOnline(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validate({need:{type:"boolean",required:!1}},{need:t},"",!0),t=void 0===t||t,a.next=5,this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:t}});case 5:case"end":return a.stop()}}),_callee5,this)})))},a.setOfflinePushConfig=function setOfflinePushConfig(t,a){validate(LI,{config:a},"",!0),this.offlinePushPlugin=t,this.offlinePushConfig=a},a.regToken=function regToken(t){var a,c,m,h,g,I,M,T,S,E,C,b,A,N,R,w,k,O,P,x,V,L,D,U,B,q,G,H,j,Y,$,W,z,K,Q,J,X=this,Z=Cp.getSystemInfo()||{},ee=Z.os?Z.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",ee),"ios"===ee||"android"===ee)if(this.offlinePushPlugin&&"function"==typeof this.offlinePushPlugin.getDeviceToken){var te="";t&&t.pushType?te=t.pushType:"ios"===ee?te="":"android"===ee&&(te="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+te);var re={xmAppId:null===(c=null===(a=this.offlinePushConfig)||void 0===a?void 0:a.miPush)||void 0===c?void 0:c.appId,xmAppKey:null===(h=null===(m=this.offlinePushConfig)||void 0===m?void 0:m.miPush)||void 0===h?void 0:h.appKey,xmCertificateName:null===(I=null===(g=this.offlinePushConfig)||void 0===g?void 0:g.miPush)||void 0===I?void 0:I.certificateName,hwAppId:null===(T=null===(M=this.offlinePushConfig)||void 0===M?void 0:M.hwPush)||void 0===T?void 0:T.appId,hwCertificateName:null===(E=null===(S=this.offlinePushConfig)||void 0===S?void 0:S.hwPush)||void 0===E?void 0:E.certificateName,oppoAppId:null===(b=null===(C=this.offlinePushConfig)||void 0===C?void 0:C.oppoPush)||void 0===b?void 0:b.appId,oppoAppKey:null===(N=null===(A=this.offlinePushConfig)||void 0===A?void 0:A.oppoPush)||void 0===N?void 0:N.appKey,oppoAppSecret:null===(w=null===(R=this.offlinePushConfig)||void 0===R?void 0:R.oppoPush)||void 0===w?void 0:w.secret,oppoCertificateName:null===(O=null===(k=this.offlinePushConfig)||void 0===k?void 0:k.oppoPush)||void 0===O?void 0:O.certificateName,vivoAppId:null===(x=null===(P=this.offlinePushConfig)||void 0===P?void 0:P.vivoPush)||void 0===x?void 0:x.appId,vivoAppKey:null===(L=null===(V=this.offlinePushConfig)||void 0===V?void 0:V.vivoPush)||void 0===L?void 0:L.appKey,vivoCertificateName:null===(U=null===(D=this.offlinePushConfig)||void 0===D?void 0:D.vivoPush)||void 0===U?void 0:U.certificateName,fcmCertificateName:null===(q=null===(B=this.offlinePushConfig)||void 0===B?void 0:B.fcmPush)||void 0===q?void 0:q.certificateName,mzAppId:null===(H=null===(G=this.offlinePushConfig)||void 0===G?void 0:G.mzPush)||void 0===H?void 0:H.appId,mzAppKey:null===(Y=null===(j=this.offlinePushConfig)||void 0===j?void 0:j.mzPush)||void 0===Y?void 0:Y.appKey,mzCertificateName:null===(W=null===($=this.offlinePushConfig)||void 0===$?void 0:$.mzPush)||void 0===W?void 0:W.certificateName,apnsCertificateName:null===(K=null===(z=this.offlinePushConfig)||void 0===z?void 0:z.apns)||void 0===K?void 0:K.certificateName,honorCertificateName:null===(J=null===(Q=this.offlinePushConfig)||void 0===Q?void 0:Q.honorPush)||void 0===J?void 0:J.certificateName};this.logger.log("OfflinePushService push config",Fc(re,null,2)),this.offlinePushPlugin.getDeviceToken({suggestPushType:te,config:re},(function(t){t?(X.logger.log("OfflinePushService:: token is :"+t),X.pushTokenToServer(te,t)):X.logger.warn("OfflinePushService:: token is empty. Please check your parameters")}))}else this.logger.warn("OfflinePushService: plugin.getDeviceToken is not a function");else this.logger.warn("OfflinePushService: only Android or IOS support offline push")},a.pushTokenToServer=function pushTokenToServer(t,a){var c,m,h,g,I,M,T,S,E="",C=this.offlinePushConfig;switch(t){case"5":E=null===(c=null==C?void 0:C.miPush)||void 0===c?void 0:c.certificateName;break;case"6":E=null===(m=null==C?void 0:C.hwPush)||void 0===m?void 0:m.certificateName;break;case"7":E=null===(h=null==C?void 0:C.mzPush)||void 0===h?void 0:h.certificateName;break;case"8":E=null===(g=null==C?void 0:C.fcmPush)||void 0===g?void 0:g.certificateName;break;case"9":E=null===(I=null==C?void 0:C.vivoPush)||void 0===I?void 0:I.certificateName;break;case"10":E=null===(M=null==C?void 0:C.oppoPush)||void 0===M?void 0:M.certificateName;break;case"11":E=null===(T=null==C?void 0:C.honorPush)||void 0===T?void 0:T.certificateName;break;default:E=null===(S=null==C?void 0:C.apns)||void 0===S?void 0:S.certificateName}if(""===E||void 0===E)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",t);else try{var b=qI.parse("557d1e3cafa43e2589a588270c53d56f"),A=qI.stringify(vM.decrypt(a,b));this.logger.log("OfflinePushService:: token",A),this.core.sendCmd("v2SetDeviceToken",{certificateName:E,pushDeviceToken:A,pushkit:0})}catch(t){return this.logger.log("OfflinePushService:: decrypt error",t),void this.logger.warn("OfflinePushService:: token before decrypt",a)}},V2NIMSettingServiceImpl}(gh);_export({target:"Number",stat:!0},{isNaN:function isNaN(t){return t!=t}});var yM,_M=j.Number.isNaN,IM=Oh({none:0,normal:1,all:3}),MM={normal:0,advanced:1},TM=Oh(MM),SM=Oh({normal:0,owner:1,manager:2}),EM={noVerify:0,needVerify:1,rejectAll:2},CM=Oh(EM),bM={needVerify:0,noVerify:1},AM=Oh(bM),NM={manager:0,all:1},RM=Oh(NM),wM={manager:0,all:1},kM=Oh(wM),OM={manager:0,all:1},PM=Oh(OM);function formatTeam(t){var a,c=["teamId"],m=["level","memberNum","memberUpdateTime","createTime","updateTime"],h=["valid","validToCurrentUser","mute"],g={type:TM,muteType:IM,joinMode:CM,beInviteMode:AM,inviteMode:RM,updateTeamMode:kM,updateExtMode:PM};t.bits;var I=__rest(t,["bits"]);return forEach$1(c).call(c,(function(t){I[t]&&(I[t]=I[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==I[t]&&(I[t]=em(I[t]))})),forEach$1(h).call(h,(function(t){void 0!==I[t]&&(I[t]=1===em(I[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==I[t]&&(I[t]=g[t][I[t]]||I[t])})),I}function formatTeams(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatTeam(t)})):[]}function generateTeam(t){var a,c=qt({},t),m=["avatar","name","intro","announcement","ext"],h={type:MM,joinMode:EM,beInviteMode:bM,inviteMode:NM,updateTeamMode:wM,updateExtMode:OM};return forEach$1(m).call(m,(function(t){void 0!==c[t]&&(c[t]=c[t].toString())})),forEach$1(a=mn(h)).call(a,(function(t){void 0!==c[t]&&(c[t]=h[t][c[t]])})),c}function generatorTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],c={};return void 0!==t.bitConfigMask&&(c.bits=em(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(c[a]=t[a].toString())})),Object.prototype.hasOwnProperty.call(t,"nickInTeam")&&(c.nickInTeam=t.nickInTeam),c}function formatTeamMember(t){var a,c=["teamId"],m=["joinTime","updateTime","bitConfigMask"],h=["active","valid","mute"],g={type:SM},I=t.bits,M=__rest(t,["bits"]);return void 0!==I&&(M.muteTeam=1===em(I),M.bitConfigMask=I),M.id=M.teamId+"-"+M.account,forEach$1(c).call(c,(function(t){M[t]&&(M[t]=M[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==M[t]&&(M[t]=em(M[t]))})),forEach$1(h).call(h,(function(t){void 0!==M[t]&&(M[t]=1===em(M[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==M[t]&&(M[t]=g[t][M[t]]||M[t])})),M}function formatTeamMembers(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatTeamMember(t)})):[]}function generatorMemberByTeam(t,a,c){return void 0===c&&(c="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:c,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersByTeam(t,a,c){return void 0===c&&(c="normal"),a&&a.length>0?map$6(a).call(a,(function(a){return generatorMemberByTeam(t,a,c)})):[]}function formatUser(t){var a=qt({},t);return a.createTime&&(a.createTime=+a.createTime),a.updateTime&&(a.updateTime=+a.updateTime),a.gender&&(a.gender=yM[+a.gender]),a}!function(t){t[t.unknown=0]="unknown",t[t.male=1]="male",t[t.female=2]="female"}(yM||(yM={}));var xM={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},VM={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},LM=invertSerializeMap(VM),DM={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:LM.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:LM.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:VM.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:LM.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:VM.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:LM.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:VM.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:LM.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:VM.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:LM.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:LM.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:VM.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:LM.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:LM.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:LM.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:LM.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:VM.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:VM.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:LM.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:LM.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:LM.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:LM.teamMember},{type:"Long",name:"timetag"}]}},UM={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},FM={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},BM=invertSerializeMap(FM),qM={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:BM.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:BM.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:BM.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:FM.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:BM.user}]}},GM={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},HM={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}};function _createForOfIteratorHelperLoose$4(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$4(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$4(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$4(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$4(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var jM={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:GM,robotInfo:HM,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},YM={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function getSessionId(t,a){return Qp[t.scene]+"-"+(t.to===a?t.from:t.to)}function msgFlow(t,a){return t.from===a?t.to===a?"in":"out":"in"}function formatMsg$1(t,a){var c=a.account,m=a.featureValue,h=a.statusValue,g=a.sessionAck,I=a.msgReceiptTime,M=Qp[t.scene],T=t.to===c?t.from:t.to,S=Zp.default,E=Xp.unread;em(t.isInBlackList)>0?(E=Xp.refused,delete t.isInBlackList):E=t.from===c?I&&I>=+t.time?Xp.receipt:Xp.sent:g&&g>=+t.time?Xp.read:Xp.unread;var C=qt(qt({},format(jM,t)),{scene:M,type:Kp[t.type],fromClientType:Jp[t.fromClientType],flow:msgFlow(t,c),target:T,to:t.to,from:t.from,time:t.time?+t.time:void 0,userUpdateTime:t.userUpdateTime?+t.userUpdateTime:void 0,idClient:t.idClient,sessionId:M+"-"+T,status:Xp[h||E],feature:Zp[m||S]});if("string"==typeof C.attach)try{C.attach=JSON.parse(C.attach)}catch(t){}return"notification"===C.type&&(C.attach=C.attach?function formatNotificationAttach(t){var a,c={};if(c.type=YM[t.id]||t.id,!t.data)return c;var m,h={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},g=t.data;return forEach$1(a=mn(h)).call(a,(function(t){void 0!==g[t]&&(c[h[t]]=g[t])})),g.tinfo&&(c.team=formatTeam(deserialize(g.tinfo,LM.team))),g.uinfos&&(c.users=map$6(m=g.uinfos).call(m,(function(t){return formatUser(deserialize(t,BM.user))}))),void 0!==g.mute&&(c.mute=1===em(g.mute)),c}(C.attach):{}),C}function formatMsgs$1(t,a){return t&&t.length>0?removeDupMsgsByIdClient(map$6(t).call(t,(function(t){return formatMsg$1(t,a)}))):[]}function removeDupMsgsByIdClient(t){for(var a,c,m={},h=_createForOfIteratorHelperLoose$4(t);!(c=h()).done;){var g=c.value,I=m[g.idClient];I&&I.time>g.time||(m[g.idClient]=g)}return map$6(a=mn(m)).call(a,(function(t){return m[t]}))}function processPushInfoInMsg(t,a){void 0===a&&(a=!0);var c=qt({},t);if(c.pushInfo&&a){for(var m in c.pushInfo)"boolean"==typeof c.pushInfo[m]?c[m]=c.pushInfo[m]?1:0:c[m]=c.pushInfo[m];delete c.pushInfo}return c.scene===Qp.team&&c.needForcePush&&(c.forcePushContent=c.forcePushContent||c.pushContent,c.forcePushIDsList=c.forcePushIDsList?c.forcePushIDsList:"#%@all@%#"),c}function generatorMsgForCmd$1(t,a,c,m){t.onSendBefore,t.onUploadStart,t.onUploadDone;var h=t.replyMsg,g=__rest(t,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),I=qt(qt({},formatReverse(jM,g)),{scene:Qp[t.scene],type:Kp[t.type],from:a,fromClientType:16,fromDeviceId:c,fromNick:null==m?void 0:m.nick,userUpdateTime:null==m?void 0:m.updateTime,status:Xp[Xp.sending]});if(I.idClient=I.resendFlag?t.idClient:_m(),!I.idClient)throw new zu("idClient is required to resend a message","idClient","required");return I=processPushInfoInMsg(I,!1),h&&(I.replyMsgFromAccount=h.from,I.replyMsgToAccount=h.to,I.replyMsgTime=+h.time,I.replyMsgIdServer=h.idServer,I.replyMsgIdClient=h.idClient,I.threadMsgFromAccount=h.from,I.threadMsgToAccount=h.to,I.threadMsgTime=+h.time,I.threadMsgIdServer=h.idServer,I.threadMsgIdClient=h.idClient,h.threadMessageInfo&&h.threadMessageInfo.threadMsgIdServer&&(I.threadMsgFromAccount=h.threadMessageInfo.threadMsgFromAccount,I.threadMsgToAccount=h.threadMessageInfo.threadMsgToAccount,I.threadMsgTime=h.threadMessageInfo.threadMsgTime,I.threadMsgIdServer=h.threadMessageInfo.threadMsgIdServer,I.threadMsgIdClient=h.threadMessageInfo.threadMsgIdClient)),I}function formatDeletedMsgs(t,a){return map$6(t).call(t,(function(t){var c;return c=a||(_M(em(t.scene))?t.scene:1===em(t.scene)?"p2p":"team"),{deletedTime:em(t.time),from:t.from,idClient:t.deletedIdClient||t.idClient,idServer:t.deletedIdServer||t.idServer,scene:c,time:em(t.deletedMsgCreateTime),to:t.to,ext:"string"==typeof t.ext?t.ext:null}}))}var $M=Array.prototype.reverse;var WM,zM,KM,QM=function reverse(t){return null==t?t:$M.call(t)},JM=function(){function ModuleService(t){this.core=t}return ModuleService.prototype.processBroadcastMsg=function processBroadcastMsg(t){var a=map$6(t).call(t,(function(t){return qt(qt({},t),{time:em(t.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:map$6(a).call(a,(function(t){return t.id}))}),a},ModuleService}(),XM={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},ZM={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},eT={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},tT=qt(qt({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:objectToJSONString,retConverter:stringToJSONObject},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),rT={msg:tT,recallMsgTag:qt({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},ZM),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},nT=invertSerializeMap(rT),aT={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:rT.msg}],response:[{type:"Property",name:"msg",reflectMapper:nT.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:rT.msg}],response:[{type:"Property",name:"msg",reflectMapper:nT.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:rT.msg}],response:[{type:"Property",name:"msg",reflectMapper:nT.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:nT.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:nT.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:nT.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:nT.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:rT.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:rT.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:rT.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:rT.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:nT.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:nT.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:nT.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:nT.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:nT.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:nT.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:nT.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:nT.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:nT.deleteSelfMsgTag}]}};!function(t){t[t.none=0]="none",t[t.pass=1]="pass",t[t.decline=2]="decline",t[t.read=3]="read",t[t.deleted=4]="deleted",t[t.invalid=5]="invalid"}(WM||(WM={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(zM||(zM={})),function(t){t[t.applyTeam=0]="applyTeam",t[t.rejectTeamApply=1]="rejectTeamApply",t[t.teamInvite=2]="teamInvite",t[t.rejectTeamInvite=3]="rejectTeamInvite",t[t.friendRequest=5]="friendRequest",t[t.deleteFriend=6]="deleteFriend",t[t.recallMsgP2p=7]="recallMsgP2p",t[t.recallMsgTeam=8]="recallMsgTeam",t[t.recallMsgSuperTeam=12]="recallMsgSuperTeam",t[t.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",t[t.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",t[t.applySuperTeam=15]="applySuperTeam",t[t.rejectSuperTeamApply=16]="rejectSuperTeamApply",t[t.superTeamInvite=17]="superTeamInvite",t[t.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",t[t.customP2p=100]="customP2p",t[t.customTeam=101]="customTeam",t[t.customSuperTeam=103]="customSuperTeam"}(KM||(KM={}));var iT={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var oT={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:XM,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function formatSystemMessage(t,a,c){var m=+t.type,h=getEnumKeyByEnumValue(KM,m);c=c||zM.default;var g=qt(qt({},format(oT,t)),{type:h,time:+t.time,to:t.to,from:t.from,idServer:t.idServer,state:WM[WM.none],feature:zM[c]});if("0"===g.idServer&&g.setting&&(g.setting.needSaveOffline=!1),"string"==typeof g.attach)try{g.attach=JSON.parse(g.attach)}catch(t){a.error("formatSystemMessage: "+g.idServer+" parse attach error",t&&t.message)}return 5===m&&g.attach?(g.attach.type=iT[+g.attach.vt],"passFriendApply"===g.attach.type?g.state=WM[WM.pass]:"rejectFriendApply"===g.attach.type&&(g.state=WM[WM.decline])):m<=3&&g.attach&&(g.attach=function formatTeamAttach(t){var a=t.attach,c=t.tinfo,m=__rest(t,["attach","tinfo"]);return m.ext=a,void 0!==c&&(m.team=formatTeam(deserialize(t.tinfo,LM.team))),m}(g.attach)),g}function generatorSysMsgForCmd$1(t){var a=qt({},t);return qt(qt({},formatReverse(oT,a)),{type:KM[a.type],to:a.to,attach:a.attach})}function getSceneFromRecallSysMsg(t){return t===KM.recallMsgP2p?"p2p":t===KM.recallMsgTeam?"team":t===KM.recallMsgSuperTeam?"superTeam":""}var sT=function(t){function MsgService(a){var c;return(c=t.call(this,"msg",a)||this).onV2SendMessage=function(t){var a=formatMsg$1(t,{account:c.core.account,featureValue:Zp.default});a.status=t.status,c.core.eventBus.emit("session/updateForNewMsg",a)},c.onV2ModifyMessage=function(t){var a,m=Qp[t.scene]+"-"+(t.to===c.core.account?t.from:t.to),h=null===(a=c.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:m}),g=formatMsg$1(t,h?{account:c.core.account,sessionAck:h.ack,msgReceiptTime:h.msgReceiptTime}:{account:c.core.account});c.core.eventBus.emit("session/updateForModifyMsg",g)},c.onV2RecallMsg=function(t){var a=formatDeletedMsgs([t],getSceneFromRecallSysMsg(+t.type));c.core.eventBus.emit("session/updateForDeletedMsg",a)},c.onV2DeleteSelfMsgs=function(t){var a=formatDeletedMsgs(t);c.core.eventBus.emit("session/updateForDeletedMsg",a)},c.service=new JM(a),registerParser({cmdMap:eT,cmdConfig:aT}),c.registerListener(),c}kt(MsgService,t);var a=MsgService.prototype;return a.registerListener=function registerListener(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},a.sendTextMsg=function sendTextMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(qt(qt({},t),{type:"text"}))},a.sendTipMsg=function sendTipMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(qt(qt({},t),{type:"tip"}))},a.sendGeoLocationMsg=function sendGeoLocationMsg(t){return validate({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},t),this.sendMsg(qt(qt({},t),{type:"geo",attach:Fc(t.attach)}))},a.sendCustomMsg=function sendCustomMsg(t){return validate({attach:{type:"string",allowEmpty:!1}},t),this.sendMsg(qt(qt({},t),{type:"custom"}))},a.sendMsg=function sendMsg(t){var a,c=this;if(validate({scene:{type:"enum",values:getEnumKeys(Qp)},type:{type:"enum",values:getEnumKeys(Kp)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:GM},robotInfo:{type:"object",required:!1,rules:HM},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},t),"team"===t.scene&&t.robotInfo&&!t.robotInfo.account)throw new $u('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var m,h="p2p"===t.scene?"sendMsg":"team"===t.scene?"sendTeamMsg":"sendSuperTeamMsg",g=generatorMsgForCmd$1(t,this.core.account,this.core.config.deviceId,null===(a=this.core.user)||void 0===a?void 0:a.myInfo),I=formatMsg$1(qt(qt({},g),{time:(new Date).getTime()}),{account:this.core.account,featureValue:Zp.default,statusValue:Xp.sending});try{t.onSendBefore&&t.onSendBefore(I)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return this.core.eventBus.emit("session/updateForNewMsg",I),this.core.eventBus.emit("forwardSend/msg/sendMsg",g),this.core.sendCmd(h,{msg:g}).then((function(a){var h=a.content,M=a.error;if(m=h.msg,M)throw M;var T=formatMsg$1(qt(qt({},g),h.msg),{account:c.core.account,featureValue:Zp.default,statusValue:Xp.sent});return T.from===T.to&&c.markMsgsAck([T]),c.core.eventBus.emit("session/updateForNewMsg",T),c.core.eventBus.emit("forwardSend/msg/sendMsg",qt(qt({},generatorMsgForCmd$1(T,T.from,T.fromDeviceId)),{idClient:T.idClient,status:"sent"})),c.core.reporter.report("msgSend",{msgId:T.idServer,clientId:T.idClient,msgTime:T.time,fromAccid:"p2p"===t.scene?c.core.account:"",toAccid:T.to,type:Qp[T.scene],roomId:"",tid:"p2p"===t.scene?"":T.to,result:200,failReason:"",rt:wi()-I.time}),T})).catch((function(a){var h=formatMsg$1(qt(qt(qt({},g),{time:(new Date).getTime()}),m),{account:c.core.account,featureValue:Zp.default,statusValue:7101===a.code?Xp.refused:Xp.sendFailed});throw a.msg=h,c.core.eventBus.emit("session/updateForNewMsg",h),c.core.eventBus.emit("forwardSend/msg/sendMsg",qt(qt({},generatorMsgForCmd$1(h,h.from,h.fromDeviceId)),{status:"sendFailed"})),c.core.reporter.report("msgSend",{msgId:h.idServer,clientId:h.idClient,msgTime:h.time,fromAccid:"p2p"===t.scene?c.core.account:"",toAccid:h.to,type:Qp[h.scene],roomId:"",tid:"p2p"===t.scene?"":h.to,result:null==a?void 0:a.code,failReason:(null==a?void 0:a.message)||"",rt:wi()-I.time}),a}))},a.resendMsg=function resendMsg(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},t),a=t.msg,c=qt(qt({},a),{attach:a.attach?Fc(a.attach):void 0,setting:{resendFlag:!0}}),a.from===this.core.account){m.next=5;break}throw new Error("You can only resend messages that you sent: "+a.idClient);case 5:return m.abrupt("return",this.sendMsg(c));case 6:case"end":return m.stop()}}),_callee,this)})))},a.forwardMsg=function forwardMsg(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c;return Dc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:getEnumKeys(Qp)},to:{type:"string",allowEmpty:!1}},t),a=t.msg,c=qt(qt({},a),{scene:t.scene,to:t.to,attach:a.attach?Fc(a.attach):void 0}),m.abrupt("return",this.sendMsg(c));case 4:case"end":return m.stop()}}),_callee2,this)})))},a.sendImageMsg=function sendImageMsg(t){return this.doSendFile(qt(qt({},t),{type:"image"}))},a.sendFileMsg=function sendFileMsg(t){return this.doSendFile(qt(qt({},t),{type:"file"}))},a.sendAudioMsg=function sendAudioMsg(t){return this.doSendFile(qt(qt({},t),{type:"audio"}))},a.sendVideoMsg=function sendVideoMsg(t){return this.doSendFile(qt(qt({},t),{type:"video"}))},a.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({scene:{type:"enum",values:getEnumKeys(Qp)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){c.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){c.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return c.prev=5,c.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=c.sent,c.next=15;break;case 11:throw c.prev=11,c.t0=c.catch(5),this.logger.error("sendFile:: upload File error or abort.",c.t0),c.t0;case 15:return c.abrupt("return",this.sendMsg(qt(qt({},t),{attach:Fc(a),type:t.type})));case 16:case"end":return c.stop()}}),_callee3,this,[[5,11]])})))},a.recallMsg=function recallMsg(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m,h,g,I;return Dc.wrap((function _callee4$(M){for(;;)switch(M.prev=M.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:getEnumKeys(Qp)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:XM},ps:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msg,c={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},m={p2p:7,team:8,superTeam:12},h=processPushInfoInMsg({time:a.time,type:m[a.scene],to:a.to,from:a.from,ps:t.ps,attach:t.attach,deletedIdClient:a.idClient,deletedIdServer:a.idServer,opeAccount:a.from,env:t.env,pushInfo:t.pushInfo}),M.next=7,this.core.sendCmd(c[a.scene],{recallMsgTag:h});case 7:return g=qt({},a,{deletedMsgCreateTime:a.time}),I=formatDeletedMsgs([g]),this.core.eventBus.emit("session/updateForDeletedMsg",I),this.core.eventBus.emit("forwardSend/msg/recallMsg",h),M.abrupt("return",a);case 12:case"end":return M.stop()}}),_callee4,this)})))},a.deleteSelfMsgs=function deleteSelfMsgs(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a,c,m,h,g;return Dc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return validate({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msgs,c=map$6(a).call(a,(function(a){return{scene:"p2p"===a.scene?1:2,from:a.from,to:a.to,idServer:a.idServer,idClient:a.idClient,deletedMsgCreateTime:a.time,ext:t.ext}})),I.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:c});case 5:return m=I.sent,h=map$6(c).call(c,(function(t){var a;return qt({},t,{time:null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.timetag})})),g=formatDeletedMsgs(h),this.core.eventBus.emit("session/updateForDeletedMsg",g),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",map$6(c).call(c,(function(t){var a;return qt(qt({},t),{time:null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.timetag})}))),I.abrupt("return",g);case 11:case"end":return I.stop()}}),_callee5,this)})))},a.sendMsgReceipt=function sendMsgReceipt(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var m,h,g,I;return Dc.wrap((function _callee6$(M){for(;;)switch(M.prev=M.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),"p2p"===(m=t.msg).scene&&"in"===m.flow){M.next=5;break}return this.logger.warn("Msg scene: "+m.scene+", flow: "+m.flow+" is not allowed to send msg receipt"),M.abrupt("return",void 0);case 5:return h={to:m.target,idClient:m.idClient,time:m.time},M.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:h});case 8:return g=M.sent,I=em(null===(c=null===(a=g.content)||void 0===a?void 0:a.msgReceiptTag)||void 0===c?void 0:c.time),M.abrupt("return",qt(qt({},h),{time:I?Math.min(I,h.time):h.time}));case 11:case"end":return M.stop()}}),_callee6,this)})))},a.sendTeamMsgReceipt=function sendTeamMsgReceipt(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var a;return Dc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},t),a=t.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:a}),c.abrupt("return",void 0);case 4:case"end":return c.stop()}}),_callee7,this)})))},a.getTeamMsgReads=function getTeamMsgReads(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var c,m,h;return Dc.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),c=t.teamMsgReceipts,g.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:c});case 4:return m=g.sent,h=(h=null===(a=m.content)||void 0===a?void 0:a.teamMsgReceipts)?map$6(h).call(h,(function(t){return qt(qt({},t),{read:em(t.read),unread:em(t.unread)})})):[],g.abrupt("return",h);case 8:case"end":return g.stop()}}),_callee8,this)})))},a.getTeamMsgReadAccounts=function getTeamMsgReadAccounts(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a,c;return Dc.wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),a=t.teamMsgReceipt,m.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:a});case 4:return c=m.sent,m.abrupt("return",c.content);case 6:case"end":return m.stop()}}),_callee9,this)})))},a.markMsgsAck=function markMsgsAck(t){if(t&&t.length>0){var a=[],c=[];forEach$1(t).call(t,(function(t){"p2p"===t.scene&&"in"===t.flow?a.push(t):"team"===t.scene&&"in"===t.flow&&c.push(t)})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:map$6(a).call(a,(function(t){return t.idServer}))}),c.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:map$6(c).call(c,(function(t){return t.idServer}))})}},a.onMsgHandler=function onMsgHandler(t){var a;if(t.error)this.logger.error("msgHandler::recvError",t.error);else{var c="number"==typeof ws(t,"raw.r[0]")?""+t.raw.r[0]:void 0,m=t.content.msg;m.idServer=m.idServer||c;var h=getSessionId(m,this.core.account),g=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:h}),I=formatMsg$1(m,g?{account:this.core.account,sessionAck:g.ack,msgReceiptTime:g.msgReceiptTime}:{account:this.core.account});"debug"===this.core.options.debugLevel?this.logger.debug("msgHandler::recvMsg",I.idClient,I.idServer,I):this.logger.log("msgHandler::recvMsg",I.idClient,I.idServer),this.markMsgsAck([I]),this.core.eventBus.emit("session/updateForNewMsg",I),"superTeam"===I.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:I.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:I.time}),this.core.emit("msg",I),"notification"===I.type?this.core.eventBus.emit("team/onNotification",I):"out"!==I.flow&&this.doMsgReceiveReport(I,t),"notification"!==I.type&&this.core.user.checkUserUpdate(I)}},a.doMsgReceiveReport=function doMsgReceiveReport(t,a){if(t.from!==this.core.account){var c="p2p"===t.scene,m=ws(t,"__clientExt.statistics.apiCallingTime")||0,h=ws(t,"__clientExt.statistics.sendTime")||0,g=ws(t,"__clientExt.statistics.attachUploadDuration")||0,I=this.core.timeOrigin.getNTPTime(),M=t.time,T=this.core.timeOrigin.checkNodeReliable(a.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(a.__receiveTimeNode):I;this.core.reporter.report("msgReceive",{msgId:t.idServer,clientId:t.idClient,serverTime:M,receiveTime:T,fromAccid:c?t.from:"",toAccid:t.to,type:Qp[t.scene],tid:c?"":t.to,apiCallingTime:m,sendTime:h,attachUploadDuration:g,callbackTime:I,preHandleTime:I,result:200,failReason:"",rt:I-M})}},a.nimOnTeamMsgsHandler=function nimOnTeamMsgsHandler(t){var a,c=this;forEach$1(a=t.content.datas).call(a,(function(a){c.onMsgHandler(qt({},t,{content:{msg:a}}))}))},a.syncRoamingMsgsHandler=function syncRoamingMsgsHandler(t){var a,c,m=t.content.msgs||[];if(0!==m.length){var h=getSessionId(m[0],this.core.account),g=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:h}),I=(m=formatMsgs$1(m,g?{account:this.core.account,featureValue:Zp.roam,sessionAck:g.ack,msgReceiptTime:g.msgReceiptTime}:{account:this.core.account,featureValue:Zp.roam}))[0].time,M={timetag:I,sessionId:h,msgs:QM(m)};(null===(c=this.core.sync)||void 0===c?void 0:c.getSyncDoneFlag())||this.core.eventBus.emit("session/syncMsgs",M),this.core.emit("syncRoamingMsgs",M),"superTeam"===m[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:I}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:I})}},a.syncOfflineMsgsHandler=function syncOfflineMsgsHandler(t){var a,c=this,m=t.content.msgs||[];if(0!==m.length){var h={},g=[];forEach$1(m).call(m,(function(t){var a=getSessionId(t,c.core.account),m=c.core.session.getSessionWithUncomplete({id:a}),I=formatMsg$1(t,m?{account:c.core.account,featureValue:Zp.leave,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:c.core.account,featureValue:Zp.leave});g.push(I),h[I.sessionId]?h[I.sessionId].push(I):h[I.sessionId]=[I]})),this.markMsgsAck(g);var I=0;forEach$1(a=mn(h)).call(a,(function(t){var a,m=sort(a=h[t]).call(a,(function(t,a){return a.time-t.time}));(m=removeDupMsgsByIdClient(m))[0].time>I&&(I=m[0].time);var g={timetag:m[0].time,sessionId:t,msgs:m};c.core.eventBus.emit("session/syncMsgs",g),c.core.emit("syncOfflineMsgs",g)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:I})}},a.syncDeleteSelfMsgsHandler=function syncDeleteSelfMsgsHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.deletedMsgs;c&&c.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var m=c[c.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:m})},a.onDeleteSelfMsgHandler=function onDeleteSelfMsgHandler(t){var a=formatDeletedMsgs([t.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onDeleteSelfMsgsHandler=function onDeleteSelfMsgsHandler(t){var a=formatDeletedMsgs(t.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onBroadcastMsgHandler=function onBroadcastMsgHandler(t){var a=t.content.msg,c=this.service.processBroadcastMsg([a]);this.core.emit("broadcastMsgs",c)},a.syncBroadcastMsgHandler=function syncBroadcastMsgHandler(t){var a=t.content.msgs,c=this.service.processBroadcastMsg(a);this.core.emit("broadcastMsgs",c)},MsgService}(Ev),cT={"6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},lT={notifyDetectTag:{type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105}},uT={getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Oh(lT.notifyDetectTag)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:lT.notifyDetectTag}]}},dT={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}};var pT=function(t){function MiscService(a){var c;return(c=t.call(this,"misc",a)||this).core=a,registerParser({cmdMap:cT,cmdConfig:uT}),c.setListener(),c}kt(MiscService,t);var a=MiscService.prototype;return a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("logined",(function(){t.core.timeOrigin.setOriginTimetick()}))},a.getServerTime=function getServerTime(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t;return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return t=a.sent,a.abrupt("return",em(t.content.time));case 4:case"end":return a.stop()}}),_callee,this)})))},a.notifyDetectHandler=function notifyDetectHandler(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return m=t.content.data,(a=format(dT,m)).t3=t.__receiveTimeNode.time,a.t4=wi(),c.prev=3,c.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:a});case 6:c.next=11;break;case 8:c.prev=8,c.t0=c.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",c.t0);case 11:case"end":return c.stop()}var m}),_callee2,this,[[3,8]])})))},MiscService}(Ev);var mT=function baseSet(t,a,c,m){if(!No(t))return t;for(var h=-1,g=(a=As(a,t)).length,I=g-1,M=t;null!=M&&++h<g;){var T=Ns(a[h]),S=c;if("__proto__"===T||"constructor"===T||"prototype"===T)return t;if(h!=I){var E=M[T];void 0===(S=m?m(E,T,M):void 0)&&(S=No(E)?E:Kd(a[h+1])?[]:{})}Yd(M,T,S),M=M[T]}return t};var hT=function basePickBy(t,a,c){for(var m=-1,h=a.length,g={};++m<h;){var I=a[m],M=Rs(t,I);c(M,I)&&mT(g,As(I,t),M)}return g};var gT=function basePick(t,a){return hT(t,a,(function(a,c){return rv(t,c)}))},vT=mo?mo.isConcatSpreadable:void 0;var fT=function isFlattenable(t){return co(t)||Cd(t)||!!(vT&&t&&t[vT])};var yT=function baseFlatten(t,a,c,m,h){var g=-1,I=t.length;for(c||(c=fT),h||(h=[]);++g<I;){var M=t[g];a>0&&c(M)?a>1?baseFlatten(M,a-1,c,m,h):fg(h,M):m||(h[h.length]=M)}return h};var _T=function flatten(t){return(null==t?0:t.length)?yT(t,1):[]};var IT=function flatRest(t){return mp(cp(t,void 0,_T),t+"")}((function(t,a){return null==t?{}:gT(t,a)}));function _createForOfIteratorHelperLoose$3(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$3(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$3(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$3(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$3(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var MT=function(t){function UserService(a){var c;return(c=t.call(this,"user",a)||this).userInfoMap=new Ml,c.myInfo=formatUser({}),registerParser({cmdMap:UM,cmdConfig:qM}),c}kt(UserService,t);var a=UserService.prototype;return a.setBlack=function setBlack(t){var a=this;return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),this.core.sendCmd("setBlack",t).then((function(){a.core.eventBus.emit("forwardSend/user/updateBlackList",t.account,t.isAdd)}))},a.setMute=function setMute(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),a.next=3,this.core.sendCmd("setMute",t).then((function(){}));case 3:this.core.eventBus.emit("forwardSend/user/setMute",t.account,t.isAdd);case 4:case"end":return a.stop()}}),_callee,this)})))},a.getRelations=function getRelations(){return this.core.sendCmd("syncRelations",{timetag:0})},a.getBlackList=function getBlackList(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var t;return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.blackList||[]);case 4:case"end":return a.stop()}}),_callee2,this)})))},a.getMuteList=function getMuteList(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var t;return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.muteList||[]);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.updatePushToken=function updatePushToken(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return t.stop()}}),_callee4,this)})))},a.updateAppBackground=function updateAppBackground(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return t.stop()}}),_callee5,this)})))},a.getUsersNameCardFromServer=function getUsersNameCardFromServer(t){var a=this;return validate({accounts:{type:"array",max:150,itemType:"string"}},t),this.core.sendCmd("getUsersNameCardFromServer",IT(t,["accounts"])).then((function(c){var m,h=c.content;return a.logger.log("user:: getUsers done",t.accounts),h&&h.users?map$6(m=h.users).call(m,(function(t){return formatUser(t)})):[]}))},a.updateMyNameCard=function updateMyNameCard(t){var a=this;if(validate({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:getEnumKeys(yM),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},t),0===mn(t).length)return Mi.resolve(this.myInfo);var c=IT(t,["nick","avatar","signature","email","birth","tel","ext"]);return t.gender&&(c.gender=yM[t.gender]),this.core.sendCmd("updateMyNameCard",{user:c}).then((function(m){var h=m.content;return h&&h.timetag&&a.core.eventBus.emit("sync/updateTimetag",{myInfo:+h.timetag}),t.gender&&(c.gender=t.gender),a.myInfo=qt({},a.myInfo,c),a.core.eventBus.emit("forwardSend/user/updateUserInfo",c),a.myInfo}))},a.checkUserUpdate=function checkUserUpdate(t){var a=t.from;if(a!==this.core.account){var c=this.userInfoMap.get(a);if(c){var m=c.updateTime,h=t.userUpdateTime;!isNaN(m)&&!isNaN(h)&&"number"==typeof m&&"number"==typeof h&&m<h&&this.refreshUserInfo(a)}else this.refreshUserInfo(a)}},a.refreshUserInfo=function refreshUserInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a,c,m,h;return Dc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.getUsersNameCardFromServer({accounts:[t]});case 2:for(a=g.sent,c=_createForOfIteratorHelperLoose$3(a);!(m=c()).done;)h=m.value,this.userInfoMap.set(h.account,h),this.core.emit("updateUserInfo",h);case 4:case"end":return g.stop()}}),_callee6,this)})))},a.onUpdateBlackListHandler=function onUpdateBlackListHandler(t){var a=t.content;a.account?this.core.emit("updateBlackList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.onUpdateMuteListHandler=function onUpdateMuteListHandler(t){var a=t.content;a.account?this.core.emit("updateMuteList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.syncRelationsHandler=function syncRelationsHandler(t){var a=t.content,c=a.list,m=a.timetag,h={blackList:[],muteList:[]};return m&&this.core.eventBus.emit("sync/updateTimetag",{relations:m}),c&&c.length&&forEach$1(c).call(c,(function(t){var a=function formatRelationMember(t){var a={account:t.account,updateTime:+t.updateTime,createTime:+t.createTime};return"1"===t.isMuted&&(a.isMuted=!0),"1"===t.isBlack&&(a.isBlack=!0),a}(t);a.isBlack&&h.blackList.push(a),a.isMuted&&h.muteList.push(a)})),this.core.emit("relations",h),Mi.resolve(h)},a.syncMyNameCardHandler=function syncMyNameCardHandler(t){t.content.user&&(this.myInfo=formatUser(t.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:t.content.timetag}))},a.onUpdateMyNameCardHandler=function onUpdateMyNameCardHandler(t){var a=t.content.user;a?(qt(this.myInfo,formatUser(a)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},UserService}(Ev),TT=/\s/;var ST=function trimmedEndIndex(t){for(var a=t.length;a--&&TT.test(t.charAt(a)););return a},ET=/^\s+/;var CT=function baseTrim(t){return t?t.slice(0,ST(t)+1).replace(ET,""):t},bT=/^[-+]0x[0-9a-f]+$/i,AT=/^0b[01]+$/i,NT=/^0o[0-7]+$/i,RT=parseInt;var wT=function toNumber(t){if("number"==typeof t)return t;if(Eo(t))return NaN;if(No(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=No(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=CT(t);var c=AT.test(t);return c||NT.test(t)?RT(t.slice(2),c?2:8):bT.test(t)?NaN:+t},kT=1/0;var OT=function toFinite(t){return t?(t=wT(t))===kT||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var PT=function toInteger(t){var a=OT(t),c=a%1;return a==a?c?a-c:a:0},xT=Math.max;var VT=function findIndex(t,a,c){var m=null==t?0:t.length;if(!m)return-1;var h=null==c?0:PT(c);return h<0&&(h=xT(m+h,0)),km(t,sv(a),h)},LT={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},DT={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},UT=invertSerializeMap(DT),FT={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:UT.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:UT.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:DT.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:DT.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:UT.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:DT.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:DT.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:UT.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:UT.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:UT.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:UT.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:UT.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:DT.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[{type:"PropertyArray",name:"datas",reflectMapper:{0:"scene",1:"to",2:"from",7:"time",12:"idServer"}}]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[{type:"Property",name:"context",reflectMapper:{1:"timetag",2:"type"}},{type:"PropertyArray",name:"datas",reflectMapper:UT.sessionReliableSyncTag}]}},BT={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatStickTop(t,a,c){void 0===c&&(c=!0);var m=format(BT,t);m.isStickOnTop=c,m.id=a.id,c||(m.ext="");var h=qt(qt({},a),{stickTopInfo:a.stickTopInfo?qt({},a.stickTopInfo,m):m});return void 0===h.lastMsg&&(h.lastMsg=null),h}var qT=function(){function StickTopService(t){this.core=t}var t=StickTopService.prototype;return t.getSession=function getSession(t){return this.core.session.getSessionWithUncomplete({id:t})||this.core.session.createSession(t)},t.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I;return Dc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),c=a.scene,m=a.accid,M.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===c?"super_team":c)+"|"+m,ext:t.ext||""}});case 4:return h=M.sent,g=this.getSession(t.id),I=formatStickTop(h.content.data,g),M.abrupt("return",I);case 8:case"end":return M.stop()}}),_callee,this)})))},t.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g,I;return Dc.wrap((function _callee2$(M){for(;;)switch(M.prev=M.next){case 0:return validate({id:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.id),c=a.scene,m=a.accid,M.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===c?"super_team":c)+"|"+m}});case 4:return h=M.sent,g=this.getSession(t.id),I=formatStickTop({updateTime:h.content.timetag,ext:""},g,!1),M.abrupt("return",I);case 8:case"end":return M.stop()}}),_callee2,this)})))},t.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m,h,g,I;return Dc.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),c=a.scene,m=a.accid,M.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===c?"super_team":c)+"|"+m,ext:t.ext||""}});case 4:return h=M.sent,g=this.getSession(t.id),I=formatStickTop(h.content.data,g),M.abrupt("return",I);case 8:case"end":return M.stop()}}),_callee3,this)})))},t.stickTopSessionHandler=function stickTopSessionHandler(t,a){void 0===a&&(a=!0);var c=getAccountFromSessionId(t.id,"|"),m=c.scene+"-"+c.accid;return formatStickTop(t,this.getSession(m),a)},StickTopService}(),GT=function(){function UnreadModuleService(t){this.core=t,this.logger=t.logger}var t=UnreadModuleService.prototype;return t.canSessionResetUnreadCount=function canSessionResetUnreadCount(t){var a=t.id;if(void 0===t.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+a+" is not completly, lastMsg undefined");return null!==t.lastMsg||t.unread>0?!(t.ack&&t.lastMsg&&t.ack>=t.lastMsg.time)||(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" reset failed, ack time is greater than last message time"),!1):(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function filterSessionForResetUnreadCount(t){var a=this,c={cmd:"markMultSuperTeamSessionsAck",params:[]},m={cmd:"markMultSessionsAck",params:[]};return forEach$1(t).call(t,(function(t){var h;try{if(!a.canSessionResetUnreadCount(t))return;var g=getAccountFromSessionId(t.id),I=g.accid,M=g.scene,T={to:I,sessionId:t.id,timetag:(null===(h=null==t?void 0:t.lastMsg)||void 0===h?void 0:h.time)||t.updateTime||0},S=function generateSceneForCmd(t){return formatReverse({scene:{type:"enum",values:Qp}},t)}({scene:M});"superTeam"===M?c.params.push(T):m.params.push(qt(qt({},T),S))}catch(t){a.logger.warn(t)}})),{superTeam:c,p2pOrTeam:m}},UnreadModuleService}(),HT=Math.ceil,jT=Math.max;var YT=function chunk(t,a,c){a=(c?gp(t,a,c):void 0===a)?1:jT(PT(a),0);var m=null==t?0:t.length;if(!m||a<1)return[];for(var h=0,g=0,I=Array(HT(m/a));h<m;)I[g++]=lv(t,h,h+=a);return I};function _createForOfIteratorHelperLoose$2(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$2(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$2(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$2(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var $T=function(t){function SessionService(a,c){var m;return(m=t.call(this,"session",a)||this).list=new Ml,m.unreadCountFilterFn=function(t){return!0},m.lastMessageFilterFn=function(t){return!0},m.initEventListeners(),registerParser({cmdMap:LT,cmdConfig:FT}),m.stickTopService=new qT(a),m.unreadModule=new GT(a),c&&m.setOptions(c),m}kt(SessionService,t);var a=SessionService.prototype;return a.setOptions=function setOptions(t){"function"==typeof(null==t?void 0:t.unreadCountFilterFn)&&(this.unreadCountFilterFn=t.unreadCountFilterFn),"function"==typeof(null==t?void 0:t.lastMessageFilterFn)&&(this.lastMessageFilterFn=t.lastMessageFilterFn)},a.reset=function reset(){var t;forEach$1(t=this.list).call(t,(function(t){t.unreadMsgs=[]})),this.list.clear()},a.initEventListeners=function initEventListeners(){var t,a,c,m,h=this;this.core.eventBus.on("session/syncMsgs",bind$1(t=this.onSyncMsgs).call(t,this)),this.core.eventBus.on("session/updateForNewMsg",bind$1(a=this.updateSessionWithMsg).call(a,this)),this.core.eventBus.on("session/updateForModifyMsg",bind$1(c=this.updateSessionByModifyMsg).call(c,this)),this.core.eventBus.on("session/updateForClearMsg",(function(t,a){void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){h.updateSession({id:t.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},a)}))})),this.core.eventBus.on("session/updateForDeletedMsg",bind$1(m=this.updateSessionForDeletedMsg).call(m,this))},a.createSession=function createSession(t,a){try{var c=getAccountFromSessionId(t);return{id:t,scene:c.scene,to:c.accid,lastMsg:a,updateTime:a?a.time:0,unread:0,unreadMsgs:[],ack:0}}catch(a){throw this.logger.error("Failed to create session with "+t,a),new Error("Failed to create session with "+t)}},a.getSession=function getSession(t){validate({id:{type:"string",allowEmpty:!1}},t);var a=this.list.get(t.id);if(this.isSessionComplete(a))return a},a.getSessionWithUncomplete=function getSessionWithUncomplete(t){return this.list.get(t.id)},a.getAllSessions=function getAllSessions(){for(var t,a=[],c=_createForOfIteratorHelperLoose$2(this.list);!(t=c()).done;){var m=t.value;m[0];var h=m[1];this.isSessionComplete(h)&&a.push(h)}return a},a.getSessions=function getSessions(t){validate({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},t);var a=[],c=t.limit,m=void 0===c?100:c,h=t.desc,g=void 0===h||h,I=t.lastSessionId,M=0;if(g){for(var T,S,E=_createForOfIteratorHelperLoose$2(this.list);!(S=E()).done;){var C=S.value,b=C[0],A=C[1];if(I===b)break;this.isSessionComplete(A)&&a.push(A)}return reverse$1(T=slice$1(a).call(a,-m)).call(T)}for(var N,R=_createForOfIteratorHelperLoose$2(this.list);!(N=R()).done;){var w=N.value,k=w[0],O=w[1];if(I)k===I&&(I=void 0);else if(this.isSessionComplete(O)){if(++M>m)break;a.push(O)}}return a},a.resetSessionUnreadCount=function resetSessionUnreadCount(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I,M,T,S,E=this;return Dc.wrap((function _callee$(C){for(;;)switch(C.prev=C.next){case 0:if(validate({id:{type:"string",allowEmpty:!1}},t),validate({id:{type:"string",allowEmpty:!1}},t),c=t.id,m=this.list.get(c)){C.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+c),new Error("Session::canSessionResetUnreadCount: can not find session "+c);case 7:h=!1;try{h=this.unreadModule.canSessionResetUnreadCount(m)}catch(t){this.logger.warn(t)}if(!1!==h){C.next=11;break}return C.abrupt("return");case 11:return g=getAccountFromSessionId(c),I=g.accid,M=g.scene,T={to:I,timetag:(null===(a=null==m?void 0:m.lastMsg)||void 0===a?void 0:a.time)||m.updateTime||0},S="markSuperTeamSessionAck","superTeam"!==M&&(T.scene="p2p"===M?0:1,S="markSessionAck"),C.abrupt("return",this.core.sendCmd(S,T).then((function(){var t=E.storeUnreadByAck(c,T.timetag);t&&E.core.emit("updateSession",t)})));case 16:case"end":return C.stop()}}),_callee,this)})))},a.resetMultiSessionUnreadCount=function resetMultiSessionUnreadCount(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g,I,M,T,S,E,C,b,A,N,R=this;return Dc.wrap((function _callee2$(w){for(;;)switch(w.prev=w.next){case 0:validate({ids:{type:"array",itemType:"string",min:1}},t),m=filter(a=map$6(c=t.ids).call(c,(function(t){return R.list.get(t)}))).call(a,(function(a,c){return!!a||(R.logger.warn("Session::canSessionResetUnreadCount: can not find session "+t.ids[c]),!1)})),h=this.unreadModule.filterSessionForResetUnreadCount(m),g=h.superTeam,I=h.p2pOrTeam,M=YT(g.params,50),T=YT(I.params,50),S=_createForOfIteratorHelperLoose$2(M);case 6:if((E=S()).done){w.next=13;break}return C=E.value,w.next=10,this.core.sendCmd(g.cmd,{datas:C});case 10:forEach$1(C).call(C,(function(t){var a=R.storeUnreadByAck(t.sessionId,t.timetag);a&&R.core.emit("updateSession",a)}));case 11:w.next=6;break;case 13:b=_createForOfIteratorHelperLoose$2(T);case 14:if((A=b()).done){w.next=21;break}return N=A.value,w.next=18,this.core.sendCmd(I.cmd,{datas:N});case 18:forEach$1(N).call(N,(function(t){var a=R.storeUnreadByAck(t.sessionId,t.timetag);a&&R.core.emit("updateSession",a)}));case 19:w.next=14;break;case 21:case"end":return w.stop()}}),_callee2,this)})))},a.resetAllSessionsUnreadCount=function resetAllSessionsUnreadCount(){var t,a=[];return forEach$1(t=this.list).call(t,(function(t){a.push(t.id)})),this.resetMultiSessionUnreadCount({ids:a})},a.deleteSession=function deleteSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},t),this.list.delete(t.id),!this.core.msgLog||!t.isSyncToServer){a.next=5;break}return a.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[t.id]});case 5:case"end":return a.stop()}}),_callee3,this)})))},a.deleteAllSessionsFromLocal=function deleteAllSessionsFromLocal(){this.list.clear()},a.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.stickTopService.addStickTopSession(t);case 2:return a=c.sent,this.list.set(a.id,a),c.abrupt("return",a);case 5:case"end":return c.stop()}}),_callee4,this)})))},a.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a;return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.stickTopService.deleteStickTopSession(t);case 2:return a=c.sent,this.list.set(a.id,a),c.abrupt("return",a);case 5:case"end":return c.stop()}}),_callee5,this)})))},a.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a;return Dc.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.stickTopService.updateStickTopSession(t);case 2:return a=c.sent,this.list.set(a.id,a),c.abrupt("return",a);case 5:case"end":return c.stop()}}),_callee6,this)})))},a.nimMultiSyncAddStickTopSessionHandler=function nimMultiSyncAddStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncDeleteStickTopSessionHandler=function nimMultiSyncDeleteStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler({id:t.content.data.id,updateTime:t.content.timetag,ext:""},!1);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncUpdateStickTopSessionHandler=function nimMultiSyncUpdateStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimSyncStickTopSessionsHandler=function nimSyncStickTopSessionsHandler(t){var a,c=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:t.content.timetag}),t.content.isThereAnyChange){var m=t.content.datas,h=[];forEach$1(a=this.list).call(a,(function(t){var a;t&&(null===(a=null==t?void 0:t.stickTopInfo)||void 0===a?void 0:a.isStickOnTop)&&h.push(t)})),forEach$1(h).call(h,(function(t){var a=t.id;if(!find(m).call(m,(function(t){var c=getAccountFromSessionId(t.id,"|");return c.scene+"-"+c.accid===a}))){var c={},h=getAccountFromSessionId(a,"-"),g=h.scene,I=h.accid;c.id=g+"|"+I,c.ext="",c.isTop=!1,m.push(c)}})),forEach$1(m).call(m,(function(t){var a;!1===t.isTop?(delete t.isTop,a=c.stickTopService.stickTopSessionHandler(t,!1)):a=c.stickTopService.stickTopSessionHandler(t),c.list.set(a.id,a)}))}},a.updateSessionWithMsg=function updateSessionWithMsg(t){var a,c,m=!0,h=!0,g="boolean"!=typeof(null===(a=t.pushInfo)||void 0===a?void 0:a.needPushBadge)||(null===(c=t.pushInfo)||void 0===c?void 0:c.needPushBadge);try{m=!!this.unreadCountFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",t)}try{h=!!this.lastMessageFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",t)}var I=this.list.get(t.sessionId)||this.createSession(t.sessionId),M=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",t.sessionId,t.idClient,t.idServer,h,m),h&&(!I.lastMsg||I.lastMsg.time<t.time||t.status===Xp[Xp.sending]||I.lastMsg.status===Xp[Xp.sending])&&(I.lastMsg=t,I.updateTime=t.time,M=!0),m&&g&&t.status===Xp[Xp.unread]&&t.time>(I.ack||0)){I.unread++;var T=I.unreadMsgs||[];T.unshift(t),sort(T).call(T,(function(t,a){return a.time-t.time})),I.unreadMsgs=T,M=!0}M&&(this.logger.log("session:updateSessionWithMsg updating ",I.id,I.unread,I.lastMsg&&I.lastMsg.idClient),this.list.set(I.id,I),this.core.emit("updateSession",I))},a.updateSessionByModifyMsg=function updateSessionByModifyMsg(t){var a=this.list.get(t.sessionId)||this.createSession(t.sessionId),c=a.unreadMsgs||[],m=findIndex$1(c).call(c,(function(a){return a.idClient===t.idClient}));m>-1&&(c[m]=t),a.unreadMsgs=c,this.list.set(a.id,a);var h=!0;try{h=!!this.lastMessageFilterFn(t)}catch(t){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",t)}h&&(a.lastMsg&&a.lastMsg.idClient!==t.idClient||(a.lastMsg=t,a.updateTime=t.time,this.logger.log("session:updateSessionByModifyMsg updating ",a.id,a.unread,a.lastMsg&&a.lastMsg.idClient),this.list.set(a.id,a),this.core.emit("updateSession",a)))},a.storeUnreadByAck=function storeUnreadByAck(t,a){var c=this.list.get(t)||this.createSession(t);if(!(c.ack&&a<c.ack)){var m=c.unreadMsgs||[],h=[],g=[],I=0;return c.unreadMsgs=[],m.length>0&&(forEach$1(m).call(m,(function(t){includes(g).call(g,t.idClient)||t.time>a&&(I++,g.push(t.idClient),h.push(t))})),c.unreadMsgs=sort(h).call(h,(function(t,a){return a.time-t.time}))),c.ack=a,c.unread=I,c.lastMsg&&"unread"===c.lastMsg.status&&a>=c.lastMsg.time&&(c.lastMsg.status="read"),this.list.set(t,c),c}this.logger.warn("storeUnreadByAck: not need update ack",t,a,c.ack)},a.updateSession=function updateSession(t,a){void 0===a&&(a=!0);var c=t.id,m=this.list.get(c)||this.createSession(t.id),h=qt(m,t);return this.list.set(c,h),this.logger.log("updateSession: update",a,IT(t,["id","ack","unread"]),h.lastMsg&&h.lastMsg.idClient),a&&this.core.emit("updateSession",h),h},a.isSessionComplete=function isSessionComplete(t){return!!t&&(!!(t.id&&t.scene&&t.to)&&void 0!==t.lastMsg)},a.syncSessionAckHandler=function syncSessionAckHandler(t){var a,c,m=this,h=t.content.p2p||{},g=t.content.team.m_map||{};this.logger.log("syncSessionAck::",h,g),forEach$1(a=mn(h)).call(a,(function(t){m.updateSession({id:"p2p-"+t,ack:h[t]},!1)})),forEach$1(c=mn(g)).call(c,(function(t){m.updateSession({id:"team-"+t,ack:g[t]},!1)}))},a.syncSuperTeamSessionAckHandler=function syncSuperTeamSessionAckHandler(t){var a,c=this,m=t.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",m),forEach$1(a=mn(m)).call(a,(function(t){c.updateSession({id:"superTeam-"+t,ack:m[t]},!1)}))},a.syncMarkSessionAckHandler=function syncMarkSessionAckHandler(t){var a=t.content,c=(0===a.scene?"p2p":1===a.scene?"team":"superTeam")+"-"+a.to,m=this.list.get(c);if(m&&m.ack&&a.timetag<m.ack)this.logger.warn("syncMarkSessionAckHandler: "+c+" do not need update ack",m.ack,a.timetag);else{var h=this.storeUnreadByAck(c,a.timetag);h&&this.core.emit("updateSession",h)}},a.syncMarkSuperTeamSessionAckHandler=function syncMarkSuperTeamSessionAckHandler(t){t.content.scene=5,this.syncMarkSessionAckHandler(t)},a.onSyncDone=function onSyncDone(){var t,a,c,m=this,h=[];forEach$1(t=this.list).call(t,(function(t,a){h.push(m.storeUnreadByAck(a,t.ack||0))})),this.list.clear(),forEach$1(a=sort(h).call(h,(function(t,a){return t.updateTime-a.updateTime}))).call(a,(function(t){m.list.set(t.id,t)})),(h=sort(c=filter(h).call(h,(function(t){return m.isSessionComplete(t)}))).call(c,(function(t,a){return a.updateTime-t.updateTime}))).length>0&&this.core.emit("sessions",h)},a.onSyncMsgs=function onSyncMsgs(t){var a,c=this,m=this.list.get(t.sessionId),h=[];try{var g;h=filter(g=t.msgs).call(g,(function(t){var a,m,h="boolean"!=typeof(null===(a=t.pushInfo)||void 0===a?void 0:a.needPushBadge)||(null===(m=t.pushInfo)||void 0===m?void 0:m.needPushBadge);return c.unreadCountFilterFn(JSON.parse(Fc(t)))&&h}))}catch(t){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",t)}var I,M=[];try{var T;M=filter(T=t.msgs).call(T,(function(t){return c.lastMessageFilterFn(JSON.parse(Fc(t)))}))}catch(t){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",t)}M&&M.length>0&&(I=M[M.length-1],I=M[0].time>I.time?M[0]:I);var S=I?I.time:0;m||(m=I?this.createSession(t.sessionId,I):this.createSession(t.sessionId)),m.unreadMsgs=m.unreadMsgs?filter(a=concat(h).call(h,m.unreadMsgs)).call(a,(function(t){return t.status===Xp[Xp.unread]})):filter(h).call(h,(function(t){return t.status===Xp[Xp.unread]})),m.updateTime&&m.updateTime>=S||(m.updateTime=S),m.lastMsg&&m.lastMsg.time>=S||(m.lastMsg=I),this.list.set(m.id,m)},a.updateSessionForDeletedMsg=function updateSessionForDeletedMsg(t){var a,c=this,m={};forEach$1(t).call(t,(function(t){var a,h=t.to===c.core.account?t.from:t.to,g=t.scene+"-"+h,I=c.list.get(g);if(I){var M=some(a=I.unreadMsgs).call(a,(function(a){return a.idClient===t.idClient})),T=!0;try{T=!!c.unreadCountFilterFn(t)}catch(t){c.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",t)}var S=I.ack||0;if(T&&M&&S<t.time&&t.from!==c.core.account&&I.unread>0&&(I.unread=I.unread-1,I.unreadMsgs&&I.unreadMsgs.length>0)){var E,C=VT(I.unreadMsgs,{idClient:t.idClient});C>=0&&splice$1(E=I.unreadMsgs).call(E,C,1)}I.lastMsg&&I.lastMsg.idClient===t.idClient&&(I.lastMsg=null),m[I.id]=!0}})),forEach$1(a=mn(m)).call(a,(function(t){var a=c.list.get(t);a&&c.core.emit("updateSession",a)}))},a.multiSyncMsgReceiptHandler=function multiSyncMsgReceiptHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.msgReceiptTag;if(c){this.updateSessionMsgReceiptTime([c],!0),c.msgReceiptTime=c.time,c.sessionId="p2p-"+c.from,c.time,c.from;var m=__rest(c,["time","from"]);this.core.emit("msgReceipts",[m])}},a.syncMsgReceiptsHandler=function syncMsgReceiptsHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.msgReceipts;c&&this.updateSessionMsgReceiptTime(c,!1)},a.updateSessionMsgReceiptTime=function updateSessionMsgReceiptTime(t,a){var c=this;void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){var m=c.list.get("p2p-"+t.from);m||(m=c.createSession("p2p-"+t.from));var h=em(t.time);m.msgReceiptTime&&m.msgReceiptTime>=h||(m.msgReceiptTime=h,m.lastMsg&&"sent"===m.lastMsg.status&&h>=m.lastMsg.time&&(m.lastMsg.status="receipt"),c.logger.log("session: update session "+m.id+" msgReceiptTime: "+m.msgReceiptTime),c.list.set(m.id,m),a&&c.core.emit("updateSession",m))}))},SessionService}(Ev),WT=function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddTeamMembers=function notifyAddTeamMembers(t,a){this.core.emit("addTeamMembers",{team:t,accounts:a,members:generatorMembersByTeam(t,a)})},t.notifyUpdateTeamManagers=function notifyUpdateTeamManagers(t,a,c,m){this.core.emit("updateTeamManagers",{team:{teamId:t,memberUpdateTime:m},accounts:a,isManager:c,members:map$6(a).call(a,(function(a){return{id:t+"-"+a,account:a,type:c?"manager":"normal",updateTime:m}}))})},t.notifyRemoveTeamMembers=function notifyRemoveTeamMembers(t,a){this.core.emit("removeTeamMembers",{team:t,accounts:a})},t.notifyTransferTeam=function notifyTransferTeam(t,a,c){this.core.emit("transferTeam",{team:t,from:{id:t.teamId+"-"+a,type:"normal",account:a,updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+c,type:"owner",account:c,updateTime:t.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function notifyUpdateTeamMembersMute(t,a,c){this.core.emit("updateTeamMembersMute",{team:t,accounts:a,members:map$6(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:c,updateTime:t.memberUpdateTime}})),mute:c})},ModuleService}();var zT=function arrayEach(t,a){for(var c=-1,m=null==t?0:t.length;++c<m&&!1!==a(t[c],c,t););return t};var KT=function baseAssign(t,a){return t&&$d(a,fm(a),t)};var QT=function baseAssignIn(t,a){return t&&$d(a,tp(a),t)};var JT=function copySymbols(t,a){return $d(t,Eg(t),a)},XT=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)fg(a,Eg(t)),t=vd(t);return a}:Ig;var ZT=function copySymbolsIn(t,a){return $d(t,XT(t),a)};var eS=function getAllKeysIn(t){return yg(t,tp,XT)},tS=Object.prototype.hasOwnProperty;var rS=function initCloneArray(t){var a=t.length,c=new t.constructor(a);return a&&"string"==typeof t[0]&&tS.call(t,"index")&&(c.index=t.index,c.input=t.input),c};var nS=function cloneDataView(t,a){var c=a?ud(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.byteLength)},aS=/\w*$/;var iS=function cloneRegExp(t){var a=new t.constructor(t.source,aS.exec(t));return a.lastIndex=t.lastIndex,a},oS=mo?mo.prototype:void 0,sS=oS?oS.valueOf:void 0;var cS=function cloneSymbol(t){return sS?Object(sS.call(t)):{}};var lS=function initCloneByTag(t,a,c){var m=t.constructor;switch(a){case"[object ArrayBuffer]":return ud(t);case"[object Boolean]":case"[object Date]":return new m(+t);case"[object DataView]":return nS(t,c);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return dd(t,c);case"[object Map]":case"[object Set]":return new m;case"[object Number]":case"[object String]":return new m(t);case"[object RegExp]":return iS(t);case"[object Symbol]":return cS(t)}};var uS=function baseIsMap(t){return So(t)&&"[object Map]"==Gg(t)},dS=Bd&&Bd.isMap,pS=dS?Fd(dS):uS;var mS=function baseIsSet(t){return So(t)&&"[object Set]"==Gg(t)},hS=Bd&&Bd.isSet,gS=hS?Fd(hS):mS,vS="[object Arguments]",fS="[object Function]",yS="[object Object]",_S={};_S[vS]=_S["[object Array]"]=_S["[object ArrayBuffer]"]=_S["[object DataView]"]=_S["[object Boolean]"]=_S["[object Date]"]=_S["[object Float32Array]"]=_S["[object Float64Array]"]=_S["[object Int8Array]"]=_S["[object Int16Array]"]=_S["[object Int32Array]"]=_S["[object Map]"]=_S["[object Number]"]=_S[yS]=_S["[object RegExp]"]=_S["[object Set]"]=_S["[object String]"]=_S["[object Symbol]"]=_S["[object Uint8Array]"]=_S["[object Uint8ClampedArray]"]=_S["[object Uint16Array]"]=_S["[object Uint32Array]"]=!0,_S["[object Error]"]=_S[fS]=_S["[object WeakMap]"]=!1;var IS=function baseClone(t,a,c,m,h,g){var I,M=1&a,T=2&a,S=4&a;if(c&&(I=h?c(t,m,h,g):c(t)),void 0!==I)return I;if(!No(t))return t;var E=co(t);if(E){if(I=rS(t),!M)return pd(t,I)}else{var C=Gg(t),b=C==fS||"[object GeneratorFunction]"==C;if(wd(t))return cd(t,M);if(C==yS||C==vS||b&&!h){if(I=T||b?{}:_d(t),!M)return T?ZT(t,QT(I,t)):JT(t,KT(I,t))}else{if(!_S[C])return h?t:{};I=lS(t,C,M)}}g||(g=new nd);var A=g.get(t);if(A)return A;g.set(t,I),gS(t)?t.forEach((function(m){I.add(baseClone(m,a,c,m,t,g))})):pS(t)&&t.forEach((function(m,h){I.set(h,baseClone(m,a,c,h,t,g))}));var N=E?void 0:(S?T?eS:Cg:T?tp:fm)(t);return zT(N||t,(function(m,h){N&&(m=t[h=m]),Yd(I,h,baseClone(m,a,c,h,t,g))})),I};var MS=function cloneDeep(t){return IS(t,5)},TS=function(t){function TeamService(a){var c;return(c=t.call(this,"team",a)||this).myTeamMembersMap=new Ml,c.service=new WT(a),c.setListeners(),registerParser({cmdMap:xM,cmdConfig:DM}),c}kt(TeamService,t);var a=TeamService.prototype;return a.setListeners=function setListeners(){var t=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",(function(a){t.emitMemberUpdate(a)})),this.core.eventBus.on("team/onNotification",(function(a){return t.notificationHandler(a)}))},a.reset=function reset(){this.myTeamMembersMap.clear()},a.mergeMyTeamMembers=function mergeMyTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.teamId,m=a.myTeamMembersMap.get(c),h=qt({},m,t);a.myTeamMembersMap.set(c,h)}))},a.getTeamInfo=function getTeamInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getTeamInfo",{teamId:t.teamId});case 3:return a=m.sent,c=a.content.team,m.abrupt("return",formatTeam(c));case 6:case"end":return m.stop()}}),_callee,this)})))},a.getTeams=function getTeams(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var t,a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=c.sent,a=t.content.teams,c.abrupt("return",formatTeams(a));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.getTeamsById=function getTeamsById(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c;return Dc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamIds:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("getTeamsById",{teamIds:t.teamIds});case 3:return a=m.sent,c=formatTeams(a.content.teams),m.abrupt("return",{teams:c,tids:a.content.tids});case 6:case"end":return m.stop()}}),_callee3,this)})))},a.createTeam=function createTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m;return Dc.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateTeam(t),h.next=4,this.core.sendCmd("createTeam",{team:a,accounts:t.accounts||[],ps:t.ps||""});case 4:return c=h.sent,m=formatTeam(c.content.team),this.core.eventBus.emit("forwardSend/team/created",m),h.abrupt("return",m);case 8:case"end":return h.stop()}}),_callee4,this)})))},a.dismissTeam=function dismissTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("dismissTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.leaveTeam=function leaveTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee6,this)})))},a.transferTeam=function transferTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferTeam",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateTeamInfo=function updateTeamInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a;return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateTeam(t),c.next=4,this.core.sendCmd("updateTeamInfo",{team:a});case 4:return c.abrupt("return",formatTeam(a));case 5:case"end":return c.stop()}}),_callee8,this)})))},a.getTeamMembers=function getTeamMembers(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var c,m;return Dc.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},t),h.next=3,this.core.sendCmd("getTeamMembers",{teamId:t.teamId,timetag:0});case 3:if(c=h.sent,m=formatTeamMembers(null===(a=c.content)||void 0===a?void 0:a.teamMembers),t.accounts&&t.accounts.length>0){h.next=7;break}return h.abrupt("return",m);case 7:return h.abrupt("return",filter(m).call(m,(function(a){var c;return null===(c=t.accounts)||void 0===c?void 0:includes(c).call(c,a.account)})));case 8:case"end":return h.stop()}}),_callee9,this)})))},a.getMutedTeamMembers=function getMutedTeamMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a,c;return Dc.wrap((function _callee10$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:t.teamId});case 3:return a=m.sent,c=a.content,m.abrupt("return",formatTeamMembers(c.teamMembers));case 6:case"end":return m.stop()}}),_callee10,this)})))},a.addTeamMembers=function addTeamMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.removeTeamMembers=function removeTeamMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){return Dc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee12,this)})))},a.applyTeam=function applyTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a;return Dc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),c.next=3,this.core.sendCmd("applyTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=c.sent,c.abrupt("return",formatTeam(a.content.team));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.addTeamManagers=function addTeamManagers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){return Dc.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addTeamManagers",t);case 3:case"end":return a.stop()}}),_callee14,this)})))},a.removeTeamManagers=function removeTeamManagers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){return Dc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeTeamManagers",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a,c,m;return Dc.wrap((function _callee16$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),h.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:a});case 4:return c=formatTeamMember(qt({updateTime:(new Date).getTime(),account:this.core.account},a)),m=this.emitMemberUpdate(c),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",m),h.abrupt("return",c);case 8:case"end":return h.stop()}}),_callee16,this)})))},a.emitMemberUpdate=function emitMemberUpdate(t){t=formatTeamMember(t),this.mergeMyTeamMembers([t]),this.core.emit("updateTeamMember",t);var a=MS(this.myTeamMembersMap.get(t.teamId));return this.core.emit("myTeamMembers",[a]),a},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){var a,c;return Dc.wrap((function _callee17$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),m.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:a});case 4:return c=formatTeamMember(qt({updateTime:(new Date).getTime()},a)),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee17,this)})))},a.muteTeamMember=function muteTeamMember(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){return Dc.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeamMember",{teamId:t.teamId,account:t.account,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getTeamMemberInvitorAccid=function getTeamMemberInvitorAccid(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){var c,m;return Dc.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},t),c={teamId:t.teamId},t.accounts&&t.accounts.length>0&&(c.accounts=t.accounts),h.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",c);case 5:return m=h.sent,h.abrupt("return",(null===(a=m.content)||void 0===a?void 0:a.accountsMap)||{});case 7:case"end":return h.stop()}}),_callee19,this)})))},a.muteTeam=function muteTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){return Dc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.passTeamApply=function passTeamApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var a;return Dc.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("passTeamApply",t);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee21,this,[[1,7]])})))},a.rejectTeamApply=function rejectTeamApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){var a;return Dc.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee22,this,[[1,7]])})))},a.acceptTeamInvite=function acceptTeamInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee23(){var a;return Dc.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("acceptTeamInvite",t);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee23,this,[[1,7]])})))},a.rejectTeamInvite=function rejectTeamInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){var a;return Dc.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee24,this,[[1,7]])})))},a.notifyTeamMsgReceiptsHandler=function notifyTeamMsgReceiptsHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.teamMsgReceipts;c&&c.length>0&&(this.core.emit("teamMsgReceipts",c),this.core.emit("msgReceipts",c))},a.syncTeamsHandler=function syncTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{teams:em(a.timetag)});var c=null==a?void 0:a.teams;if(c&&c.length){var m=formatTeams(c);this.core.emit("teams",m)}},a.syncCreateTeamHandler=function syncCreateTeamHandler(t){var a=t.content,c=formatTeam(null==a?void 0:a.team),m=generatorMemberByTeam(c,c.owner,"owner");this.core.emit("createTeam",c,m)},a.syncUpdateTeamMemberHandler=function syncUpdateTeamMemberHandler(t){var a=t.content,c=formatTeamMember(null==a?void 0:a.teamMember);c.updateTime||(c.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([c]),this.core.emit("updateTeamMember",c);var m=MS(this.myTeamMembersMap.get(c.teamId));this.core.emit("myTeamMembers",[m])},a.syncMyTeamMembersHandler=function syncMyTeamMembersHandler(t){var a,c=t.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:em(c.timetag)});var m=null==c?void 0:map$6(a=c.teamMembers).call(a,(function(t){return formatTeamMember(t)}));this.mergeMyTeamMembers(m),this.core.emit("myTeamMembers",MS(m))},a.notificationHandler=function notificationHandler(t){var a=t.attach,c=t.scene,m=t.from,h=t.to,g=t.time,I=t.idServer,M=t.idClient,T=a.team,S=a.account,E=a.accounts,C=a.type;if("team"===c)switch("debug"===this.core.options.debugLevel?this.logger.debug("team::recvNotification",I,M,a):this.logger.log("team::recvNotification",I,M,h,C,S,E),C){case"updateTeam":T.updateTime=g,this.core.emit("updateTeam",T);break;case"addTeamMembers":this.service.notifyAddTeamMembers(T,E);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(T,[m]);break;case"passTeamApply":this.service.notifyAddTeamMembers(T,[S]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(h,E,!0,g);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(h,E,!1,g);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(T,E);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(T,[m]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:h});break;case"transferTeam":this.service.notifyTransferTeam(T,m,S);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(T,[S],a.mute)}},TeamService}(Ev),SS={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","4_101":"syncOfflineSysMsgs","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg","101_3":"onSysMsg","101_7":"sendFilterCustomSysMsg"},ES={sysMsg:qt({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},ZM)},CS=invertSerializeMap(ES),bS={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:CS.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:ES.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:ES.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:ES.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:CS.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:CS.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:CS.sysMsg}]}},AS=function(t){function SystemMessageService(a){var c;return(c=t.call(this,"systemMessage",a)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},c.core.eventBus.on("logined",(function(){c.initEventListeners()})),registerParser({cmdMap:SS,cmdConfig:bS}),c}kt(SystemMessageService,t);var a=SystemMessageService.prototype;return a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"decline",type:"friendRequest"}])}))},a.doMarkSysMsgAck=function doMarkSysMsgAck(t){var a=[],c=[],m=["customSuperTeam"];forEach$1(t).call(t,(function(t){t.idServer&&(includes(m).call(m,t.type)?c.push(t.idServer):a.push(t.idServer))})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:a}),c.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:c})},a.sendCustomSysMsg=function sendCustomSysMsg(t){var a=this;validate({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:XM}},t);var c="customSuperTeam"===t.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(c,{sysMsg:generatorSysMsgForCmd$1(t)}).then((function(){a.logger.log("sendCustomSysMsg success")})).catch((function(t){throw a.logger.error("sendCustomSysMsg failed",t.message),t}))},a.onSysMsgHandler=function onSysMsgHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.sysMsg;if(c){var m="number"==typeof ws(t,"raw.r[0]")?""+t.raw.r[0]:void 0;c.idServer=c.idServer||m;var h=formatSystemMessage(c,this.logger,zM.default);this.core.emit("sysMsg",h),this.doMarkSysMsgAck([h])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncOfflineSysMsgsHandler=function syncOfflineSysMsgsHandler(t){var a,c=this;if(t.content.sysMsgs&&t.content.sysMsgs.length>0){var m=map$6(a=t.content.sysMsgs).call(a,(function(t){return formatSystemMessage(t,c.logger,zM.leave)}));this.core.emit("syncSysMsgs",m),this.doMarkSysMsgAck(m)}},a.onRecallMsgHandler=function onRecallMsgHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.sysMsg;if(c){var m="number"==typeof ws(t,"raw.r[0]")?""+t.raw.r[0]:void 0;c.idServer=c.idServer||m;var h=formatDeletedMsgs([c],getSceneFromRecallSysMsg(+c.type));this.core.eventBus.emit("session/updateForDeletedMsg",h);var g=formatSystemMessage(c,this.logger,zM.default);this.core.emit("sysMsg",g),this.doMarkSysMsgAck([g])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncRecallMsgOfflineAndRoamingHandler=function syncRecallMsgOfflineAndRoamingHandler(t){var a=this,c=t.content,m=c.timetag,h=c.type,g=c.sysMsgs,I=em(h),M=1===I?zM.leave:zM.roam,T=map$6(g).call(g,(function(t){return formatSystemMessage(t,a.logger,M)}));1===I&&this.doMarkSysMsgAck(T),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:m}),this.core.emit("syncSysMsgs",T)},SystemMessageService}(Ev);function reverseFriend(t){var a=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],c=qt({},t);return forEach$1(a).call(a,(function(t){void 0!==c[t]&&(c[t]=em(c[t]))})),void 0!==c.relationShip&&(c.valid=1===c.relationShip),c}var NS={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var RS={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},wS={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},kS=invertSerializeMap(wS),OS={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:kS.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:wS.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:wS.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:kS.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:kS.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:kS.friendTag}]}},PS=function(t){function FriendService(a){var c;return c=t.call(this,"friend",a)||this,registerParser({cmdMap:RS,cmdConfig:OS}),c}kt(FriendService,t);var a=FriendService.prototype;return a.getFriends=function getFriends(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return a=m.sent,c=(null===(t=a.content)||void 0===t?void 0:t.friends)||[],c=map$6(c).call(c,(function(t){return reverseFriend(t)})),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee,this)})))},a.addFriend=function addFriend(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:1,ps:t.ps||""});case 3:return a=(new Date).getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",t.account),c.abrupt("return",{account:t.account,createTime:a,updateTime:a,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return c.stop()}}),_callee2,this)})))},a.applyFriend=function applyFriend(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:2,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee3,this)})))},a.passFriendApply=function passFriendApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a=this;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("friendReuqest",{account:t.account,type:3,ps:t.ps||""}).then((function(c){return a.core.eventBus.emit("systemMessage/passFriendApply",t),c}));case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",t.account),c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",t.account,c.t0),c.t0;case 11:case"end":return c.stop()}}),_callee4,this,[[1,7]])})))},a.rejectFriendApply=function rejectFriendApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a=this;return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("friendReuqest",{account:t.account,type:4,ps:t.ps||""}).then((function(c){return a.core.eventBus.emit("systemMessage/rejectFriendApply",t),c}));case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",t.account,t.ps),c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",t.account,t.ps,c.t0),c.t0;case 11:case"end":return c.stop()}}),_callee5,this,[[1,7]])})))},a.deleteFriend=function deleteFriend(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},t),a.next=3,this.core.sendCmd("deleteFriend",{account:t.account,delFriendParams:{delAlias:!0===t.delAlias?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",t.account);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.updateFriend=function updateFriend(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:t});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",t);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.syncFriendRequestHandler=function syncFriendRequestHandler(t){var a=function formatFriendRequest(t){var a=qt({},t);try{a.ps=a.ps&&JSON.parse(a.ps)}catch(t){}if(a.type=NS[a.type],"addFriend"===a.type||"passFriendApply"===a.type){var c=(new Date).getTime();a.friend={account:t.account,alias:"",createTime:c,ext:"",updateTime:c,valid:!0}}return a}(t.content);this.core.emit("syncFriend",a)},a.syncDeleteFriendHandler=function syncDeleteFriendHandler(t){var a=t.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+a),this.core.emit("syncFriend",{type:"deleteFriend",account:a})},a.syncUpdateFriendHandler=function syncUpdateFriendHandler(t){var a=reverseFriend(t.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==a?void 0:a.account),this.core.emit("syncFriend",{type:"updateFriend",friend:a})},a.syncFriendsHandler=function syncFriendsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friends:em(a.timetag)});var c=null==a?void 0:a.friends;if(c&&c.length){var m=map$6(c).call(c,(function(t){return reverseFriend(t)}));this.core.emit("friends",m)}},a.syncFriendUsersHandler=function syncFriendUsersHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:em(a.timetag)});var c=null==a?void 0:a.users;if(c&&c.length){var m=map$6(c).call(c,(function(t){return formatUser(t)}));this.core.emit("users",m)}},FriendService}(Ev);function formatSubscribes(t){return t&&t.length>0?map$6(t).call(t,(function(t){return function formatSubscribe(t){var a=qt({},t),c=["subscribeTime","time"];return forEach$1(c).call(c,(function(t){a[t]&&(a[t]=em(a[t]))})),a}(t)})):[]}function formatEvent(t){if(!t)return t;var a=t.serverExt,c=__rest(t,["serverExt"]),m=["time","type","value"];if(forEach$1(m).call(m,(function(t){c[t]&&(c[t]=em(c[t]))})),c.clientType&&(c.clientType=getEnumKeyByEnumValue(Jp,c.clientType)||""),a)try{c.ext=JSON.parse(a),"string"==typeof c.ext[0]&&(c.ext=c.ext[0])}catch(t){}return c}var xS={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},VS={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},LS=invertSerializeMap(VS),DS={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:VS.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:LS.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:LS.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:VS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:VS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:VS.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:VS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:LS.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:VS.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:LS.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:LS.msgEvent}]}},US=function(t){function EventService(a){var c;return c=t.call(this,"event",a)||this,registerParser({cmdMap:xS,cmdConfig:DS}),c}kt(EventService,t);var a=EventService.prototype;return a.publishEvent=function publishEvent(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h;return Dc.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:return validate({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},t),c=qt(qt({validTime:t.validTime||604800,broadcastType:t.broadcastType||2},t),{idClient:_m(),sync:!0===t.sync?1:0}),g.next=4,this.core.sendCmd("publishEvent",{msgEvent:c});case 4:return m=g.sent,h=(null===(a=m.content)||void 0===a?void 0:a.msgEvent)||{},g.abrupt("return",formatEvent(h));case 7:case"end":return g.stop()}}),_callee,this)})))},a.subscribeEvent=function subscribeEvent(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m,h;return Dc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:return validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},t),c=qt(qt({subscribeTime:2592e3},t),{sync:!0===t.sync?1:0}),g.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:c,accounts:t.accounts});case 4:return m=g.sent,h=(null===(a=m.content)||void 0===a?void 0:a.accounts)||[],g.abrupt("return",{failedAccounts:h});case 7:case"end":return g.stop()}}),_callee2,this)})))},a.unSubscribeEvents=function unSubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c,m,h;return Dc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),c={type:t.type},!(t.accounts&&t.accounts.length>0)){g.next=9;break}return g.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:c,accounts:t.accounts});case 5:h=g.sent,m=(null===(a=h.content)||void 0===a?void 0:a.accounts)||[],g.next=12;break;case 9:return g.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:c});case 11:m=[];case 12:return g.abrupt("return",{failedAccounts:m});case 13:case"end":return g.stop()}}),_callee3,this)})))},a.querySubscribeEvents=function querySubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var c;return Dc.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),!(t.accounts&&t.accounts.length>0)){m.next=7;break}return m.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:t.type},accounts:t.accounts});case 4:c=m.sent,m.next=10;break;case 7:return m.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:t.type}});case 9:c=m.sent;case 10:return m.abrupt("return",formatSubscribes(null===(a=c.content)||void 0===a?void 0:a.msgEventSubscribes));case 11:case"end":return m.stop()}}),_callee4,this)})))},a.pushEventHandler=function pushEventHandler(t){var a,c=(null===(a=t.content)||void 0===a?void 0:a.msgEvent)||{};this.core.emit("pushEvents",[formatEvent(c)])},a.pushEventsHandler=function pushEventsHandler(t){var a,c=(null===(a=t.content)||void 0===a?void 0:a.msgEvents)||{};this.core.emit("pushEvents",function formatEvents(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatEvent(t)})):[]}(c))},EventService}(Ev);function generateThreadMsgsParams(t){var a={scene:Qp[t.scene],from:t.threadMsgFromAccount,to:t.threadMsgToAccount,time:t.threadMsgTime,idServer:t.threadMsgIdServer},c={limit:t.limit<100?t.limit:100,beginTime:"number"==typeof t.beginTime?t.beginTime:0,reverse:!0===reverse$1(t)?1:0};return t.lastMsgId&&(c.lastMsgId=t.lastMsgId),{msg:a,threadMsgReq:c}}var FS,BS={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},qS={msg:tT,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},GS=invertSerializeMap(qS),HS={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:qS.msg},{type:"Property",name:"threadMsgReq",reflectMapper:qS.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:GS.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:GS.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:GS.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:qS.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:GS.msg}]}},jS=function(t){function MsgExtendService(a){var c;return c=t.call(this,"msgExtend",a)||this,registerParser({cmdMap:BS,cmdConfig:HS}),c}kt(MsgExtendService,t);var a=MsgExtendService.prototype;return a.getThreadMsgs=function getThreadMsgs(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g,I,M,T;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return validate({scene:{type:"enum",values:getEnumKeys(Qp)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},t),S.next=3,this.core.sendCmd("getThreadMsgs",generateThreadMsgsParams(t));case 3:return c=S.sent,m=c.content,h=m.msgs,g=m.threadMsg,I=c.content.threadMsgsMeta,M=getSessionId(g,this.core.account),T=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:M}),h=formatMsgs$1(h,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),g=formatMsg$1(g,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),S.abrupt("return",{msgs:h,threadMsg:g,total:em(I.total),timetag:em(I.lastMsgTime)});case 11:case"end":return S.stop()}}),_callee,this)})))},a.getMsgsByIdServer=function getMsgsByIdServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g=this;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return validate({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:getEnumKeys(Qp)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},t),I.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:map$6(a=t.reqMsgs).call(a,(function(t){return qt(qt({},t),{scene:getEnumKeyByEnumValue(Qp,t.scene)})}))});case 3:return m=I.sent,h=map$6(c=m.content.msgs).call(c,(function(t){var a,c=getSessionId(t,g.core.account),m=null===(a=g.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:c});return formatMsg$1(t,m?{account:g.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:g.core.account})})),I.abrupt("return",h);case 6:case"end":return I.stop()}}),_callee2,this)})))},MsgExtendService}(Ev);!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(FS||(FS={}));var YS,$S={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},WS={msg:tT,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},zS=invertSerializeMap(WS),KS={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:zS.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:WS.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:zS.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:zS.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:WS.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:zS.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:WS.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:zS.msg}]}};!function(t){t[t.p2p=1]="p2p",t[t.team=2]="team"}(YS||(YS={}));var QS={type:{type:"enum",values:YS},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function formatClearResult(t){var a=format(QS,t);return{sessionId:"p2p"===a.type?"p2p-"+a.otherAccid:"team-"+a.toTid,time:a.time}}var JS={orderRule:{type:"enum",values:FS}};function generateFtsTagForCmd(t){var a,c=format(JS,t);jc(c.msgTypeList)&&(c.msgTypeList=map$6(a=c.msgTypeList).call(a,(function(t){return Kp[t]})).join(","));var m=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return forEach$1(m).call(m,(function(t){jc(c[t])&&(c[t]=c[t].join(","))})),c}var XS,ZS,eE=function(t){function MsgLogService(a){var c;return(c=t.call(this,"msgLog",a)||this).onV2ClearHistoryMessage=function(t){var a=formatClearResult(t);c.core.eventBus.emit("session/updateForClearMsg",[a],!0)},registerParser({cmdMap:$S,cmdConfig:KS}),c.registerListener(),c}kt(MsgLogService,t);var a=MsgLogService.prototype;return a.registerListener=function registerListener(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},a.deleteRoamingMsgs=function deleteRoamingMsgs(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:validate({ids:{type:"array",itemType:"string"}},t),a=[],m.prev=2,a=map$6(c=t.ids).call(c,(function(t){var a=getAccountFromSessionId(t);return a.scene+"|"+a.accid})),m.next=10;break;case 6:throw m.prev=6,m.t0=m.catch(2),this.logger.error("Failed to delete roaming msgs with "+t.ids,m.t0),new Error("Failed to create session with "+t.ids);case 10:return m.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:a});case 12:case"end":return m.stop()}}),_callee,this,[[2,6]])})))},a.getHistoryMsgs=function getHistoryMsgs(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var m,h,g,I,M,T,S;return Dc.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:return(null===(a=this.core.sync)||void 0===a?void 0:a.getSyncDoneFlag())||this.logger.warn("Please call getHistoryMsgs after syncdone event"),validate({scene:{type:"enum",values:getEnumKeys(Qp)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},t),h="p2p"===t.scene?"getHistoryMsgs":"team"===t.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",E.next=5,this.core.sendCmd(h,qt(qt({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},t),{msgTypes:t.msgTypes?map$6(m=t.msgTypes).call(m,(function(t){return Kp[t]})):[]}));case 5:if(g=E.sent,(I=g.content).msgs&&I.msgs.length>0){E.next=9;break}return E.abrupt("return",[]);case 9:if(M=getSessionId(I.msgs[0],this.core.account),T=null===(c=this.core.session)||void 0===c?void 0:c.getSessionWithUncomplete({id:M}),S=formatMsgs$1(I.msgs,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),!0!==t.asc){E.next=14;break}return E.abrupt("return",sort(S).call(S,(function(t,a){return t.time-a.time})));case 14:return E.abrupt("return",S);case 15:case"end":return E.stop()}}),_callee2,this)})))},a.clearHistoryMsgsFromServer=function clearHistoryMsgsFromServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},t),(a=qt(qt({isDeleteRoam:1},t),{type:"team"===t.scene?2:1,isSyncSelf:!0===t.isSyncSelf?1:0}))[2===a.type?"toTid":"otherAccid"]=t.to,h.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:a});case 5:return c=h.sent,m=c.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:t.scene+"-"+t.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",qt(qt({},a),{time:m.timetag})),h.abrupt("return",m);case 10:case"end":return h.stop()}}),_callee3,this)})))},a.multiSyncClearServerHistoryMsgsHandler=function multiSyncClearServerHistoryMsgsHandler(t){var a=formatClearResult(t.content.data);this.core.eventBus.emit("session/updateForClearMsg",[a],!0),this.core.emit("clearServerHistoryMsgs",[a])},a.ftsCloudMsgLogs=function ftsCloudMsgLogs(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogs"));case 1:case"end":return a.stop()}}),_callee4,this)})))},a.ftsCloudMsgLogsAggWithSession=function ftsCloudMsgLogsAggWithSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return a.stop()}}),_callee5,this)})))},a.baseFtsCloudMsgLogs=function baseFtsCloudMsgLogs(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var c,m,h,g=this;return Dc.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:getEnumKeys(FS),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:getEnumKeys(Kp),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},t),!(t.fromTime&&t.toTime&&t.toTime<t.fromTime)){I.next=3;break}throw new $u("Request parameter error: toTime should be greater than fromTime",t,"");case 3:return m=generateFtsTagForCmd(t),I.next=6,this.core.sendCmd(a,{tag:m});case 6:return h=I.sent,I.abrupt("return",map$6(c=h.content.datas).call(c,(function(t){var a,c=getSessionId(t,g.core.account),m=null===(a=g.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:c});return formatMsg$1(t,m?{account:g.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:g.core.account})})));case 8:case"end":return I.stop()}}),_callee6,this)})))},a.syncClearServerHistoryMsgsHandler=function syncClearServerHistoryMsgsHandler(t){var a=function formatClearResults(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatClearResult(t)})):[]}(t.content.datas);this.core.emit("clearServerHistoryMsgs",a)},MsgLogService}(Ev),tE={"22_1":"requestProxy","22_2":"onRequestProxy"},rE={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},nE=invertSerializeMap(rE),aE={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:rE.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:nE.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:nE.requestProxyMsgTag}]}},iE=function(t){function PassThroughService(a){var c;return(c=t.call(this,"passThrough",a)||this).core=a,registerParser({cmdMap:tE,cmdConfig:aE}),c}kt(PassThroughService,t);var a=PassThroughService.prototype;return a.request=function request(t){return validate({path:{type:"string",allowEmpty:!1}},t),this.core.sendCmd("requestProxy",{requestProxyTag:t}).then((function(t){return t.content.requestProxyTag}))},a.onRequestProxyHandler=function onRequestProxyHandler(t){var a=t.content.proxyMsg;a&&a.time&&(a.time=+a.time),this.core.emit("proxyMsg",a)},PassThroughService}(Ev),oE={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},sE={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function getUploadResponseFormat(t){return void 0===t&&(t="file"),Fc(oE[t]||{}).replace(/"/gi,'\\"')}!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(XS||(XS={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(ZS||(ZS={}));var cE={chunkUploadHost:"https://wannos-web.127.net",commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};var lE=function pickBy(t,a){if(null==t)return{};var c=Ts(eS(t),(function(t){return[t]}));return a=sv(a),hT(t,c,(function(t,c){return a(t,c[0])}))},uE=function(){function NOS(t,a){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=t,this.cloudStorage=a}var t=NOS.prototype;return t.reset=function reset(){this.nosErrorCount=0},t.getNosAccessToken=function getNosAccessToken(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("getNosAccessToken",{tag:t});case 2:return a=h.sent,c=ws(a,"content.nosAccessTokenTag.token"),m=t.url,h.abrupt("return",{token:c,url:-1!==indexOf(m).call(m,"?")?m+"&token="+c:m+"?token="+c});case 6:case"end":return h.stop()}}),_callee,this)})))},t.deleteNosAccessToken=function deleteNosAccessToken(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:t});case 2:case"end":return a.stop()}}),_callee2,this)})))},t.nosUpload=function nosUpload(t,a){var c,m,h,g,I,M,T,S;return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var E,C,b,A,N,R,w,k,O,P,x,V,L,D,U,B,q,G,H;return Dc.wrap((function _callee3$(j){for(;;)switch(j.prev=j.next){case 0:if(E=ws(this.core,"config.cdn.bucket"),C={tag:t.nosScenes||E||"nim"},t.nosSurvivalTime&&(C.expireSec=t.nosSurvivalTime),b=this.core.adapters.getFileUploadInformation(t),!(!a&&!b)){j.next=18;break}return j.prev=6,j.next=9,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:C});case 9:A=j.sent,j.next=18;break;case 12:if(j.prev=12,j.t0=j.catch(6),this.core.logger.error("uploadFile:: getNosToken error",j.t0),!(j.t0 instanceof Yu)){j.next=17;break}throw j.t0;case 17:throw new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:j.t0,curProvider:1}});case 18:return N=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",b?null===(c=b.uploadInfo)||void 0===c?void 0:c.objectName:a?null==a?void 0:a.objectName:A.content.nosToken.objectName),R="",a&&a.shortUrl&&(R=a.shortUrl),(null===(g=null===(h=null===(m=null==b?void 0:b.uploadInfo)||void 0===m?void 0:m.payload)||void 0===h?void 0:h.mixStoreToken)||void 0===g?void 0:g.shortUrl)&&(R=b.uploadInfo.payload.mixStoreToken.shortUrl),w=R||N,j.prev=23,O=b?{token:null===(I=null==b?void 0:b.uploadInfo)||void 0===I?void 0:I.token,bucket:null===(M=null==b?void 0:b.uploadInfo)||void 0===M?void 0:M.bucketName,objectName:null===(T=null==b?void 0:b.uploadInfo)||void 0===T?void 0:T.objectName}:a||A.content.nosToken,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:O,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:Cp.platform}),P="BROWSER"===Cp.platform?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(O&&O.bucket),this.core.reporterHookCloudStorage.update({remote_addr:P,operation_type:a?2:0}),j.next=30,this.core.adapters.uploadFile(qt(qt(qt({},t),{nosToken:O,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:t.maxSize||this.config.chunkMaxSize}),a?{payload:{mixStoreToken:a}}:{}));case 30:k=j.sent,j.next=65;break;case 33:if(j.prev=33,j.t1=j.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",j.t1),x="v2"===ws(this.core,"options.apiVersion"),j.t1.code!==Gu.V2NIM_ERROR_CODE_CANCELLED&&10499!==j.t1.errCode){j.next=39;break}throw new Ku({code:x?Gu.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:ws(j.t1,"message")||"Request abort",rawError:j.t1,curProvider:1}});case 39:if(!x||j.t1.errCode!==Gu.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){j.next=41;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:ws(j.t1,"message")||"Read file failed",rawError:j.t1,curProvider:1}});case 41:return j.next=43,Cp.net.getNetworkStatus();case 43:if(V=j.sent,!1!==V.net_connect){j.next=47;break}throw new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:j.t1,curProvider:1}});case 47:if(!a){j.next=64;break}if(0!==this.nosErrorCount){j.next=60;break}j.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),j.next=56;break;case 53:throw j.prev=53,j.t2=j.catch(49),new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:j.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:t.file||t.filePath}});case 56:return this.nosErrorCount=ws(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),j.abrupt("return",this.cloudStorage._uploadFile(t));case 60:return this.nosErrorCount--,j.abrupt("return",this.nosUpload(t,a));case 62:j.next=65;break;case 64:throw new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:j.t1,curProvider:1}});case 65:if(L=null==k?void 0:k.type,(D=L&&indexOf(L).call(L,"/")>-1?slice$1(L).call(L,0,indexOf(L).call(L,"/")):"")||(D=t.type||""),(U={image:"imageInfo",video:"vinfo",audio:"vinfo"})[D]){j.next=71;break}return j.abrupt("return",qt({url:w},k));case 71:return j.prev=71,j.next=74,this.core.adapters.request(N+"?"+U[D],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:B=j.sent,j.next=81;break;case 77:return j.prev=77,j.t3=j.catch(71),this.core.logger.error("uploadFile:: fetch file info error",j.t3),j.abrupt("return",qt({url:w},k));case 81:if(!B){j.next=88;break}return q=B.data,G="imageInfo"===U[D]?q:null===(S=null==q?void 0:q.GetVideoInfo)||void 0===S?void 0:S.VideoInfo,H={url:w,name:k.name,size:k.size,ext:k.ext,w:null==G?void 0:G.Width,h:null==G?void 0:G.Height,orientation:null==G?void 0:G.Orientation,dur:null==G?void 0:G.Duration,audioCodec:null==G?void 0:G.AudioCodec,videoCodec:null==G?void 0:G.VideoCodec,container:null==G?void 0:G.Container},j.abrupt("return",lE(H,(function(t,a){return void 0!==a})));case 88:return j.abrupt("return",qt({url:w},k));case 89:case"end":return j.stop()}}),_callee3,this,[[6,12],[23,33],[49,53],[71,77]])})))},t._getNosCdnHost=function _getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m,h=this;return Dc.wrap((function _callee4$(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=g.sent,g.next=10;break;case 6:return g.prev=6,g.t0=g.catch(0),this.core.logger.error("getNosCdnHost::error",g.t0),g.abrupt("return");case 10:if(a){g.next=12;break}return g.abrupt("return");case 12:c=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(m=em(null==c?void 0:c.expire))&&c.cdnDomain?-1===m?(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix):(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){h._getNosCdnHost()}),1e3*m)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return g.stop()}}),_callee4,this,[[0,6]])})))},Ke(NOS,[{key:"config",get:function get(){return this.cloudStorage.config}}]),NOS}(),dE={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},pE={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},mE={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:pE.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:Oh(pE.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:pE.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Oh(pE.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Oh(pE.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:Oh(pE.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Oh(pE.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:pE.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Oh(pE.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:pE.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Oh(pE.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:pE.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:Oh(pE.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:pE.nosAccessTokenTag}]}},hE=function(){function MixStorage(t,a){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=XS.nos,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=MixStorage.prototype;return t.reset=function reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=XS.nos,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(Cp.localStorage)try{Cp.localStorage.getItem&&Cp.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(Cp.localStorage.getItem(this.GRAYKEY))[t])}catch(t){Cp.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){h.next=17;break}return h.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(c=h.sent).content||!c.content.grayConfigTag){h.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(c.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(c.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){h.next=10;break}return h.abrupt("return");case 10:m=Cp.localStorage.getItem(this.GRAYKEY)?JSON.parse(Cp.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),m[t]=this.grayConfig,Cp.localStorage.setItem(this.GRAYKEY,Fc(m)),h.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",c.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){h.next=20;break}return h.next=20,this._getMixStorePolicy(t);case 20:case"end":return h.stop()}}),_callee,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g,I,M;return Dc.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:if(a=(new Date).getTime(),Cp.localStorage)try{this.mixStorePolicy=JSON.parse(Cp.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=em(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(m=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(c=this._getMixStorePolicy).call(c,this,t),m))}catch(a){Cp.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(Cp.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){T.next=30;break}return T.prev=3,T.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:g=T.sent,I=g.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(I.ttl),this.mixStorePolicy.providers=I.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=em(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=I.nosPolicy?JSON.parse(I.nosPolicy):null,this.mixStorePolicy.s3Policy=I.s3Policy?JSON.parse(I.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(h=this._getMixStorePolicy).call(h,this,t),1e3*this.mixStorePolicy.ttl),M=Cp.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(Cp.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),M[t]=this.mixStorePolicy,Cp.localStorage.setItem(this.MIXSTOREKEY,Fc(M)),T.next=30;break;case 23:if(T.prev=23,T.t0=T.catch(3),this.logger.error("getMixStorePolicy error",T.t0),0!==this.mixStoreErrorCount){T.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return T.stop()}}),_callee2,this,[[3,23]])})))},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,c=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(!c)throw new Error("uploadFile nextProvider error");if(c===a[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+c),this.curProvider=em(c),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var m=this.mixStorePolicy[this.curProvider===XS.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!m||0===m)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+em(t.mixStorePolicy.providers[0])),t.curProvider=em(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*m)}throw new Error("uploadFile will not retry again")},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=c.sent,c.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return c.stop()}}),_callee3,this)})))},MixStorage}(),gE=qp.trim,vE=N("".charAt),fE=h.parseFloat,yE=h.Symbol,_E=yE&&yE.iterator,IE=1/fE(Lp+"-0")!=-1/0||_E&&!fails((function(){fE(Object(_E))}))?function parseFloat(t){var a=gE(toString$1(t)),c=fE(a);return 0===c&&"-"==vE(a,0)?-0:c}:fE;_export({global:!0,forced:parseFloat!=IE},{parseFloat:IE});var ME=j.parseFloat,TE=function(){function AWS(t,a){this.s3=null,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=AWS.prototype;return t.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m,h,g,I,M,T,S,E,C,b=this;return Dc.wrap((function _callee2$(A){for(;;)switch(A.prev=A.next){case 0:if(!t.file){A.next=4;break}c=t.file,A.next=19;break;case 4:if("string"!=typeof t.fileInput){A.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((m=document.getElementById(t.fileInput))&&m.files&&m.files[0])){A.next=11;break}c=m.files[0],A.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:A.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){A.next=18;break}c=t.fileInput.files[0],A.next=19;break;case 18:throw new Error("Can not get file from fileInput "+t.fileInput);case 19:if(this.mixStorePolicy.s3Policy){A.next=21;break}throw new Error("dont get s3 policy");case 21:return h={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},g=this.s3,(I=new g).config.update(h),M=decodeURIComponent(a.bucket),T=decodeURIComponent(a.objectName),E={Bucket:M,Key:T,Body:S=c,Metadata:{token:a.token},ContentType:S.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",E),(C=I.upload(E)).on("httpUploadProgress",(function(a){var c=ME((a.loaded/a.total).toFixed(2));t.onUploadProgress&&t.onUploadProgress({total:a.total,loaded:a.loaded,percentage:c,percentageText:Math.round(100*c)+"%"})})),A.abrupt("return",new Mi((function(c,m){var h=(new Date).getTime();C.send((function(g,I){return __awaiter(b,void 0,void 0,Dc.mark((function _callee(){var E,C,b,A,N,R,w,k;return Dc.wrap((function _callee$(O){for(;;)switch(O.prev=O.next){case 0:if(!g||"RequestAbortedError"!==g.code){O.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",g),m(new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:g,curProvider:2}})),O.next=42;break;case 5:if(!g){O.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",g),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(C=null===(E=this.core)||void 0===E?void 0:E.auth)||void 0===C?void 0:C.account),trace_id:null===(b=this.core.clientSocket.socket)||void 0===b?void 0:b.sessionId,start_time:h,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof g.status?g.status:"number"==typeof g.code?g.code:0,description:g.message||""+g.code,operation_type:1,target:Fc({bucket:M,object:T})},{asyncParams:Cp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),O.next=12,Cp.net.getNetworkStatus();case 12:if(A=O.sent,!1!==A.net_connect){O.next=16;break}return O.abrupt("return",m(new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:g,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:O.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),O.next=23;break;case 20:return O.prev=20,O.t0=O.catch(16),O.abrupt("return",m(new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:O.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:t.file||t.filePath}})));case 23:c(this.cloudStorage._uploadFile(t)),O.next=42;break;case 26:if(N=(N=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn),this.core.reporterHookCloudStorage.update({remote_addr:N,operation_type:1}),N=N.replace("{objectName}",I.Key),R={size:S.size,name:S.name,url:a.shortUrl?a.shortUrl:N,ext:S.name.split(".")[1]||"unknown"},w=t.type||"",(k={image:"imageInfo"})[w]){O.next=37;break}return O.abrupt("return",c(R));case 37:return O.t1=c,O.next=40,this.getS3FileInfo({url:N,infoSuffix:k[w],s3Result:R});case 40:return O.t2=O.sent,O.abrupt("return",(0,O.t1)(O.t2));case 42:case"end":return O.stop()}}),_callee,this,[[16,20]])})))})),t.onUploadStart&&t.onUploadStart(C)})));case 33:case"end":return A.stop()}}),_callee2,this)})))},t.getS3FileInfo=function getS3FileInfo(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c,m,h,g,I,M,T;return Dc.wrap((function _callee3$(S){for(;;)switch(S.prev=S.next){case 0:return c=t.url,m=t.infoSuffix,h=t.s3Result,S.prev=1,S.next=4,this.core.adapters.request(c+"?"+m,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:g=S.sent,S.next=11;break;case 7:return S.prev=7,S.t0=S.catch(1),this.core.logger.error("uploadFile:: fetch file info error",S.t0),S.abrupt("return",h);case 11:if(!g){S.next=18;break}return I=g.data,M="imageInfo"===m?I:null===(a=null==I?void 0:I.GetVideoInfo)||void 0===a?void 0:a.VideoInfo,T=qt(qt({},h),{w:null==M?void 0:M.Width,h:null==M?void 0:M.Height,orientation:null==M?void 0:M.Orientation,dur:null==M?void 0:M.Duration,audioCodec:null==M?void 0:M.AudioCodec,videoCodec:null==M?void 0:M.VideoCodec,container:null==M?void 0:M.Container}),S.abrupt("return",lE(T,(function(t,a){return void 0!==a})));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",c+"?"+m),S.abrupt("return",h);case 20:case"end":return S.stop()}}),_callee3,this,[[1,7]])})))},Ke(AWS,[{key:"mixStorePolicy",get:function get(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),AWS}(),SE=function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=t.logger,this.core=t,this.nos=new uE(t,this),this.mixStorage=new hE(t,this),this.aws=new TE(t,this),registerParser({cmdMap:dE,cmdConfig:mE}),this.setOptions(a),this.setListeners()}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=a+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=a+"-AllMixStorePolicy";var c=t.s3,m=__rest(t,["s3"]),h=qt({},cE,this.config);if(m&&Object.prototype.hasOwnProperty.call(m,"cdn")){var g=qt(qt({},h.cdn),m.cdn);this.config=qt({},h,m),this.config.cdn=g}else this.config=qt({},h,m);c&&(this.aws.s3=c)},t.setListeners=function setListeners(){var t,a,c,m;this.core.eventBus.on("kicked",bind$1(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("disconnect",bind$1(a=this._clearUnCompleteTask).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._clearUnCompleteTask).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(m=this._clearUnCompleteTask).call(m,this))},t._clearUnCompleteTask=function _clearUnCompleteTask(){var t,a=this;forEach$1(t=mn(this.uploadTaskMap)).call(t,(function(t){var c=a.uploadTaskMap[t];c&&c.abort&&c.abort()})),this.uploadTaskMap={}},t.init=function init(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){t.next=5;break}return t.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return t.next=7,this.nos._getNosCdnHost();case 7:case"end":return t.stop()}}),_callee,this)})))},t.processCallback=function processCallback(t,a){var c=this,m=t.onUploadProgress,h=t.onUploadDone,g=t.onUploadStart;return{onUploadStart:"function"==typeof g?function(t){c.uploadTaskMap[a]=t;try{g(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",t)}}:function(t){c.uploadTaskMap[a]=t},onUploadProgress:"function"==typeof m?function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded});try{m(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded})},onUploadDone:"function"==typeof h?function(t){c.core.reporterHookCloudStorage.end(0);try{h(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:function(){c.core.reporterHookCloudStorage.end(0)},taskKey:a}},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g,I,M,T;return Dc.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){S.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){S.next=7;break}if(!(a=ws(t,"file.type"))||"string"!=typeof a||-1!==indexOf(a).call(a,t.type)){S.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),t.file?this.core.reporterHookCloudStorage.update({full_size:t.file.size}):"string"==typeof t.fileInput?(c=document.getElementById(t.fileInput))&&c.files&&c.files[0]&&this.core.reporterHookCloudStorage.update({full_size:c.files[0].size}):t.fileInput&&t.fileInput.files&&t.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:t.fileInput.files[0].size}),m=_m(),h=this.processCallback(t,m),g=h.onUploadStart,I=h.onUploadProgress,M=h.onUploadDone,t.onUploadStart=g,t.onUploadProgress=I,t.onUploadDone=M,T=null,S.prev=15,S.next=18,this._uploadFile(t);case 18:T=S.sent,t.md5&&(T.md5=t.md5),delete this.uploadTaskMap[m],S.next=28;break;case 23:throw S.prev=23,S.t0=S.catch(15),delete this.uploadTaskMap[m],this.core.reporterHookCloudStorage.end((S.t0&&S.t0.code)===Gu.V2NIM_ERROR_CODE_CANCELLED?3:1),S.t0;case 28:return T&&(T.size=void 0===T.size?void 0:Number(T.size),T.w=void 0===T.w?void 0:Number(T.w),T.h=void 0===T.h?void 0:Number(T.h),T.dur=void 0===T.dur?void 0:Number(T.dur)),T.url=decodeURIComponent(T.url),t.onUploadDone({size:T.size,name:T.name,url:T.url,ext:T.name.split(".")[1]||"unknown"}),S.abrupt("return",T);case 32:case"end":return S.stop()}}),_callee2,this,[[15,23]])})))},t._uploadFile=function _uploadFile(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var m,h,g,I;return Dc.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:if(ws(this.mixStorage,"grayConfig.mixStoreEnable")&&ws(this.mixStorage,"mixStorePolicy.providers.length")){M.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),M.abrupt("return",this.nos.nosUpload(t));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+ws(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+ws(this.mixStorage,"curProvider")),m=this.core.adapters.getFileUploadInformation(t),h=!0,m?!1===m.complete&&this.mixStorage.curProvider===XS.s3&&(h=!1):h=!1,this.aws.s3||(this.mixStorage.curProvider=XS.nos),g=sE,h){M.next=23;break}return M.prev=10,M.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:t.nosSurvivalTime,returnBody:getUploadResponseFormat(t.type)}});case 13:I=M.sent,g=I.content.mixStoreTokenResTag,M.next=23;break;case 17:if(M.prev=17,M.t0=M.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",M.t0),!(M.t0 instanceof Yu)){M.next=22;break}throw M.t0;case 22:throw new Ku({code:"v2"===ws(this.core,"options.apiVersion")?Gu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:M.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(h){M.next=27;break}return M.abrupt("return",this.mixStorage.curProvider===XS.s3?this.aws.s3Upload(t,g):this.nos.nosUpload(t,g));case 27:return M.abrupt("return",this.nos.nosUpload(t,null===(c=null===(a=null==m?void 0:m.uploadInfo)||void 0===a?void 0:a.payload)||void 0===c?void 0:c.mixStoreToken));case 28:case"end":return M.stop()}}),_callee3,this,[[10,17]])})))},t.getThumbUrl=function getThumbUrl(t,a){var c,m,h,g,I;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var M=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);M[0],M[1],M[2],M[3],M[4];var T=M[5];if(M[6],M[7],null===(c=this.grayConfig)||void 0===c?void 0:c.mixStoreEnable){var S=this._getUrlType(t);if(S===XS.s3&&this.mixStorePolicy.s3Policy&&ws(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(h=null===(m=this.mixStorePolicy.s3Policy)||void 0===m?void 0:m.thumbPolicy)||void 0===h?void 0:h.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString());if(S===XS.nos&&this.mixStorePolicy.nosPolicy&&ws(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(I=null===(g=this.mixStorePolicy.nosPolicy)||void 0===g?void 0:g.thumbPolicy)||void 0===I?void 0:I.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString())}return includes(t).call(t,"?")?t+"&imageView&thumbnail="+a.width+"x"+a.height:t+"?imageView&thumbnail="+a.width+"x"+a.height},t.getVideoCoverUrl=function getVideoCoverUrl(t,a){var c,m,h,g,I;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var M=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);M[0],M[1],M[2],M[3],M[4];var T=M[5];if(M[6],M[7],null===(c=this.grayConfig)||void 0===c?void 0:c.mixStoreEnable){var S=this._getUrlType(t);if(S===XS.s3&&this.mixStorePolicy.s3Policy&&ws(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(h=null===(m=this.mixStorePolicy.s3Policy)||void 0===m?void 0:m.thumbPolicy)||void 0===h?void 0:h.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString()).replace("{offset}","0").replace("{type}","png");if(S===XS.nos&&this.mixStorePolicy.nosPolicy&&ws(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(I=null===(g=this.mixStorePolicy.nosPolicy)||void 0===g?void 0:g.thumbPolicy)||void 0===I?void 0:I.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString()).replace("{offset}","0").replace("{type}","png")}return includes(t).call(t,"?")?t+"&vframe&offset=0&resize="+a.width+"x"+a.height+"&type=png":t+"?vframe&offset=0&resize="+a.width+"x"+a.height+"&type=png"},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var c=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);c[0];var m=c[1];c[2];var h=c[3];c[4];var g=c[5];if(c[6],c[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var I=this._getUrlType(t);return I===XS.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",g)),I===XS.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",g)),t}var M=this.config,T=M.downloadUrl,S=M.downloadHostList,E=M.nosCdnEnable,C=this.config.cdn.cdnDomain,b=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",A=decodeURIComponent(g),N=indexOf(A).call(A,b);if(C&&N>-1&&E)return""+m+C+"/"+slice$1(A).call(A,N);if(includes(S).call(S,h)&&includes(g).call(g,"/")){var R=indexOf(g).call(g,"/"),w=g.substring(0,R),k=g.substring(R+1);return T.replace("{bucket}",w).replace("{object}",k)}var O=filter(S).call(S,(function(t){return"string"==typeof h&&includes(h).call(h,t)}))[0],P=O?h.replace(O,"").replace(/\W/g,""):null;return P?T.replace("{bucket}",P).replace("{object}",g):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if("string"==typeof t&&includes(t).call(t,"_im_url=1")){c.next=2;break}return c.abrupt("return",t);case 2:return c.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 4:return a=c.sent,c.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 6:case"end":return c.stop()}}),_callee4,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a,c,m,h,g,I=this;return Dc.wrap((function _callee5$(M){for(;;)switch(M.prev=M.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,c=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(ZS.dontNeed)||c!==String(ZS.dontNeed)){M.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==ZS.time){M.next=17;break}if(!(a&&indexOf(a).call(a,String(ZS.time))>=0||c&&indexOf(c).call(c,String(ZS.time))>0)){M.next=13;break}return M.abrupt("return",this.mixStorage.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:M.next=33;break;case 17:if(t.urls&&t.urls.length){M.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(h=[],g=[],forEach$1(m=t.urls).call(m,(function(t){var a=I._getUrlType(t);a===XS.nos&&g.push(t),a===XS.s3&&h.push(t)})),(!c||0!==h.length&&indexOf(c).call(c,String(ZS.urls))<0)&&(this.logger.warn("s3 url don't support url token"),h=[]),(!a||0!==g.length&&indexOf(a).call(a,String(ZS.urls))<0)&&(this.logger.warn("nos url don't support url token"),g=[]),0!==h.length||0!==g.length){M.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==h.length&&0!==g.length){M.next=33;break}return t.urls=Fc(t.urls),M.abrupt("return",this.mixStorage.getFileAuthToken(t));case 33:case"end":return M.stop()}}),_callee5,this)})))},t._getUrlType=function _getUrlType(t){var a,c;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?XS.nos:this.mixStorePolicy.s3Policy&&some(c=this.mixStorePolicy.s3Policy.dlcdns).call(c,(function(a){return indexOf(t).call(t,a)>=0}))?XS.s3:null},t.getNosAccessToken=function getNosAccessToken(t){return validate({url:{type:"string",allowEmpty:!1}},t),this.nos.getNosAccessToken(t)},t.deleteNosAccessToken=function deleteNosAccessToken(t){return validate({token:{type:"string",allowEmpty:!1}},t),this.nos.deleteNosAccessToken(t)},t.process=function process(t){var a=ws(t,"error.detail.ignore");return t.error&&!a?Mi.reject(t.error):Mi.resolve(t)},Ke(CloudStorageService,[{key:"grayConfig",get:function get(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function get(){return this.mixStorage.mixStorePolicy}}]),CloudStorageService}(),CE=Oh({none:0,normal:1,all:3}),bE=Oh({normal:0,advanced:1}),AE=Oh({normal:0,owner:1,manager:2}),NE={noVerify:0,needVerify:1,rejectAll:2},RE=Oh(NE),wE={needVerify:0,noVerify:1},kE=Oh(wE),OE={manager:0,all:1},PE=Oh(OE),xE={manager:0,all:1},VE=Oh(xE),LE={manager:0,all:1},DE=Oh(LE);function formatSuperTeam(t){var a,c=["teamId"],m=["level","memberNum","memberUpdateTime","createTime","updateTime"],h=["valid","validToCurrentUser","mute"],g={type:bE,muteType:CE,joinMode:RE,beInviteMode:kE,inviteMode:PE,updateTeamMode:VE,updateExtMode:DE};t.bits;var I=__rest(t,["bits"]);return forEach$1(c).call(c,(function(t){I[t]&&(I[t]=I[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==I[t]&&(I[t]=em(I[t]))})),forEach$1(h).call(h,(function(t){void 0!==I[t]&&(I[t]=1===em(I[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==I[t]&&(I[t]=g[t][I[t]]||I[t])})),I}function formatSuperTeams(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatSuperTeam(t)})):[]}function generateSuperTeam(t){var a,c=qt({},t),m=["avatar","name","intro","announcement","ext"],h={joinMode:NE,beInviteMode:wE,inviteMode:OE,updateTeamMode:xE,updateExtMode:LE};return forEach$1(m).call(m,(function(t){void 0!==c[t]&&(c[t]=c[t].toString())})),forEach$1(a=mn(h)).call(a,(function(t){void 0!==c[t]&&(c[t]=h[t][c[t]])})),c}function generatorSuperTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],c={};return void 0!==t.bitConfigMask&&(c.bits=em(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(c[a]=t[a].toString())})),Object.prototype.hasOwnProperty.call(t,"nickInTeam")&&(c.nickInTeam=t.nickInTeam),c}function formatSuperTeamMember(t){var a,c=["teamId"],m=["joinTime","updateTime","bitConfigMask"],h=["active","valid","mute"],g={type:AE},I=t.bits,M=__rest(t,["bits"]);return void 0!==I&&(M.muteTeam=1===em(I),M.bitConfigMask=I),M.id=M.teamId+"-"+M.account,forEach$1(c).call(c,(function(t){M[t]&&(M[t]=M[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==M[t]&&(M[t]=em(M[t]))})),forEach$1(h).call(h,(function(t){void 0!==M[t]&&(M[t]=1===em(M[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==M[t]&&(M[t]=g[t][M[t]]||M[t])})),M}function formatSuperTeamMembers(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatSuperTeamMember(t)})):[]}function generatorMemberBySuperTeam(t,a,c){return void 0===c&&(c="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:c,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersBySuperTeam(t,a,c){return void 0===c&&(c="normal"),a&&a.length>0?map$6(a).call(a,(function(a){return generatorMemberBySuperTeam(t,a,c)})):[]}var UE=function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddSuperTeamMembers=function notifyAddSuperTeamMembers(t,a){this.core.emit("addSuperTeamMembers",{team:t,accounts:a,members:generatorMembersBySuperTeam(t,a)})},t.notifyUpdateSuperTeamManagers=function notifyUpdateSuperTeamManagers(t,a,c,m){this.core.emit("updateSuperTeamManagers",{team:{teamId:t,memberUpdateTime:m},accounts:a,isManager:c,members:map$6(a).call(a,(function(a){return{id:t+"-"+a,type:c?"manager":"normal",account:a,updateTime:m}}))})},t.notifyRemoveSuperTeamMembers=function notifyRemoveSuperTeamMembers(t,a){this.core.emit("removeSuperTeamMembers",{team:t,accounts:a})},t.notifyTransferSuperTeam=function notifyTransferSuperTeam(t,a,c){this.core.emit("transferSuperTeam",{team:t,from:{id:t.teamId+"-"+a,account:a,type:"normal",updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+c,account:c,type:"owner",updateTime:t.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function notifyUpdateSuperTeamMembersMute(t,a,c){this.core.emit("updateSuperTeamMembersMute",{team:t,accounts:a,members:map$6(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:c,updateTime:t.memberUpdateTime}})),mute:c})},ModuleService}(),FE={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},BE={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},qE=invertSerializeMap(BE),GE={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:qE.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:qE.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:BE.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:qE.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:BE.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:BE.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:qE.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:qE.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:qE.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:qE.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:qE.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:qE.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:qE.superTeamMember},{type:"Long",name:"timetag"}]}},HE=function(t){function SuperTeamService(a){var c;return(c=t.call(this,"superTeam",a)||this).mySuperTeamMembersMap=new Ml,c.service=new UE(a),registerParser({cmdMap:FE,cmdConfig:GE}),c.setListeners(),c}kt(SuperTeamService,t);var a=SuperTeamService.prototype;return a.setListeners=function setListeners(){var t=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",(function(a){t.emitMemberUpdate(a)})),this.core.eventBus.on("team/onNotification",(function(a){return t.notificationHandler(a)}))},a.reset=function reset(){this.mySuperTeamMembersMap.clear()},a.mergeMySuperTeamMembers=function mergeMySuperTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.teamId,m=a.mySuperTeamMembersMap.get(c),h=qt({},m,t);a.mySuperTeamMembersMap.set(c,h)}))},a.getSuperTeamInfo=function getSuperTeamInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:t.teamId});case 3:return a=m.sent,c=a.content.superTeam,m.abrupt("return",formatSuperTeam(c));case 6:case"end":return m.stop()}}),_callee,this)})))},a.getSuperTeams=function getSuperTeams(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var t,a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=c.sent,a=t.content.superTeams,c.abrupt("return",formatSuperTeams(a));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.updateSuperTeamInfo=function updateSuperTeamInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateSuperTeam(t),c.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:a});case 4:return c.abrupt("return",formatSuperTeam(a));case 5:case"end":return c.stop()}}),_callee3,this)})))},a.addSuperTeamMembers=function addSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.removeSuperTeamMembers=function removeSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.addSuperTeamManagers=function addSuperTeamManagers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},a.removeSuperTeamManagers=function removeSuperTeamManagers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.applySuperTeam=function applySuperTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a;return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),c.next=3,this.core.sendCmd("applySuperTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=c.sent,c.abrupt("return",formatSuperTeam(a.content.superTeam));case 5:case"end":return c.stop()}}),_callee8,this)})))},a.transferSuperTeam=function transferSuperTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){return Dc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferSuperTeam",t);case 3:case"end":return a.stop()}}),_callee9,this)})))},a.muteSuperTeam=function muteSuperTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.muteSuperTeamMembers=function muteSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a,c;return Dc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),m.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:a});case 4:return c=formatSuperTeamMember(qt({updateTime:(new Date).getTime()},a)),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee12,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a,c,m;return Dc.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),h.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:a});case 4:return c=formatSuperTeamMember(qt({updateTime:(new Date).getTime(),account:this.core.account},a)),m=this.emitMemberUpdate(c),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",m),h.abrupt("return",c);case 8:case"end":return h.stop()}}),_callee13,this)})))},a.getSuperTeamMembersByAccounts=function getSuperTeamMembersByAccounts(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var c,m,h;return Dc.wrap((function _callee14$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},t),m=map$6(c=t.accounts).call(c,(function(a){return t.teamId+"|"+a})),g.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:m});case 4:return h=g.sent,g.abrupt("return",formatSuperTeamMembers(null===(a=h.content)||void 0===a?void 0:a.superTeamMembers));case 6:case"end":return g.stop()}}),_callee14,this)})))},a.getSuperTeamMembers=function getSuperTeamMembers(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){var c;return Dc.wrap((function _callee15$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},t),m.next=3,this.core.sendCmd("getSuperTeamMembers",qt({joinTime:0,limit:100,reverse:!1},t));case 3:return c=m.sent,m.abrupt("return",formatSuperTeamMembers(null===(a=c.content)||void 0===a?void 0:a.superTeamMembers));case 5:case"end":return m.stop()}}),_callee15,this)})))},a.queryMuteMembers=function queryMuteMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a,c;return Dc.wrap((function _callee16$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),m.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",qt({limit:100,joinTime:0,reverse:!1},t));case 3:return a=m.sent,c=a.content,m.abrupt("return",formatSuperTeamMembers(c.superTeamMembers));case 6:case"end":return m.stop()}}),_callee16,this)})))},a.leaveSuperTeam=function leaveSuperTeam(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){return Dc.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee17,this)})))},a.passSuperTeamApply=function passSuperTeamApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){var a;return Dc.wrap((function _callee18$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("passSuperTeamApply",t);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee18,this,[[1,7]])})))},a.rejectSuperTeamApply=function rejectSuperTeamApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){var a;return Dc.wrap((function _callee19$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee19,this,[[1,7]])})))},a.acceptSuperTeamInvite=function acceptSuperTeamInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){var a;return Dc.wrap((function _callee20$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("acceptSuperTeamInvite",t);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee20,this,[[1,7]])})))},a.rejectSuperTeamInvite=function rejectSuperTeamInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var a;return Dc.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee21,this,[[1,7]])})))},a.emitMemberUpdate=function emitMemberUpdate(t){t=formatSuperTeamMember(t),this.mergeMyTeamMembers([t]),this.core.emit("updateTeamMember",t);var a=MS(this.mySuperTeamMembersMap.get(t.teamId));return this.core.emit("myTeamMembers",[a]),a},a.mergeMyTeamMembers=function mergeMyTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.teamId,m=a.mySuperTeamMembersMap.get(c),h=qt({},m,t);a.mySuperTeamMembersMap.set(c,h)}))},a.syncSuperTeamsHandler=function syncSuperTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:em(a.timetag)});var c=null==a?void 0:a.teams;if(c&&c.length){var m=formatSuperTeams(c);this.core.emit("superTeams",m)}},a.syncCreateSuperTeamHandler=function syncCreateSuperTeamHandler(t){var a=t.content,c=formatSuperTeam(null==a?void 0:a.superTeam),m=generatorMemberBySuperTeam(c,c.owner,"owner");this.core.emit("createSuperTeam",c,m)},a.syncUpdateSuperTeamMemberHandler=function syncUpdateSuperTeamMemberHandler(t){var a=t.content,c=formatSuperTeamMember(null==a?void 0:a.teamMember);c.updateTime||(c.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([c]),this.core.emit("updateSuperTeamMember",c);var m=MS(this.mySuperTeamMembersMap.get(c.teamId));this.core.emit("mySuperTeamMembers",[m])},a.syncMySuperTeamMembersHandler=function syncMySuperTeamMembersHandler(t){var a,c=t.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:em(c.timetag)});var m=null==c?void 0:map$6(a=c.teamMembers).call(a,(function(t){return formatSuperTeamMember(t)}));this.mergeMySuperTeamMembers(m),this.core.emit("mySuperTeamMembers",MS(m))},a.notificationHandler=function notificationHandler(t){var a=t.attach,c=t.scene,m=t.from,h=t.to,g=t.time,I=t.idServer,M=t.idClient,T=a.team,S=a.account,E=a.accounts,C=a.type;if("superTeam"===c)switch("debug"===this.core.options.debugLevel?this.logger.debug("superTeam::recvNotification",I,M,a):this.logger.log("superTeam::recvNotification",I,M,h,C,S,E),C){case"updateSuperTeam":T.updateTime=g,this.core.emit("updateSuperTeam",T);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(T,E);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(T,[m]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(T,[S]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(h,E,!0,g);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(h,E,!1,g);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(T,E);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(T,[m]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:h});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(T,m,S);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(T,E,a.mute)}},SuperTeamService}(Ev),jE={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},YE={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},$E=function(t){function PluginService(a){var c;return(c=t.call(this,"plugin",a)||this).core=a,registerParser({cmdMap:jE,cmdConfig:YE}),c}kt(PluginService,t);var a=PluginService.prototype;return a.getChatroomAddress=function getChatroomAddress(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:t.chatroomId,isWeixinApp:"WXAPP"===Cp.platform,ipType:t.ipType||0});case 3:return a=c.sent,c.abrupt("return",a.content.address);case 5:case"end":return c.stop()}}),_callee,this)})))},a.getQChatAddress=function getQChatAddress(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({ipType:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==t?void 0:t.ipType)||0}});case 3:return a=c.sent,c.abrupt("return",a.content.address);case 5:case"end":return c.stop()}}),_callee2,this)})))},PluginService}(Ev),WE={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},zE={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},KE=invertSerializeMap(zE),QE={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:zE.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:KE.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:KE.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:zE.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:KE.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:zE.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:zE.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:KE.sessionTag}]}},JE={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function formatCloudSession(t,a,c){var m=format(JE,t),h=getAccountFromSessionId(m.sessionId,"|"),g=h.accid,I=h.scene;if(m.sessionId=I+"-"+g,m.lastMsg){var M=1===m.lastMsgType;m.lastMsgInfo=M?{isLastMsgRecalled:M,revokedMsg:formatSystemMessage(deserialize(m.lastMsg,CS.sysMsg),c)}:{isLastMsgRecalled:M,lastMsg:formatMsg$1(deserialize(m.lastMsg,nT.msg),{account:a})}}return delete m.lastMsg,delete m.lastMsgType,m}function formatCloudSessions(t,a,c){return t&&t.length>0?map$6(t).call(t,(function(t){return formatCloudSession(t,a,c)})):[]}var XE,ZE,eC,tC=function(t){function CloudSessionService(a){var c;return c=t.call(this,"cloudSession",a)||this,registerParser({cmdMap:WE,cmdConfig:QE}),c}kt(CloudSessionService,t);var a=CloudSessionService.prototype;return a.queryCloudSessionList=function queryCloudSessionList(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g;return Dc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return validate({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},t),(c=qt({limit:100,includedLastMsg:!0},t)).includedLastMsg=Cm.boolean(t,"includedLastMsg"),I.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:c});case 5:return m=I.sent,h=(null===(a=m.content)||void 0===a?void 0:a.tag)||{},g=m.content.sessions,I.abrupt("return",{hasMore:+h.hasMore>0,sessionList:formatCloudSessions(g,this.core.account,this.logger)});case 9:case"end":return I.stop()}}),_callee,this)})))},a.queryCloudSession=function queryCloudSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h;return Dc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:return validate({sessionId:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.sessionId,"-"),c=a.accid,m=a.scene,g.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===m?"super_team|"+c:m+"|"+c}});case 4:return h=g.sent,g.abrupt("return",formatCloudSession(h.content.session,this.core.account,this.logger));case 6:case"end":return g.stop()}}),_callee2,this)})))},a.updateCloudSession=function updateCloudSession(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c,m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=getAccountFromSessionId(t.sessionId,"-"),c=a.accid,m=a.scene,h.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===m?"super_team|"+c:m+"|"+c,ext:t.ext}});case 4:case"end":return h.stop()}}),_callee3,this)})))},a.deleteCloudSessionList=function deleteCloudSessionList(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c;return Dc.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({sessionIdList:{type:"array",itemType:"string"}},t),c=map$6(a=t.sessionIdList).call(a,(function(t){var a=getAccountFromSessionId(t,"-"),c=a.accid,m=a.scene;return{sessionId:"superTeam"===m?"super_team|"+c:m+"|"+c}})),m.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:c});case 4:case"end":return m.stop()}}),_callee4,this)})))},a.nimMultiSyncUpdateCloudSessionHandler=function nimMultiSyncUpdateCloudSessionHandler(t){var a=formatCloudSession(t.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",a)},CloudSessionService}(Ev);!function(t){t[t.audio=1]="audio",t[t.video=2]="video",t[t.custom=3]="custom"}(XE||(XE={})),function(t){t[t.kClose=1]="kClose",t[t.kJoin=2]="kJoin",t[t.kInvite=3]="kInvite",t[t.kCancelInvite=4]="kCancelInvite",t[t.kReject=5]="kReject",t[t.kAccept=6]="kAccept",t[t.kLeave=7]="kLeave",t[t.kCustom=8]="kCustom"}(ZE||(ZE={})),function(t){t[t.kDefault=0]="kDefault",t[t.kLeave=1]="kLeave",t[t.kSelfSync=3]="kSelfSync"}(eC||(eC={}));var rC={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},nC={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},aC={avSignalTag:qt({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},iC=invertSerializeMap(aC),oC={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:iC.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:iC.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:iC.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},sC={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:rC,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function formatSignalingChannelMember(t){return format(sC,deserialize(t,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function formatSignaling(t){var a,c=format(sC,t),m=[];c.members&&c.members.length>0&&(m=map$6(a=c.members).call(a,(function(t){return formatSignalingChannelMember(t)})),delete c.members);return m.length>0?{channelInfo:c,memberList:m}:{channelInfo:c}}function formatSignalingWithCallStatus(t){var a,c=format(sC,t),m=[];c.members&&c.members.length>0&&(m=map$6(a=c.members).call(a,(function(t){return formatSignalingChannelMember(t)})),delete c.members);var h=200;return t.callStatus&&(h=Number(t.callStatus)),m.length>0?{channelInfo:c,memberList:m,callStatus:h}:{channelInfo:c,callStatus:h}}function generateSignalingForCmd(t){return formatReverse(sC,t)}var cC,lC,uC,dC,pC,mC,hC,gC=function(t){function SignalingService(a){var c;return(c=t.call(this)||this).timer=0,c.pollingInterval=12e4,c.name="signaling",c.logger=a.logger,c.core=a,c.channels={},registerParser({cmdMap:nC,cmdConfig:oC}),c}kt(SignalingService,t);var a=SignalingService.prototype;return a.callEx=function callEx(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g;return Dc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return validate({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:rC},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),I.next=3,this.core.sendCmd("signalingCallEx",{tag:generateSignalingForCmd(t)});case 3:return c=I.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h=formatSignalingWithCallStatus(m),this.channels[h.channelInfo.channelId]=MS(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),I.abrupt("return",h);case 9:case"end":return I.stop()}}),_callee,this)})))},a.joinAndAccept=function joinAndAccept(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m,h,g,I,M;return Dc.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),c=t.fromAccid,(m=__rest(t,["fromAccid"])).toAccid=c,T.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:generateSignalingForCmd(m)});case 5:return h=T.sent,g=(null===(a=h.content)||void 0===a?void 0:a.data)||{},I=formatSignalingWithCallStatus(g),this.channels[I.channelInfo.channelId]=MS(I.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(M=this.aotoDelay).call(M,this),this.pollingInterval,-1)),T.abrupt("return",I);case 11:case"end":return T.stop()}}),_callee2,this)})))},a.create=function create(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c,m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"number"},ext:{type:"string",required:!1}},t),h.next=3,this.core.sendCmd("signalingCreate",{tag:generateSignalingForCmd(t)});case 3:return c=h.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h.abrupt("return",formatSignaling(m));case 6:case"end":return h.stop()}}),_callee3,this)})))},a.close=function close(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingClose",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.queryInfo=function queryInfo(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var c,m;return Dc.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return validate({name:{type:"string",allowEmpty:!1}},t),h.next=3,this.core.sendCmd("signalingQueryInfo",{tag:t});case 3:return c=h.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h.abrupt("return",formatSignaling(m));case 6:case"end":return h.stop()}}),_callee5,this)})))},a.join=function join(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var c,m,h,g;return Dc.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},t),I.next=3,this.core.sendCmd("signalingJoin",{tag:generateSignalingForCmd(t)});case 3:return c=I.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h=formatSignaling(m),this.channels[h.channelInfo.channelId]=MS(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),I.abrupt("return",h);case 9:case"end":return I.stop()}}),_callee6,this)})))},a.aotoDelay=function aotoDelay(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var t,a,c,m,h;return Dc.wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:if(0!==(t=mn(this.channels)).length){g.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,g.abrupt("return");case 5:this.logger.log("signling:autoDelay",t),a=0;case 7:if(!(a<t.length)){g.next=24;break}return c=t[a],g.prev=9,g.next=12,this.core.sendCmd("signalingDelay",{tag:{channelId:c}});case 12:m=g.sent,h=formatSignaling(m.content.data),this.channels[c]=h.channelInfo,g.next=21;break;case 17:g.prev=17,g.t0=g.catch(9),this.logger.warn("signling:autoDelay "+c+" failed",g.t0),delete this.channels[c];case 21:a++,g.next=7;break;case 24:case"end":return g.stop()}}),_callee7,this,[[9,17]])})))},a.leave=function leave(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){return Dc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingLeave",{tag:generateSignalingForCmd(t)});case 3:delete this.channels[t.channelId];case 4:case"end":return a.stop()}}),_callee8,this)})))},a.invite=function invite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){return Dc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:rC}},t),a.next=3,this.core.sendCmd("signalingInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.cancelInvite=function cancelInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingCancelInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.reject=function reject(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var a,c;return Dc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a=t.fromAccid,(c=__rest(t,["fromAccid"])).toAccid=a,m.next=5,this.core.sendCmd("signalingReject",{tag:generateSignalingForCmd(c)});case 5:case"end":return m.stop()}}),_callee11,this)})))},a.accept=function accept(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a,c,m,h,g;return Dc.wrap((function _callee12$(I){for(;;)switch(I.prev=I.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},t),a=t.autoJoin,c=t.joinAttachExt,m=t.fromAccid,(h=__rest(t,["autoJoin","joinAttachExt","fromAccid"])).toAccid=m,I.next=5,this.core.sendCmd("signalingAccept",{tag:generateSignalingForCmd(h)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+t.autoJoin),!a){I.next=10;break}return g={channelId:t.channelId,needOffline:t.needOffline,attachExt:c,uid:t.uid},I.next=10,this.join(g);case 10:case"end":return I.stop()}}),_callee12,this)})))},a.sendCustomCommand=function sendCustomCommand(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){return Dc.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee13,this)})))},a.signalingRecvNotificationHandler=function signalingRecvNotificationHandler(t){var a="number"==typeof ws(t,"raw.r[0]")?""+t.raw.r[0]:"0";t.content.data.msgId=t.content.data.msgId||a,this.doNotify(t.content.data),a&&em(a)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[a]})},a.signalingMultiSyncNotificationHandler=function signalingMultiSyncNotificationHandler(t){this.doNotify(t.content.data,eC.kSelfSync)},a.doNotify=function doNotify(t,a){void 0===a&&(a=eC.kDefault);var c=function formatSignalingNotification(t,a){void 0===a&&(a=eC.kDefault);var c=format(sC,t),m=c.attach,h=c.attachExt,g=c.time,I=c.msgId;c.fromAccid,c.toAccid,c.members,c.requestId,c.pushInfo;var M=__rest(c,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===m.type)try{c.member={accid:c.attach.member[1],uid:Number(c.attach.member[2]),createTime:Number(c.attach.member[3]),expireTime:Number(c.attach.member[4])}}catch(t){delete c.member}var T=m.type;return delete c.attach,{metaData:{eventType:T,channelInfo:M,feature:a,ext:h||"",time:g,msgId:I},rawData:c}}(t,a),m=c.metaData,h=c.rawData,g=h.fromAccid,I=h.toAccid,M=h.requestId,T=h.pushInfo,S=h.msgId,E=h.member;switch(m.eventType){case ZE.kClose:this.emit("signalingClose",{fromAccid:g,metaData:m});break;case ZE.kJoin:this.emit("signalingJoin",{fromAccid:g,metaData:m,member:E});break;case ZE.kInvite:this.emit("signalingInvite",{fromAccid:g,toAccid:I,requestId:M,pushInfo:T,metaData:m});break;case ZE.kCancelInvite:this.emit("signalingCancelInvite",{fromAccid:g,toAccid:I,requestId:M,metaData:m});break;case ZE.kReject:this.emit("signalingReject",{fromAccid:g,toAccid:I,requestId:M,metaData:m});break;case ZE.kAccept:this.emit("signalingAccept",{fromAccid:g,toAccid:I,requestId:M,metaData:m});break;case ZE.kLeave:this.emit("signalingLeave",{fromAccid:g,metaData:m});break;case ZE.kCustom:this.emit("signalingCustomCommand",{fromAccid:g,metaData:m});break;default:this.logger.warn("signaling:notification, no such a type "+m.eventType,h)}return S},a.signalingSyncNotificationHandler=function signalingSyncNotificationHandler(t){var a,c,m=this;if(t.content.datas&&t.content.datas.length>0){var h=filter(a=map$6(c=t.content.datas).call(c,(function(t){return m.doNotify(t,eC.kLeave)}))).call(a,(function(t){return t}));h.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:h})}},a.singalingSyncChannelsHandler=function singalingSyncChannelsHandler(t){var a,c=this;if(this.timer=0,this.channels={},t.content.datas&&t.content.datas.length>0){var m=map$6(a=t.content.datas).call(a,(function(t){return formatSignaling(t)}));forEach$1(m).call(m,(function(t){var a=t.channelInfo.channelId;c.channels[a]=MS(t.channelInfo)})),this.emit("singalingSyncChannels",m)}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t),Mi.resolve(t);var c=ws(t,"error.detail.ignore");return t.error&&!c?Mi.reject(t.error):Mi.resolve(t)},SignalingService}(Hi.EventEmitter),vC=function(t){function Service(a,c){var m;return(m=t.call(this)||this).name=a,m.core=c,m.name=a,m.logger=c.logger,m.core=c,m}kt(Service,t);var a=Service.prototype;return a.emit=function emit(a){var c=this;try{for(var m,h,g=arguments.length,I=new Array(g>1?g-1:0),M=1;M<g;M++)I[M-1]=arguments[M];var T=(m=t.prototype.emit).call.apply(m,concat(h=[this,a]).call(h,I));return T}catch(t){return Gi((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var c=ws(t,"error.detail.ignore");return t.error&&!c?Mi.reject(t.error):Mi.resolve(t)},Service}(Hi),fC={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},yC={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},_C={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:yC,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},IC=function getDeserializeTag(){return invertSerializeMap(_C)},MC=function getCmdConfig(){var t=IC();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:_C.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:_C.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:_C.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:_C.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:t.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:_C.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:_C.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:_C.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:_C.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:_C.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:_C.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:_C.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:_C.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:_C.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:_C.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:t.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:_C.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:t.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:t.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:_C.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:_C.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:_C.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:_C.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:_C.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:_C.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:_C.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:_C.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:_C.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:_C.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:t.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:t.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:_C.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:_C.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:_C.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:_C.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:_C.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:t.qchatChannelIdInfoTag}]}}};!function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime"}(cC||(cC={})),function(t){t[t.white=1]="white",t[t.black=2]="black"}(lC||(lC={})),function(t){t[t.add=1]="add",t[t.remove=2]="remove"}(uC||(uC={})),function(t){t[t.message=0]="message",t[t.media=1]="media",t[t.ext=100]="ext"}(dC||(dC={})),function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(pC||(pC={})),function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime",t[t.totalMember=2]="totalMember"}(mC||(mC={})),function(t){t[t.square=1]="square",t[t.person=2]="person"}(hC||(hC={}));var TC={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:dC},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},SC={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},EC={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:lC},opeType:{type:"enum",values:uC},toAccids:{type:"object"}},CC={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:lC},opeType:{type:"enum",values:uC},roleId:{type:"string"}},bC={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},AC={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatUpdateWhiteBlackRole(t){return format(CC,t)}function formatChannel(t){return format(TC,t)}function formatChannels(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatChannel(t)})):[]}function formatUnreadInfo(t){return format(SC,t)}function formatUnreadInfos(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatUnreadInfo(t)})):[]}function formatChannelCategory(t){return format(bC,t)}function formatChannelCategorys(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatChannelCategory(t)})):[]}function formatChannelMembers(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatChannelMember(t){return format(AC,t)}(t)})):[]}function formatFailServerIds(t){try{return JSON.parse(t)}catch(t){return[]}}var NC={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},RC={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},wC={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatServer(t){return format(NC,t)}function formatServers(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatServer(t)})):[]}function formatMember$1(t){return format(RC,t)}function formatMembers$1(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatMember$1(t)})):[]}function formatServerMemberBanInfos(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatServerMemberBanInfo(t){return format(wC,t)}(t)})):[]}function generateAntispamTag(t){var a,c,m;if(!t.antispamTag)return{};var h=qt({},t.antispamTag);return(null===(a=t.antispamTag)||void 0===a?void 0:a.antiSpamBusinessId)&&"string"!=typeof(null===(c=t.antispamTag)||void 0===c?void 0:c.antiSpamBusinessId)&&(h.antiSpamBusinessId=Fc(null===(m=t.antispamTag)||void 0===m?void 0:m.antiSpamBusinessId)),h}var kC={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function formatInviteApplyRecord(t){return format(kC,t)}function formatInviteApplyRecords(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatInviteApplyRecord(t)})):[]}var OC,PC,xC,VC,LC={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function formatClearServersUnread(t){return format(LC,t)}!function(t){t[t.everyone=1]="everyone",t[t.custom=2]="custom"}(OC||(OC={})),function(t){t[t.normal=0]="normal",t[t.owner=1]="owner"}(PC||(PC={})),function(t){t[t.ignore=0]="ignore",t[t.deny=-1]="deny",t[t.allow=1]="allow"}(xC||(xC={})),function(t){t[t.manageServer=1]="manageServer",t[t.manageChannel=2]="manageChannel",t[t.manageRole=3]="manageRole",t[t.sendMsg=4]="sendMsg",t[t.accountInfoSelf=5]="accountInfoSelf",t[t.inviteServer=6]="inviteServer",t[t.kickServer=7]="kickServer",t[t.accountInfoOther=8]="accountInfoOther",t[t.recallMsg=9]="recallMsg",t[t.deleteMsg=10]="deleteMsg",t[t.remindOther=11]="remindOther",t[t.remindEveryone=12]="remindEveryone",t[t.manageBlackWhiteList=13]="manageBlackWhiteList",t[t.banServerMember=14]="banServerMember",t[t.RTCChannelConnect=15]="RTCChannelConnect",t[t.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",t[t.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",t[t.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",t[t.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",t[t.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",t[t.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",t[t.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",t[t.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",t[t.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",t[t.manageInviteApply=25]="manageInviteApply",t[t.manageInviteApplyHistory=26]="manageInviteApplyHistory",t[t.mentionedRole=27]="mentionedRole"}(VC||(VC={}));var DC,UC,FC,BC,qC,GC,HC,jC,YC={type:{type:"enum",values:OC},memberType:{type:"enum",values:PC},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},$C={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:OC},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},WC={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:PC},joinTime:{type:"number"},inviter:{type:"string"}};function generatorRoleForCmd(t){var a=qt({},t),c=formatReverse(YC,a);return c.auths&&(c.auths=function generateRoleAuthsForCmd(t){var a,c=reduce(a=mn(t)).call(a,(function(a,c){var m=VC[c];return m?a[m]=xC[t[c]]:a[c]=xC[t[c]],a}),{});return Fc(c)}(c.auths)),c}function formatRoleAuths(t){var a;return reduce(a=mn(t)).call(a,(function(a,c){var m=getEnumKeyByEnumValue(VC,c);m?a[m]=xC[t[c]]:a[em(c)]=xC[t[c]];return a}),{})}function formatRole(t){var a=format(YC,t);return t.auths&&(a.auths=formatRoleAuths(JSON.parse(a.auths))),a.isMember&&delete a.isMember,a}function formatRoles(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatRole(t)})):[]}function formatChannelCategoryRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format($C,t)}function formatChannelCategoryMemberRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(WC,t)}function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)}!function(t){t[t.default=1]="default",t[t.sync=2]="sync"}(DC||(DC={})),function(t){t[t.sendTime=1]="sendTime"}(UC||(UC={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(FC||(FC={})),function(t){t[t.sending=1]="sending",t[t.success=2]="success",t[t.failed=3]="failed"}(BC||(BC={})),function(t){t[t.notifyAll=1]="notifyAll",t[t.notifySubscribe=2]="notifySubscribe"}(qC||(qC={})),function(t){t[t.unknown=0]="unknown",t[t.server=1]="server",t[t.channel=2]="channel",t[t.serverAccids=3]="serverAccids",t[t.channelAccids=4]="channelAccids",t[t.accids=5]="accids"}(GC||(GC={})),function(t){t[t.serverMemberInvite=1]="serverMemberInvite",t[t.serverMemberInviteReject=2]="serverMemberInviteReject",t[t.serverMemberApply=3]="serverMemberApply",t[t.serverMemberApplyReject=4]="serverMemberApplyReject",t[t.serverCreate=5]="serverCreate",t[t.serverRemove=6]="serverRemove",t[t.serverUpdate=7]="serverUpdate",t[t.serverMemberInviteDone=8]="serverMemberInviteDone",t[t.serverMemberInviteAccept=9]="serverMemberInviteAccept",t[t.serverMemberApplyDone=10]="serverMemberApplyDone",t[t.serverMemberApplyAccept=11]="serverMemberApplyAccept",t[t.serverMemberKick=12]="serverMemberKick",t[t.serverMemberLeave=13]="serverMemberLeave",t[t.serverMemberUpdate=14]="serverMemberUpdate",t[t.channelCreate=15]="channelCreate",t[t.channelRemove=16]="channelRemove",t[t.channelUpdate=17]="channelUpdate",t[t.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",t[t.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",t[t.updateQuickComment=20]="updateQuickComment",t[t.channelCategoryCreate=21]="channelCategoryCreate",t[t.channelCategoryRemove=22]="channelCategoryRemove",t[t.channelCategoryUpdate=23]="channelCategoryUpdate",t[t.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",t[t.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",t[t.serverIdentifyAdd=26]="serverIdentifyAdd",t[t.serverIdentifyRemove=27]="serverIdentifyRemove",t[t.serverIdentifyUpdate=28]="serverIdentifyUpdate",t[t.channelIdentifyUpdate=29]="channelIdentifyUpdate",t[t.userIdentifyUpdate=30]="userIdentifyUpdate",t[t.channelVisibilityUpdate=31]="channelVisibilityUpdate",t[t.serverEnterLeave=32]="serverEnterLeave",t[t.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",t[t.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",t[t.myMemberInfoUpdated=35]="myMemberInfoUpdated",t[t.custom=100]="custom",t[t.msgTyping=101]="msgTyping"}(HC||(HC={})),function(t){t[t.reply=1]="reply",t[t.thread=2]="thread",t[t.all=3]="all"}(jC||(jC={}));var zC=Math.max,KC=Math.min;function debounce(t,a,c){var m,h,g,I,M,T,S=0,E=!1,C=!1,b=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function invokeFunc(a){var c=m,g=h;return m=h=void 0,S=a,I=t.apply(g,c)}function leadingEdge(t){return S=t,M=Gi(timerExpired,a),E?invokeFunc(t):I}function shouldInvoke(t){var c=t-T;return void 0===T||c>=a||c<0||C&&t-S>=g}function timerExpired(){var t=wi();if(shouldInvoke(t))return trailingEdge(t);M=Gi(timerExpired,function remainingWait(t){var c=a-(t-T);return C?KC(c,g-(t-S)):c}(t))}function trailingEdge(t){return M=void 0,b&&m?invokeFunc(t):(m=h=void 0,I)}function debounced(){var t=wi(),c=shouldInvoke(t);if(m=arguments,h=this,T=t,c){if(void 0===M)return leadingEdge(T);if(C)return clearTimeout(M),M=Gi(timerExpired,a),invokeFunc(T)}return void 0===M&&(M=Gi(timerExpired,a)),I}return a=Number(a)||0,isObject(c)&&(E=!!c.leading,g=(C="maxWait"in c)?zC(Number(c.maxWait)||0,a):g,b="trailing"in c?!!c.trailing:b),debounced.cancel=function cancel(){void 0!==M&&clearTimeout(M),S=0,m=T=h=M=void 0},debounced.flush=function flush(){return void 0===M?I:trailingEdge(wi())},debounced}var QC;function throttle(t,a,c){var m=!0,h=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return isObject(c)&&(m="leading"in c?!!c.leading:m,h="trailing"in c?!!c.trailing:h),debounce(t,a,{leading:m,maxWait:a,trailing:h})}!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(QC||(QC={}));var JC=function(){function UnreadInfoModuleService(t){var a=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=throttle((function(t){a.core.emit("serverUnreadInfo",a.getServerUnreadInfo(t)),ws(a.core,"qchatServer.emit")&&a.core.qchatServer.emit("serverUnreadInfo",a.getServerUnreadInfo(t))}),100),this.core=t}var t=UnreadInfoModuleService.prototype;return t.changeCacheServerRoleIds=function changeCacheServerRoleIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g,I,M,T=this;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:if(c=t.attach.serverIdentifyInfo,m=c.serverId,h=c.roleId,this.serverRoleIdsMap[m]){S.next=4;break}return S.next=4,this.getRoleIdsByServerId([m]);case 4:if(g=this.serverRoleIdsMap[m],!(t.time<g.timeTag)){S.next=7;break}return S.abrupt("return");case 7:if(t.type===HC[HC.serverIdentifyAdd]?g.roleIds.add(h):g.roleIds.delete(h),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+m+" roleIds is",concat(a=[]).call(a,g.roleIds)),I=this.unreadServerCount[m]){S.next=12;break}return S.abrupt("return");case 12:M=YT(mn(I),100),forEach$1(M).call(M,(function(t){T.core.qchatChannel.getChannelUnreadInfos({channels:map$6(t).call(t,(function(t){return{serverId:m,channelId:t}}))})}));case 14:case"end":return S.stop()}}),_callee,this)})))},t.getRoleIdsByServerId=function getRoleIdsByServerId(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g=this;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:if((c=filter(t).call(t,(function(t){return!g.serverRoleIdsMap[t]}))).length){I.next=3;break}return I.abrupt("return");case 3:return m={serverIdTimeTags:c},I.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:m});case 6:h=I.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",m,"result is",h),forEach$1(a=h.content.serverRoles).call(a,(function(t){try{t.roleIds=JSON.parse(t.roleIds)}catch(t){g.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}g.serverRoleIdsMap[t.serverId]={roleIds:new hI(t.roleIds),timeTag:t.timeTag}}));case 9:case"end":return I.stop()}}),_callee2,this)})))},t._unSubscribeChannel=function _unSubscribeChannel(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var c,m,h,g,I;return Dc.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:if(c=t+"_"+a,m=[],this.manualSubscribeUnreadMap[c]?m.push(this.manualSubscribeUnreadMap[c]):this.autoSubscribeUnreadMap[c]&&m.push(this.autoSubscribeUnreadMap[c]),this.manualSubscribeTypingMap[c]&&m.push(this.manualSubscribeTypingMap[c]),0!==m.length){M.next=6;break}return M.abrupt("return");case 6:for(h=0,g=m;h<g.length;h++)I=g[h],this.subscribe({opeType:QC.unSub,type:I,channels:[{serverId:t,channelId:a}]});this.manualSubscribeUnreadMap[c]?this.manualSubscribeUnreadMap[c]=void 0:this.autoSubscribeUnreadMap[c]&&(this.autoSubscribeUnreadMap[c]=void 0),this.manualSubscribeTypingMap[c]&&(this.manualSubscribeTypingMap[c]=void 0);case 9:case"end":return M.stop()}}),_callee3,this)})))},t._unSubscribeServer=function _unSubscribeServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c;return Dc.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t,c=this.manualSubscribeServerMap[a]||this.autoSubscribeServerMap[a]){m.next=4;break}return m.abrupt("return");case 4:this.subscribe({opeType:QC.unSub,type:c,channels:[{serverId:t,channelId:""}]}),this.manualSubscribeServerMap[a]?this.manualSubscribeServerMap[a]=void 0:this.autoSubscribeServerMap[a]&&(this.autoSubscribeServerMap[a]=void 0);case 6:case"end":return m.stop()}}),_callee4,this)})))},t.subscribe=function subscribe(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a,c,m,h,g=this;return Dc.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),I.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return c=I.sent,m=new hI,forEach$1(a=t.channels).call(a,(function(t){return __awaiter(g,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:this.serverRoleIdsMap[t.serverId]||m.add(t.serverId);case 1:case"end":return a.stop()}}),_callee5,this)})))})),h=YT(Wc(m),10),forEach$1(h).call(h,(function(t){g.getRoleIdsByServerId(t)})),I.abrupt("return",c.content);case 9:case"end":return I.stop()}}),_callee6,this)})))},t.autoSubscribe=function autoSubscribe(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return t.stop()}}),_callee7,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a,c,m,h,g,I,M,T=this;return Dc.wrap((function _callee10$(S){for(;;)switch(S.prev=S.next){case 0:if(this.serverRoleIdsMap={},g=100,t){S.next=6;break}return this.unreadServerCount={},this.unreadCount={},S.abrupt("return");case 6:return I={},forEach$1(a=mn(this.manualSubscribeUnreadMap)).call(a,(function(t){var a=T.manualSubscribeUnreadMap[t];if(a){var c=t.split("_"),m={serverId:c[0],channelId:c[1]};I[a]=I[a]||[],I[a].push(m)}})),I[5]=[],forEach$1(c=mn(this.manualSubscribeTypingMap)).call(c,(function(t){return __awaiter(T,void 0,void 0,Dc.mark((function _callee8(){var a,c,m,h;return Dc.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:this.manualSubscribeTypingMap[t]&&(a=t.split("_"),c=a[0],m=a[1],h={serverId:c,channelId:m},I[5].push(h));case 2:case"end":return g.stop()}}),_callee8,this)})))})),I[4]=[],forEach$1(m=mn(this.manualSubscribeServerMap)).call(m,(function(t){return __awaiter(T,void 0,void 0,Dc.mark((function _callee9(){var a;return Dc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:this.manualSubscribeServerMap[t]&&(a={serverId:t},I[4].push(a));case 2:case"end":return c.stop()}}),_callee9,this)})))})),M=[],forEach$1(h=mn(I)).call(h,(function(t){var a=I[t];if(a&&0===a.length)return Mi.resolve();if(a.length>g){var c=YT(a,100);return forEach$1(c).call(c,(function(a){M.push(T.createSubscribePromise(a,t))}))}M.push(T.createSubscribePromise(a,t))})),S.next=16,Mi.all(M);case 16:case"end":return S.stop()}}),_callee10,this)})))},t.createSubscribePromise=function createSubscribePromise(t,a){var c=this,m={type:em(a),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",m),this.subscribe(m).then((function(t){var a=t.unreadInfos;a&&a.length>0&&(a=formatUnreadInfos(a),c.updateUnreads(a))})).catch((function(t){c.core.logger.error("qchatChannel:: autoSubscribeUnread error ",t)}))},t.cacheSubscribe=function cacheSubscribe(t){var a,c=this;forEach$1(a=t.channels).call(a,(function(a){var m=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,h=5===t.type?c.manualSubscribeTypingMap:4===t.type?c.manualSubscribeServerMap:c.manualSubscribeUnreadMap;t.opeType===QC.sub?h[m]=t.type:t.opeType===QC.unSub&&(h[m]=void 0)}))},t.cacheAutoSubscribe=function cacheAutoSubscribe(t){var a,c=this;forEach$1(a=t.channels).call(a,(function(a){var m=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,h=4===t.type?c.autoSubscribeServerMap:c.autoSubscribeUnreadMap;t.opeType===QC.sub?h[m]=t.type:t.opeType===QC.unSub&&(h[m]=void 0)}))},t.cacheUnreadCount=function cacheUnreadCount(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.serverId+"_"+t.channelId;a.unreadCount[c]=qt({},t),a.unreadServerCount[t.serverId]||(a.unreadServerCount[t.serverId]={}),a.unreadServerCount[t.serverId][t.channelId]=!0}))},t.getServerUnreadInfo=function getServerUnreadInfo(t){var a,c=this,m={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0},h=this.unreadServerCount[t];h&&(forEach$1(a=mn(h)).call(a,(function(a){var h=t+"_"+a,g=c.unreadCount[h];m.unreadCount+=g.unreadCount,m.mentionedCount+=g.mentionedCount,void 0!==g.maxCount&&(m.maxCount=g.maxCount)})),m.unreadCount=m.unreadCount>m.maxCount?m.maxCount:m.unreadCount,m.mentionedCount=m.mentionedCount>m.maxCount?m.maxCount:m.mentionedCount);return m},t.getUnreadInfo=function getUnreadInfo(t){validate({serverId:{type:"string"},channelId:{type:"string"}},t);var a=t.serverId+"_"+t.channelId;return this.unreadCount[a]?this.unreadCount[a]:null},t.shouldChangeUnread=function shouldChangeUnread(t,a){if(!t.serverId||!t.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(t.serverId,t.channelId))return!1;if(!1===t.historyEnable)return!1;if(!1===t.needBadge)return!1;if(t.fromAccount===this.core.account)return!1;if(a&&2!==(null==t?void 0:t.status))return!1;if(t.notifyReason&&t.notifyReason===getEnumKeyByEnumValue(qC,qC.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var c=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),m=a?"ackTimestamp":"lastMsgTime";if(!c)return!1;if(t.time&&c[m]&&c[m]>t.time)return!1}return!0},t.shouldChangeMentionedUnread=function shouldChangeMentionedUnread(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var c,m;return Dc.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:if(!t.accidsOfMentionedRoles||!includes(c=t.accidsOfMentionedRoles).call(c,this.core.account)){h.next=2;break}return h.abrupt("return",!0);case 2:if(!t.mentionRoleIds||!t.serverId){h.next=16;break}if(this.serverRoleIdsMap[t.serverId]){h.next=9;break}if(a){h.next=7;break}return this.handledRoleMsg(t),h.abrupt("return",!1);case 7:return h.next=9,this.getRoleIdsByServerId([t.serverId]);case 9:m=0;case 10:if(!(m<t.mentionRoleIds.length)){h.next=16;break}if(!this.serverRoleIdsMap[t.serverId].roleIds.has(t.mentionRoleIds[m])){h.next=13;break}return h.abrupt("return",!0);case 13:m++,h.next=10;break;case 16:return h.abrupt("return",!1);case 17:case"end":return h.stop()}}),_callee11,this)})))},t.handledRoleMsg=function handledRoleMsg(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a,c,m,h,g,I=this;return Dc.wrap((function _callee12$(M){for(;;)switch(M.prev=M.next){case 0:if(t.mentionRoleIds){M.next=2;break}return M.abrupt("return");case 2:if(this.serverRoleIdsMap[t.serverId]){M.next=5;break}return M.next=5,this.getRoleIdsByServerId([t.serverId]);case 5:if(this.serverRoleIdsMap[t.serverId]){M.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",t.serverId),M.abrupt("return");case 8:if(c=!1,forEach$1(a=t.mentionRoleIds).call(a,(function(a){I.serverRoleIdsMap[t.serverId].roleIds.has(a)&&(c=!0,I.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCountï¼message is ",t))})),c){M.next=12;break}return M.abrupt("return");case 12:if(m=this.unreadCount[t.serverId+"_"+t.channelId],h=2===(null==t?void 0:t.status),m.mentionedCount=h?m.mentionedCount?m.mentionedCount-1:0:m.mentionedCount?m.mentionedCount+1:1,"number"!=typeof m.maxCount){M.next=25;break}if(!((g=(g=m.mentionedCount)>m.maxCount?m.maxCount:g)>m.maxCount)){M.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),M.abrupt("return");case 21:this.core.emit("unreadInfo",qt(qt({},m),{mentionedCount:g})),this.core.emit("unreadInfos",[qt(qt({},m),{mentionedCount:g})]),this.core.qchatChannel.emit("unreadInfos",[qt(qt({},m),{mentionedCount:g})]),this._serverUnreadInfo(t.serverId);case 25:case"end":return M.stop()}}),_callee12,this)})))},t.getMentionedFlag=function getMentionedFlag(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var c;return Dc.wrap((function _callee13$(m){for(;;)switch(m.prev=m.next){case 0:if(!t.mentionAll){m.next=4;break}return m.abrupt("return",!0);case 4:if(!t.mentionRoleIds&&!t.accidsOfMentionedRoles){m.next=10;break}return m.next=7,this.shouldChangeMentionedUnread(t,a);case 7:return m.abrupt("return",m.sent);case 10:if(!t.mentionAccids||!includes(c=t.mentionAccids).call(c,this.core.account)){m.next=12;break}return m.abrupt("return",!0);case 12:return m.abrupt("return",!1);case 13:case"end":return m.stop()}}),_callee13,this)})))},t.changeUnread=function changeUnread(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var c,m,h,g,I,M,T;return Dc.wrap((function _callee14$(S){for(;;)switch(S.prev=S.next){case 0:if(c=t.serverId,m=t.channelId,h=c+"_"+m,this.shouldChangeUnread(t,a)){S.next=6;break}return this.core.logger.debug("changeUnread: "+h+" does not need to update unreadInfo"),S.abrupt("return");case 6:if(this.unreadCount[h]){S.next=11;break}return S.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:c,channelId:m}]});case 9:return!this.serverRoleIdsMap[c]&&t.mentionRoleIds&&this.getRoleIdsByServerId([c]),S.abrupt("return");case 11:return g=this.unreadCount[h],I=2===(null==t?void 0:t.status),S.next=15,this.getMentionedFlag(t);case 15:if(M=S.sent,I?(g.unreadCount=g.unreadCount?g.unreadCount-1:0,M&&(g.mentionedCount=g.mentionedCount?g.mentionedCount-1:0),delete g.lastMsgTime,this.core.logger.debug("changeUnread: "+h+" unread reduce ",g)):(g.unreadCount=g.unreadCount?g.unreadCount+1:1,M&&(g.mentionedCount=g.mentionedCount?g.mentionedCount+1:1),t.time&&(g.lastMsgTime=t.time),this.core.logger.debug("changeUnread: "+h+" unread add ",g)),T="number"==typeof g.maxCount?g.maxCount:100,!(g.unreadCount>T)){S.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),S.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",qt(qt({},g),{mentionedCount:g.mentionedCount>T?T:g.mentionedCount,unreadCount:g.unreadCount>T?T:g.unreadCount})),this.core.emit("unreadInfos",[qt(qt({},g),{mentionedCount:g.mentionedCount>T?T:g.mentionedCount,unreadCount:g.unreadCount>T?T:g.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[qt(qt({},g),{mentionedCount:g.mentionedCount>T?T:g.mentionedCount,unreadCount:g.unreadCount>T?T:g.unreadCount})]),this._serverUnreadInfo(c);case 26:case"end":return S.stop()}}),_callee14,this)})))},t.updateUnreads=function updateUnreads(t){var a,c,m=this;if(t&&t.length>0){var h=[],g=[],I=map$6(a=filter(t).call(t,(function(t){var a=t.serverId+"_"+t.channelId,c=m.unreadCount[a],h=ws(c,"ackTimestamp"),g=ws(t,"ackTimestamp");return!(h&&g&&g<h)&&(ws(c,"unreadCount")!==ws(t,"unreadCount")||ws(c,"mentionedCount")!==ws(t,"mentionedCount"))}))).call(a,(function(t){h.push(m.getServerUnreadInfo(t.serverId)),g.push(m.unreadServerCount[t.serverId]);var a=t.serverId,c=t.channelId,I=a+"_"+c;return m.core.logger.debug("qchat channel updateUnread: ",t),m.unreadCount[I]=qt({},t),m.unreadServerCount[a]||(m.unreadServerCount[a]={}),m.unreadServerCount[a][c]=!0,t}));if(0!==I.length){this.core.emit("unreadInfos",I),this.core.qchatChannel.emit("unreadInfos",I);var M={};forEach$1(I).call(I,(function(t,a){m.core.emit("unreadInfo",t);var c=h[a],I=g[a],T=m.getServerUnreadInfo(t.serverId),S=m.unreadServerCount[t.serverId],E=c.unreadCount!==T.unreadCount,C=!I||0===mn(I).length,b=S&&mn(S).length>0,A=c.mentionedCount!==T.mentionedCount;(E||A||C&&b)&&(M[t.serverId]=!0)})),forEach$1(c=mn(M)).call(c,(function(t){m.core.emit("serverUnreadInfo",m.getServerUnreadInfo(t)),ws(m.core,"qchatServer.emit")&&m.core.qchatServer.emit("serverUnreadInfo",m.getServerUnreadInfo(t))}))}}},t.clearUnreadCountByServers=function clearUnreadCountByServers(t,a){var c=this,m=[];forEach$1(t).call(t,(function(t){var a;c.unreadServerCount[t]&&forEach$1(a=mn(c.unreadServerCount[t])).call(a,(function(a){m.push(t+"_"+a)}))}));var h=[];forEach$1(m).call(m,(function(t){h.push(qt(qt({},c.unreadCount[t]),{unreadCount:0,mentionedCount:0,ackTimestamp:a}))})),this.updateUnreads(h)},UnreadInfoModuleService}(),XC=function(){function SubscribeForVisitorService(t){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new hI,this.autoVisitorSubscribeServer=new hI,this.autoVisitorSubscribeChannel=new hI,this.core=t}var t=SubscribeForVisitorService.prototype;return t.subscribeChannelAsVisitor=function subscribeChannelAsVisitor(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c,m,h,g=this;return Dc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||6,opeType:t.opeType},datas:t.channels});case 2:return c=I.sent,m=c.content.failedArr,h=filter(a=t.channels).call(a,(function(t){return!some(m).call(m,(function(a){return a.channelId===t.channelId&&a.serverId===t.serverId}))})),forEach$1(h).call(h,(function(a){1===t.opeType?g.autoVisitorSubscribeChannel.add(a.serverId+"&"+a.channelId):g.autoVisitorSubscribeChannel.delete(a.serverId+"&"+a.channelId)})),I.abrupt("return",{failedChannels:m});case 7:case"end":return I.stop()}}),_callee,this)})))},t.subscribeServerAsVisitor=function subscribeServerAsVisitor(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g,I,M=this;return Dc.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||7,opeType:t.opeType},datas:map$6(a=t.serverIds).call(a,(function(t){return{serverId:t}}))});case 2:return h=T.sent,g=h.content.failedArr,I=filter(c=t.serverIds).call(c,(function(t){return!some(g).call(g,(function(a){return a.serverId===t}))})),forEach$1(I).call(I,(function(a){1===t.opeType?M.autoVisitorSubscribeServer.add(a):M.autoVisitorSubscribeServer.delete(a)})),T.abrupt("return",{failedServers:map$6(m=h.content.failedArr).call(m,(function(t){return t.serverId}))});case 7:case"end":return T.stop()}}),_callee2,this)})))},t.deleteServer=function deleteServer(t){var a;this.autoServers.delete(t),this.autoVisitorSubscribeServer.has(t)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[t]});var c=[];forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){if(0===indexOf(a).call(a,t)){var m=a.replace(t+"&","");c.push({serverId:t,channelId:m})}})),c.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:c})},t.deleteAutoSetInServerId=function deleteAutoSetInServerId(t){var a,c=this;this.autoServers.delete(t),this.autoVisitorSubscribeServer.delete(t),forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){0===indexOf(a).call(a,t)&&c.autoVisitorSubscribeChannel.delete(a)}))},t.deleteAutoSetInChannel=function deleteAutoSetInChannel(t,a){this.autoVisitorSubscribeChannel.delete(t+"&"+a)},t.unSubscribeChannel=function unSubscribeChannel(t,a){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:t,channelId:a}]})},t.isInSubscribeChannels=function isInSubscribeChannels(t,a){return this.autoVisitorSubscribeChannel.has(t+"&"+a)},t.isInAutoServers=function isInAutoServers(t){return this.autoServers.has(t)},t.doAutoSubscribe=function doAutoSubscribe(){var t=this,a=[],c=YT(Wc(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);forEach$1(c).call(c,(function(c){a.push(t.subscribeServerAsVisitor({opeType:1,serverIds:c}))}));var m=YT(Wc(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return forEach$1(m).call(m,(function(c){a.push(t.subscribeChannelAsVisitor({opeType:1,channels:map$6(c).call(c,(function(t){var a=indexOf(t).call(t,"&");return{serverId:slice$1(t).call(t,0,a),channelId:slice$1(t).call(t,a+1)}}))}))})),Mi.all(a)},t.doAutoEnterServer=function doAutoEnterServer(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var t,a,c,m=this;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return t=YT(Wc(this.autoServers),this.limitForBatchEnter),a=[],forEach$1(t).call(t,(function(t){a.push(m.core.qchatServer.enterAsVisitor({serverIds:t}))})),h.next=5,Mi.all(a);case 5:c=h.sent,forEach$1(c).call(c,(function(t){var a;forEach$1(a=t.failedServers).call(a,(function(t){m.deleteAutoSetInServerId(t)}))}));case 7:case"end":return h.stop()}}),_callee3,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!t){a.next=7;break}return a.next=3,this.doAutoEnterServer();case 3:return a.next=5,this.doAutoSubscribe();case 5:a.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return a.stop()}}),_callee4,this)})))},t.cacheServer=function cacheServer(t){var a=this;forEach$1(t).call(t,(function(t){return a.autoServers.add(t)}))},SubscribeForVisitorService}();function _createForOfIteratorHelperLoose$1(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$1(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var ZC,eb,tb=function(t){function QChatChannelService(a,c){var m;return(m=t.call(this,"qchatChannel",a)||this).config={autoSubscribe:!1},m.core=a,registerParser({cmdMap:fC,cmdConfig:MC()}),c&&m.setOptions(c),m.subscribeModuleService=new JC(a),m.subscribeForVisitorService=new XC(a),m.setListener(),m}kt(QChatChannelService,t);var a=QChatChannelService.prototype;return a.setOptions=function setOptions(t){t&&(this.config=qt(this.config,t))},a.setListener=function setListener(){var t,a,c,m,h,g=this;this.core.eventBus.on("logined",(function(t){g.subscribeModuleService.resumeSubscribe(t.isAutoReconnect),g.subscribeForVisitorService.resumeSubscribe(t.isAutoReconnect),g.config.autoSubscribe&&(g.subscribeModuleService.autoSubscribeServerMap={},g.subscribeModuleService.autoSubscribeUnreadMap={},g.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(t){g.subscribeModuleService.resumeSubscribe(t.isReconnect),g.subscribeForVisitorService.resumeSubscribe(t.isReconnect),g.config.autoSubscribe&&(g.subscribeModuleService.autoSubscribeServerMap={},g.subscribeModuleService.autoSubscribeUnreadMap={},g.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("qchatChannel/changeUnread",bind$1(t=this.subscribeModuleService.changeUnread).call(t,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",bind$1(a=this.subscribeModuleService.updateUnreads).call(a,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",bind$1(c=this.subscribeModuleService.cacheSubscribe).call(c,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",bind$1(m=this.subscribeModuleService.clearUnreadCountByServers).call(m,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",bind$1(h=this.subscribeModuleService.getRoleIdsByServerId).call(h,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(t){if(g.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",t),t.type===HC[HC.channelVisibilityUpdate])g.logger.log("QChatChannel::begin autoUnSubscribe channel key is",t.serverId+"_"+t.channelId),g.subscribeModuleService._unSubscribeChannel(t.serverId,t.channelId),g.logger.log("QChatChannel::autoUnSubscribe channel done key is",t.serverId+"_"+t.channelId);else if(t.type===HC[HC.serverEnterLeave]){var a;(g.subscribeModuleService.manualSubscribeServerMap[t.serverId]||g.subscribeModuleService.autoSubscribeServerMap[t.serverId])&&(g.logger.log("QChatChannel::begin autoUnSubscribe server key is",t.serverId),g.subscribeModuleService._unSubscribeServer(t.serverId),g.logger.log("QChatChannel::autoUnSubscribe server done key is",t.serverId));var c=g.subscribeModuleService.unreadServerCount[t.serverId];if(!c)return;g.logger.log("QChatChannel::begin autoUnSubscribe channels key is",mn(c)),forEach$1(a=mn(c)).call(a,(function(a){g.subscribeModuleService._unSubscribeChannel(t.serverId,a)})),g.logger.log("QChatChannel::autoUnSubscribe channels done key is",mn(c))}})),this.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(t){g.subscribeModuleService.changeCacheServerRoleIds(t)}))},a.createChannel=function createChannel(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(dC)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:qt(qt({},t),{type:dC[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return c.stop()}}),_callee,this)})))},a.deleteChannel=function deleteChannel(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteChannel",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateChannel=function updateChannel(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a,c;return Dc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:getEnumKeys(dC),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),a=t,t.type&&(a.type=dC[t.type]),m.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:a,antispamTag:generateAntispamTag(t)});case 5:return c=m.sent,m.abrupt("return",formatChannel(c.content.channelInfo));case 7:case"end":return m.stop()}}),_callee3,this)})))},a.getChannels=function getChannels(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannels",t);case 3:return a=c.sent,c.abrupt("return",formatChannels(a.content.channelList));case 5:case"end":return c.stop()}}),_callee4,this)})))},a.getChannelsByPage=function getChannelsByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a,c,m,h;return Dc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:qt({limit:100},t)});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatChannels(m)});case 6:case"end":return g.stop()}}),_callee5,this)})))},a.getMembersByPage=function getMembersByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a,c,m,h;return Dc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee6,this)})))},a.updateWhiteBlackRole=function updateWhiteBlackRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(lC)},opeType:{type:"enum",values:getEnumKeys(uC)}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:qt(qt({},t),{type:lC[t.type],opeType:uC[t.opeType]})});case 3:case"end":return a.stop()}}),_callee7,this)})))},a.getWhiteBlackRolesPage=function getWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a,c,m,h;return Dc.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(lC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:qt(qt({},t),{type:lC[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatRoles(m)});case 6:case"end":return g.stop()}}),_callee8,this)})))},a.updateWhiteBlackMembers=function updateWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){return Dc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(lC)},opeType:{type:"enum",values:getEnumKeys(uC)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:qt(qt({},t),{type:lC[t.type],opeType:uC[t.opeType],toAccids:Fc(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.getWhiteBlackMembersPage=function getWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a,c,m,h;return Dc.wrap((function _callee10$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(lC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:qt(qt({limit:100},t),{type:lC[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee10,this)})))},a.getExistingWhiteBlackRoles=function getExistingWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var a,c;return Dc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(lC)},roleIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:qt(qt({},t),{type:lC[t.type],roleIds:Fc(t.roleIds)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",{datas:formatRoles(c)});case 6:case"end":return m.stop()}}),_callee11,this)})))},a.getExistingWhiteBlackMembers=function getExistingWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a,c;return Dc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(lC)},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:qt(qt({},t),{type:lC[t.type],accids:Fc(t.accids)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",{datas:formatMembers$1(c)});case 6:case"end":return m.stop()}}),_callee12,this)})))},a.updateCategoryInfoOfChannel=function updateCategoryInfoOfChannel(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a;return Dc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.createChannelCategory=function createChannelCategory(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var a;return Dc.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return c.stop()}}),_callee14,this)})))},a.removeChannelCategory=function removeChannelCategory(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){return Dc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategory",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateChannelCategory=function updateChannelCategory(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a;return Dc.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return c.stop()}}),_callee16,this)})))},a.getChannelCategoriesByID=function getChannelCategoriesByID(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){var a;return Dc.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",t);case 3:return a=c.sent,c.abrupt("return",formatChannelCategorys(a.content.channelCategoryList));case 5:case"end":return c.stop()}}),_callee17,this)})))},a.updateChannelCategoryWhiteBlackRole=function updateChannelCategoryWhiteBlackRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){return Dc.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lC)},opeType:{type:"enum",values:getEnumKeys(uC)},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:qt(qt({},t),{type:lC[t.type],opeType:uC[t.opeType]})});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getChannelCategoryWhiteBlackRolesPage=function getChannelCategoryWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){var a,c,m,h;return Dc.wrap((function _callee19$(g){for(;;)switch(g.prev=g.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:qt(qt({},t),{type:lC[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatRoles(m)});case 6:case"end":return g.stop()}}),_callee19,this)})))},a.updateChannelCategoryWhiteBlackMembers=function updateChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){return Dc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lC)},opeType:{type:"enum",values:getEnumKeys(uC)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:qt(qt({},t),{type:lC[t.type],opeType:uC[t.opeType],toAccids:Fc(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getChannelCategoryWhiteBlackMembersPage=function getChannelCategoryWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var a,c,m,h;return Dc.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:qt(qt({},t),{type:lC[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee21,this)})))},a.getChannelCategoryWhiteBlackRoles=function getChannelCategoryWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){var a,c;return Dc.wrap((function _callee22$(m){for(;;)switch(m.prev=m.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lC)},roleIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:qt(qt({},t),{type:lC[t.type],roleIds:Fc(t.roleIds)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",formatRoles(c));case 6:case"end":return m.stop()}}),_callee22,this)})))},a.getChannelCategoryWhiteBlackMembers=function getChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee23(){var a,c;return Dc.wrap((function _callee23$(m){for(;;)switch(m.prev=m.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lC)},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:qt(qt({},t),{type:lC[t.type],accids:Fc(t.accids)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",formatMembers$1(c));case 6:case"end":return m.stop()}}),_callee23,this)})))},a.getChannelCategoriesPage=function getChannelCategoriesPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){var a,c,m,h;return Dc.wrap((function _callee24$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatChannelCategorys(m)});case 6:case"end":return g.stop()}}),_callee24,this)})))},a.getChannelCategoryChannelsPage=function getChannelCategoryChannelsPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee25(){var a,c,m,h;return Dc.wrap((function _callee25$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatChannels(m)});case 6:case"end":return g.stop()}}),_callee25,this)})))},a.subscribeChannel=function subscribeChannel(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee26(){var a,c;return Dc.wrap((function _callee26$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),!this.config.autoSubscribe||t.isInternalTrigger||5===t.type){m.next=3;break}throw new Qu("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return m.next=5,this.subscribeModuleService.subscribe(t);case 5:if((a=m.sent).unreadInfos=formatUnreadInfos(a.unreadInfos),5!==t.type){m.next=10;break}return this.subscribeModuleService.cacheSubscribe(t),m.abrupt("return");case 10:return 1===t.opeType&&(t.channels=map$6(c=a.unreadInfos).call(c,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",t),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(t):this.subscribeModuleService.cacheSubscribe(t),this.subscribeModuleService.updateUnreads(a.unreadInfos),m.abrupt("return",a);case 15:case"end":return m.stop()}}),_callee26,this)})))},a.getChannelUnreadInfos=function getChannelUnreadInfos(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee27(){var a,c;return Dc.wrap((function _callee27$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetUnreadInfo",t);case 2:return a=m.sent,c=formatUnreadInfos(a.content.unreadInfos),this.subscribeModuleService.updateUnreads(c),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee27,this)})))},a.getChannelSearchByPage=function getChannelSearchByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee28(){var a,c,m,h;return Dc.wrap((function _callee28$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:getEnumKeys(pC),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:getEnumKeys(cC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){g.next=3;break}throw new $u("startTime more than endTime",t,"timeRule");case 3:return g.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:qt(qt({},t),{order:t.order&&pC[t.order],sort:sort(t)&&cC[sort(t)]})});case 5:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag),cursor:h.cursor},datas:formatChannels(m)});case 8:case"end":return g.stop()}}),_callee28,this)})))},a.channelMemberSearch=function channelMemberSearch(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee29(){var a;return Dc.wrap((function _callee29$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelMembers(a.content.datas));case 5:case"end":return c.stop()}}),_callee29,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee30(){return Dc.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee30,this)})))},a.qchatAutoSubscribeNotificationHandler=function qchatAutoSubscribeNotificationHandler(t){var a=formatUnreadInfos(t.content.unreadInfos),c=t.content.serverIds;this.subscribeModuleService.updateUnreads(a);var m=[];if(c.length){var h={opeType:1};h.channels=map$6(c).call(c,(function(t){return{serverId:t.serverId,channelId:""}})),h.type=4,m.push(h)}if(a.length){var g={opeType:1};g.channels=map$6(a).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}})),g.type=1,m.push(g)}if(m.length)for(var I,M=_createForOfIteratorHelperLoose$1(m);!(I=M()).done;){var T=I.value;this.subscribeModuleService.cacheAutoSubscribe(T)}},QChatChannelService}(vC);!function(t){t.UNKNOWN="UNKNOWN",t.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",t.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",t.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",t.END_OF_LIFE="END_OF_LIFE",t.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",t.KICK_OUT="KICK_OUT",t.SYNC_DATA_ERROR="SYNC_DATA_ERROR",t.LEAVE_BY_SELF="LEAVE_BY_SELF",t.kICK_BY_SELF="kICK_BY_SELF"}(ZC||(ZC={})),function(t){t.offNotAllowSelfOn="offNotAllowSelfOn",t.offAllowSelfOn="offAllowSelfOn",t.disable="disable"}(eb||(eb={}));var rb={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},nb={limit:{type:"number"}};function formatMembers(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatMember(t){return format(rb,t)}(t)})):[]}function formatRTCChannelConfig(t){try{t.audio&&(t.audio=JSON.parse(t.audio))}catch(t){throw new $u('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{t.video&&(t.video=JSON.parse(t.video))}catch(t){throw new $u('result "video" JSON parse error',{key:"video"},"JSON parse error")}return format(nb,t)}var ab,ib={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},ob={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},sb=function getCmdConfig(){var t=function getDeserializeTag(){return invertSerializeMap(ob)}();return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:ob.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:t.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:ob.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:ob.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:t.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:ob.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:t.memberInfo}]}}},cb=function(t){function QChatMediaService(a,c){var m;return(m=t.call(this,"qchatMedia",a)||this).config={},m.tokenExpireTime=24e4,m.getTokenState=!1,m.core=a,registerParser({cmdMap:ib,cmdConfig:sb()}),c&&m.setOptions(c),m.setListener(),m.tokenExpireTime=24e4,m.channelId="",m.serverId="",m}kt(QChatMediaService,t);var a=QChatMediaService.prototype;return a.setOptions=function setOptions(t){t&&(this.config=qt(this.config,t),(null==t?void 0:t.neroom)&&this.setNeroom(t.neroom))},a.setNeroom=function setNeroom(t){this.neroom=new t},a.setListener=function setListener(){var t,a,c,m,h=this;this.core.eventBus.on("disconnect",bind$1(t=this._existRomm).call(t,this)),this.core.eventBus.on("kicked",bind$1(a=this._existRomm).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._existRomm).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(m=this._existRomm).call(m,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(t){return __awaiter(h,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!(t.type===HC[HC.channelVisibilityUpdate]&&t.channelId===this.channelId||t.type===HC[HC.serverEnterLeave]&&t.serverId===this.serverId)){a.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){a.next=4;break}return a.next=4,this.disconnectChannel();case 4:case"end":return a.stop()}}),_callee,this)})))}))},a._existRomm=function _existRomm(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee2,this)})))},a._checkPermission=function _checkPermission(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.qchatRole.checkPermission(t);case 2:return a=c.sent,c.abrupt("return",a);case 4:case"end":return c.stop()}}),_callee3,this)})))},a._checkConnectState=function _checkConnectState(){if("connect"!==this.state)throw new Qu("QChatMedia::you should connect first")},a.kickMemberOut=function kickMemberOut(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,c.next=5,null===(a=this.roomContext)||void 0===a?void 0:a.kickMemberOut(t.accid);case 5:c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+Fc(t),c.t0),new Qu("QChatMedia::kickMemberOut error",c.t0);case 11:case"end":return c.stop()}}),_callee4,this,[[2,7]])})))},a.disconnectChannel=function disconnectChannel(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),a.prev=1,a.next=4,null===(t=this.roomContext)||void 0===t?void 0:t.leaveRoom();case 4:a.next=9;break;case 6:a.prev=6,a.t0=a.catch(1),this.logger.error("QChatMedia::disconnect error",a.t0);case 9:if(!this.authService){a.next=12;break}return a.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return a.stop()}}),_callee5,this,[[1,6]])})))},a._setStateInit=function _setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},a.muteAudio=function muteAudio(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var I;return Dc.wrap((function _callee6$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){M.next=14;break}return M.prev=3,M.next=6,null===(c=this.rtcController)||void 0===c?void 0:c.muteMyAudio();case 6:M.next=12;break;case 8:throw M.prev=8,M.t0=M.catch(3),this.logger.error("QChatMedia::muteAudio error",M.t0),new Qu("QChatMedia::muteAudio error",M.t0);case 12:case 25:M.next=31;break;case 14:if(M.prev=14,!(I=null===(m=this.roomContext)||void 0===m?void 0:m.roomProperties.audioOff)||(null===(h=I.value)||void 0===h?void 0:h.split("_")[0])!==eb.offNotAllowSelfOn){M.next=23;break}return M.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(M.sent){M.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),M.abrupt("return");case 23:return M.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.muteMemberAudio(t.accid);case 27:throw M.prev=27,M.t1=M.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+Fc(t),M.t1),new Qu("QChatMedia::muteAudio error",M.t1);case 31:case"end":return M.stop()}}),_callee6,this,[[3,8],[14,27]])})))},a.unMuteAudio=function unMuteAudio(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var I;return Dc.wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(I=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.audioOff)||(null===(c=I.value)||void 0===c?void 0:c.split("_")[0])!==eb.offNotAllowSelfOn){M.next=10;break}return M.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(M.sent){M.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),M.abrupt("return");case 10:if((null===(m=this.roomContext)||void 0===m?void 0:m.localMember.uuid)!==t.accid){M.next=22;break}return M.prev=11,M.next=14,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMyAudio();case 14:M.next=20;break;case 16:throw M.prev=16,M.t0=M.catch(11),this.logger.error("QChatMedia::unMuteAudio error",M.t0),new Qu("QChatMedia::unMuteAudio error",M.t0);case 20:case 25:M.next=31;break;case 22:return M.prev=22,M.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.unmuteMemberAudio(t.accid);case 27:throw M.prev=27,M.t1=M.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+Fc(t),M.t1),new Qu("QChatMedia::unMuteAudio error",M.t1);case 31:case"end":return M.stop()}}),_callee7,this,[[11,16],[22,27]])})))},a.muteVideo=function muteVideo(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var I;return Dc.wrap((function _callee8$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){M.next=14;break}return M.prev=3,M.next=6,null===(c=this.rtcController)||void 0===c?void 0:c.muteMyVideo();case 6:M.next=12;break;case 8:throw M.prev=8,M.t0=M.catch(3),this.logger.error("QChatMedia::muteVideo error",M.t0),new Qu("QChatMedia::muteVideo error",M.t0);case 12:case 25:M.next=31;break;case 14:if(M.prev=14,!(I=null===(m=this.roomContext)||void 0===m?void 0:m.roomProperties.videoOff)||(null===(h=I.value)||void 0===h?void 0:h.split("_")[0])!==eb.offNotAllowSelfOn){M.next=23;break}return M.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(M.sent){M.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),M.abrupt("return");case 23:return M.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.muteMemberVideo(t.accid);case 27:throw M.prev=27,M.t1=M.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+Fc(t),M.t1),new Qu("QChatMedia::muteVideo error",M.t1);case 31:case"end":return M.stop()}}),_callee8,this,[[3,8],[14,27]])})))},a.unMuteVideo=function unMuteVideo(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var I;return Dc.wrap((function _callee9$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(I=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.videoOff)||(null===(c=I.value)||void 0===c?void 0:c.split("_")[0])!==eb.offNotAllowSelfOn){M.next=10;break}return M.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(M.sent){M.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),M.abrupt("return");case 10:if((null===(m=this.roomContext)||void 0===m?void 0:m.localMember.uuid)!==t.accid){M.next=22;break}return M.prev=11,M.next=14,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMyVideo();case 14:M.next=20;break;case 16:throw M.prev=16,M.t0=M.catch(11),this.logger.error("QChatMedia::unMuteVideo error",M.t0),new Qu("QChatMedia::unMuteVideo error",M.t0);case 20:M.next=30;break;case 22:M.prev=22,null===(g=this.rtcController)||void 0===g||g.unmuteMemberVideo(t.accid),M.next=30;break;case 26:throw M.prev=26,M.t1=M.catch(22),this.logger.error("QChatMedia::unMuteVideo error",M.t1),new Qu("QChatMedia::unMuteVideo error",M.t1);case 30:case"end":return M.stop()}}),_callee9,this,[[11,16],[22,26]])})))},a.startScreenShare=function startScreenShare(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.startScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::startScreenShare error",a.t0),new Qu("QChatMedia::startScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee10,this,[[1,5]])})))},a.stopScreenShare=function stopScreenShare(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.stopScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::stopScreenShare error",a.t0),new Qu("QChatMedia::stopScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee11,this,[[1,5]])})))},a.stopMemberScreenShare=function stopMemberScreenShare(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){return Dc.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.stopMemberScreenShare(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",c.t0),new Qu("QChatMedia::stopMemberScreenShare error",c.t0);case 10:case"end":return c.stop()}}),_callee12,this,[[2,6]])})))},a.subscribeRemoteVideoStream=function subscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){return Dc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoStream(t.accid,t.streamType),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",c.t0),new Qu("QChatMedia::subscribeRemoteVideoStream error",c.t0);case 10:case"end":return c.stop()}}),_callee13,this,[[2,6]])})))},a.unSubscribeRemoteVideoStream=function unSubscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){return Dc.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoStream(t.accid,t.streamType),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",c.t0),new Qu("QChatMedia::unSubscribeRemoteVideoStream error",c.t0);case 10:case"end":return c.stop()}}),_callee14,this,[[2,6]])})))},a.setupVideoCanvas=function setupVideoCanvas(t){var a;if(this._checkConnectState(),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)===t.accid)try{return this.rtcController.setupLocalVideoCanvas(t.videoView)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new Qu("QChatMedia::setupVideoCanvas error",t)}else try{return this.rtcController.setupRemoteVideoCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new Qu("QChatMedia::setupVideoCanvas error",t)}},a.setupRemoteVideoSubStreamCanvas=function setupRemoteVideoSubStreamCanvas(t){this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new Qu("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}},a.getScreenSharingUserUuid=function getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(t){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",t),new Qu("QChatMedia::getScreenSharingUserUuid error",t)}},a.initQChatMedia=function initQChatMedia(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){return Dc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:if(this.neroom){a.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),a.abrupt("return");case 3:if(void 0===this.state){a.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),a.abrupt("return");case 6:a.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:t.serverConfig}),a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(6),this.logger.error("QChatMedia::initQChatMedia error",a.t0),new Qu("QChatMedia::initQChatMedia error",a.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return a.stop()}}),_callee15,this,[[6,10]])})))},a.loginByIM=function loginByIM(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a,c;return Dc.wrap((function _callee16$(m){for(;;)switch(m.prev=m.next){case 0:if("init"===this.state){m.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),m.abrupt("return");case 3:return m.next=5,this._getToken();case 5:return a=m.sent,c=ws(this.core,"options.token")||ws(this.core,"V2NIMLoginService.token"),m.prev=7,m.next=10,null===(t=this.authService)||void 0===t?void 0:t.loginByIM(this.core.account,a,c);case 10:m.next=16;break;case 12:throw m.prev=12,m.t0=m.catch(7),this.logger.error("QChatMedia::loginByIM error",m.t0),new Qu("QChatMedia::loginByIM error",m.t0);case 16:this.state="login";case 17:case"end":return m.stop()}}),_callee16,this,[[7,12]])})))},a._getToken=function _getToken(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){var a,c,m,h,g=this;return Dc.wrap((function _callee18$(I){for(;;)switch(I.prev=I.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),I.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(t=this.neroom)||void 0===t?void 0:t.deviceId}});case 3:return a=I.sent,c=a.content.neroomToken,m=c.token,h=c.expire,this.logger.log("QChatMedia::getToken success token is "+m+",expire is "+h+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*h-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return __awaiter(g,void 0,void 0,Dc.mark((function _callee17(){var t;return Dc.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,a.next=4,this._getToken();case 4:t=a.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return a.stop()}}),_callee17,this)})))}),1e3*h-this.tokenExpireTime)),I.abrupt("return",m);case 8:case"end":return I.stop()}}),_callee18,this)})))},a.connectChannel=function connectChannel(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){var m;return Dc.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:if(void 0!==this.state){h.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),h.abrupt("return");case 3:if("init"!==this.state){h.next=6;break}return h.next=6,this.loginByIM();case 6:return this.serverId=t.serverId,this.channelId=t.channelId,h.prev=8,h.next=11,null===(a=this.roomService)||void 0===a?void 0:a.joinRoom({roomUuid:t.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:h.next=17;break;case 13:throw h.prev=13,h.t0=h.catch(8),this.logger.error("QChatMedia::connectChannel error",h.t0),new Qu("QChatMedia::connectChannel error",h.t0);case 17:if(!(m=null===(c=this.roomService)||void 0===c?void 0:c.getRoomContext(t.channelId))){h.next=28;break}return this.roomContext=m,this.rtcController=this.roomContext.rtcController,this.state="connect",h.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),h.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return h.stop()}}),_callee19,this,[[8,13]])})))},a.updateRTCChannelInfo=function updateRTCChannelInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){return Dc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:qt(qt({},t),{audio:Fc(t.audio),video:Fc(t.video)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getRTCChannelInfo=function getRTCChannelInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var a;return Dc.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:t});case 3:return a=c.sent,c.abrupt("return",formatRTCChannelConfig(a.content.RTCChannelConfig));case 5:case"end":return c.stop()}}),_callee21,this)})))},a.getRTCChannelOnlineMembers=function getRTCChannelOnlineMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){var a;return Dc.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:t});case 3:return a=c.sent,c.abrupt("return",formatMembers(a.content.memberList));case 5:case"end":return c.stop()}}),_callee22,this)})))},a.addRTCChannelListener=function addRTCChannelListener(){var t,a,c=this;this._checkConnectState();try{null===(t=this.authService)||void 0===t||t.addAuthListener({onAuthEvent:function onAuthEvent(t){return __awaiter(c,void 0,void 0,Dc.mark((function _callee23(){var a;return Dc.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:if(1026!==t||this.getTokenState){c.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,c.next=5,this._getToken();case 5:if(a=c.sent,!this.authService){c.next=9;break}return c.next=9,this.authService.renewToken(a);case 9:this.getTokenState=!1;case 10:case"end":return c.stop()}}),_callee23,this)})))}})}catch(t){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",t),new Qu("QChatMedia::loginByIM addAuthListener error",t)}null===(a=this.roomContext)||void 0===a||a.addRoomListener({onRoomPropertiesChanged:function onRoomPropertiesChanged(t){var a,m,h,g,I,M;if(c.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",t),t.audioOff){var T=null===(a=t.audioOff.value)||void 0===a?void 0:a.split("_")[0];T!==eb.offNotAllowSelfOn&&T!==eb.offAllowSelfOn||(null===(m=c.roomContext)||void 0===m?void 0:m.localMember.isAudioOn)&&(null===(h=c.rtcController)||void 0===h||h.muteMyAudio())}else if(t.videoOff){var S=null===(g=t.videoOff.value)||void 0===g?void 0:g.split("_")[0];S!==eb.offNotAllowSelfOn&&S!==eb.offAllowSelfOn||(null===(I=c.roomContext)||void 0===I?void 0:I.localMember.isVideoOn)&&(null===(M=c.rtcController)||void 0===M||M.muteMyVideo())}},onRoomPropertiesDeleted:function onRoomPropertiesDeleted(t){c.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",t)},onMemberJoinRtcChannel:function onMemberJoinRtcChannel(t){c.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",t);var a=map$6(t).call(t,(function(t){return t.uuid}));c.core.emit("memberJoinRTCChannel",a),c.core.qchatMedia.emit("memberJoinRTCChannel",a)},onMemberLeaveRoom:function onMemberLeaveRoom(t){c.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",t);var a=map$6(t).call(t,(function(t){return t.uuid}));c.core.emit("memberLeaveRTCChannel",a),c.core.qchatMedia.emit("memberLeaveRTCChannel",a)},onRoomEnded:function onRoomEnded(t){c.authService&&c.authService.logout(),c._setStateInit(),c.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",t),c.core.emit("RTCChannelEnded",t),c.core.qchatMedia.emit("RTCChannelEnded",t)},onRtcChannelError:function onRtcChannelError(t){c.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",t),"SOCKET_ERROR"===t&&c.disconnectChannel(),c.core.emit("RTCChannelError",t),c.core.qchatMedia.emit("RTCChannelError",t)},onRtcAudioVolumeIndication:function onRtcAudioVolumeIndication(t){c.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",t),c.core.emit("onRtcAudioVolumeIndication",t),c.core.qchatMedia.emit("onRtcAudioVolumeIndication",t)},onMemberAudioMuteChanged:function onMemberAudioMuteChanged(t,a,m){c.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",t,a),c.core.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid}),c.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid})},onMemberScreenShareStateChanged:function onMemberScreenShareStateChanged(t,a,m){c.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",t,a),c.core.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:m.uuid}),c.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:m.uuid})},onMemberVideoMuteChanged:function onMemberVideoMuteChanged(t,a,m){c.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",t,a),c.core.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid}),c.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid})}})},a.enumCameraDevices=function enumCameraDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumCameraDevices error",a),new Qu("QChatMedia::enumCameraDevices error",a)}))},a.enumPlayoutDevices=function enumPlayoutDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumPlayoutDevices error",a),new Qu("QChatMedia::enumPlayoutDevices error",a)}))},a.enumRecordDevices=function enumRecordDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumRecordDevices error",a),new Qu("QChatMedia::enumRecordDevices error",a)}))},a.removeRTCChannelListener=function removeRTCChannelListener(){var t,a;this._checkConnectState(),null===(t=this.roomContext)||void 0===t||t.removeRoomListener({}),null===(a=this.authService)||void 0===a||a.removeAuthListener({})},a.setSelectedCameraDevice=function setSelectedCameraDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedCameraDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedCameraDevice error",t),new Qu("QChatMedia::setSelectedCameraDevice error",t)}))},a.setSelectedPlayoutDevice=function setSelectedPlayoutDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedPlayoutDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedPlayoutDevice error",t),new Qu("QChatMedia::setSelectedPlayoutDevice error",t)}))},a.setSelectedRecordDevice=function setSelectedRecordDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedRecordDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedRecordDevice error",t),new Qu("QChatMedia::setSelectedRecordDevice error",t)}))},a.getRTCMembers=function getRTCMembers(){var t,a;return this._checkConnectState(),map$6(t=filter(a=this.roomContext.remoteMembers).call(a,(function(t){return t.isInRtcChannel}))).call(t,(function(t){return{accid:t.uuid,isAudioOn:!!t.isAudioOn,isVideoOn:!!t.isVideoOn,isSharingScreen:!!t.isSharingScreen,properties:t.properties}}))},a.subscribeRemoteVideoSubStream=function subscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){return Dc.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoSubStream(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",c.t0),new Qu("QChatMedia::subscribeRemoteVideoSubStream error",c.t0);case 10:case"end":return c.stop()}}),_callee24,this,[[2,6]])})))},a.unsubscribeRemoteVideoSubStream=function unsubscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee25(){return Dc.wrap((function _callee25$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoSubStream(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",c.t0),new Qu("QChatMedia::unsubscribeRemoteVideoSubStream error",c.t0);case 10:case"end":return c.stop()}}),_callee25,this,[[2,6]])})))},a.muteAllAudio=function muteAllAudio(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee26(){return Dc.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",Fc({value:eb.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllAudio error",a.t0),new Qu("QChatMedia::muteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee26,this,[[7,11]])})))},a.muteAllVideo=function muteAllVideo(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee27(){return Dc.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",Fc({value:eb.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllVideo error",a.t0),new Qu("QChatMedia::muteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee27,this,[[7,11]])})))},a.unMuteAllAudio=function unMuteAllAudio(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee28(){return Dc.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",Fc({value:eb.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",a.t0),new Qu("QChatMedia::unMuteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee28,this,[[7,11]])})))},a.unMuteAllVideo=function unMuteAllVideo(){var t;return __awaiter(this,void 0,void 0,Dc.mark((function _callee29(){return Dc.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",Fc({value:eb.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",a.t0),new Qu("QChatMedia::unMuteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee29,this,[[7,11]])})))},QChatMediaService}(vC),lb={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},ub={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:yC},db=function getDeserializeTag(){return invertSerializeMap(ub)},pb=function getCmdConfig(){var t=db();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:ub.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:ub.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:ub.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:ub.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:ub.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:t.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:ub.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:t.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:t.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:ub.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:ub.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:t.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:t.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:ub.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:ub.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:t.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:t.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:ub.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:ub.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:t.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:ub.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:ub.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:ub.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:t.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:t.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:t.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:t.qchatMsgTag}]}}};!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(ab||(ab={}));var mb,hb={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},gb={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:yC},vb=function getDeserializeTag(){return invertSerializeMap(gb)},fb=function getCmdConfig(){var t=vb();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:gb.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:gb.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:t.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:gb.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:gb.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:t.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:t.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:gb.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:t.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:gb.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:gb.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:t.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:gb.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:gb.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:gb.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:gb.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:t.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:gb.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:gb.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:t.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:t.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:gb.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:gb.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:gb.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:gb.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:gb.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:t.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:t.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:t.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},yb={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},_b={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Ib=function getDeserializeTag(){return invertSerializeMap(_b)},Mb=function getCmdConfig(){var t=Ib();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:_b.serverRole},{type:"Property",name:"antispamTag",reflectMapper:_b.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:t.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:_b.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:t.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:_b.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:t.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:t.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:t.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:_b.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:t.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:_b.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:t.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:t.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:t.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:t.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:_b.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:_b.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:t.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:_b.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:t.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:_b.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:t.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:_b.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:t.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:_b.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:t.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:_b.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:t.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:_b.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},Tb=["image","audio","video","file"],Sb={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:HC},fromClientType:{type:"enum",values:ab},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function generatorSysMsgForCmd(t,a){var c=qt({},t),m=qt({type:a||HC.custom},formatReverse(Sb,c));return m.serverId&&m.channelId&&m.toAccids?m.toType=GC.channelAccids:m.serverId&&m.toAccids?m.toType=GC.serverAccids:m.serverId&&m.channelId?m.toType=GC.channel:m.serverId?m.toType=GC.server:m.toAccids?m.toType=GC.accids:m.toType=GC.unknown,m}function generatorSysMsgMarkersForCmd(t){var a=IT(t,["msgIdServer","type"]);return formatReverse(Sb,a)}var Eb=((mb={})[HC.channelUpdateWhiteBlackIdentify]=function(t){var a=IC();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateWhiteBlackRoleTag)),t},mb[HC.channelUpdateWhiteBlackIdentifyUser]=function(t){var a=IC();return t.notify=function formatUpdateWhiteBlackMembers(t){return format(EC,t)}(deserialize(t.notify,a.qchatUpdateWhiteBlackMembersTag)),t},mb[HC.updateQuickComment]=function(t){var a=db();return t.notify=function formatQuickCommentRequest(t){return format(Ab,t)}(deserialize(t.notify,a.qchatQuickCommentRequestTag)),t},mb[HC.channelCategoryCreate]=function(t){var a=IC();return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,a.QChatChannelCategoryInfo)),t},mb[HC.channelCategoryUpdate]=function(t){var a=IC();return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,a.QChatChannelCategoryInfo)),t},mb[HC.channelCategoryUpdateWhiteBlackIdentify]=function(t){var a=IC();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateChannelCategoryWhiteBlackRoleTag)),t},mb[HC.channelCategoryUpdateWhiteBlackIdentifyUser]=function(t){var a=IC();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateChannelCategoryWhiteBlackMembersTag)),t},mb[HC.serverIdentifyAdd]=function(t){var a=Ib();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},mb[HC.serverIdentifyRemove]=function(t){var a=Ib();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},mb[HC.serverIdentifyUpdate]=function(t){var a=Ib();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},mb[HC.channelIdentifyUpdate]=function(t){var a=Ib();return t.channelIdentifyInfo=formatRole(deserialize(t.channelIdentifyInfo,a.channelRole)),t},mb[HC.userIdentifyUpdate]=function(t){var a=Ib();return t.userIdentifyInfo=formatRole(deserialize(t.userIdentifyInfo,a.memberRole)),t},mb[HC.myMemberInfoUpdated]=function(t){var a,c=ws(t,"userInfo.name"),m=ws(t,"userInfo.icon");return t.updatedInfos=map$6(a=t.reuseServers).call(a,(function(t){var a={serverId:t.serverId};return 1==(1&t.bits)&&"string"==typeof c&&qt(a,{nickChanged:!0,nick:c}),2==(2&t.bits)&&"string"==typeof m&&qt(a,{avatarChanged:!0,avatar:m}),a})),delete t.userInfo,delete t.reuseServers,t},mb);function formatSystemNotification(t,a){var c=format(Sb,t);if(!c.attach)return c;var m=vb(),h=IC();if(c.attach.serverInfo&&(c.attach.serverInfo=formatServer(deserialize(c.attach.serverInfo,m.serverInfo))),c.attach.channelInfo&&(c.attach.channelInfo=formatChannel(deserialize(c.attach.channelInfo,h.channelInfo))),c.attach.serverMember&&(c.attach.serverMember=formatMember$1(deserialize(c.attach.serverMember,m.memberInfo))),Eb[c.attach.type]&&(c.attach=Eb[c.attach.type](c.attach)),c.attach.updateAuths)try{c.attach.updateAuths=formatRoleAuths(JSON.parse(c.attach.updateAuths))}catch(t){a.error("formatSystemNotification:JSON parse updateAuths error: ",t)}return c.attach.type&&(c.attach.rawType=c.attach.type,c.attach.type=HC[c.attach.type]),c}var Cb={type:{type:"enum",values:FC},fromClientType:{type:"enum",values:ab},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:qC},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function generatorMsgForCmd(t){t.onSendBefore,t.onUploadStart,t.onUploadDone,t.onUploadProgress;var a=__rest(t,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),c=formatReverse(Cb,a);if(c.msgIdClient=t.resendFlag?t.msgIdClient:_m(),!c.msgIdClient)throw new zu("msgIdClient is required for resend a message","msgIdClient","required");return t.replyMessage&&t.replyMessage.msgIdServer&&(c.replyMsgFromAccount=t.replyMessage.fromAccount,c.replyMsgTime=+t.replyMessage.time,c.replyMsgIdServer=t.replyMessage.msgIdServer,c.replyMsgIdClient=t.replyMessage.msgIdClient,t.replyMessage.threadRefer&&t.replyMessage.threadRefer.msgIdServer?(c.threadMsgFromAccount=t.replyMessage.threadRefer.fromAccount,c.threadMsgTime=+t.replyMessage.threadRefer.time,c.threadMsgIdServer=t.replyMessage.threadRefer.msgIdServer,c.threadMsgIdClient=t.replyMessage.threadRefer.msgIdClient):(c.threadMsgFromAccount=t.replyMessage.fromAccount,c.threadMsgTime=+t.replyMessage.time,c.threadMsgIdServer=t.replyMessage.msgIdServer,c.threadMsgIdClient=t.replyMessage.msgIdClient),delete c.replyMessage),c}function formatMsgOperatorInfo(t){return format({operatorClientType:{type:"enum",values:ab},pushPayload:{type:"object"}},t)}function formatMsg(t,a,c){var m,h;return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee(){var g,I,M,T;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return(g=format(Cb,t)).deliveryStatus=a.deliveryStatus?BC[a.deliveryStatus]:BC[BC.success],a.time&&(g.time=a.time),I=db(),g.updateContent&&(M=format({status:{type:"number"}},M=deserialize(M=JSON.parse(g.updateContent),I.qchatMsgTag)),g.updateContent=M),g.updateOperatorInfo&&(T=formatMsgOperatorInfo(deserialize(T=JSON.parse(g.updateOperatorInfo),I.qchatMsgUpdateTag)),g.updateOperatorInfo=T),""===(null===(m=null==g?void 0:g.threadRefer)||void 0===m?void 0:m.fromAccount)&&delete g.threadRefer,""===(null===(h=null==g?void 0:g.replyRefer)||void 0===h?void 0:h.fromAccount)&&delete g.replyRefer,g.attach&&a.attachUrl&&(g.attach.url=a.attachUrl),S.next=11,formatMsgAttach(g,c);case 11:return S.abrupt("return",S.sent);case 12:case"end":return S.stop()}}),_callee)})))}function formatMsgAttach(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c;return Dc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:if(includes(Tb).call(Tb,t.type)&&t.attach&&t.attach.url){m.next=2;break}return m.abrupt("return",t);case 2:if(a&&a.cloudStorage&&"function"==typeof a.cloudStorage.getPrivateUrl&&"function"==typeof a.cloudStorage.getOriginUrl){m.next=4;break}return m.abrupt("return",t);case 4:if(!(indexOf(c=t.attach.url).call(c,"_im_url=1")<0)){m.next=7;break}return t.attach.url=a.cloudStorage.getPrivateUrl(t.attach.url),m.abrupt("return",t);case 7:return m.prev=7,m.next=10,a.cloudStorage.getOriginUrl(t.attach.url);case 10:t.attach.url=m.sent,m.next=16;break;case 13:throw m.prev=13,m.t0=m.catch(7),new zu('url "'+t.attach.url+'" parse error',"message.attach.url","parse error");case 16:return m.abrupt("return",t);case 17:case"end":return m.stop()}}),_callee2,null,[[7,13]])})))}function formatMsgs(t,a,c){return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(jc(t)&&t.length>0){h.next=2;break}return h.abrupt("return",[]);case 2:return m=map$6(t).call(t,(function(t){return formatMsg(t,a,c)})),h.next=5,Mi.all(m);case 5:return h.abrupt("return",h.sent);case 6:case"end":return h.stop()}}),_callee3)})))}var bb={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function formatQuickComments(t){var a=map$6(t).call(t,(function(t){var a,c=format(bb,t);return c.details=map$6(a=c.details).call(a,(function(t){var a=t.createTime?em(t.createTime):0;return a=isNaN(a)?0:a,{count:t.count,hasSelf:t.self,severalAccids:t.topN,type:t.type,createTime:a}})),c})),c={};return forEach$1(a).call(a,(function(t){return c[t.msgIdServer]=t})),c}var Ab={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}};var Nb={includeSelf:{type:"number"},order:{type:"enum",values:pC},sort:{type:"enum",values:UC},msgTypes:{type:"object"},subTypes:{type:"object"}};var Rb={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}};var wb={6:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(t.serverId),!0},16:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(t.serverId,t.channelId),!0},26:function _(t){var a=ws(t,"attach.addAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},27:function _(t){var a=ws(t,"attach.deleteAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},31:function _(t){var a,c;return 1===t.attach.event?(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:t.serverId,channelId:t.channelId}],isInternalTrigger:!0}):2===t.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)),!0},32:function _(t){var a,c;return 2===t.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)):1===t.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(t.serverId),(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:t.serverId}],isInternalTrigger:!0})),!0},34:function _(t){return 2===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(t.serverId,t.channelId),!0},101:function _(t){var a=IT(t,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",a),this.core.emit("recvTypingEvent",a),this.core.qchatMsg.emit("recvTypingEvent",a),!1}},kb=function(){function NotificationModuleService(t){this.core=t,this.logger=t.logger}var t=NotificationModuleService.prototype;return t.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(t)});case 2:return a=m.sent,c=formatSystemNotification(a.content.sysMsg,this.logger),"debug"===this.core.options.debugLevel?this.logger.debug("sendCustomSysMsg success",c):this.logger.log("sendCustomSysMsg success",c.serverId,c.channelId,c.msgIdServer),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee,this)})))},t.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c,m,h,g;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return a=t.systemNotification,c=__rest(t,["systemNotification"]),m=IT(a,["msgIdServer","type","body","ext","status"]),h=generatorSysMsgForCmd(m),I.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:h,qchatMsgUpdateTag:qt(qt({},c),{operatorAccount:this.core.account,operatorClientType:ab.Web,pushPayload:Fc(t.pushPayload),routeEnable:Cm.boolean(t,"routeEnable")})});case 5:return g=I.sent,I.abrupt("return",formatSystemNotification(g.content.sysMsg,this.logger));case 7:case"end":return I.stop()}}),_callee2,this)})))},t.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:map$6(a=t.systemNotifications).call(a,(function(t){return generatorSysMsgMarkersForCmd(t)}))});case 2:case"end":return c.stop()}}),_callee3,this)})))},t.onSysMsg=function onSysMsg(t){var a=t.content.sysMsg;if(a){var c=formatSystemNotification(a,this.core.logger),m=wb[HC[c.type]];if(m)if(!1===m.call(this,c))return;var h={feature:"default",systemNotifications:[c]};this.logger.log("qchat on systemNotification: ",h),this.core.emit("systemNotification",h),this.core.qchatMsg.emit("systemNotification",h)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function onMultiSysMsg(t){var a=t.content.sysMsg;if(a){var c=formatSystemNotification(a,this.logger);this.core.emit("systemNotificationUpdate",c),this.core.qchatMsg.emit("systemNotificationUpdate",c)}},t.onSyncSysMsg=function onSyncSysMsg(t){var a=this,c=t.content.systemNotifications;if(c&&c.length>0){var m=map$6(c).call(c,(function(t){return formatSystemNotification(t,a.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:m}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:m})}else this.logger.warn("sync system notification not exist")},NotificationModuleService}(),Ob=["image","audio","video","file"],Pb=function(){function MessageModuleService(t){var a=this;this.markMessageRead=throttle((function(t){return __awaiter(a,void 0,void 0,Dc.mark((function _callee(){var a,c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:t});case 2:a=m.sent,c=formatUnreadInfo(a.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[c]);case 5:case"end":return m.stop()}}),_callee,this)})))}),200),this.core=t,this.logger=t.logger}var t=MessageModuleService.prototype;return t.sendMessage=function sendMessage(t){var a,c,m,h;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var g,I,M,T,S,E;return Dc.wrap((function _callee2$(C){for(;;)switch(C.prev=C.next){case 0:if(!(indexOf(Ob).call(Ob,t.type)>-1)){C.next=4;break}return C.next=3,this.doSendFile(t);case 3:t.attach=C.sent;case 4:return g=generatorMsgForCmd(qt({fromAccount:this.core.account},t)),C.next=7,formatMsg(g,{time:(new Date).getTime(),deliveryStatus:BC.sending},this.core);case 7:I=C.sent;try{t.onSendBefore&&t.onSendBefore(I)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return C.prev=9,C.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:g});case 12:M=C.sent,C.next=22;break;case 15:return C.prev=15,C.t0=C.catch(9),C.next=19,formatMsg(g,{time:(new Date).getTime(),deliveryStatus:BC.failed,attachUrl:null===(a=I.attach)||void 0===a?void 0:a.url},this.core);case 19:throw T=C.sent,C.t0.msg=T,C.t0;case 22:return S=M.content,C.next=25,formatMsg(qt({},S.qchatMsg),{deliveryStatus:BC.success,attachUrl:null===(c=I.attach)||void 0===c?void 0:c.url},this.core);case 25:if(!(E=C.sent).isAntispam){C.next=29;break}throw{code:10403,msg:E,message:(null===(m=null==E?void 0:E.antiSpamInfo)||void 0===m?void 0:m.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(h=null==E?void 0:E.antiSpamInfo)||void 0===h?void 0:h.yidunAntiSpamRes)||""};case 29:return C.abrupt("return",E);case 30:case"end":return C.stop()}}),_callee2,this,[[9,15]])})))},t.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){c.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){c.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return c.prev=5,c.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=c.sent,c.next=15;break;case 11:throw c.prev=11,c.t0=c.catch(5),this.logger.error("sendFile:: upload File error or abort.",c.t0),c.t0;case 15:return c.abrupt("return",a);case 16:case"end":return c.stop()}}),_callee3,this,[[5,11]])})))},t.resendMessage=function resendMessage(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var m,h,g,I,M;return Dc.wrap((function _callee4$(T){for(;;)switch(T.prev=T.next){case 0:return(m=generatorMsgForCmd(qt(qt({},t),{resendFlag:!0}))).deliveryStatus=BC.sending,T.prev=2,T.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:m});case 5:h=T.sent,T.next=15;break;case 8:return T.prev=8,T.t0=T.catch(2),T.next=12,formatMsg(m,{time:(new Date).getTime(),deliveryStatus:BC.failed},this.core);case 12:throw g=T.sent,T.t0.msg=g,T.t0;case 15:return I=h.content,T.next=18,formatMsg(qt({},I.qchatMsg),{deliveryStatus:BC.success},this.core);case 18:if(!(M=T.sent).isAntispam){T.next=22;break}throw{code:10403,msg:M,message:(null===(a=null==M?void 0:M.antiSpamInfo)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(c=null==M?void 0:M.antiSpamInfo)||void 0===c?void 0:c.yidunAntiSpamRes)||""};case 22:return T.abrupt("return",M);case 23:case"end":return T.stop()}}),_callee4,this,[[2,8]])})))},t.doUpdateMessage=function doUpdateMessage(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var m,h,g,I,M;return Dc.wrap((function _callee5$(T){for(;;)switch(T.prev=T.next){case 0:return m=t.message,h=__rest(t,["message"]),(g=generatorMsgForCmd(m)).msgIdClient=void 0,g.time=m.time,T.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:g,qchatMsgUpdateTag:qt(qt({},h),{operatorAccount:this.core.account,operatorClientType:ab.Web,pushPayload:Fc(t.pushPayload),routeEnable:Cm.boolean(t,"routeEnable")})});case 6:return I=T.sent,T.next=9,formatMsg(I.content.qchatMsg,{},this.core);case 9:if(M=T.sent,this.core.eventBus.emit("qchatChannel/changeUnread",M,!0),!I.content.qchatMsg.isAntispam){T.next=14;break}throw{code:10403,msg:g,message:(null===(a=I.content.qchatMsg)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(c=I.content.qchatMsg)||void 0===c?void 0:c.yidunAntiSpamRes)||""};case 14:return T.abrupt("return",M);case 15:case"end":return T.stop()}}),_callee5,this)})))},t.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a,c,m,h=this;return Dc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:qt(qt({},t),{reverse:reverse$1(t)?1:0})});case 2:return c=g.sent,m=c.content,g.next=6,Mi.all(map$6(a=m.qchatMsgs).call(a,(function(t){return formatMsg(t,{},h.core)})));case 6:return g.abrupt("return",g.sent);case 7:case"end":return g.stop()}}),_callee6,this)})))},t.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var a,c,m,h,g,I=this;return Dc.wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:t});case 2:return c=M.sent,m=c.content,T=m.page,h=format(Rb,T),M.next=7,Mi.all(map$6(a=m.datas).call(a,(function(t){return formatMsg(t,{},I.core)})));case 7:return g=M.sent,M.abrupt("return",{pageInfo:h,messages:g});case 9:case"end":return M.stop()}var T}),_callee7,this)})))},t.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a,c,m;return Dc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:a={},c=0;case 2:if(!(c<t.length)){h.next=13;break}if((m=t[c]).fromAccount!==this.core.account){h.next=7;break}return a[m.msgIdClient]=!1,h.abrupt("continue",10);case 7:return h.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(m,!0);case 9:a[m.msgIdClient]=h.sent;case 10:c++,h.next=2;break;case 13:return h.abrupt("return",a);case 14:case"end":return h.stop()}}),_callee8,this)})))},t.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a,c,m;return Dc.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return a=h.sent,c=a.content.msgs,h.next=6,formatMsgs(c,{},this.core);case 6:return m=h.sent,h.abrupt("return",reduce(m).call(m,(function(t,a){return t[a.channelId]=a,t}),{}));case 8:case"end":return h.stop()}}),_callee9,this)})))},t.messageSearchByPage=function messageSearchByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a,c,m,h,g;return Dc.wrap((function _callee10$(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:qt(qt({},(M=t,formatReverse(Nb,M))),{includeSelf:t.includeSelf?1:""})});case 2:return a=I.sent,c=a.content,m=c.datas,h=c.listQueryTag,I.next=6,formatMsgs(m,{},this.core);case 6:return g=I.sent,I.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:h.nextTimetag?em(h.nextTimetag):0,cursor:h.cursor},datas:g});case 8:case"end":return I.stop()}var M}),_callee10,this)})))},t.onMsg=function onMsg(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){var a,c;return Dc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t.content.qchatMsg){m.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),m.abrupt("return");case 4:return m.next=6,formatMsg(a,{},this.core);case 6:c=m.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!1),this.core.emit("message",c),this.core.qchatMsg.emit("message",c);case 10:case"end":return m.stop()}}),_callee11,this)})))},t.onRecvUnreadInfo=function onRecvUnreadInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a,c;return Dc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t.content.qchatMsg){m.next=3;break}return m.abrupt("return");case 3:return m.next=5,formatMsg(a);case 5:c=m.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!1);case 7:case"end":return m.stop()}}),_callee12,this)})))},t.onMultiSyncRead=function onMultiSyncRead(t){var a=t.content.unreadInfo;if(a){var c=formatUnreadInfo(a);this.core.eventBus.emit("qchatChannel/updateUnreads",[c])}},t.onMultiSyncServersRead=function onMultiSyncServersRead(t){var a=t.content.qchatMultiSyncServersMessageReadTag;if(a){var c=formatClearServersUnread(a),m=c.successServerIds,h=c.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",m,h)}},t.onRecvMsgUpdate=function onRecvMsgUpdate(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a,c,m,h;return Dc.wrap((function _callee13$(g){for(;;)switch(g.prev=g.next){case 0:if(a=t.content.qchatMsg,c=t.content.qchatMsgUpdateInfo,a){g.next=4;break}return g.abrupt("return");case 4:return g.next=6,formatMsg(a,{},this.core);case 6:m=g.sent,h=formatMsgOperatorInfo(c),this.core.eventBus.emit("qchatChannel/changeUnread",m,!0),this.core.emit("messageUpdate",m,h),this.core.qchatMsg.emit("messageUpdate",m,h);case 11:case"end":return g.stop()}}),_callee13,this)})))},MessageModuleService}(),xb=function(){function ExtendModuleService(t){var a=this;this._sendTypingEvent=throttle((function(t){return __awaiter(a,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(qt(qt({},t),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),HC.msgTyping)});case 2:case"end":return a.stop()}}),_callee,this)})))}),3e3),this.core=t,this.logger=t.logger,this.lastChannelIdInTyping=""}var t=ExtendModuleService.prototype;return t.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c;return Dc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return c=m.sent,m.abrupt("return",Mi.all(map$6(a=c.content.qchatMsgs).call(a,(function(t){return formatMsg(t)}))));case 4:case"end":return m.stop()}}),_callee2,this)})))},t.getReferMessages=function getReferMessages(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if((null===(a=t.message.replyRefer)||void 0===a?void 0:a.msgIdServer)&&(null===(c=t.message.threadRefer)||void 0===c?void 0:c.msgIdServer)){h.next=2;break}throw new Error("Message has no reply");case 2:return h.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(m=h.sent,t.referType!==jC[jC.all]){h.next=9;break}return h.abrupt("return",{replyMessage:m[0],threadMessage:m[1]});case 9:if(t.referType!==jC[jC.reply]){h.next=13;break}return h.abrupt("return",{replyMessage:m[0]});case 13:if(t.referType!==jC[jC.thread]){h.next=15;break}return h.abrupt("return",{threadMessage:m[1]});case 15:return h.abrupt("return",{replyMessage:m[0],threadMessage:m[1]});case 16:case"end":return h.stop()}}),_callee3,this)})))},t.getThreadMessages=function getThreadMessages(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var c,m,h,g,I;return Dc.wrap((function _callee4$(M){for(;;)switch(M.prev=M.next){case 0:return m=(null===(a=t.message.threadRefer)||void 0===a?void 0:a.msgIdServer)?qt({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,M.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:m,getThreadHistoryMsgTag:qt(qt({},t.messageQueryOption),{reverse:Cm.boolean(t.messageQueryOption,"reverse")})});case 3:return h=M.sent,M.next=6,formatMsg(h.content.thread);case 6:return g=M.sent,M.next=9,Mi.all(map$6(c=h.content.qchatMsgs).call(c,(function(t){return formatMsg(t)})));case 9:return I=M.sent,M.abrupt("return",{thread:g,threadInfo:{messageCount:+h.content.threadInfo.messageCount,lastMessageTimestamp:+h.content.threadInfo.lastMessageTimestamp},messages:I});case 11:case"end":return M.stop()}}),_callee4,this)})))},t.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a,c,m,h;return Dc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return a=t.threadRootMessages,c=__rest(t,["threadRootMessages"]),g.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:a,tag:c});case 3:if(m=g.sent,!((h=m.content.metas)&&h.length>0)){g.next=7;break}return g.abrupt("return",map$6(h).call(h,(function(t){return qt(qt({},t),{total:em(t.total),timestamp:em(t.timestamp),msgTime:em(t.msgTime)})})));case 7:return g.abrupt("return",[]);case 8:case"end":return g.stop()}}),_callee5,this)})))},t.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a,c,m;return Dc.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:Fc(map$6(a=t.msgList).call(a,(function(t){return t.msgIdServer})))}});case 2:return c=h.sent,m=c.content.quickCommentResponse,h.abrupt("return",formatQuickComments(m));case 5:case"end":return h.stop()}}),_callee6,this)})))},t.updateQuickComment=function updateQuickComment(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var c,m,h,g,I,M;return Dc.wrap((function _callee7$(T){for(;;)switch(T.prev=T.next){case 0:return validate({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),c=t.commentMessage,m=c.serverId,h=c.channelId,g=c.fromAccount,I=c.msgIdServer,M=c.time,T.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:m,channelId:h,fromAccount:g,msgIdServer:I,time:M,type:t.type,opeType:a,opeAccid:this.core.account}});case 4:case"end":return T.stop()}}),_callee7,this)})))},t.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){return Dc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){a.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),a.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return a.stop()}}),_callee8,this)})))},ExtendModuleService}(),Vb=function(t){function QChatMsgService(a){var c;return(c=t.call(this,"qchatMsg",a)||this).core=a,c.lastChannelIdInMark="",registerParser({cmdMap:lb,cmdConfig:pb()}),c.notificationModuleService=new kb(a),c.messageModuleService=new Pb(a),c.extendModuleService=new xb(a),c}kt(QChatMsgService,t);var a=QChatMsgService.prototype;return a.sendMessage=function sendMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(FC)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.sendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee,this)})))},a.updateMessage=function updateMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},t),!("number"==typeof t.message.status&&t.message.status<1e4)){a.next=3;break}throw new Qu("Status should be greater than or equal to 10000");case 3:return a.next=5,this.messageModuleService.doUpdateMessage(t);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee2,this)})))},a.resendMessage=function resendMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},t),a.next=3,this.messageModuleService.resendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.deleteMessage=function deleteMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(Fc(t))).message.status=2,c.next=5,this.messageModuleService.doUpdateMessage(a);case 5:return c.abrupt("return",c.sent);case 6:case"end":return c.stop()}}),_callee4,this)})))},a.revokeMessage=function revokeMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a;return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(Fc(t))).message=IT(a.message,["serverId","channelId","msgIdServer","time"]),a.message.status=1,c.next=6,this.messageModuleService.doUpdateMessage(a);case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}}),_callee5,this)})))},a.markMessageRead=function markMessageRead(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:validate({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},t),t.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=t.channelId,this.messageModuleService.markMessageRead(t);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.replyMessage=function replyMessage(t){validate({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t);var replyMessage=t.replyMessage;if(t.serverId!==replyMessage.serverId||t.channelId!==replyMessage.channelId)throw new Qu("Forbid replying to message from other server, channel");return this.sendMessage(t)},a.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getMessageHistoryByIds(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.getReferMessages=function getReferMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){return Dc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:getEnumKeys(jC),required:!1}},t),a.next=3,this.extendModuleService.getReferMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee8,this)})))},a.getThreadMessages=function getThreadMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){return Dc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},t),a.next=3,this.extendModuleService.getThreadMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee9,this)})))},a.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getThreadRootMessagesMeta(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee10,this)})))},a.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},t),a.next=3,this.notificationModuleService.sendSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee11,this)})))},a.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){return Dc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(HC)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},t),a.next=3,this.notificationModuleService.updateSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee12,this)})))},a.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){return Dc.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.notificationModuleService.markSystemNotificationsRead(t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){return Dc.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.getHistoryMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee14,this)})))},a.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){return Dc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),a.next=3,this.messageModuleService.getMentionedMeMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee15,this)})))},a.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a;return Dc.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),every(a=t.messages).call(a,(function(a){return t.messages[0].serverId===a.serverId}))){c.next=4;break}throw new Qu("Different serverId",t,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(t.messages[0].serverId)){c.next=7;break}throw new Qu("Not allowed for visitor",t,10403);case 7:return c.next=9,this.messageModuleService.areMentionedMeMessages(t.messages);case 9:return c.abrupt("return",c.sent);case 10:case"end":return c.stop()}}),_callee16,this)})))},a.addQuickComment=function addQuickComment(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){return Dc.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,1);case 2:case"end":return a.stop()}}),_callee17,this)})))},a.removeQuickComment=function removeQuickComment(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){return Dc.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,2);case 2:case"end":return a.stop()}}),_callee18,this)})))},a.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){return Dc.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.extendModuleService.getQuickComments(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee19,this)})))},a.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){return Dc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.extendModuleService.sendTypingEvent(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee20,this)})))},a.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){return Dc.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},t),a.next=3,this.messageModuleService.getLastMessageOfChannels(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee21,this)})))},a.qchatOnMsgHandler=function qchatOnMsgHandler(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){return Dc.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onMsg(t);case 1:case"end":return a.stop()}}),_callee22,this)})))},a.qchatOnRecvUnreadInfoHandler=function qchatOnRecvUnreadInfoHandler(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee23(){return Dc.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvUnreadInfo(t);case 1:case"end":return a.stop()}}),_callee23,this)})))},a.qchatOnSysMsgHandler=function qchatOnSysMsgHandler(t){this.notificationModuleService.onSysMsg(t)},a.qchatMultiSyncMessageReadHandler=function qchatMultiSyncMessageReadHandler(t){this.messageModuleService.onMultiSyncRead(t)},a.qchatMultiSyncSystemNotificationUpdateHandler=function qchatMultiSyncSystemNotificationUpdateHandler(t){this.notificationModuleService.onMultiSysMsg(t)},a.qchatSyncSystemNotificationHandler=function qchatSyncSystemNotificationHandler(t){this.notificationModuleService.onSyncSysMsg(t)},a.qchatRecvMessageUpdateHandler=function qchatRecvMessageUpdateHandler(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){return Dc.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvMsgUpdate(t);case 1:case"end":return a.stop()}}),_callee24,this)})))},a.searchMsgByPage=function searchMsgByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee25(){return Dc.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:getEnumKeys(pC),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:getEnumKeys(UC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),a.next=3,this.messageModuleService.messageSearchByPage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee25,this)})))},a.qchatMultiSyncServersMessageReadHandler=function qchatMultiSyncServersMessageReadHandler(t){this.messageModuleService.onMultiSyncServersRead(t)},QChatMsgService}(vC),Lb=function(){function CategoryModuleService(t){this.core=t}var t=CategoryModuleService.prototype;return t.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 5:case"end":return c.stop()}}),_callee,this)})))},t.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},t.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Qu("No update required",{},406);case 6:return c.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 7:case"end":return c.stop()}}),_callee3,this)})))},t.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return a=c.sent,c.abrupt("return",(m=a.content.list,jc(m)&&m.length>0?map$6(m).call(m,(function(t){return formatChannelCategoryRole(t)})):[]));case 5:case"end":return c.stop()}var m}),_callee4,this)})))},t.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a;return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 5:case"end":return c.stop()}}),_callee5,this)})))},t.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},t.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){var a;return Dc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Qu("No update required",{},406);case 6:return c.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 7:case"end":return c.stop()}}),_callee7,this)})))},t.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a;return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return a=c.sent,c.abrupt("return",(m=a.content.list,jc(m)&&m.length>0?map$6(m).call(m,(function(t){return formatChannelCategoryMemberRole(t)})):[]));case 5:case"end":return c.stop()}var m}),_callee8,this)})))},CategoryModuleService}(),Db=function(t){function QChatRoleService(a){var c;return(c=t.call(this,"qchatRole",a)||this).core=a,registerParser({cmdMap:yb,cmdConfig:Mb()}),c.category=new Lb(a),c}kt(QChatRoleService,t);var a=QChatRoleService.prototype;return a.createServerRole=function createServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:qt(qt({},generatorRoleForCmd(t)),{type:OC.custom}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return c.stop()}}),_callee,this)})))},a.updateServerRole=function updateServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a;return Dc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:generatorRoleForCmd(t),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.deleteServerRole=function deleteServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteServerRole",t);case 3:case"end":return a.stop()}}),_callee3,this)})))},a.getServerRoles=function getServerRoles(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m;return Dc.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},t),h.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:generatorRoleForCmd(t)});case 3:return c=h.sent,m=filter(a=c.content.serverRoles).call(a,(function(t){return 1===em(t.isMember)})),m=map$6(m).call(m,(function(t){return t.roleId})),h.abrupt("return",{roles:formatRoles(c.content.serverRoles),isMemberRoles:m});case 7:case"end":return h.stop()}}),_callee4,this)})))},a.addChannelRole=function addChannelRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a;return Dc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:generatorRoleForCmd(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.channelRole));case 5:case"end":return c.stop()}}),_callee5,this)})))},a.getChannelRoles=function getChannelRoles(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a;return Dc.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return c.stop()}}),_callee6,this)})))},a.removeChannelRole=function removeChannelRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelRole",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateChannelRole=function updateChannelRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var a;return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Qu("No update required",{},406);case 6:return c.abrupt("return",formatRole(a.content.channelRole));case 7:case"end":return c.stop()}}),_callee8,this)})))},a.addMemberRole=function addMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a;return Dc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:t});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.memberRole));case 5:case"end":return c.stop()}}),_callee9,this)})))},a.getMemberRoles=function getMemberRoles(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){var a;return Dc.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.memberRoles));case 5:case"end":return c.stop()}}),_callee10,this)})))},a.removeMemberRole=function removeMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:t});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberRole=function updateMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){var a;return Dc.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Qu("No update required",{},406);case 6:return c.abrupt("return",formatRole(a.content.memberRole));case 7:case"end":return c.stop()}}),_callee12,this)})))},a.addMembersToServerRole=function addMembersToServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a,c,m;return Dc.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatAddMembersToServerRole",qt(qt({},t),{accids:Fc(t.accids)}));case 3:return a=h.sent,c=ws(a,"content.accids.successAccids"),m=ws(a,"content.accids.failedAccids"),h.abrupt("return",{successAccids:c?JSON.parse(c):[],failedAccids:m?JSON.parse(m):[]});case 7:case"end":return h.stop()}}),_callee13,this)})))},a.removeMembersFromServerRole=function removeMembersFromServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var a,c,m;return Dc.wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",qt(qt({},t),{accids:Fc(t.accids)}));case 3:return a=h.sent,c=ws(a,"content.accids.successAccids"),m=ws(a,"content.accids.failedAccids"),h.abrupt("return",{successAccids:c?JSON.parse(c):[],failedAccids:m?JSON.parse(m):[]});case 7:case"end":return h.stop()}}),_callee14,this)})))},a.getMembersFromServerRole=function getMembersFromServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){var a;return Dc.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.members));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.getServerRolesByAccid=function getServerRolesByAccid(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a;return Dc.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.serverRoles));case 5:case"end":return c.stop()}}),_callee16,this)})))},a.getExistingServerRolesByAccids=function getExistingServerRolesByAccids(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){var a,c,m;return Dc.wrap((function _callee17$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),h.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:t.serverId,accids:Fc(t.accids)});case 3:return a=h.sent,h.prev=4,m=JSON.parse(a.content.serverRoles),forEach$1(c=mn(m)).call(c,(function(t){var a;forEach$1(a=m[t]).call(a,(function(a,c){m[t][c]=deserialize(a,Ib().serverRole)})),m[t]=formatRoles(m[t])})),h.abrupt("return",m);case 10:throw h.prev=10,h.t0=h.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+t.serverId+" and "+t.accids,a.content.serverRoles),h.t0;case 14:case"end":return h.stop()}}),_callee17,this,[[4,10]])})))},a.getExistingChannelRolesByServerRoleIds=function getExistingChannelRolesByServerRoleIds(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){var a;return Dc.wrap((function _callee18$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:t.serverId,channelId:t.channelId,roleIds:Fc(t.roleIds)});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return c.stop()}}),_callee18,this)})))},a.getExistingAccidsOfMemberRoles=function getExistingAccidsOfMemberRoles(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){var a,c;return Dc.wrap((function _callee19$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:t.serverId,channelId:t.channelId,accids:Fc(t.accids)});case 3:return a=m.sent,c=a.content.memberRoles,m.abrupt("return",c&&c.length>0?map$6(c).call(c,(function(t){return t.accid})):[]);case 6:case"end":return m.stop()}}),_callee19,this)})))},a.getExistingAccidsInServerRole=function getExistingAccidsInServerRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){var a,c;return Dc.wrap((function _callee20$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:t.serverId,roleId:t.roleId,accids:Fc(t.accids)});case 3:return a=m.sent,c=a.content.members,m.abrupt("return",c&&c.length>0?map$6(c).call(c,(function(t){return t.accid})):[]);case 6:case"end":return m.stop()}}),_callee20,this)})))},a.updateServerRolePriorities=function updateServerRolePriorities(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var a,c;return Dc.wrap((function _callee21$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},t),m.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:t.serverId,serverRoles:map$6(a=t.serverRoles).call(a,(function(t){return{serverId:t.serverId,roleId:t.roleId,priority:t.priority}}))});case 3:return c=m.sent,m.abrupt("return",formatRoles(c.content.serverRoles));case 5:case"end":return m.stop()}}),_callee21,this)})))},a.checkPermission=function checkPermission(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){var a;return Dc.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},t),c.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:qt(qt({},t),{auth:VC[t.auth]||t.auth})});case 3:return a=c.sent,c.abrupt("return",a.content.checked);case 5:case"end":return c.stop()}}),_callee22,this)})))},a.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee23(){return Dc.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee23,this)})))},a.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){return Dc.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee24,this)})))},a.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee25(){return Dc.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee26(){return Dc.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee26,this)})))},a.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee27(){return Dc.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee27,this)})))},a.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee28(){return Dc.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee28,this)})))},a.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee29(){return Dc.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee29,this)})))},a.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee30(){return Dc.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee30,this)})))},a.checkPermissions=function checkPermissions(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee31(){var a,c,m,h;return Dc.wrap((function _callee31$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},t),this.core.logger.log("qchatRole::checkPermission options is",t),g.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:qt(qt({},t),{auths:Fc(map$6(a=t.auths).call(a,(function(t){return VC[t]||t})))})});case 4:return m=g.sent,this.core.logger.log("qchatRole::checkPermission result is",m.content),h={},forEach$1(c=m.content.checkPermissionsResult).call(c,(function(t){h[t.auth]=t.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",h),g.abrupt("return",formatRoleAuths(h));case 10:case"end":return g.stop()}}),_callee31,this)})))},QChatRoleService}(vC),Ub=hp((function(t,a){return Nd(t)?rh(t,yT(a,1,Nd,!0)):[]})),Fb=Ub;function _createForOfIteratorHelperLoose(t,a){var c,m=void 0!==bc&&zc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var m=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Wc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var Bb=function(t){function QChatServerService(a){var c;return(c=t.call(this,"qchatServer",a)||this).core=a,registerParser({cmdMap:hb,cmdConfig:fb()}),c}kt(QChatServerService,t);var a=QChatServerService.prototype;return a.createServer=function createServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:qt(qt({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return c.stop()}}),_callee,this)})))},a.deleteServer=function deleteServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatDeleteServer",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateServer=function updateServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:qt(qt({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return c.stop()}}),_callee3,this)})))},a.getServers=function getServers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetServers",t);case 3:return a=c.sent,c.abrupt("return",formatServers(a.content.serverList));case 5:case"end":return c.stop()}}),_callee4,this)})))},a.getServersByPage=function getServersByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var a,c,m,h;return Dc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatServers(m)});case 6:case"end":return g.stop()}}),_callee5,this)})))},a.inviteServerMembers=function inviteServerMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var a,c;return Dc.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),m.next=3,this.core.sendCmd("qchatInviteServerMembers",t);case 3:return a=m.sent,c=a.content.record||{},m.abrupt("return",{failByOverAccids:a.content.failByOverAccids,failByBanAccids:a.content.failByBanAccids,recordInfo:formatInviteApplyRecord(c)});case 6:case"end":return m.stop()}}),_callee6,this)})))},a.acceptServerInvite=function acceptServerInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerInvite",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.rejectInviteServer=function rejectInviteServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){return Dc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectInviteServer",t);case 3:case"end":return a.stop()}}),_callee8,this)})))},a.applyServerJoin=function applyServerJoin(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a;return Dc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),c.next=3,this.core.sendCmd("qchatApplyServerJoin",t);case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecord(a.content.data));case 5:case"end":return c.stop()}}),_callee9,this)})))},a.acceptServerApply=function acceptServerApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerApply",t);case 3:case"end":return a.stop()}}),_callee10,this)})))},a.rejectServerApply=function rejectServerApply(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectServerApply",t);case 3:case"end":return a.stop()}}),_callee11,this)})))},a.kickServerMembers=function kickServerMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){return Dc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatKickServerMembers",t);case 3:case"end":return a.stop()}}),_callee12,this)})))},a.leaveServer=function leaveServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){return Dc.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatLeaveServer",t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var a;return Dc.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return c.stop()}}),_callee14,this)})))},a.updateServerMemberInfo=function updateServerMemberInfo(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee15(){var a;return Dc.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.getServerMembers=function getServerMembers(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee16(){var a,c,m,h,g;return Dc.wrap((function _callee16$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({accids:{type:"array"}},t),a=[],t.accids.length)for(c=_createForOfIteratorHelperLoose(t.accids);!(m=c()).done;)h=m.value,a.push(h.serverId+"|"+h.accid);return I.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:a});case 5:return g=I.sent,I.abrupt("return",formatMembers$1(g.content.accidList));case 7:case"end":return I.stop()}}),_callee16,this)})))},a.getServerMembersByPage=function getServerMembersByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee17(){var a,c,m,h;return Dc.wrap((function _callee17$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee17,this)})))},a.subscribeServer=function subscribeServer(t){var a,c,m,h;return __awaiter(this,void 0,void 0,Dc.mark((function _callee18(){var g,I,M,T;return Dc.wrap((function _callee18$(S){for(;;)switch(S.prev=S.next){case 0:if(validate({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},t),!(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)||t.isInternalTrigger){S.next=3;break}throw new Qu("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(t.type||(t.type=4),!t.servers.length){S.next=12;break}return I=qt(qt({},t),{channels:map$6(g=t.servers).call(g,(function(t){return{serverId:t.serverId,channelId:""}}))}),S.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(I);case 8:return M=S.sent,T=M.failedChannels,(null===(h=null===(m=this.core.qchatChannel)||void 0===m?void 0:m.config)||void 0===h?void 0:h.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(I):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(I),S.abrupt("return",{failedServers:T});case 12:case"end":return S.stop()}}),_callee18,this)})))},a.banServerMember=function banServerMember(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee19(){return Dc.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:qt(qt({},t),{opeType:1})});case 3:case"end":return a.stop()}}),_callee19,this)})))},a.unbanServerMember=function unbanServerMember(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee20(){return Dc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:qt(qt({},t),{opeType:2})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getBannedMembersByPage=function getBannedMembersByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee21(){var a,c,m,h;return Dc.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag)},datas:formatServerMemberBanInfos(m)});case 6:case"end":return g.stop()}}),_callee21,this)})))},a.serverSearchByPage=function serverSearchByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee22(){var a,c,m,h;return Dc.wrap((function _callee22$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:getEnumKeys(pC),required:!1},searchType:{type:"enum",values:getEnumKeys(hC)},sort:{type:"enum",values:getEnumKeys(mC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){g.next=3;break}throw new $u("startTime more than endTime",t,"timeRule");case 3:return g.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:qt(qt({},t),{order:t.order&&pC[t.order],searchType:hC[t.searchType],sort:sort(t)&&mC[sort(t)],serverType:Fc(t.serverType)})});case 5:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:em(h.nextTimetag),cursor:h.cursor},datas:formatServers(m)});case 8:case"end":return g.stop()}}),_callee22,this)})))},a.serverMemberSearchByPage=function serverMemberSearchByPage(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee23(){var a;return Dc.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:t});case 3:return a=c.sent,c.abrupt("return",formatMembers$1(a.content.members));case 5:case"end":return c.stop()}}),_callee23,this)})))},a.generateInviteCode=function generateInviteCode(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee24(){var a;return Dc.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},t),c.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:t});case 3:return a=c.sent,c.abrupt("return",format({expireTime:{type:"number"}},a.content.data));case 5:case"end":return c.stop()}}),_callee24,this)})))},a.joinByInviteCode=function joinByInviteCode(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee25(){return Dc.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:t});case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getInviteApplyRecordOfServer=function getInviteApplyRecordOfServer(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee26(){var a;return Dc.wrap((function _callee26$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:qt(qt({},t),{reverse:reverse$1(t)?1:0})});case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return c.stop()}}),_callee26,this)})))},a.getInviteApplyRecordOfSelf=function getInviteApplyRecordOfSelf(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee27(){var a;return Dc.wrap((function _callee27$(c){for(;;)switch(c.prev=c.next){case 0:return validate({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:qt(qt({},t),{reverse:reverse$1(t)?1:0})});case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return c.stop()}}),_callee27,this)})))},a.markRead=function markRead(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee28(){var a,c,m,h;return Dc.wrap((function _callee28$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverIds:{type:"array",itemType:"string",required:!0}},t),g.next=3,this.core.sendCmd("qchatClearServersUnread",t);case 3:return a=g.sent,c=formatClearServersUnread(a.content.clearServersUnreadTag),m=c.successServerIds,h=c.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",m,h),g.abrupt("return",c);case 9:case"end":return g.stop()}}),_callee28,this)})))},a.subscribeAllChannel=function subscribeAllChannel(t){var a,c;return __awaiter(this,void 0,void 0,Dc.mark((function _callee29(){var m,h,g;return Dc.wrap((function _callee29$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},t),!(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)){I.next=3;break}throw new Qu("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return I.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",t,{timeout:3e4});case 5:return(h=I.sent).content.unreadInfos=formatUnreadInfos(h.content.unreadInfos),h.content.failServerIds=formatFailServerIds(h.content.failServerIds),g={type:t.type,opeType:1,channels:map$6(m=h.content.unreadInfos).call(m,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",g),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",t.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",h.content.unreadInfos),I.abrupt("return",h.content);case 13:case"end":return I.stop()}}),_callee29,this)})))},a.enterAsVisitor=function enterAsVisitor(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee30(){var a,c,m;return Dc.wrap((function _callee30$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:Fc(t.serverIds)}});case 3:return a=h.sent,c=formatFailServerIds(a.content.failServerIds),m=Fb(t.serverIds,c),this.core.qchatChannel.subscribeForVisitorService.cacheServer(m),h.abrupt("return",{failedServers:c});case 8:case"end":return h.stop()}}),_callee30,this)})))},a.leaveAsVisitor=function leaveAsVisitor(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee31(){var a,c,m,h=this;return Dc.wrap((function _callee31$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),g.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:Fc(t.serverIds)}});case 3:return a=g.sent,c=formatFailServerIds(a.content.failServerIds),m=Fb(t.serverIds,c),forEach$1(m).call(m,(function(t){h.core.qchatChannel.subscribeForVisitorService.deleteServer(t)})),g.abrupt("return",{failedServers:c});case 8:case"end":return g.stop()}}),_callee31,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee32(){return Dc.wrap((function _callee32$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},t),!t.serverIds.length){a.next=5;break}return a.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(t);case 4:return a.abrupt("return",a.sent);case 5:return a.abrupt("return",{failedServers:[]});case 6:case"end":return a.stop()}}),_callee32,this)})))},QChatServerService}(vC),qb="V2NIMNotificationService",Gb={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","101_3":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","4_101":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},Hb={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:boolToInt,retConverter:function retConverter(t,a){return"0"!==a[6]&&!!em(t)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:boolToInt,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function def(t){if(101===t.type&&t["pushConfig.forcePush"])return"#%@all@%#"},converter:function converter(t,a){if(a["pushConfig.forcePush"])return t?Fc(t):"#%@all@%#"}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:boolToInt,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:boolToInt,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:boolToInt,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:boolToInt,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:boolToInt,retType:"boolean",access:"pushConfig.pushNickEnabled"}},jb={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},Yb={v2SendCustomNotification:{sid:30,cid:7,service:qb,params:[{type:"Property",name:"tag",reflectMapper:Hb}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:qb,params:[{type:"Property",name:"tag",reflectMapper:Hb}]},onSysNotification:{sid:7,cid:3,service:qb,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hb)}]},syncBroadcastMsg:{sid:4,cid:16,service:qb,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(jb)}]},onBroadcastMsg:{sid:7,cid:17,service:qb,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(jb)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:qb,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Hb)}]},v2NotificationRevoke:{sid:7,cid:14,service:qb,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Hb)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:qb,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Hb)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},$b={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccounts:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}},Wb=function(t){function V2NIMNotificationServiceImpl(a,c){var m;return(m=t.call(this,"V2NIMNotificationService",a)||this).config={compatibleWithV1:!0},"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:Gb,cmdConfig:Yb}),m.setOptions(c),m)}kt(V2NIMNotificationServiceImpl,t);var a=V2NIMNotificationServiceImpl.prototype;return a.setOptions=function setOptions(t){var a;(null===(a=this.core.systemMessage)||void 0===a?void 0:a.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=qt(this.config,t)},a.sendCustomNotification=function sendCustomNotification(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var m,h,g,I,M,T;return Dc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate($b,{content:a,params:c},"",!0),h=this.core.V2NIMConversationIdUtil.parseConversationType(t),g=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t),(m={})[Wl.V2NIM_CONVERSATION_TYPE_P2P]=100,m[Wl.V2NIM_CONVERSATION_TYPE_TEAM]=101,m[Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM]=103,I=m,M=wi(),T=h===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",S.next=10,this.core.sendCmd(T,{tag:qt(qt({},c),{notificationConfig:qt({unreadEnabled:!0,offlineEnabled:!0},null==c?void 0:c.notificationConfig),pushConfig:qt({pushEnabled:!0,pushNickEnabled:!0},null==c?void 0:c.pushConfig),antispamConfig:qt({antispamEnabled:!0},null==c?void 0:c.antispamConfig),routeConfig:qt({routeEnabled:!0},null==c?void 0:c.routeConfig),timestamp:M,type:I[h],receiverId:g,content:a})});case 10:case"end":return S.stop()}}),_callee,this)})))},a.processSystemNotification=function processSystemNotification(t){var a=[0,1,2,3,4,15,16,17,18],c=[5,6],m=t.type;if(!includes(a).call(a,m)){includes(c).call(c,m)&&this.core.eventBus.emit("V2NIMFriendService/sysNotification",t);var h={100:Wl.V2NIM_CONVERSATION_TYPE_P2P,101:Wl.V2NIM_CONVERSATION_TYPE_TEAM,102:Wl.V2NIM_CONVERSATION_TYPE_P2P,103:Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM},g=qt(qt({},t),{conversationType:h[m]});return delete g.type,g}this.core.eventBus.emit("V2NIMTeamService/sysNotification",t)},a.markBroadcastMsgAck=function markBroadcastMsgAck(t){this.config.compatibleWithV1||this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:17,ids:map$6(t).call(t,(function(t){return t.id}))})},a.syncBroadcastMsgHandler=function syncBroadcastMsgHandler(t){var a=t.content.datas;this.markBroadcastMsgAck(a),this.emit("onReceiveBroadcastNotifications",a)},a.onBroadcastMsgHandler=function onBroadcastMsgHandler(t){var a=t.content.data;this.markBroadcastMsgAck([a]),this.emit("onReceiveBroadcastNotifications",[a])},a.onSysNotificationHandler=function onSysNotificationHandler(t){this.markSysNotificationAck([t.content.data]);var a=this.processSystemNotification(t.content.data);a&&this.emit("onReceiveCustomNotifications",[a])},a.v2SyncOfflineSysNotificationsHandler=function v2SyncOfflineSysNotificationsHandler(t){var a,c,m,h=this;this.markSysNotificationAck([t.content.datas]);var g=filter(a=map$6(c=sort(m=t.content.datas).call(m,(function(t,a){return t.timestamp-a.timestamp}))).call(c,(function(t){return h.processSystemNotification(t)}))).call(a,(function(t){return t}));g&&this.emit("onReceiveCustomNotifications",g)},a.v2NotificationRevokeHandler=function v2NotificationRevokeHandler(t){this.markSysNotificationAck([t.content.data])},a.v2NotificationSyncRevokeHandler=function v2NotificationSyncRevokeHandler(t){var a=t.content.type;1===em(a)&&this.markSysNotificationAck(t.content.datas)},a.markSysNotificationAck=function markSysNotificationAck(t){if(!this.config.compatibleWithV1){var a=[],c=[],m=[15,16,17,18,103];forEach$1(t).call(t,(function(t){t.idServer&&(includes(m).call(m,t.type)?c.push(t.idServer):a.push(t.idServer))})),a.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"7",cid:"3",ids:a}),c.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"21",cid:"19",ids:c})}},V2NIMNotificationServiceImpl}(gh),zb=function(t){function V2NIMStorageServiceImpl(a){var c;return(c=t.call(this,"V2NIMStorageService",a)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},c.uploadingMessageInfo={},c.core=a,c}kt(V2NIMStorageServiceImpl,t);var a=V2NIMStorageServiceImpl.prototype;return a.addCustomStorageScene=function addCustomStorageScene(t,a){return this.checkV2(),validate({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:t,expireTime:a},"",!0),this.sceneMap[t]={sceneName:t,expireTime:a},{sceneName:t,expireTime:a}},a.getStorageSceneList=function getStorageSceneList(){return this.checkV2(),Ai(this.sceneMap)},a.getStorageScene=function getStorageScene(t){return t&&this.sceneMap[t]||this.sceneMap.nim_default_im},a.hasStorageScene=function hasStorageScene(t){return void 0!==this.sceneMap[t]},a.createUploadFileTask=function createUploadFileTask(t){var a;if(this.checkV2(),"string"==typeof t.fileObj&&0===indexOf(a=t.fileObj).call(a,"nim-external")){var c=document.getElementById(t.fileObj);c&&c.files&&c.files[0]&&(t.fileObj=c.files[0])}return{taskId:_m(),uploadParams:t}},a.uploadFile=function uploadFile(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c;return Dc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate({taskId:{type:"string",allowEmpty:!1}},t,"fileTask",!0),m.next=4,this._uploadFile(t,a);case 4:return c=m.sent,m.abrupt("return",c[0]);case 6:case"end":return m.stop()}}),_callee,this)})))},a._uploadFile=function _uploadFile(t,a,c){var m;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var h,g,I,M,T,S,E,C,b,A,N=this;return Dc.wrap((function _callee2$(R){for(;;)switch(R.prev=R.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){R.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(h=t.uploadParams,g=t.taskId,I=getFileOrPath(h.fileObj),M=I.file,T=I.path,S=(c||{}).fileType,!this.uploadingMessageInfo[g]){R.next=7;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(R.prev=7,E={},M?E.file=M:T&&(0===(null==T?void 0:indexOf(T).call(T,"nim-external"))?E.fileInput=T:E.filePath=T),C=this.getStorageScene(h.sceneName),E.nosScenes=C.sceneName,E.nosSurvivalTime=C.expireTime,S===su.V2NIM_MESSAGE_TYPE_IMAGE?E.type="image":S===su.V2NIM_MESSAGE_TYPE_AUDIO?E.type="audio":S===su.V2NIM_MESSAGE_TYPE_VIDEO?E.type="video":E.type="file",!E.file||!this.core.pluginMap["browser-md5-file"]){R.next=19;break}return R.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],g,E.file);case 17:b=R.sent,E.md5=b;case 19:return E.onUploadProgress=function(t){"function"==typeof a&&a(100*t.percentage)},E.onUploadStart=function(t){var a;if(null===(a=N.uploadingMessageInfo[g])||void 0===a?void 0:a.abort)return t.abort(),void delete N.uploadingMessageInfo[g];N.uploadingMessageInfo[g]={abort:!1,task:t}},this.uploadingMessageInfo[g]={abort:!1},R.next=24,this.core.cloudStorage.uploadFile(E);case 24:if(A=R.sent,!(null===(m=this.uploadingMessageInfo[g])||void 0===m?void 0:m.abort)){R.next=27;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[g],R.abrupt("return",[A.url,A]);case 31:throw R.prev=31,R.t0=R.catch(7),delete this.uploadingMessageInfo[g],this.core.logger.error("sendFile:: upload File error or abort.",R.t0),R.t0;case 36:case"end":return R.stop()}}),_callee2,this,[[7,31]])})))},a.cancelUploadFile=function cancelUploadFile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.next=3,this._cancelUploadFile(t.taskId);case 3:case"end":return a.stop()}}),_callee3,this)})))},a._cancelUploadFile=function _cancelUploadFile(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),!(null==(a=this.uploadingMessageInfo[t])?void 0:a.task)){c.next=16;break}return c.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),c.next=7,a.task.abort();case 7:delete this.uploadingMessageInfo[t],c.next=14;break;case 10:c.prev=10,c.t0=c.catch(3),delete this.uploadingMessageInfo[t],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",c.t0);case 14:c.next=22;break;case 16:if(!a){c.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),a.abort=!0,c.next=22;break;case 21:throw new Yu({code:Gu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return c.stop()}}),_callee4,this,[[3,10]])})))},a.getFileMd5=function getFileMd5(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){var m=this;return Dc.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",new Mi((function(h,g){var I,M=new t;(null===(I=m.uploadingMessageInfo[a])||void 0===I?void 0:I.abort)?g(new Yu({code:Gu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):m.uploadingMessageInfo[a]={abort:!1,task:M};try{M.md5(c,(function(t,a){"aborted"===t?g(new Yu({code:Gu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:t}})):t?g(new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:t}})):h(a)}))}catch(t){g(new Yu({code:Gu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:t}}))}})));case 1:case"end":return h.stop()}}),_callee5)})))},a.shortUrlToLong=function shortUrlToLong(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){return Dc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.abrupt("return",this.core.cloudStorage.getOriginUrl(t));case 2:case"end":return a.stop()}}),_callee6,this)})))},a.getImageThumbUrl=function getImageThumbUrl(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.core.V2NIMStorageUtil.getImageThumbUrl(t,a));case 1:case"end":return c.stop()}}),_callee7,this)})))},a.getVideoCoverUrl=function getVideoCoverUrl(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){return Dc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.core.V2NIMStorageUtil.getVideoCoverUrl(t,a));case 1:case"end":return c.stop()}}),_callee8,this)})))},V2NIMStorageServiceImpl}(gh),Kb={"27_1":"v2NIMSync","27_10":"v2QChatSync"},Qb={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}},Jb=function(t){function V2NIMSyncServiceImpl(a){var c;return(c=t.call(this,"V2NIMSyncService",a)||this).teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],c.config={},c.timetags={},"v2"!==c.core.options.apiVersion?Qe(c):(c.initEventListeners(),registerParser({cmdMap:Kb,cmdConfig:Qb}),c)}kt(V2NIMSyncServiceImpl,t);var a=V2NIMSyncServiceImpl.prototype;return a.reset=function reset(){this.timetags={}},a.setOptions=function setOptions(t){var a=this.core;return this.config=qt({myInfo:!0,offlineMsgs:!!a.V2NIMMessageService.name,roamingMsgs:!!a.V2NIMMessageService.name,relations:!0,friends:!0,friendUsers:!0,msgReceipts:!!a.V2NIMMessageService.name,broadcastMsgs:!!a.V2NIMMessageService.name,recallMsg:!!a.V2NIMMessageService.name,sessionAck:!0,superTeamSessionAck:!!a.V2NIMConversationService.name,superTeamRoamingMsgs:!!a.V2NIMTeamService.name,deleteSuperTeamMsg:!!a.V2NIMTeamService.name,deleteSelfMsgs:!!a.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!a.V2NIMMessageService.name,avSignal:!!a.signaling.name,teams:!!a.V2NIMTeamService.name,superTeams:!!a.V2NIMTeamService.name,myTeamMembers:!!a.V2NIMTeamService.name,mySuperTeamMembers:!!a.V2NIMTeamService.name,p2pTeamModifyMessage:!!a.V2NIMMessageService.name,superTeamModifyMessage:!!a.V2NIMMessageService.name},t),this.config},a.doBasicSync=function doBasicSync(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t,a,c,m,h,g=this;return Dc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return t=mn(this.config),a=filter(t).call(t,(function(t){var a;return!includes(a=g.teamKey).call(a,t)&&g.config[t]})),c=this.genSyncParams(a),I.next=5,this.core.clientSocket.sendCmd("v2NIMSync",{tag:c});case 5:return m=I.sent,h=m.content.timetag,this.setTimetags(h,a),I.next=10,this.delaySyncDone();case 10:return I.next=12,this.handleImmediate();case 12:this.core.logger.log("sync::basic sync complete in",h);case 13:case"end":return I.stop()}}),_callee,this)})))},a.doTeamSync=function doTeamSync(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var t,a,c,m,h,g=this;return Dc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return a=filter(t=this.teamKey).call(t,(function(t){return g.config[t]})),c=this.genSyncParams(a),this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),m=null,I.prev=4,I.next=7,this.core.clientSocket.sendCmd("v2NIMSync",{tag:c});case 7:m=I.sent,I.next=14;break;case 10:throw I.prev=10,I.t0=I.catch(4),this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",I.t0),I.t0;case 14:this.core.eventBus.emit("V2NIMTeamService/onSyncFinished"),h=m.content.timetag,this.setTimetags(h,this.teamKey),this.core.logger.log("sync::team sync complete in",h);case 18:case"end":return I.stop()}}),_callee2,this,[[4,10]])})))},a.doQchatSync=function doQchatSync(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var t;return Dc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});case 2:t=a.sent,this.core.logger.log("sync::qchat sync complete in",t.content.timetag);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.doSync=function doSync(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var t;return Dc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==(t=ws(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType"))){a.next=4;break}return this.logger.warn("sync::doSync: no loginType, stop sync"),a.abrupt("return");case 4:if(this.logger.log("sync::doSync:type "+t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Yl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_SYNCING}),1!==t){a.next=20;break}return a.prev=7,a.next=10,this.doBasicSync();case 10:return a.next=12,this.doTeamSync();case 12:a.next=18;break;case 14:return a.prev=14,a.t0=a.catch(7),this.doSyncComplete(a.t0),a.abrupt("return");case 18:a.next=49;break;case 20:if(2!==t){a.next=32;break}return a.prev=21,a.next=24,this.doQchatSync();case 24:a.next=30;break;case 26:return a.prev=26,a.t1=a.catch(21),this.doSyncComplete(a.t1),a.abrupt("return");case 30:a.next=49;break;case 32:if(3!==t){a.next=48;break}return a.prev=33,a.next=36,this.doBasicSync();case 36:return a.next=38,this.doTeamSync();case 38:return a.next=40,this.doQchatSync();case 40:a.next=46;break;case 42:return a.prev=42,a.t2=a.catch(33),this.doSyncComplete(a.t2),a.abrupt("return");case 46:a.next=49;break;case 48:return a.abrupt("return");case 49:this.doSyncComplete();case 50:case"end":return a.stop()}}),_callee4,this,[[7,14],[21,26],[33,42]])})))},a.doSyncComplete=function doSyncComplete(t){t&&this.core.logger.log("sync::doSync complete but got error",t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Yl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_COMPLETED,error:t,subType:"mainSync"})},a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.doSync()}))},a.genSyncParams=function genSyncParams(t){var a=this;return reduce(t).call(t,(function(t,c){var m=c;return t[m]=a.timetags[m]||0,t}),{})},a.setTimetags=function setTimetags(t,a){var c=this;forEach$1(a).call(a,(function(a){c.timetags[a]=t}))},a.handleImmediate=function handleImmediate(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Mi.resolve()},a.delaySyncDone=function delaySyncDone(){return"ALI"===getMiniappEnv()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Mi((function(t){Gi((function(){t()}),100)}))):Mi.resolve()},V2NIMSyncServiceImpl}(gh);var Xb=function castSlice(t,a,c){var m=t.length;return c=void 0===c?m:c,!a&&c>=m?t:lv(t,a,c)},Zb=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var eA=function hasUnicode(t){return Zb.test(t)};var tA=function asciiToArray(t){return t.split("")},rA="[\\ud800-\\udfff]",nA="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",aA="\\ud83c[\\udffb-\\udfff]",iA="[^\\ud800-\\udfff]",oA="(?:\\ud83c[\\udde6-\\uddff]){2}",sA="[\\ud800-\\udbff][\\udc00-\\udfff]",cA="(?:"+nA+"|"+aA+")"+"?",lA="[\\ufe0e\\ufe0f]?",uA=lA+cA+("(?:\\u200d(?:"+[iA,oA,sA].join("|")+")"+lA+cA+")*"),dA="(?:"+[iA+nA+"?",nA,oA,sA,rA].join("|")+")",pA=RegExp(aA+"(?="+aA+")|"+dA+uA,"g");var mA=function unicodeToArray(t){return t.match(pA)||[]};var hA=function stringToArray(t){return eA(t)?mA(t):tA(t)};var gA=function createCaseFirst(t){return function(a){a=bs(a);var c=eA(a)?hA(a):void 0,m=c?c[0]:a.charAt(0),h=c?Xb(c,1).join(""):a.slice(1);return m[t]()+h}}("toUpperCase");var vA=function capitalize(t){return gA(bs(t).toLowerCase())};var fA=function arrayReduce(t,a,c,m){var h=-1,g=null==t?0:t.length;for(m&&g&&(c=t[++h]);++h<g;)c=a(c,t[h],h,t);return c};var yA=function basePropertyOf(t){return function(a){return null==t?void 0:t[a]}}({"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"}),_A=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,IA=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var MA=function deburr(t){return(t=bs(t))&&t.replace(_A,yA).replace(IA,"")},TA=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var SA=function asciiWords(t){return t.match(TA)||[]},EA=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var CA=function hasUnicodeWord(t){return EA.test(t)},bA="\\u2700-\\u27bf",AA="a-z\\xdf-\\xf6\\xf8-\\xff",NA="A-Z\\xc0-\\xd6\\xd8-\\xde",RA="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wA="["+RA+"]",kA="\\d+",OA="[\\u2700-\\u27bf]",PA="["+AA+"]",xA="[^\\ud800-\\udfff"+RA+kA+bA+AA+NA+"]",VA="(?:\\ud83c[\\udde6-\\uddff]){2}",LA="[\\ud800-\\udbff][\\udc00-\\udfff]",DA="["+NA+"]",UA="(?:"+PA+"|"+xA+")",FA="(?:"+DA+"|"+xA+")",BA="(?:['â](?:d|ll|m|re|s|t|ve))?",qA="(?:['â](?:D|LL|M|RE|S|T|VE))?",GA="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",HA="[\\ufe0e\\ufe0f]?",jA=HA+GA+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",VA,LA].join("|")+")"+HA+GA+")*"),YA="(?:"+[OA,VA,LA].join("|")+")"+jA,$A=RegExp([DA+"?"+PA+"+"+BA+"(?="+[wA,DA,"$"].join("|")+")",FA+"+"+qA+"(?="+[wA,DA+UA,"$"].join("|")+")",DA+"?"+UA+"+"+BA,DA+"+"+qA,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kA,YA].join("|"),"g");var WA=function unicodeWords(t){return t.match($A)||[]};var zA=function words(t,a,c){return t=bs(t),void 0===(a=c?void 0:a)?CA(t)?WA(t):SA(t):t.match(a)||[]},KA=RegExp("['â]","g");var QA=function createCompounder(t){return function(a){return fA(zA(MA(a).replace(KA,"")),t,"")}}((function(t,a,c){return a=a.toLowerCase(),t+(c?vA(a):a)})),JA="V2NIMAIService",XA={"4_26":"v2AIChatNotify","29_35":"v2AIProxyModelCall","29_36":"v2AIGetUserList"},ZA={accountId:1,messages:{id:2,converter:objectToJSONString,retConverter:stringToJSONObject},requestId:3,content:{id:4,converter:objectToJSONString,retConverter:stringToJSONObject},promptVariables:5,modelConfigParams:{id:6,converter:objectToJSONString,retConverter:stringToJSONObject},antispamBusinessId:7,antispamEnabled:{id:8,converter:boolToInt}},eN={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:function retConverter(t){if(t=stringToJSONObject(t)){var a=mn(t),c=reduce(a).call(a,(function(a,c){return a[QA(c)]=t[c],a}),{});if("string"==typeof c.promptKeys)try{c.promptKeys=JSON.parse(c.promptKeys)}catch(t){}return c}}},yunxinConfig:{id:13,retConverter:function retConverter(t){if(t=stringToJSONObject(t))return t}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}},tN={v2AIChatNotify:{sid:4,cid:26,service:JA,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem({code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:stringToJSONObject}})}]},v2AIProxyModelCall:{sid:29,cid:35,service:JA,params:[{type:"Property",name:"tag",reflectMapper:ZA}]},v2AIGetUserList:{sid:29,cid:36,service:JA,params:[{type:"Property",name:"tag",reflectMapper:{pageToken:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(eN)},{type:"Property",name:"queryTag",reflectMapper:invertSerializeItem({hasMore:{id:16,retType:"boolean"},nextToken:2})}]}},rN=function(t){function V2NIMAIServiceImpl(a){var c;return c=t.call(this,"V2NIMAIService",a)||this,registerParser({cmdMap:XA,cmdConfig:tN}),c}kt(V2NIMAIServiceImpl,t);var a=V2NIMAIServiceImpl.prototype;return a.getAIUserList=function getAIUserList(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var t;return Dc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.next=3,this.core.sendCmd("v2AIGetUserList",{tag:{}});case 3:return t=a.sent,a.abrupt("return",t.content.datas);case 5:case"end":return a.stop()}}),_callee,this)})))},a.proxyAIModelCall=function proxyAIModelCall(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){return Dc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate(fy,t,"",!0),a.next=3,this.core.sendCmd("v2AIProxyModelCall",{tag:t});case 3:case"end":return a.stop()}}),_callee2,this)})))},a.v2AIChatNotifyHandler=function v2AIChatNotifyHandler(t){var a=t.content.data;a&&a.requestId?this.emit("onProxyAIModelCall",{code:a.code||200,accountId:a.accountId,requestId:a.requestId,content:a.content}):this.logger.warn("v2AIChatNotifyHandler: invalid data",a)},V2NIMAIServiceImpl}(gh),nN={"18_1":"v2SignallingCreateRoom","18_2":"v2SignallingDelayRoom","18_3":"v2SignallingCloseRoom","18_4":"v2SignallingJoinRoom","18_5":"v2SignallingLeaveRoom","18_6":"v2SignallingInvite","18_7":"v2SignallingCancelInvite","18_16":"v2SignallingCall","18_17":"v2SignallingCallSetup","18_8":"v2SignallingRejectInvite","18_9":"v2SignallingAcceptInvite","18_10":"v2SignallingSendControl","15_11":"v2SignallingOnlineEvent","15_12":"v2SignallingMultiClientEvent","15_13":"v2SignallingOfflineEvent","15_14":"v2SignallingSyncChannels","18_15":"v2SignallingGetRoomInfo"},aN="V2NIMSignallingService",iN={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},oN={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},invalid:8,fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:boolToInt,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:boolToInt,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:function retConverter(t){try{var a=JSON.parse(t);return map$6(a).call(a,(function(t){return deserialize(t,invertSerializeItem(iN))}))}catch(t){return}}},attach:{id:19,retConverter:stringToJSONObject},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:boolToInt,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}},sN={v2SignallingCall:{sid:18,cid:16,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingCallSetup:{sid:18,cid:17,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingCreateRoom:{sid:18,cid:1,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingDelayRoom:{sid:18,cid:2,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingCloseRoom:{sid:18,cid:3,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingJoinRoom:{sid:18,cid:4,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingLeaveRoom:{sid:18,cid:5,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingInvite:{sid:18,cid:6,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingCancelInvite:{sid:18,cid:7,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingRejectInvite:{sid:18,cid:8,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}]},v2SignallingAcceptInvite:{sid:18,cid:9,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}]},v2SignallingSendControl:{sid:18,cid:10,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}]},v2SignallingOnlineEvent:{sid:15,cid:11,service:aN,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingMultiClientEvent:{sid:15,cid:12,service:aN,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingOfflineEvent:{sid:15,cid:13,service:aN,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(oN)}]},v2SignallingSyncChannels:{sid:15,cid:14,service:aN,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(oN)}]},v2SignallingGetRoomInfo:{sid:18,cid:15,service:aN,params:[{type:"Property",name:"tag",reflectMapper:oN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(oN)}]},v2SignallingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:aN,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},cN={calleeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},channelType:{type:"enum",values:getEnumValues(Lu)},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},lN={channelId:{type:"string",required:!0,allowEmpty:!1},callerAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},uN={channelType:{type:"enum",values:getEnumValues(Lu)},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0}},dN={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},pN={channelId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},mN={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},hN={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},gN={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},vN={channelId:{type:"string",allowEmpty:!1},receiverAccountId:{type:"string",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},fN={channelId:{type:"string",allowEmpty:!1},inviterAccountId:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},yN=fN;function formatSignalingEvent(t){var a,c=t.attach,m={eventType:c.type,channelInfo:t.channelInfo,operatorAccountId:t.fromAccid,time:t.time,serverExtension:t.serverExtension,requestId:t.requestId,pushConfig:t.pushConfig,unreadEnabled:null===(a=t.signallingConfig)||void 0===a?void 0:a.unreadEnabled},h=t.fromAccid,g=t.toAccid;switch(m.eventType){case Vu.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE:break;case Vu.V2NIM_SIGNALLING_EVENT_TYPE_JOIN:m.member={accountId:c.member[1],uid:Number(c.member[2]),joinTime:Number(c.member[3]),expireTime:Number(c.member[4]),deviceId:c.member[5]};break;case Vu.V2NIM_SIGNALLING_EVENT_TYPE_INVITE:case Vu.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE:m.operatorAccountId=h,m.inviteeAccountId=g,m.inviterAccountId=h;break;case Vu.V2NIM_SIGNALLING_EVENT_TYPE_REJECT:case Vu.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT:m.operatorAccountId=h,m.inviterAccountId=g,m.inviteeAccountId=h;case Vu.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE:case Vu.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL:}return JSON.parse(Fc(m))}var _N=function(t){function V2NIMSignallingServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMSignallingService",a)||this).config={compatibleWithV1:!0},m.channels={},m.timer=0,m.pollingInterval=12e4,"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:nN,cmdConfig:sN}),m.setOptions(c),m)}kt(V2NIMSignallingServiceImpl,t);var a=V2NIMSignallingServiceImpl.prototype;return a.reset=function reset(){this.timer=0,this.channels={}},a.setOptions=function setOptions(t){var a;(null===(a=this.core.signaling)||void 0===a?void 0:a.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=qt(this.config,t)},a.call=function call(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m,h,g;return Dc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),validate(cN,t,"",!0),t.calleeAccountId!==this.core.account){I.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"You cannot call yourself"}});case 4:return c=void 0!==t.pushConfig&&(void 0!==t.pushConfig.pushEnabled&&t.pushConfig.pushEnabled),I.next=7,this.core.sendCmd("v2SignallingCall",{tag:qt(qt({},t),{toAccid:t.calleeAccountId,offlineEnabled:void 0===(null===(a=t.signallingConfig)||void 0===a?void 0:a.offlineEnabled)||t.signallingConfig.offlineEnabled,pushConfig:qt(qt({},t.pushConfig||{}),{pushEnabled:c})})});case 7:return m=I.sent,h=m.content.data,this.channels[h.channelInfo.channelId]=MS(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),I.abrupt("return",{callStatus:h.callStatus,rtcInfo:h.rtcInfo,roomInfo:{channelInfo:h.channelInfo,members:h.members}});case 12:case"end":return I.stop()}}),_callee,this)})))},a.callSetup=function callSetup(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m,h;return Dc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),validate(lN,t,"",!0),t.callerAccountId!==this.core.account){g.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"callSetup: cannot be yourself"}});case 4:return g.next=6,this.core.sendCmd("v2SignallingCallSetup",{tag:qt(qt({},t),{toAccid:t.callerAccountId,offlineEnabled:void 0===(null===(a=t.signallingConfig)||void 0===a?void 0:a.offlineEnabled)||t.signallingConfig.offlineEnabled})});case 6:return c=g.sent,m=c.content.data,this.channels[m.channelInfo.channelId]=MS(m.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),g.abrupt("return",{callStatus:m.callStatus,rtcInfo:m.rtcInfo,roomInfo:{channelInfo:m.channelInfo,members:m.members}});case 11:case"end":return g.stop()}}),_callee2,this)})))},a.createRoom=function createRoom(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var m;return Dc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(uN,{channelType:t,channelName:a,channelExtension:c},"",!0),h.next=4,this.core.sendCmd("v2SignallingCreateRoom",{tag:{channelType:t,channelName:a,channelExtension:c}});case 4:return m=h.sent,h.abrupt("return",m.content.data.channelInfo);case 6:case"end":return h.stop()}}),_callee3,this)})))},a.delayRoom=function delayRoom(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a;return Dc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),c.next=3,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:t}});case 3:return a=c.sent,c.abrupt("return",{channelInfo:a.content.data.channelInfo,members:a.content.data.members});case 5:case"end":return c.stop()}}),_callee4,this)})))},a.closeRoom=function closeRoom(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee5(){return Dc.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(dN,{channelId:t,offlineEnabled:a,serverExtension:c},"",!0),m.next=4,this.core.sendCmd("v2SignallingCloseRoom",{tag:{channelId:t,offlineEnabled:void 0!==a&&a,serverExtension:c}});case 4:case"end":return m.stop()}}),_callee5,this)})))},a.joinRoom=function joinRoom(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee6(){var c,m,h;return Dc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(pN,t,"",!0),g.next=4,this.core.sendCmd("v2SignallingJoinRoom",{tag:qt(qt({},t),{offlineEnabled:void 0===(null===(a=t.signallingConfig)||void 0===a?void 0:a.offlineEnabled)||t.signallingConfig.offlineEnabled})});case 4:return c=g.sent,m=c.content.data,this.channels[m.channelInfo.channelId]=MS(m.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),g.abrupt("return",{channelInfo:c.content.data.channelInfo,members:c.content.data.members});case 9:case"end":return g.stop()}}),_callee6,this)})))},a.leaveRoom=function leaveRoom(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee7(){return Dc.wrap((function _callee7$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(mN,{channelId:t,offlineEnabled:a,serverExtension:c},"",!0),m.next=4,this.core.sendCmd("v2SignallingLeaveRoom",{tag:{channelId:t,offlineEnabled:void 0!==a&&a,serverExtension:c}});case 4:delete this.channels[t];case 5:case"end":return m.stop()}}),_callee7,this)})))},a.invite=function invite(t){var a;return __awaiter(this,void 0,void 0,Dc.mark((function _callee8(){var c,m;return Dc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:if(this.checkV2(),validate(hN,t,"",!0),t.inviteeAccountId!==this.core.account){h.next=4;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"invite: cannot be yourself"}});case 4:return c=void 0!==t.pushConfig&&(void 0!==t.pushConfig.pushEnabled&&t.pushConfig.pushEnabled),h.next=7,this.core.sendCmd("v2SignallingInvite",{tag:qt(qt({},t),{toAccid:t.inviteeAccountId,offlineEnabled:void 0===(null===(a=t.signallingConfig)||void 0===a?void 0:a.offlineEnabled)||t.signallingConfig.offlineEnabled,pushConfig:qt(qt({},t.pushConfig||{}),{pushEnabled:c})})});case 7:return m=h.sent,h.abrupt("return",m.content.data);case 9:case"end":return h.stop()}}),_callee8,this)})))},a.cancelInvite=function cancelInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee9(){var a;return Dc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(gN,t,"",!0),c.next=4,this.core.sendCmd("v2SignallingCancelInvite",{tag:qt(qt({},t),{toAccid:t.inviteeAccountId})});case 4:return a=c.sent,c.abrupt("return",a.content.data);case 6:case"end":return c.stop()}}),_callee9,this)})))},a.rejectInvite=function rejectInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee10(){return Dc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:if(validate(fN,t,"",!0),t.inviterAccountId!==this.core.account){a.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"rejectInvite: cannot be yourself"}});case 3:return a.next=5,this.core.sendCmd("v2SignallingRejectInvite",{tag:qt(qt({},t),{toAccid:t.inviterAccountId})});case 5:case"end":return a.stop()}}),_callee10,this)})))},a.acceptInvite=function acceptInvite(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee11(){return Dc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:if(validate(yN,t,"",!0),t.inviterAccountId!==this.core.account){a.next=3;break}throw new Yu({code:Gu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"acceptInvite: cannot be yourself"}});case 3:return a.next=5,this.core.sendCmd("v2SignallingAcceptInvite",{tag:qt(qt({},t),{toAccid:t.inviterAccountId})});case 5:case"end":return a.stop()}}),_callee11,this)})))},a.sendControl=function sendControl(t,a,c){return __awaiter(this,void 0,void 0,Dc.mark((function _callee12(){return Dc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return validate(vN,{channelId:t,receiverAccountId:a,serverExtension:c},"",!0),m.next=3,this.core.sendCmd("v2SignallingSendControl",{tag:{channelId:t,toAccid:a,serverExtension:c}});case 3:case"end":return m.stop()}}),_callee12,this)})))},a.getRoomInfoByChannelName=function getRoomInfoByChannelName(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee13(){var a,c,m,h;return Dc.wrap((function _callee13$(g){for(;;)switch(g.prev=g.next){case 0:return validate({channelName:{type:"string",allowEmpty:!1}},{channelName:t},"",!0),g.next=3,this.core.sendCmd("v2SignallingGetRoomInfo",{tag:{channelName:t}});case 3:return a=g.sent,c=a.content.data,m=c.members,h=c.channelInfo,g.abrupt("return",{channelInfo:h,members:m||[]});case 6:case"end":return g.stop()}}),_callee13,this)})))},a.aotoDelay=function aotoDelay(){return __awaiter(this,void 0,void 0,Dc.mark((function _callee14(){var t,a,c,m;return Dc.wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:if(0!==(t=mn(this.channels)).length){h.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,h.abrupt("return");case 5:this.logger.log("v2Signlling:autoDelay",t),a=0;case 7:if(!(a<t.length)){h.next=23;break}return c=t[a],h.prev=9,h.next=12,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:c}});case 12:m=h.sent,this.channels[c]=m.content.data.channelInfo,h.next=20;break;case 16:h.prev=16,h.t0=h.catch(9),this.logger.warn("signling:autoDelay "+c+" failed",h.t0),delete this.channels[c];case 20:a++,h.next=7;break;case 23:case"end":return h.stop()}}),_callee14,this,[[9,16]])})))},a.v2SignallingOnlineEventHandler=function v2SignallingOnlineEventHandler(t){var a=t.content.data,c="number"==typeof ws(t,"raw.r[0]")?""+t.raw.r[0]:"0";!this.config.compatibleWithV1&&c&&em(c)&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:[c]}),this.emit("onOnlineEvent",formatSignalingEvent(a))},a.v2SignallingMultiClientEventHandler=function v2SignallingMultiClientEventHandler(t){this.emit("onMultiClientEvent",formatSignalingEvent(t.content.data))},a.v2SignallingOfflineEventHandler=function v2SignallingOfflineEventHandler(t){var a;if(t.content.datas&&t.content.datas.length>0){if(!this.config.compatibleWithV1){var c,m=map$6(c=t.content.datas).call(c,(function(t){return t.msgId}));m.length>0&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:m})}var h=map$6(a=t.content.datas).call(a,(function(t){return formatSignalingEvent(t)}));this.emit("onOfflineEvent",h)}},a.v2SignallingSyncChannelsHandler=function v2SignallingSyncChannelsHandler(t){var a=this;if(this.timer=0,this.channels={},t.content.datas&&t.content.datas.length>0){var c,m=t.content.datas;if(forEach$1(m).call(m,(function(t){var c=t.channelInfo.channelId;a.channels[c]=MS(t.channelInfo)})),!this.timer)this.timer=this.core.timerManager.addTimer(bind$1(c=this.aotoDelay).call(c,this),this.pollingInterval,-1);this.emit("onSyncRoomInfoList",m)}},V2NIMSignallingServiceImpl}(gh),IN={"19_1":"v2PublishEvent","14_2":"v2OnUserStatusChange","19_3":"v2SubscribeUserStatus","19_4":"v2UnsubscribeUserStatus","19_5":"v2UnsubscribeAllUserStatus","19_6":"v2QuerySubscribeEvent","19_7":"v2QueryAllSubscribeEvent","14_9":"v2OnMultiUserStatusChange"},MN="V2NIMSubscriptionService",TN={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:function converter(t){return t?1:2}},multiSync:{id:7,retType:"boolean",converter:boolToInt},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},SN={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:boolToInt},accountId:102,subscribeTime:{id:105,retType:"number"}},EN={v2PublishEvent:{sid:19,cid:1,service:MN,params:[{type:"Property",name:"tag",reflectMapper:TN}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(TN)}]},v2OnUserStatusChange:{sid:14,cid:2,service:MN,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(TN)}]},v2SubscribeUserStatus:{sid:19,cid:3,service:MN,params:[{type:"Property",name:"tag",reflectMapper:SN},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeUserStatus:{sid:19,cid:4,service:MN,params:[{type:"Property",name:"tag",reflectMapper:SN},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeAllUserStatus:{sid:19,cid:5,service:MN,params:[{type:"Property",name:"tag",reflectMapper:SN}]},v2QuerySubscribeEvent:{sid:19,cid:6,service:MN,params:[{type:"Property",name:"tag",reflectMapper:SN},{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(SN)}]},v2QueryAllSubscribeEvent:{sid:19,cid:7,service:MN,params:[{type:"Property",name:"tag",reflectMapper:SN}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(SN)}]},v2OnMultiUserStatusChange:{sid:14,cid:9,service:MN,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(TN)}]}},CN={accountIds:{type:"array",required:!0,itemType:"string",min:1,max:100},duration:{type:"number",required:!1,min:60,max:2592e3},immediateSync:{type:"boolean",required:!1}},bN={accountIds:{type:"array",required:!1,itemType:"string",max:100}},AN={statusType:{type:"number",required:!0,min:1e4,max:2147483647},duration:{type:"number",required:!1,min:60,max:604800},extension:{type:"jsonstr",required:!1},onlineOnly:{type:"boolean",required:!1},multiSync:{type:"boolean",required:!1}},NN=function(t){function V2NIMSubscriptionServiceImpl(a){var c;return"v2"!==(c=t.call(this,"V2NIMSubscriptionService",a)||this).core.options.apiVersion?Qe(c):(registerParser({cmdMap:IN,cmdConfig:EN}),c)}kt(V2NIMSubscriptionServiceImpl,t);var a=V2NIMSubscriptionServiceImpl.prototype;return a.subscribeUserStatus=function subscribeUserStatus(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var a;return Dc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkLogin(),this.checkV2(),validate(CN,t,"",!0),c.next=5,this.core.sendCmd("v2SubscribeUserStatus",{tag:{eventType:1,duration:t.duration||60,immediateSync:void 0!==t.immediateSync&&t.immediateSync},accountIds:t.accountIds});case 5:return a=c.sent,c.abrupt("return",a.content.failedList);case 7:case"end":return c.stop()}}),_callee,this)})))},a.unsubscribeUserStatus=function unsubscribeUserStatus(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var a,c;return Dc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:if(this.checkLogin(),this.checkV2(),validate(bN,t,"",!0),a=[],!(t.accountIds.length>0)){m.next=11;break}return m.next=7,this.core.sendCmd("v2UnsubscribeUserStatus",{tag:{eventType:1},accountIds:t.accountIds});case 7:c=m.sent,a=c.content.failedList,m.next=15;break;case 11:return m.next=14,this.core.sendCmd("v2UnsubscribeAllUserStatus",{tag:{eventType:1}});case 14:a=[];case 15:return m.abrupt("return",a);case 16:case"end":return m.stop()}}),_callee2,this)})))},a.publishCustomUserStatus=function publishCustomUserStatus(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee3(){var a;return Dc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkLogin(),this.checkV2(),validate(AN,t,"",!0),c.next=5,this.core.sendCmd("v2PublishEvent",{tag:qt(qt({},t),{eventType:1,uniqueId:_m(),duration:t.duration||60,onlineOnly:void 0===t.onlineOnly||t.onlineOnly,multiSync:void 0!==t.multiSync&&t.multiSync})});case 5:return a=c.sent,c.abrupt("return",a.content.data);case 7:case"end":return c.stop()}}),_callee3,this)})))},a.queryUserStatusSubscriptions=function queryUserStatusSubscriptions(t){return __awaiter(this,void 0,void 0,Dc.mark((function _callee4(){var a,c,m,h,g,I;return Dc.wrap((function _callee4$(M){for(;;)switch(M.prev=M.next){case 0:if(this.checkLogin(),this.checkV2(),validate({accountIds:{type:"array",required:!0,itemType:"string",max:3e3}},{accountIds:t},"",!0),a=[],!(t.length>0)){M.next=16;break}c=0;case 6:if(!(c<t.length)){M.next=14;break}return M.next=9,this.core.sendCmd("v2QuerySubscribeEvent",{tag:{eventType:1},accountIds:slice$1(t).call(t,c,c+100)});case 9:h=M.sent,a=concat(a).call(a,map$6(m=h.content.data).call(m,(function(t){return{accountId:t.accountId,subscribeTime:t.subscribeTime,duration:t.duration}})));case 11:c+=100,M.next=6;break;case 14:M.next=20;break;case 16:return M.next=18,this.core.sendCmd("v2QueryAllSubscribeEvent",{tag:{eventType:1}});case 18:I=M.sent,a=concat(a).call(a,map$6(g=I.content.data).call(g,(function(t){return{accountId:t.accountId,subscribeTime:t.subscribeTime,duration:t.duration}})));case 20:return M.abrupt("return",a);case 21:case"end":return M.stop()}}),_callee4,this)})))},a.v2OnUserStatusChangeHandler=function v2OnUserStatusChangeHandler(t){var a=t.content.data,c=a.eventType,m=a.extensionReceived,h=__rest(a,["eventType","extensionReceived"]);1===c?this.emit("onUserStatusChanged",[qt(qt({},h),{extension:m})]):this.logger.log("v2OnUserStatusChangeHandler eventType = ",c,"msgEvent = ",a)},a.v2OnMultiUserStatusChangeHandler=function v2OnMultiUserStatusChangeHandler(t){var a,c=t.content.data,m=map$6(a=filter(c).call(c,(function(t){return 1===t.eventType}))).call(a,(function(t){t.eventType;var a=t.extensionReceived,c=__rest(t,["eventType","extensionReceived"]);return qt(qt({},c),{extension:a})}));m.length>0&&this.emit("onUserStatusChanged",m)},V2NIMSubscriptionServiceImpl}(gh),RN=createCommonjsModule((function(t,a){t.exports=function(t){var add32=function(t,a){return t+a&4294967295},a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function cmn(t,a,c,m,h,g){return a=add32(add32(a,t),add32(m,g)),add32(a<<h|a>>>32-h,c)}function ff(t,a,c,m,h,g,I){return cmn(a&c|~a&m,t,a,h,g,I)}function gg(t,a,c,m,h,g,I){return cmn(a&m|c&~m,t,a,h,g,I)}function hh(t,a,c,m,h,g,I){return cmn(a^c^m,t,a,h,g,I)}function ii(t,a,c,m,h,g,I){return cmn(c^(a|~m),t,a,h,g,I)}function md5cycle(t,a){var c=t[0],m=t[1],h=t[2],g=t[3];c=ff(c,m,h,g,a[0],7,-680876936),g=ff(g,c,m,h,a[1],12,-389564586),h=ff(h,g,c,m,a[2],17,606105819),m=ff(m,h,g,c,a[3],22,-1044525330),c=ff(c,m,h,g,a[4],7,-176418897),g=ff(g,c,m,h,a[5],12,1200080426),h=ff(h,g,c,m,a[6],17,-1473231341),m=ff(m,h,g,c,a[7],22,-45705983),c=ff(c,m,h,g,a[8],7,1770035416),g=ff(g,c,m,h,a[9],12,-1958414417),h=ff(h,g,c,m,a[10],17,-42063),m=ff(m,h,g,c,a[11],22,-1990404162),c=ff(c,m,h,g,a[12],7,1804603682),g=ff(g,c,m,h,a[13],12,-40341101),h=ff(h,g,c,m,a[14],17,-1502002290),c=gg(c,m=ff(m,h,g,c,a[15],22,1236535329),h,g,a[1],5,-165796510),g=gg(g,c,m,h,a[6],9,-1069501632),h=gg(h,g,c,m,a[11],14,643717713),m=gg(m,h,g,c,a[0],20,-373897302),c=gg(c,m,h,g,a[5],5,-701558691),g=gg(g,c,m,h,a[10],9,38016083),h=gg(h,g,c,m,a[15],14,-660478335),m=gg(m,h,g,c,a[4],20,-405537848),c=gg(c,m,h,g,a[9],5,568446438),g=gg(g,c,m,h,a[14],9,-1019803690),h=gg(h,g,c,m,a[3],14,-187363961),m=gg(m,h,g,c,a[8],20,1163531501),c=gg(c,m,h,g,a[13],5,-1444681467),g=gg(g,c,m,h,a[2],9,-51403784),h=gg(h,g,c,m,a[7],14,1735328473),c=hh(c,m=gg(m,h,g,c,a[12],20,-1926607734),h,g,a[5],4,-378558),g=hh(g,c,m,h,a[8],11,-2022574463),h=hh(h,g,c,m,a[11],16,1839030562),m=hh(m,h,g,c,a[14],23,-35309556),c=hh(c,m,h,g,a[1],4,-1530992060),g=hh(g,c,m,h,a[4],11,1272893353),h=hh(h,g,c,m,a[7],16,-155497632),m=hh(m,h,g,c,a[10],23,-1094730640),c=hh(c,m,h,g,a[13],4,681279174),g=hh(g,c,m,h,a[0],11,-358537222),h=hh(h,g,c,m,a[3],16,-722521979),m=hh(m,h,g,c,a[6],23,76029189),c=hh(c,m,h,g,a[9],4,-640364487),g=hh(g,c,m,h,a[12],11,-421815835),h=hh(h,g,c,m,a[15],16,530742520),c=ii(c,m=hh(m,h,g,c,a[2],23,-995338651),h,g,a[0],6,-198630844),g=ii(g,c,m,h,a[7],10,1126891415),h=ii(h,g,c,m,a[14],15,-1416354905),m=ii(m,h,g,c,a[5],21,-57434055),c=ii(c,m,h,g,a[12],6,1700485571),g=ii(g,c,m,h,a[3],10,-1894986606),h=ii(h,g,c,m,a[10],15,-1051523),m=ii(m,h,g,c,a[1],21,-2054922799),c=ii(c,m,h,g,a[8],6,1873313359),g=ii(g,c,m,h,a[15],10,-30611744),h=ii(h,g,c,m,a[6],15,-1560198380),m=ii(m,h,g,c,a[13],21,1309151649),c=ii(c,m,h,g,a[4],6,-145523070),g=ii(g,c,m,h,a[11],10,-1120210379),h=ii(h,g,c,m,a[2],15,718787259),m=ii(m,h,g,c,a[9],21,-343485551),t[0]=add32(c,t[0]),t[1]=add32(m,t[1]),t[2]=add32(h,t[2]),t[3]=add32(g,t[3])}function md5blk(t){var a,c=[];for(a=0;a<64;a+=4)c[a>>2]=t.charCodeAt(a)+(t.charCodeAt(a+1)<<8)+(t.charCodeAt(a+2)<<16)+(t.charCodeAt(a+3)<<24);return c}function md5blk_array(t){var a,c=[];for(a=0;a<64;a+=4)c[a>>2]=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+(t[a+3]<<24);return c}function md51(t){var a,c,m,h,g,I,M=t.length,T=[1732584193,-271733879,-1732584194,271733878];for(a=64;a<=M;a+=64)md5cycle(T,md5blk(t.substring(a-64,a)));for(c=(t=t.substring(a-64)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)m[a>>2]|=t.charCodeAt(a)<<(a%4<<3);if(m[a>>2]|=128<<(a%4<<3),a>55)for(md5cycle(T,m),a=0;a<16;a+=1)m[a]=0;return h=(h=8*M).toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(h[2],16),I=parseInt(h[1],16)||0,m[14]=g,m[15]=I,md5cycle(T,m),T}function md51_array(t){var a,c,m,h,g,I,M=t.length,T=[1732584193,-271733879,-1732584194,271733878];for(a=64;a<=M;a+=64)md5cycle(T,md5blk_array(t.subarray(a-64,a)));for(c=(t=a-64<M?t.subarray(a-64):new Uint8Array(0)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)m[a>>2]|=t[a]<<(a%4<<3);if(m[a>>2]|=128<<(a%4<<3),a>55)for(md5cycle(T,m),a=0;a<16;a+=1)m[a]=0;return h=(h=8*M).toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(h[2],16),I=parseInt(h[1],16)||0,m[14]=g,m[15]=I,md5cycle(T,m),T}function rhex(t){var c,m="";for(c=0;c<4;c+=1)m+=a[t>>8*c+4&15]+a[t>>8*c&15];return m}function hex(t){var a;for(a=0;a<t.length;a+=1)t[a]=rhex(t[a]);return t.join("")}function toUtf8(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function utf8Str2ArrayBuffer(t,a){var c,m=t.length,h=new ArrayBuffer(m),g=new Uint8Array(h);for(c=0;c<m;c+=1)g[c]=t.charCodeAt(c);return a?g:h}function arrayBuffer2Utf8Str(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function concatenateArrayBuffers(t,a,c){var m=new Uint8Array(t.byteLength+a.byteLength);return m.set(new Uint8Array(t)),m.set(new Uint8Array(a),t.byteLength),c?m:m.buffer}function hexToBinaryString(t){var a,c=[],m=t.length;for(a=0;a<m-1;a+=2)c.push(parseInt(t.substr(a,2),16));return String.fromCharCode.apply(String,c)}function SparkMD5(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==hex(md51("hello"))&&(add32=function(t,a){var c=(65535&t)+(65535&a);return(t>>16)+(a>>16)+(c>>16)<<16|65535&c}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function clamp(t,a){return(t=0|t||0)<0?Math.max(t+a,0):Math.min(t,a)}ArrayBuffer.prototype.slice=function(a,c){var m,h,g,I,M=this.byteLength,T=clamp(a,M),S=M;return c!==t&&(S=clamp(c,M)),T>S?new ArrayBuffer(0):(m=S-T,h=new ArrayBuffer(m),g=new Uint8Array(h),I=new Uint8Array(this,T,m),g.set(I),h)}}(),SparkMD5.prototype.append=function(t){return this.appendBinary(toUtf8(t)),this},SparkMD5.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var a,c=this._buff.length;for(a=64;a<=c;a+=64)md5cycle(this._hash,md5blk(this._buff.substring(a-64,a)));return this._buff=this._buff.substring(a-64),this},SparkMD5.prototype.end=function(t){var a,c,m=this._buff,h=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<h;a+=1)g[a>>2]|=m.charCodeAt(a)<<(a%4<<3);return this._finish(g,h),c=hex(this._hash),t&&(c=hexToBinaryString(c)),this.reset(),c},SparkMD5.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},SparkMD5.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},SparkMD5.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},SparkMD5.prototype._finish=function(t,a){var c,m,h,g=a;if(t[g>>2]|=128<<(g%4<<3),g>55)for(md5cycle(this._hash,t),g=0;g<16;g+=1)t[g]=0;c=(c=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(c[2],16),h=parseInt(c[1],16)||0,t[14]=m,t[15]=h,md5cycle(this._hash,t)},SparkMD5.hash=function(t,a){return SparkMD5.hashBinary(toUtf8(t),a)},SparkMD5.hashBinary=function(t,a){var c=hex(md51(t));return a?hexToBinaryString(c):c},SparkMD5.ArrayBuffer=function(){this.reset()},SparkMD5.ArrayBuffer.prototype.append=function(t){var a,c=concatenateArrayBuffers(this._buff.buffer,t,!0),m=c.length;for(this._length+=t.byteLength,a=64;a<=m;a+=64)md5cycle(this._hash,md5blk_array(c.subarray(a-64,a)));return this._buff=a-64<m?new Uint8Array(c.buffer.slice(a-64)):new Uint8Array(0),this},SparkMD5.ArrayBuffer.prototype.end=function(t){var a,c,m=this._buff,h=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<h;a+=1)g[a>>2]|=m[a]<<(a%4<<3);return this._finish(g,h),c=hex(this._hash),t&&(c=hexToBinaryString(c)),this.reset(),c},SparkMD5.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.ArrayBuffer.prototype.getState=function(){var t=SparkMD5.prototype.getState.call(this);return t.buff=arrayBuffer2Utf8Str(t.buff),t},SparkMD5.ArrayBuffer.prototype.setState=function(t){return t.buff=utf8Str2ArrayBuffer(t.buff,!0),SparkMD5.prototype.setState.call(this,t)},SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy,SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish,SparkMD5.ArrayBuffer.hash=function(t,a){var c=hex(md51_array(new Uint8Array(t)));return a?hexToBinaryString(c):c},SparkMD5}()}));var wN=function _interopDefault$1(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(RN);var kN,ON,PN,xN,VN,LN,DN=class BMF{md5(t,a,c){this.aborted=!1,this.progress=0;let m=0;const h=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,g=2097152,I=Math.ceil(t.size/g),M=new wN.ArrayBuffer,T=new FileReader;function loadNext(){const a=m*g,c=a+g>=t.size?t.size:a+g;T.readAsArrayBuffer(h.call(t,a,c))}loadNext(),T.onloadend=t=>{M.append(t.target.result),m++,this.progress=m/I,c&&"function"==typeof c&&c(this.progress),this.aborted?a("aborted"):m<I?loadNext():a(null,M.end())}}abort(){this.aborted=!0}};!function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(kN||(kN={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(ON||(ON={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(PN||(PN={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(xN||(xN={})),function(t){t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER=0]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT=1]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED=2]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED=3]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED=4]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED=5]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED=6]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED=7]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED=8]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED=9]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED=10]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE=11]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED=12]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED=13]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED=14]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED=15]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE=16]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE=17]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE=18]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE"}(VN||(VN={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(LN||(LN={}));var UN=function(){function DataStructureConverterImpl(t){this.core=t}var t=DataStructureConverterImpl.prototype;return t.messageConvertToV1=function messageConvertToV1(t){var a,c=deserialize(serialize(t,Hf),Oh(tT)),m=getSessionId(c,this.core.account),h=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:m});return formatMsg$1(c,h?{account:this.core.account,sessionAck:h.ack,msgReceiptTime:h.msgReceiptTime}:{account:this.core.account})},t.messageConvertToV2=function messageConvertToV2(t){var a=deserialize(serialize(generatorMsgForCmd$1(t,t.from,t.fromDeviceId),tT),jf);return(a=completeMessage(this.core,a)).sendingState="sending"===t.status?kN.V2NIM_MESSAGE_SENDING_STATE_SENDING:"sendFailed"===t.status?kN.V2NIM_MESSAGE_SENDING_STATE_FAILED:kN.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,a},DataStructureConverterImpl}(),FN=function(){function V2NIMMessageConverterImpl(t){this.core=t}var t=V2NIMMessageConverterImpl.prototype;return t.messageSerialization=function messageSerialization(t){if(!t)return null;var a=serialize(t,Hf);return Fc(a)},t.messageDeserialization=function messageDeserialization(t){var a,c,m,h,g,I,M,T,S,E,C,b,A,N,R,w,k,O,P,x,V,L,D;if(!t)return null;try{var U,B,q,G,H=deserialize(JSON.parse(t),jf);return H.sendingState=kN.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN,H.conversationType!==Wl.V2NIM_CONVERSATION_TYPE_P2P||H.senderId!==this.core.account&&H.receiverId!==this.core.account?H.conversationType===Wl.V2NIM_CONVERSATION_TYPE_TEAM?H.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(H.receiverId):H.conversationType===Wl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM&&(H.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(H.receiverId)):H.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(H.senderId===this.core.account?H.receiverId:H.senderId),H.threadReply&&(H.threadReply.conversationType=H.conversationType,H.threadReply=completeMessageRefer(this.core,H.threadReply)),H.threadRoot&&(H.threadRoot.conversationType=H.conversationType,H.threadRoot=completeMessageRefer(this.core,H.threadRoot)),includes(U=Ai(Wl)).call(U,H.conversationType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+H.conversationType),H.senderId&&"string"!=typeof H.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+H.senderId),H.receiverId&&"string"!=typeof H.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+H.receiverId),"createTime"in H&&isNaN(H.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+H.createTime),includes(B=Ai(su)).call(B,H.messageType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): "+H.messageType),"subType"in H&&isNaN(H.subType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): "+H.subType),H.messageClientId&&"string"!=typeof H.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+H.messageClientId),H.messageServerId&&"string"!=typeof H.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+H.messageServerId),H.attachment&&"object"!=typeof H.attachment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): "+H.attachment),H.text&&"string"!=typeof H.text&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): "+H.text),H.serverExtension&&"string"!=typeof H.serverExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): "+H.serverExtension),H.callbackExtension&&"string"!=typeof H.callbackExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): "+H.callbackExtension),(null===(a=H.pushConfig)||void 0===a?void 0:a.pushContent)&&"string"!=typeof H.pushConfig.pushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): "+H.pushConfig.pushContent),(null===(c=H.pushConfig)||void 0===c?void 0:c.pushPayload)&&"string"!=typeof H.pushConfig.pushPayload&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): "+H.pushConfig.pushPayload),(null===(m=H.pushConfig)||void 0===m?void 0:m.forcePushContent)&&"string"!=typeof H.pushConfig.forcePushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): "+H.pushConfig.forcePushContent),(null===(h=H.pushConfig)||void 0===h?void 0:h.forcePushAccountIds)&&!jc(H.pushConfig.forcePushAccountIds)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): "+H.pushConfig.forcePushAccountIds),(null===(g=H.routeConfig)||void 0===g?void 0:g.routeEnvironment)&&"string"!=typeof H.routeConfig.routeEnvironment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): "+H.routeConfig.routeEnvironment),(null===(I=H.antispamConfig)||void 0===I?void 0:I.antispamBusinessId)&&"string"!=typeof H.antispamConfig.antispamBusinessId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): "+H.antispamConfig.antispamBusinessId),(null===(M=H.antispamConfig)||void 0===M?void 0:M.antispamCustomMessage)&&"string"!=typeof H.antispamConfig.antispamCustomMessage&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): "+H.antispamConfig.antispamCustomMessage),(null===(T=H.antispamConfig)||void 0===T?void 0:T.antispamCheating)&&"string"!=typeof H.antispamConfig.antispamCheating&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): "+H.antispamConfig.antispamCheating),(null===(S=H.antispamConfig)||void 0===S?void 0:S.antispamExtension)&&"string"!=typeof H.antispamConfig.antispamExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): "+H.antispamConfig.antispamExtension),(null===(E=H.robotConfig)||void 0===E?void 0:E.accountId)&&"string"!=typeof H.robotConfig.accountId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): "+H.robotConfig.accountId),(null===(C=H.robotConfig)||void 0===C?void 0:C.topic)&&"string"!=typeof H.robotConfig.topic&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): "+H.robotConfig.topic),(null===(b=H.robotConfig)||void 0===b?void 0:b.function)&&"string"!=typeof H.robotConfig.function&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): "+H.robotConfig.function),(null===(A=H.robotConfig)||void 0===A?void 0:A.customContent)&&"string"!=typeof H.robotConfig.customContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): "+H.robotConfig.customContent),(null===(N=H.threadRoot)||void 0===N?void 0:N.senderId)&&"string"!=typeof H.threadRoot.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+H.threadRoot.senderId),(null===(R=H.threadRoot)||void 0===R?void 0:R.receiverId)&&"string"!=typeof H.threadRoot.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+H.threadRoot.receiverId),(null===(w=H.threadRoot)||void 0===w?void 0:w.messageClientId)&&"string"!=typeof H.threadRoot.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+H.threadRoot.messageClientId),(null===(k=H.threadRoot)||void 0===k?void 0:k.messageServerId)&&"string"!=typeof H.threadRoot.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+H.threadRoot.messageServerId),H.threadRoot&&"createTime"in H.threadRoot&&isNaN(H.threadRoot.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+H.threadRoot.createTime),H.threadRoot&&!includes(q=Ai(Wl)).call(q,H.threadRoot.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+H.threadRoot.conversationType),(null===(O=H.threadRoot)||void 0===O?void 0:O.conversationId)&&"string"!=typeof H.threadRoot.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+H.threadRoot.conversationId),(null===(P=H.threadReply)||void 0===P?void 0:P.senderId)&&"string"!=typeof H.threadReply.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+H.threadReply.senderId),(null===(x=H.threadReply)||void 0===x?void 0:x.receiverId)&&"string"!=typeof H.threadReply.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+H.threadReply.receiverId),(null===(V=H.threadReply)||void 0===V?void 0:V.messageClientId)&&"string"!=typeof H.threadReply.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+H.threadReply.messageClientId),(null===(L=H.threadReply)||void 0===L?void 0:L.messageServerId)&&"string"!=typeof H.threadReply.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+H.threadReply.messageServerId),H.threadReply&&"createTime"in H.threadReply&&isNaN(H.threadReply.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+H.threadReply.createTime),H.threadReply&&!includes(G=Ai(Wl)).call(G,H.threadReply.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+H.threadReply.conversationType),(null===(D=H.threadReply)||void 0===D?void 0:D.conversationId)&&"string"!=typeof H.threadReply.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+H.threadReply.conversationId),delete H.__clientExt,delete H.userUpdateTime,H}catch(a){return this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid message string: "+t),null}},V2NIMMessageConverterImpl}(),BN={attachment:{type:"object",rules:{url:{type:"string",allowEmpty:!1}}},thumbSize:{type:"object",rules:{width:{type:"number",required:!1,min:0},height:{type:"number",required:!1,min:0}}}},qN=function(t){function V2NIMStorageUtil(a){var c;return(c=t.call(this,"V2NIMStorageUtil",a)||this).core=a,c}kt(V2NIMStorageUtil,t);var a=V2NIMStorageUtil.prototype;return a.imageThumbUrl=function imageThumbUrl(t,a){return t+"?imageView&thumbnail="+a+"z"+a},a.videoCoverUrl=function videoCoverUrl(t,a){return t+"?vframe&offset="+a},a.getImageThumbUrl=function getImageThumbUrl(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee(){var c,m;return Dc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(BN,{attachment:c=t,thumbSize:a},"",!0),a.width=a.width||0,a.height=a.height||0,0===a.width&&0===a.height&&(a.width=150),m=c.url,h.prev=7,h.next=10,this.core.V2NIMStorageService.shortUrlToLong(c.url);case 10:m=h.sent,h.next=16;break;case 13:h.prev=13,h.t0=h.catch(7),this.core.logger.warn("shortUrlToLong error:",h.t0);case 16:return h.abrupt("return",{url:this.core.cloudStorage.getThumbUrl(m,a)});case 17:case"end":return h.stop()}}),_callee,this,[[7,13]])})))},a.getVideoCoverUrl=function getVideoCoverUrl(t,a){return __awaiter(this,void 0,void 0,Dc.mark((function _callee2(){var c,m;return Dc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(BN,{attachment:c=t,thumbSize:a},"",!0),a.width=a.width||0,a.height=a.height||0,0===a.width&&0===a.height&&(a.width=150),m=c.url,h.prev=7,h.next=10,this.core.V2NIMStorageService.shortUrlToLong(c.url);case 10:m=h.sent,h.next=16;break;case 13:h.prev=13,h.t0=h.catch(7),this.core.logger.warn("shortUrlToLong error:",h.t0);case 16:return h.abrupt("return",{url:this.core.cloudStorage.getVideoCoverUrl(m,a)});case 17:case"end":return h.stop()}}),_callee2,this,[[7,13]])})))},V2NIMStorageUtil}(gh),GN=function(){function V2NIMMessageAttachmentCreatorImpl(){this.name="V2NIMMessageAttachmentCreator"}var t=V2NIMMessageAttachmentCreatorImpl.prototype;return t.createLocationMessageAttachment=function createLocationMessageAttachment(t,a,c){return{latitude:"number"==typeof t?t:0,longitude:"number"==typeof a?a:0,address:"string"==typeof c?c:""}},t.createCustomMessageAttachment=function createCustomMessageAttachment(t){return{raw:"string"==typeof t?t:""}},V2NIMMessageAttachmentCreatorImpl}();!function setAdapters(t){fp(Cp,t())}((function getAdapter(){return{setLogger:function setLogger(t){If=t},platform:"BROWSER",localStorage:window.localStorage,request:_f,WebSocket:window.WebSocket,uploadFile:uploadFile,getFileUploadInformation:getFileUploadInformation,getSystemInfo:getSystemInfo,net:{getNetworkStatus:function getNetworkStatus(){return Mi.resolve({net_type:Mp.kStatNetTypeUnkonw,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function onNetworkStatusChange(t){Mf=function onlineListener(){t({isConnected:!0,networkType:Mp.kStatNetTypeUnkonw})},Tf=function offlineListener(){t({isConnected:!1,networkType:Mp.kStatNetTypeUnkonw})},window.addEventListener("online",Mf),window.addEventListener("offline",Tf)},offNetworkStatusChange:function offNetworkStatusChange(){Mf&&window.removeEventListener("online",Mf),Tf&&window.removeEventListener("offline",Tf),Mf=null,Tf=null}}}})),Jv.registerService(fh,"V1NIMLoginService"),Jv.registerService(sT,"msg"),Jv.registerService(pT,"misc"),Jv.registerService(MT,"user"),Jv.registerService($T,"session"),Jv.registerService(TS,"team"),Jv.registerService(AS,"systemMessage"),Jv.registerService(PS,"friend"),Jv.registerService(US,"event"),Jv.registerService(jS,"msgExtend"),Jv.registerService(eE,"msgLog"),Jv.registerService(iE,"passThrough"),Jv.registerService(SE,"cloudStorage"),Jv.registerService(HE,"superTeam"),Jv.registerService(Av,"sync"),Jv.registerService($E,"plugin"),Jv.registerService(tC,"cloudSession"),Jv.registerService(gC,"signaling"),Jv.registerService(Sv,"V2NIMLoginService"),Jv.registerService(cy,"V2NIMConversationService"),Jv.registerService(s_,"V2NIMMessageService"),Jv.registerService(Wb,"V2NIMNotificationService"),Jv.registerService(zb,"V2NIMStorageService"),Jv.registerService(qN,"V2NIMStorageUtil"),Jv.registerService(hy,"V2NIMConversationGroupService"),Jv.registerService(aI,"V2NIMTeamService"),Jv.registerService(_I,"V2NIMUserService"),Jv.registerService(OI,"V2NIMFriendService"),Jv.registerService(fM,"V2NIMSettingService"),Jv.registerService(Jb,"V2NIMSyncService"),Jv.registerService(rN,"V2NIMAIService"),Jv.registerService(UN,"DataStructureConverter"),Jv.registerService(FN,"V2NIMMessageConverter"),Jv.registerService(M_,"V2NIMMessageLogUtil"),Jv.registerService(O_,"V2NIMMessageExtendUtil"),Jv.registerService(_N,"V2NIMSignallingService"),Jv.registerService(NN,"V2NIMSubscriptionService"),Jv.registerService(GN,"V2NIMMessageAttachmentCreator"),Jv.registerService(tb,"qchatChannel"),Jv.registerService(cb,"qchatMedia"),Jv.registerService(Vb,"qchatMsg"),Jv.registerService(Db,"qchatRole"),Jv.registerService(Bb,"qchatServer"),Jv.registerPlugin(DN,"browser-md5-file"),Jv.registerPrivateService((function EventForwardCenter(t){var a=this;this.bindEvents=function(){a.core.eventBus.on("forwardSend/msg/sendMsg",a.onV1SendMsg),a.core.eventBus.on("forwardSend/msg/recallMsg",a.onV1RecallMsg),a.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",a.onV1DeleteSelfMsgs),a.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",a.onV1ClearHistoryMessage),a.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",a.onV2SendMsg),a.core.eventBus.on("forwardSend/V2NIMMessageService/modifyMsg",a.onV2ModifyMsg),a.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",a.onV2RevokeMessage),a.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",a.onV2DeleteSelfMsgs),a.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",a.onV2ClearHistoryMessage),a.core.eventBus.on("forwardSend/team/created",a.onV1TeamCreated),a.core.eventBus.on("forwardSend/team/updateMyMemberInfo",a.onV1TeamMemberUpdate),a.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",a.onV1SuperTeamMemberUpdate),a.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",a.onV2TeamMemberUpdate),a.core.eventBus.on("forwardSend/team/passTeamApply",(function(t,c){return a.onV1TeamApply(t,Mu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",(function(t,c){a.onV1TeamApply(t,Mu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/team/rejectTeamApply",(function(t,c){a.onV1TeamApply(t,Mu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",(function(t,c){a.onV1TeamApply(t,Mu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/team/acceptTeamInvite",(function(t,c){a.onV1TeamInvite(t,Mu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",(function(t,c){a.onV1TeamInvite(t,Mu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/team/rejectTeamInvite",(function(t,c){a.onV1TeamInvite(t,Mu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",(function(t,c){a.onV1TeamInvite(t,Mu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/user/updateBlackList",a.onV1UpdateBlackList),a.core.eventBus.on("forwardSend/user/updateUserInfo",a.onV1UpdateUserInfo),a.core.eventBus.on("forwardSend/user/setMute",a.onV1SetMute),a.core.eventBus.on("forwardSend/friend/addFriend",a.onV1AddFriend),a.core.eventBus.on("forwardSend/friend/deleteFriend",a.onV1DeleteFriend),a.core.eventBus.on("forwardSend/friend/updateFriend",a.onV1UpdateFriend),a.core.eventBus.on("forwardSend/friend/passFriendApply",a.onV1PassFriendApply),a.core.eventBus.on("forwardSend/friend/rejectFriendApply",a.onV1RejectFriendApply)},this.onV1TeamApply=function(t,c,m,h){if(h){if(!a.core.V2NIMTeamService.notification.checkIfExpired(h))return;m=ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED}a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:t.teamId,teamType:c,operatorAccountId:t.from,actionType:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION},m)},this.onV1TeamInvite=function(t,c,m,h){if(h){if(!a.core.V2NIMTeamService.notification.checkIfExpired(h.code))return;m=ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED}a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:t.teamId,teamType:c,operatorAccountId:t.from,actionType:wu.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION},m)},this.onV1PassFriendApply=function(t,c){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",t,c)},this.onV1RejectFriendApply=function(t,c,m){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:t,recipientAccountId:a.core.account,operatorAccountId:a.core.account,postscript:c||"",timestamp:a.core.timeOrigin.getNTPTime(),read:!0,status:Jl.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED},m)},this.onV1SetMute=function(t,c){a.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",t,c?_u.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:_u.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF)},this.onV1UpdateFriend=function(t){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",t.account,qt(qt({},"alias"in t?{alias:t.alias}:{}),"ext"in t?{serverExtension:t.ext}:{}))},this.onV1AddFriend=function(t){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",t)},this.onV1DeleteFriend=function(t){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",t)},this.onV1UpdateUserInfo=function(t){var c=deserialize(serialize(t,FM.user),invertSerializeItem(sI));a.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",c)},this.onV1UpdateBlackList=function(t,c){a.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",t,c)},this.onV1TeamCreated=function(t){var c=deserialize(serialize(generateTeam(t),VM.team),invertSerializeItem(Df));a.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",c)},this.onV1TeamMemberUpdate=function(t){(t=qt({},t)).type&&(t.type={normal:0,owner:1,manager:2}[t.type]);var c=deserialize(serialize(t,VM.teamMember),invertSerializeItem(Uf));c.teamType=Mu.V2NIM_TEAM_TYPE_ADVANCED,a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",c)},this.onV1SuperTeamMemberUpdate=function(t){(t=qt({},t)).type&&(t.type={normal:0,owner:1,manager:2}[t.type]);var c=deserialize(serialize(t,BE.superTeamMember),invertSerializeItem(Ff));c.teamType=Mu.V2NIM_TEAM_TYPE_SUPER,a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",c)},this.onV2TeamMemberUpdate=function(t){var c=t.teamType,m=serialize(t,Uf);if(c===Mu.V2NIM_TEAM_TYPE_SUPER){var h=deserialize(m,invertSerializeItem(BE.superTeamMember));a.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",h)}else{var g=deserialize(m,invertSerializeItem(VM.teamMember));a.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",g)}},this.onV1SendMsg=function(t){var c=deserialize(serialize(t,tT),jf);(c=completeMessage(a.core,c)).sendingState="sending"===t.status?uu.V2NIM_MESSAGE_SENDING_STATE_SENDING:"sent"===t.status?uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED:uu.V2NIM_MESSAGE_SENDING_STATE_FAILED,a.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",c)},this.onV2SendMsg=function(t){var c=deserialize(serialize(t,Hf),Oh(tT));c.status=t.sendingState===uu.V2NIM_MESSAGE_SENDING_STATE_SENDING?"sending":t.sendingState===uu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED?"sent":"sendFailed",a.core.eventBus.emit("forwardReceive/msg/sendMsg",c)},this.onV2ModifyMsg=function(t){var c=deserialize(serialize(t,Hf),Oh(tT));a.core.eventBus.emit("forwardReceive/msg/modifyMsg",c)},this.onV1RecallMsg=function(t){t.deleteMsgCreatetime=t.time;var c=deserialize(serialize(t,rT.recallMsgTag),invertSerializeItem(Wf));a.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[c])},this.onV2RevokeMessage=function(t){var c=deserialize(serialize(t,Wf),nT.recallMsgTag);a.core.eventBus.emit("forwardReceive/msg/recallMsg",c)},this.onV1DeleteSelfMsgs=function(t){var c=map$6(t).call(t,(function(t){return deserialize(serialize(t,rT.deleteSelfMsgTag),invertSerializeItem(Yf))}));forEach$1(c).call(c,(function(t){t.messageRefer=formatMessageRefer(a.core,t.messageRefer)})),a.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",c)},this.onV2DeleteSelfMsgs=function(t){var c=map$6(t).call(t,(function(t){return deserialize(serialize(t,Yf),nT.deleteSelfMsgTag)}));a.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",c)},this.onV1ClearHistoryMessage=function(t){var c=deserialize(serialize(t,WS.clearHistoryMsgsFromServerReqTag),invertSerializeItem(y_));a.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",c)},this.onV2ClearHistoryMessage=function(t){var c=deserialize(serialize(t,y_),zS.clearHistoryMsgsFromServerReqTag);a.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",c)},this.core=t,this.bindEvents()}),"eventForwardCenter"),t.V2NIMConst=ju,t.default=Jv,Object.defineProperty(t,"__esModule",{value:!0})}));
