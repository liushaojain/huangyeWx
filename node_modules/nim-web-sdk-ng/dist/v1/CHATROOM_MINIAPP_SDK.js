/**
 * 
 *   Version: 10.4.0
 * 
 *   Git Hash: 18a110e8a09523bcccd386391747f378b0b20912
 * 
 *   Created At: 2024/8/21 19:52:27
 * 
 *   Target: CHATROOM_MINIAPP_SDK.js
 *   
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Chatroom=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var t,r,o,i,n,s,a,c,l,_,d,u,E,h,m,p,g,T,f,I,N,M,O,y,S,v,A,R,C,b,P,D,k,V,L,w,U,x,F,G,j,Y,B,H,$,K,q,W,z=createCommonjsModule((function(e){var t=Object.prototype.hasOwnProperty,r="~";function Events(){}function EE(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function addListener(e,t,o,i,n){if("function"!=typeof o)throw new TypeError("The listener must be a function");var s=new EE(o,i||e,n),a=r?r+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(r=!1)),EventEmitter.prototype.eventNames=function eventNames(){var e,o,i=[];if(0===this._eventsCount)return i;for(o in e=this._events)t.call(e,o)&&i.push(r?o.slice(1):o);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},EventEmitter.prototype.listeners=function listeners(e){var t=r?r+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var i=0,n=o.length,s=new Array(n);i<n;i++)s[i]=o[i].fn;return s},EventEmitter.prototype.listenerCount=function listenerCount(e){var t=r?r+e:e,o=this._events[t];return o?o.fn?1:o.length:0},EventEmitter.prototype.emit=function emit(e,t,o,i,n,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,_=this._events[a],d=arguments.length;if(_.fn){switch(_.once&&this.removeListener(e,_.fn,void 0,!0),d){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,t),!0;case 3:return _.fn.call(_.context,t,o),!0;case 4:return _.fn.call(_.context,t,o,i),!0;case 5:return _.fn.call(_.context,t,o,i,n),!0;case 6:return _.fn.call(_.context,t,o,i,n,s),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];_.fn.apply(_.context,c)}else{var u,E=_.length;for(l=0;l<E;l++)switch(_[l].once&&this.removeListener(e,_[l].fn,void 0,!0),d){case 1:_[l].fn.call(_[l].context);break;case 2:_[l].fn.call(_[l].context,t);break;case 3:_[l].fn.call(_[l].context,t,o);break;case 4:_[l].fn.call(_[l].context,t,o,i);break;default:if(!c)for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];_[l].fn.apply(_[l].context,c)}}return!0},EventEmitter.prototype.on=function on(e,t,r){return addListener(this,e,t,r,!1)},EventEmitter.prototype.once=function once(e,t,r){return addListener(this,e,t,r,!0)},EventEmitter.prototype.removeListener=function removeListener(e,t,o,i){var n=r?r+e:e;if(!this._events[n])return this;if(!t)return clearEvent(this,n),this;var s=this._events[n];if(s.fn)s.fn!==t||i&&!s.once||o&&s.context!==o||clearEvent(this,n);else{for(var a=0,c=[],l=s.length;a<l;a++)(s[a].fn!==t||i&&!s[a].once||o&&s[a].context!==o)&&c.push(s[a]);c.length?this._events[n]=1===c.length?c[0]:c:clearEvent(this,n)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(e){var t;return e?(t=r?r+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=r,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter})),J=createCommonjsModule((function(e,t){e.exports=function(){function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var e={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:6e5},t=function emptyFn(){},r=function(){function Reporter(t){_classCallCheck(this,Reporter),this.isUploadEnable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=e,this.traceMsgCache={},this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(t),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(e){var t=Object.assign({},this.reportConfig.common,e.common);this.reportConfig=Object.assign({},this.reportConfig,e),this.reportConfig.common=t,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function reportImmediately(e,t){var r=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(e,Object.assign({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},t)).catch((function(e){var t,o;null===(o=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===o||o.warn("Reporter immediately upload failed",e)}))}},{key:"report",value:function report(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o.priority||(o.priority=this.getEventPriority(t,r)),this.reportConfig.isDataReportEnable&&t){if("login"===t&&!1===r.succeed&&r.process_id){var i=this.lastFailLogin[r.process_id]||0;if(r.start_time-i<e.loginFailIgnoreInterval)return;this.lastFailLogin[r.process_id]=r.start_time}var n=Date.now();"HIGH"===o.priority?this.highPriorityMsgList.push({module:t,msg:r,createTime:n}):"NORMAL"===o.priority?this.msgList.push({module:t,msg:r,createTime:n}):"LOW"===o.priority&&this.lowPriorityMsgList.push({module:t,msg:r,createTime:n}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(e,t){if(this.reportConfig.isDataReportEnable&&e&&!this.traceMsgCache[e]){var r=Object.assign(Object.assign({start_time:Date.now()},t),{extension:[]});this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(e){}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(e,t,r){var o,i=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e]){var n=this.traceMsgCache[e].extension,s=n.length,a=(new Date).getTime();0===s?t.duration=a-this.traceMsgCache[e].start_time:n[s-1].end_time?t.duration=a-n[s-1].end_time:t.duration=a-this.traceMsgCache[e].start_time,n.push(Object.assign({end_time:a},t));var c=n.length-1;(null==r?void 0:r.asyncParams)&&((o=this.traceMsgCache[e]).asyncPromiseArray||(o.asyncPromiseArray=[]),this.traceMsgCache[e].asyncPromiseArray.push(r.asyncParams.then((function(t){i.traceMsgCache[e]&&i.traceMsgCache[e].extension[c]&&Object.assign(i.traceMsgCache[e].extension[c],t)}))))}}},{key:"reportTraceEnd",value:function reportTraceEnd(e){var t,r=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e])if("nos"!==e||!1===o){"boolean"==typeof o?this.traceMsgCache[e].succeed=!!o:this.traceMsgCache[e].state=o,this.traceMsgCache[e].duration=Date.now()-this.traceMsgCache[e].start_time,this.traceMsgCache[e].extension.forEach((function(e){delete e.end_time}));var i=this.traceMsgCache[e];if(this.traceMsgCache[e]=null,i.asyncPromiseArray){(t=this.endedAsyncMsgByModule)[e]||(t[e]=[]),this.endedAsyncMsgByModule[e].push(i);var n=function asyncCallback(){r.endedAsyncMsgByModule[e]&&r.endedAsyncMsgByModule[e].includes(i)&&(delete i.asyncPromiseArray,r.report(e,i,{priority:r.getEventPriority(e,i)}))};Promise.all(i.asyncPromiseArray).then(n).catch(n)}else this.report(e,i,{priority:this.getEventPriority(e,i)})}else this.traceMsgCache[e]=null}},{key:"getEventPriority",value:function getEventPriority(e,t){if("exceptions"===e){if(0===t.action)return"HIGH";if(2===t.action)return"HIGH";if(1===t.action&&0!==t.exception_service)return"HIGH"}else{if("msgReceive"===e)return"LOW";if("nim_api_trace"===e)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function reportTraceCancel(e){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[e]=[],this.traceMsgCache[e]=null)}},{key:"pause",value:function pause(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function restore(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function destroy(){var e=this;this.reportConfig.isDataReportEnable&&(Object.keys(this.traceMsgCache).forEach((function(t){e.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=t,this.report=t,this.reportTraceStart=t,this.reportTraceUpdate=t,this.reportTraceEnd=t,this.pause=t,this.restore=t,this.destroy=t,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function initUploadConfig(){var e,t,r=this;if(!this.loading){this.loading=!0;var o=this.reportConfig.common||{};try{this.reportConfig.request(this.reportConfig.reportConfigUrl,{method:"GET",dataType:"json",params:{deviceId:o.dev_id,sdkVer:o.sdk_ver,platform:o.platform,appkey:o.app_key},timeout:this.reportConfig.timeout}).then((function(e){var t,o;if(!r.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){var i=e.data.data||{};r.reportConfig.maxSize=i.maxSize>1e3?1e3:i.maxSize,r.reportConfig.maxInterval=i.maxInterval>1e4?1e4:i.maxInterval,r.reportConfig.maxInterval=i.maxInterval<10?10:i.maxInterval,r.reportConfig.minInterval=i.minInterval<2?2:i.minInterval,r.reportConfig.maxDelay=i.maxDelay||300,r.reportConfig.maxInterval=1e3*r.reportConfig.maxInterval,r.reportConfig.minInterval=1e3*r.reportConfig.minInterval,r.reportConfig.maxDelay=1e3*r.reportConfig.maxDelay,r.isUploadEnable=!0,r.initConfigLoaded=!0,r.loading=!1,r.reportHeartBeat()}null===(o=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===o||o.log("Get reporter upload config success")}})).catch((function(e){var t,o;r.loading=!1,null===(o=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===o||o.error("Get reporter upload config failed",e)}))}catch(r){this.loading=!1,null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.error("Exec reporter request failed",r)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var e=this;this.isDestroyed||(this.timer=setTimeout((function(){e.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var e=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Date.now()-this.lastReportTime>=e&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var e=this,t={},r=Date.now();this.highPriorityMsgList=this.highPriorityMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.msgList=this.msgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.lowPriorityMsgList=this.lowPriorityMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.cacheMsgList=this.cacheMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay}));var o=this.highPriorityMsgList.slice(0,this.reportConfig.maxSize);if(this.highPriorityMsgList=this.highPriorityMsgList.slice(o.length),o.length<this.reportConfig.maxSize){var i=this.reportConfig.maxSize-o.length;o=o.concat(this.msgList.slice(0,i)),this.msgList=this.msgList.slice(i)}if(o.length<this.reportConfig.maxSize){var n=this.reportConfig.maxSize-o.length;o=o.concat(this.lowPriorityMsgList.slice(0,n)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(n)}if(o.length<this.reportConfig.maxSize){var s=this.reportConfig.maxSize-o.length;o=o.concat(this.cacheMsgList.slice(0,s)),this.cacheMsgList=this.cacheMsgList.slice(s)}return o.forEach((function(e){t[e.module]?t[e.module].push(e.msg):t[e.module]=[e.msg]})),{uploadMsgArr:o,uploadMsg:t}}},{key:"upload",value:function upload(){var e,t,r=this;if(this.isUploadEnable&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var o=this.getUploadMsg(),i=o.uploadMsgArr,n=o.uploadMsg;if(i.length){this.lastReportTime=Date.now();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:n},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,o;r.cacheMsgList=r.cacheMsgList.concat(i).slice(0,r.reportConfig.cacheMaxSize),null===(o=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===o||o.warn("Reporter upload failed",e)}))}catch(r){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",r)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return r}()}));!function(e){e[e.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",e[e.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(t||(t={})),function(e){e[e.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",e[e.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",e[e.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(r||(r={})),function(e){e[e.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",e[e.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",e[e.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(o||(o={})),function(e){e[e.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",e[e.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",e[e.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",e[e.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(i||(i={})),function(e){e[e.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",e[e.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",e[e.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(n||(n={})),function(e){e[e.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",e[e.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(s||(s={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(a||(a={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(c||(c={})),function(e){e[e.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",e[e.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(l||(l={})),function(e){e[e.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",e[e.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",e[e.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",e[e.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(_||(_={})),function(e){e[e.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",e[e.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",e[e.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(d||(d={})),function(e){e[e.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",e[e.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",e[e.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",e[e.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(u||(u={})),function(e){e[e.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",e[e.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",e[e.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",e[e.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",e[e.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",e[e.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",e[e.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",e[e.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",e[e.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(E||(E={})),function(e){e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",e[e.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(h||(h={})),function(e){e[e.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(m||(m={})),function(e){e[e.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",e[e.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(p||(p={})),function(e){e[e.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",e[e.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",e[e.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(g||(g={})),function(e){e[e.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",e[e.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",e[e.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",e[e.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",e[e.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",e[e.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",e[e.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",e[e.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",e[e.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",e[e.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",e[e.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",e[e.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",e[e.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(T||(T={})),function(e){e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(f||(f={})),function(e){e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(I||(I={})),function(e){e[e.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",e[e.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",e[e.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(N||(N={})),function(e){e[e.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",e[e.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(M||(M={})),function(e){e[e.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(O||(O={})),function(e){e[e.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(y||(y={})),function(e){e[e.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",e[e.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(S||(S={})),function(e){e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(v||(v={})),function(e){e[e.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",e[e.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(A||(A={})),function(e){e[e.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",e[e.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",e[e.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",e[e.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",e[e.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",e[e.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",e[e.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",e[e.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(R||(R={})),function(e){e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(C||(C={})),function(e){e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(b||(b={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(P||(P={})),function(e){e[e.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",e[e.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",e[e.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(D||(D={})),function(e){e[e.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",e[e.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",e[e.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(k||(k={})),function(e){e[e.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",e[e.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(V||(V={})),function(e){e[e.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",e[e.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(L||(L={})),function(e){e[e.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(w||(w={})),function(e){e[e.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(U||(U={})),function(e){e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(x||(x={})),function(e){e[e.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL=0]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL",e[e.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER=1]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER",e[e.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE=2]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE"}(F||(F={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",e[e.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(G||(G={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(j||(j={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(Y||(Y={})),function(e){e[e.teamApply=0]="teamApply",e[e.teamApplyReject=1]="teamApplyReject",e[e.teamInvite=2]="teamInvite",e[e.teamInviteReject=3]="teamInviteReject",e[e.tlistUpdate=4]="tlistUpdate",e[e.superTeamApply=15]="superTeamApply",e[e.superTeamApplyReject=16]="superTeamApplyReject",e[e.superTeamInvite=17]="superTeamInvite",e[e.superTeamInviteReject=18]="superTeamInviteReject"}(B||(B={})),function(e){e[e.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",e[e.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",e[e.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",e[e.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(H||(H={})),function(e){e.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",e.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",e.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}($||($={})),function(e){e[e.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(K||(K={})),function(e){e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(q||(q={})),function(e){e[e.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",e[e.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",e[e.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",e[e.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(W||(W={}));var Q={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},X=Object.keys(Q),Z=X.reduce((function(e,t){var r=Q[t];return e[t]=r.code,e}),{}),ee=X.reduce((function(e,t){var r=Q[t];return e[r.code]=r.message,e}),{});class V2NIMErrorImpl extends Error{constructor(e){super(e.desc),this.name="V2NIMError",this.code=e.code||0,this.desc=e.desc||ee[this.code]||te[this.code]||"",this.message=this.desc,this.detail=e.detail||{}}toString(){var e,t=`${this.name}\n code: ${this.code}\n message: "${this.message}"\n detail: ${this.detail?JSON.stringify(this.detail):""}`;return(null===(e=null==this?void 0:this.detail)||void 0===e?void 0:e.rawError)&&(t+=`\n rawError: ${this.detail.rawError.message}`),t}}class ValidateError extends V2NIMErrorImpl{constructor(e,t={},r){super({code:Z.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:e,rules:r,data:t}}),this.name="validateError",this.message=this.message+"\n"+JSON.stringify(this.detail,null,2),this.data=t,this.rules=r}}class ValidateErrorV2 extends V2NIMErrorImpl{constructor(e){var t,r,o;super({code:Z.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(t=e.detail)||void 0===t?void 0:t.reason,rules:null===(r=e.detail)||void 0===r?void 0:r.rules,data:null===(o=e.detail)||void 0===o?void 0:o.data}}),this.name="ValidateErrorV2"}}class UploadError extends V2NIMErrorImpl{constructor(e){super(Object.assign({code:400},e)),this.desc=this.desc||"upload file error",this.message=this.desc,this.name="uploadError"}}var te={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},re="object"==typeof e&&e&&e.Object===Object&&e,oe="object"==typeof self&&self&&self.Object===Object&&self,ie=re||oe||Function("return this")(),ne=ie.Symbol,se=Object.prototype,ae=se.hasOwnProperty,ce=se.toString,le=ne?ne.toStringTag:void 0;var _e=function getRawTag(e){var t=ae.call(e,le),r=e[le];try{e[le]=void 0;var o=!0}catch(e){}var i=ce.call(e);return o&&(t?e[le]=r:delete e[le]),i},de=Object.prototype.toString;var ue=function objectToString(e){return de.call(e)},Ee=ne?ne.toStringTag:void 0;var he=function baseGetTag(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ee&&Ee in Object(e)?_e(e):ue(e)};var me=function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var pe,ge=function isFunction(e){if(!me(e))return!1;var t=he(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Te=ie["__core-js_shared__"],fe=(pe=/[^.]+$/.exec(Te&&Te.keys&&Te.keys.IE_PROTO||""))?"Symbol(src)_1."+pe:"";var Ie=function isMasked(e){return!!fe&&fe in e},Ne=Function.prototype.toString;var Me=function toSource(e){if(null!=e){try{return Ne.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Oe=/^\[object .+?Constructor\]$/,ye=Function.prototype,Se=Object.prototype,ve=ye.toString,Ae=Se.hasOwnProperty,Re=RegExp("^"+ve.call(Ae).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ce=function baseIsNative(e){return!(!me(e)||Ie(e))&&(ge(e)?Re:Oe).test(Me(e))};var be=function getValue(e,t){return null==e?void 0:e[t]};var Pe=function getNative(e,t){var r=be(e,t);return Ce(r)?r:void 0},De=function(){try{var e=Pe(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var ke=function baseAssignValue(e,t,r){"__proto__"==t&&De?De(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var Ve=function eq(e,t){return e===t||e!=e&&t!=t},Le=Object.prototype.hasOwnProperty;var we=function assignValue(e,t,r){var o=e[t];Le.call(e,t)&&Ve(o,r)&&(void 0!==r||t in e)||ke(e,t,r)};var Ue=function copyObject(e,t,r,o){var i=!r;r||(r={});for(var n=-1,s=t.length;++n<s;){var a=t[n],c=o?o(r[a],e[a],a,r,e):void 0;void 0===c&&(c=e[a]),i?ke(r,a,c):we(r,a,c)}return r};var xe=function identity(e){return e};var Fe=function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},Ge=Math.max;var je=function overRest(e,t,r){return t=Ge(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,n=Ge(o.length-t,0),s=Array(n);++i<n;)s[i]=o[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=o[i];return a[t]=r(s),Fe(e,this,a)}};var Ye=function constant(e){return function(){return e}},Be=De?function(e,t){return De(e,"toString",{configurable:!0,enumerable:!1,value:Ye(t),writable:!0})}:xe,He=Date.now;var $e=function shortOut(e){var t=0,r=0;return function(){var o=He(),i=16-(o-r);if(r=o,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}},Ke=$e(Be);var qe=function baseRest(e,t){return Ke(je(e,t,xe),e+"")};var We=function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var ze=function isArrayLike(e){return null!=e&&We(e.length)&&!ge(e)},Je=/^(?:0|[1-9]\d*)$/;var Qe=function isIndex(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Je.test(e))&&e>-1&&e%1==0&&e<t};var Xe=function isIterateeCall(e,t,r){if(!me(r))return!1;var o=typeof t;return!!("number"==o?ze(r)&&Qe(t,r.length):"string"==o&&t in r)&&Ve(r[t],e)};var Ze=function createAssigner(e){return qe((function(t,r){var o=-1,i=r.length,n=i>1?r[i-1]:void 0,s=i>2?r[2]:void 0;for(n=e.length>3&&"function"==typeof n?(i--,n):void 0,s&&Xe(r[0],r[1],s)&&(n=i<3?void 0:n,i=1),t=Object(t);++o<i;){var a=r[o];a&&e(t,a,o,n)}return t}))};var et=function baseTimes(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o};var rt=function isObjectLike(e){return null!=e&&"object"==typeof e};var ot=function baseIsArguments(e){return rt(e)&&"[object Arguments]"==he(e)},it=Object.prototype,nt=it.hasOwnProperty,st=it.propertyIsEnumerable,at=ot(function(){return arguments}())?ot:function(e){return rt(e)&&nt.call(e,"callee")&&!st.call(e,"callee")},ct=at,lt=Array.isArray;var _t=function stubFalse(){return!1},dt=createCommonjsModule((function(e,t){var r=t&&!t.nodeType&&t,o=r&&e&&!e.nodeType&&e,i=o&&o.exports===r?ie.Buffer:void 0,n=(i?i.isBuffer:void 0)||_t;e.exports=n})),ut={};ut["[object Float32Array]"]=ut["[object Float64Array]"]=ut["[object Int8Array]"]=ut["[object Int16Array]"]=ut["[object Int32Array]"]=ut["[object Uint8Array]"]=ut["[object Uint8ClampedArray]"]=ut["[object Uint16Array]"]=ut["[object Uint32Array]"]=!0,ut["[object Arguments]"]=ut["[object Array]"]=ut["[object ArrayBuffer]"]=ut["[object Boolean]"]=ut["[object DataView]"]=ut["[object Date]"]=ut["[object Error]"]=ut["[object Function]"]=ut["[object Map]"]=ut["[object Number]"]=ut["[object Object]"]=ut["[object RegExp]"]=ut["[object Set]"]=ut["[object String]"]=ut["[object WeakMap]"]=!1;var Et=function baseIsTypedArray(e){return rt(e)&&We(e.length)&&!!ut[he(e)]};var ht=function baseUnary(e){return function(t){return e(t)}},mt=createCommonjsModule((function(e,t){var r=t&&!t.nodeType&&t,o=r&&e&&!e.nodeType&&e,i=o&&o.exports===r&&re.process,n=function(){try{var e=o&&o.require&&o.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=n})),pt=mt&&mt.isTypedArray,gt=pt?ht(pt):Et,Tt=Object.prototype.hasOwnProperty;var ft=function arrayLikeKeys(e,t){var r=lt(e),o=!r&&ct(e),i=!r&&!o&&dt(e),n=!r&&!o&&!i&&gt(e),s=r||o||i||n,a=s?et(e.length,String):[],c=a.length;for(var l in e)!t&&!Tt.call(e,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||n&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Qe(l,c))||a.push(l);return a},It=Object.prototype;var Nt=function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||It)};var Mt=function overArg(e,t){return function(r){return e(t(r))}},Ot=Mt(Object.keys,Object),yt=Object.prototype.hasOwnProperty;var St=function baseKeys(e){if(!Nt(e))return Ot(e);var t=[];for(var r in Object(e))yt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var vt=function keys(e){return ze(e)?ft(e):St(e)},At=Ze((function(e,t,r,o){Ue(t,vt(t),e,o)}));var Rt,Ct=function isUndefined(e){return void 0===e},bt=(Rt=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Rt()+Rt()+Rt()+Rt()+Rt()+Rt()+Rt()+Rt()});function getEnumKeys(e){return Object.keys(e).filter((e=>!(+e>=0)))}function getEnumKeyByEnumValue(e,t){var r=Object.keys(e).filter((r=>e[r]==t));return r.length>0?r[0]:void 0}function assignOptions(e,t){return At({},e,t,(function(e,t){return Ct(t)?e:t}))}function emptyFuncWithPromise(){return Promise.resolve()}function __rest(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]])}return r}function __awaiter(e,t,r,o){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o.throw(e))}catch(e){n(e)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}var Pt=function isSymbol(e){return"symbol"==typeof e||rt(e)&&"[object Symbol]"==he(e)},Dt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kt=/^\w*$/;var Vt=function isKey(e,t){if(lt(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Pt(e))||(kt.test(e)||!Dt.test(e)||null!=t&&e in Object(t))},Lt=Pe(Object,"create");var wt=function hashClear(){this.__data__=Lt?Lt(null):{},this.size=0};var Ut=function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},xt=Object.prototype.hasOwnProperty;var Ft=function hashGet(e){var t=this.__data__;if(Lt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return xt.call(t,e)?t[e]:void 0},Gt=Object.prototype.hasOwnProperty;var jt=function hashHas(e){var t=this.__data__;return Lt?void 0!==t[e]:Gt.call(t,e)};var Yt=function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Lt&&void 0===t?"__lodash_hash_undefined__":t,this};function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Hash.prototype.clear=wt,Hash.prototype.delete=Ut,Hash.prototype.get=Ft,Hash.prototype.has=jt,Hash.prototype.set=Yt;var Bt=Hash;var Ht=function listCacheClear(){this.__data__=[],this.size=0};var $t=function assocIndexOf(e,t){for(var r=e.length;r--;)if(Ve(e[r][0],t))return r;return-1},Kt=Array.prototype.splice;var qt=function listCacheDelete(e){var t=this.__data__,r=$t(t,e);return!(r<0)&&(r==t.length-1?t.pop():Kt.call(t,r,1),--this.size,!0)};var Wt=function listCacheGet(e){var t=this.__data__,r=$t(t,e);return r<0?void 0:t[r][1]};var zt=function listCacheHas(e){return $t(this.__data__,e)>-1};var Jt=function listCacheSet(e,t){var r=this.__data__,o=$t(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this};function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}ListCache.prototype.clear=Ht,ListCache.prototype.delete=qt,ListCache.prototype.get=Wt,ListCache.prototype.has=zt,ListCache.prototype.set=Jt;var Qt=ListCache,Xt=Pe(ie,"Map");var Zt=function mapCacheClear(){this.size=0,this.__data__={hash:new Bt,map:new(Xt||Qt),string:new Bt}};var er=function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var tr=function getMapData(e,t){var r=e.__data__;return er(t)?r["string"==typeof t?"string":"hash"]:r.map};var rr=function mapCacheDelete(e){var t=tr(this,e).delete(e);return this.size-=t?1:0,t};var or=function mapCacheGet(e){return tr(this,e).get(e)};var ir=function mapCacheHas(e){return tr(this,e).has(e)};var nr=function mapCacheSet(e,t){var r=tr(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this};function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}MapCache.prototype.clear=Zt,MapCache.prototype.delete=rr,MapCache.prototype.get=or,MapCache.prototype.has=ir,MapCache.prototype.set=nr;var sr=MapCache;function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var memoized=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=memoized.cache;if(i.has(o))return i.get(o);var n=e.apply(this,r);return memoized.cache=i.set(o,n)||i,n};return memoized.cache=new(memoize.Cache||sr),memoized}memoize.Cache=sr;var ar=memoize;var cr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lr=/\\(\\)?/g,_r=function memoizeCapped(e){var t=ar(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(cr,(function(e,r,o,i){t.push(o?i.replace(lr,"$1"):r||e)})),t}));var dr=function arrayMap(e,t){for(var r=-1,o=null==e?0:e.length,i=Array(o);++r<o;)i[r]=t(e[r],r,e);return i},ur=ne?ne.prototype:void 0,Er=ur?ur.toString:void 0;var hr=function baseToString(e){if("string"==typeof e)return e;if(lt(e))return dr(e,baseToString)+"";if(Pt(e))return Er?Er.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};var mr=function toString(e){return null==e?"":hr(e)};var pr=function castPath(e,t){return lt(e)?e:Vt(e,t)?[e]:_r(mr(e))};var gr=function toKey(e){if("string"==typeof e||Pt(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};var Tr=function baseGet(e,t){for(var r=0,o=(t=pr(t,e)).length;null!=e&&r<o;)e=e[gr(t[r++])];return r&&r==o?e:void 0};var fr=function get(e,t,r){var o=null==e?void 0:Tr(e,t);return void 0===o?r:o};var Ir=function stackClear(){this.__data__=new Qt,this.size=0};var Nr=function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Mr=function stackGet(e){return this.__data__.get(e)};var Or=function stackHas(e){return this.__data__.has(e)};var yr=function stackSet(e,t){var r=this.__data__;if(r instanceof Qt){var o=r.__data__;if(!Xt||o.length<199)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new sr(o)}return r.set(e,t),this.size=r.size,this};function Stack(e){var t=this.__data__=new Qt(e);this.size=t.size}Stack.prototype.clear=Ir,Stack.prototype.delete=Nr,Stack.prototype.get=Mr,Stack.prototype.has=Or,Stack.prototype.set=yr;var Sr=Stack;var vr=function assignMergeValue(e,t,r){(void 0!==r&&!Ve(e[t],r)||void 0===r&&!(t in e))&&ke(e,t,r)};var Ar=function createBaseFor(e){return function(t,r,o){for(var i=-1,n=Object(t),s=o(t),a=s.length;a--;){var c=s[e?a:++i];if(!1===r(n[c],c,n))break}return t}}(),Rr=createCommonjsModule((function(e,t){var r=t&&!t.nodeType&&t,o=r&&e&&!e.nodeType&&e,i=o&&o.exports===r?ie.Buffer:void 0,n=i?i.allocUnsafe:void 0;e.exports=function cloneBuffer(e,t){if(t)return e.slice();var r=e.length,o=n?n(r):new e.constructor(r);return e.copy(o),o}})),Cr=ie.Uint8Array;var br=function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Cr(t).set(new Cr(e)),t};var Pr=function cloneTypedArray(e,t){var r=t?br(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Dr=function copyArray(e,t){var r=-1,o=e.length;for(t||(t=Array(o));++r<o;)t[r]=e[r];return t},kr=Object.create,Vr=function(){function object(){}return function(e){if(!me(e))return{};if(kr)return kr(e);object.prototype=e;var t=new object;return object.prototype=void 0,t}}(),Lr=Mt(Object.getPrototypeOf,Object);var wr=function initCloneObject(e){return"function"!=typeof e.constructor||Nt(e)?{}:Vr(Lr(e))};var Ur=function isArrayLikeObject(e){return rt(e)&&ze(e)},xr=Function.prototype,Fr=Object.prototype,Gr=xr.toString,jr=Fr.hasOwnProperty,Yr=Gr.call(Object);var Br=function isPlainObject(e){if(!rt(e)||"[object Object]"!=he(e))return!1;var t=Lr(e);if(null===t)return!0;var r=jr.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Gr.call(r)==Yr};var Hr=function safeGet(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};var $r=function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Kr=Object.prototype.hasOwnProperty;var qr=function baseKeysIn(e){if(!me(e))return $r(e);var t=Nt(e),r=[];for(var o in e)("constructor"!=o||!t&&Kr.call(e,o))&&r.push(o);return r};var Wr=function keysIn(e){return ze(e)?ft(e,!0):qr(e)};var zr=function toPlainObject(e){return Ue(e,Wr(e))};var Jr=function baseMergeDeep(e,t,r,o,i,n,s){var a=Hr(e,r),c=Hr(t,r),l=s.get(c);if(l)vr(e,r,l);else{var _=n?n(a,c,r+"",e,t,s):void 0,d=void 0===_;if(d){var u=lt(c),E=!u&&dt(c),h=!u&&!E&&gt(c);_=c,u||E||h?lt(a)?_=a:Ur(a)?_=Dr(a):E?(d=!1,_=Rr(c,!0)):h?(d=!1,_=Pr(c,!0)):_=[]:Br(c)||ct(c)?(_=a,ct(a)?_=zr(a):me(a)&&!ge(a)||(_=wr(c))):d=!1}d&&(s.set(c,_),i(_,c,o,n,s),s.delete(c)),vr(e,r,_)}};var Qr,Xr,Zr=function baseMerge(e,t,r,o,i){e!==t&&Ar(t,(function(n,s){if(i||(i=new Sr),me(n))Jr(e,t,s,r,baseMerge,o,i);else{var a=o?o(Hr(e,s),n,s+"",e,t,i):void 0;void 0===a&&(a=n),vr(e,s,a)}}),Wr)},eo=Ze((function(e,t,r){Zr(e,t,r)}));!function(e){e[e.Unset=0]="Unset",e[e.RN=2]="RN",e[e.UNIAPP=3]="UNIAPP",e[e.Electron=5]="Electron",e[e.WeiXin=6]="WeiXin",e[e.BROWSER=100]="BROWSER",e[e.H5=101]="H5",e[e.Ali=102]="Ali",e[e.Baidu=103]="Baidu",e[e.Tiktok=104]="Tiktok"}(Qr||(Qr={})),function(e){e[e.kStatNetTypeUnkonw=0]="kStatNetTypeUnkonw",e[e.kStatNetTypeEthernet=1]="kStatNetTypeEthernet",e[e.kStatNetTypeWifi=2]="kStatNetTypeWifi",e[e.kStatNetType2G=3]="kStatNetType2G",e[e.kStatNetType3G=4]="kStatNetType3G",e[e.kStatNetType4G=5]="kStatNetType4G",e[e.kStatNetType5G=6]="kStatNetType5G"}(Xr||(Xr={}));var to={wifi:Xr.kStatNetTypeWifi,"2g":Xr.kStatNetType2G,"3g":Xr.kStatNetType3G,"4g":Xr.kStatNetType4G,"5g":Xr.kStatNetType5G,ethernet:Xr.kStatNetTypeEthernet,unknown:Xr.kStatNetTypeUnkonw,none:Xr.kStatNetTypeUnkonw,notreachable:Xr.kStatNetTypeUnkonw,wwan:Xr.kStatNetTypeUnkonw};function base64ToArrayBuffer(e){for(var t=function base64Decode(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o=0,i=0,n=0,s="";r=t.charAt(n++);~r&&(i=o%4?64*i+r:r,o++%4)?s+=String.fromCharCode(255&i>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s}(e),r=t.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=t.charCodeAt(i);return o.buffer}var ro={setLogger:function(e){throw new Error("Function not implemented.")},platform:"",WebSocket:class AdapterSocket{constructor(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}close(e,t){throw new Error("Method not implemented.")}send(e){throw new Error("Method not implemented.")}onclose(e){throw new Error("Method not implemented.")}onerror(e){throw new Error("Method not implemented.")}onmessage(e){throw new Error("Method not implemented.")}onopen(e){throw new Error("Method not implemented.")}},localStorage:{},request:function(e,t){throw new Error("Function not implemented.")},uploadFile:function(e){throw new Error("Function not implemented.")},getSystemInfo:function(){throw new Error("Function not implemented.")},getFileUploadInformation(e){throw new Error("Function not implemented.")},net:{__getEnv:()=>null,__onNetworkStatusChangeFn:null,getNetworkStatus(){var e=this.__getEnv();return new Promise(((t,r)=>{e.getNetworkType({success:function(e){var r=!1;r="boolean"==typeof e.networkAvailable?e.networkAvailable:"none"!==e.networkType.toLowerCase(),t({net_type:to[e.networkType.toLowerCase()],net_connect:r})},fail:function(){r(new Error("getNetworkType failed"))}})}))},onNetworkStatusChange(e){var t=this.__getEnv();this.offNetworkStatusChange(),t.onNetworkStatusChange&&(this.__onNetworkStatusChangeFn=function(t){var r=t.networkType.toLowerCase();e({isConnected:t.isConnected||"none"!==r,networkType:to[r]})},t.onNetworkStatusChange(this.__onNetworkStatusChangeFn))},offNetworkStatusChange(){var e=this.__getEnv();e.offNetworkStatusChange&&(this.__onNetworkStatusChangeFn&&e.offNetworkStatusChange(this.__onNetworkStatusChangeFn),this.__onNetworkStatusChangeFn=null)}}};class PromiseManager{constructor(){this.abortFns=[]}add(e){var t=function getPromiseWithAbort(e){var t={},r=new Promise((function(e,r){t.abort=r}));return t.promise=Promise.race([e,r]),t}(e);return this.abortFns.push(t.abort),t.promise}clear(e){this.abortFns.forEach((t=>t(e||new V2NIMErrorImpl({code:Z.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}})))),this.abortFns=[]}destroy(){this.clear()}}var oo={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},io={timestamp:0,rtt:0,baseClock:0,baseTime:0};class TimeOrigin{constructor(e,t,r="getServerTime"){this.serverOrigin=io,this.config=oo,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=e,this.logger=e.logger,this.promiseManager=new PromiseManager,this.cmdName=r,t&&this.setOptions(t)}setOptions(e){this.config=Object.assign({},oo,this.config,e)}reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=io,this.currentChance=0}setOriginTimetick(){return __awaiter(this,void 0,void 0,(function*(){if(this.config.enable&&!(this.isSettingNTP||this.currentChance>=this.config.maxChances)){var e=fr(this.core,"auth.status"),t=fr(this.core,"status"),r=fr(this.core,"V2NIMLoginService.lifeCycle.loginStatus");if("logined"===e||"logined"===t||r===u.V2NIM_LOGIN_STATUS_LOGINED){this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0;var o,i="TimeOrigin::setOriginTimetick:",n=Date.now();this.core.logger.log(`${i} getServerTime start, times ${this.currentChance}`);try{var s=yield this.promiseManager.add(this.core.sendCmd(this.cmdName));o=fr(s,"content.time"),this.isSettingNTP=!1}catch(e){var a=e;return this.isSettingNTP=!1,this.logger.warn(`${i} Calculate Delay time, getServerTime error`,a),void(a.code!==Z.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)))}if(!o)return this.core.logger.warn(`${i} Calculate Delay time incorrect format`),void(this.config.enable=!1);var c=Date.now()-n;this.doSet(o,c)}}}))}doSet(e,t){var r="TimeOrigin::setOriginTimetick:";t>this.config.tolerantRTT?(this.logger.warn(`${r} Denied, cause of exceeding the maximum tolerance range of RTT: ${t}`),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):t>this.config.bestRTT?(this.serverOrigin.rtt&&t>=this.serverOrigin.rtt?this.logger.log(`${r} Denied, cause of current.RTT >= serverOrigin.RTT: ${t}`):(this.setServerOrigin(t,e),this.logger.log(`${r} Accept within maximum tolerance range of RTT: ${t}, ntpTimestamp: ${this.serverOrigin.timestamp}, localClock: ${this.serverOrigin.baseClock}, localTime: ${this.serverOrigin.baseTime}`)),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):(this.setServerOrigin(t,e),this.logger.log(`${r} Accept within best RTT: ${t}, ntpTimestamp: ${this.serverOrigin.timestamp}, localClock: ${this.serverOrigin.baseClock}, localTime: ${this.serverOrigin.baseTime}`),this.currentChance=0,this.timer=setTimeout(this.setOriginTimetick.bind(this),this.successDelay))}getNTPTime(e){if(void 0===e&&(e=this.getTimeNode()),this.checkNodeReliable(e)){var t=Math.floor(e.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+t}return Date.now()}checkNodeReliable(e){if(void 0===e&&(e=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var t=e.clock-this.serverOrigin.baseClock,r=e.time-this.serverOrigin.baseTime;return Math.abs(r-t)<500}return!1}checkPerformance(){return"BROWSER"===ro.platform&&!("undefined"==typeof performance||!performance.now)}static checkPerformance(){return"BROWSER"===ro.platform&&!("undefined"==typeof performance||!performance.now)}getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Date.now()}}static getTimeNode(){return{clock:TimeOrigin.checkPerformance()?performance.now():0,time:Date.now()}}setServerOrigin(e,t){this.serverOrigin={timestamp:t+Math.floor(e/2),rtt:e,baseClock:this.checkPerformance()?performance.now():0,baseTime:Date.now()}}}var no={},so={};function parseEachCmd(e,t,r,o,i){var n,s={cmd:r,raw:e,error:null,service:null==t?void 0:t.service,content:{},__receiveTimeNode:TimeOrigin.getTimeNode()};if(!r||!t)return s.notFound=!0,s;(18===t.sid||t.sid>=26&&t.sid<100)&&(e.code=function toReadableCode(e){if("number"!=typeof e||e!=e)throw new V2NIMErrorImpl({code:Z.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:`${e}`}});if(e<0||e>=0&&e<1e3||e>=2e4&&e<=20099)return e;var t=(65535&e)>>9;t-=t<=38?1:2;return 1e5+1e3*t+(511&e)}(e.code));var a=function genCmdError(e,t){var r=ee[e],o=te[e];return null===o?null:new V2NIMErrorImpl({code:e,desc:r||o||e,detail:{cmd:t,timetag:Date.now()}})}(e.code,r);if(s.error=a,s.error){if(s.error.detail.cmd=r,!(null===(n=null==t?void 0:t.ignoreErrCodes)||void 0===n?void 0:n.includes(e.code)))return s;i.warn("parseCmd:: ignore error ",s.error),s.error.detail.ignore=!0}return t.response&&t.response.forEach(((e,t)=>{var r=o[t],i=e.type,n=e.name,a=e.reflectMapper;if(!Ct(r))switch(i){case"Property":s.content[n]=a?deserialize(r,a):r;break;case"PropertyArray":s.content[n]=r.map((e=>a?deserialize(e,a):e));break;case"Int":case"Long":case"Byte":s.content[n]=+r;break;case"Bool":s.content[n]="true"===r||!0===r||1===r;break;default:s.content[n]=r}})),s}function serialize(e,t,r){var o={};for(var i in e=function flattenObjByMapper(e,t){var r={};for(var o in t){var i=t[o],n="number"==typeof i?o:i.access?i.access:o,s=n.split("."),a=e;for(var c of s){if(void 0===a[c]||null===a[c]){a=void 0;break}a=a[c]}void 0!==a&&(r[n]=a)}return r}(e,t),t){var n=t[i],s="number"==typeof n?i:n.access?n.access:i;if(!r||r.includes(i))if(s in e){if("number"==typeof n)o[n]=e[s];else if("object"==typeof n)if(n.converter){var a=n.converter(e[s],e);void 0!==a&&(o[n.id]=a)}else o[n.id]=e[s]}else"object"==typeof n&&n.def&&("function"==typeof n.def?o[n.id]=n.def(e):o[n.id]=n.def)}return o}function deserialize(e,t){var r={};for(var o in e){var i=t[o];if("string"==typeof i)r[i]=e[o];else if("object"==typeof i&&"prop"in i){var n=i.access?i.access:i.prop;if(i.converter){var s=i.converter(e[o],e);void 0!==s&&(r[n]=s)}else i.type&&"number"===i.type?r[n]=+e[o]:i.type&&"boolean"===i.type?r[n]=!("0"===e[o]||!e[o]):r[n]=e[o]}}for(var a in t){var c=t[a];if(c&&void 0!==c.def){var l=c.access?c.access:c.prop;l in r||("function"==typeof c.def?r[l]=c.def(e):r[l]=c.def)}}return r=function unflattenObj(e){var t={},_loop=function(r){var o=r.split(".");o.reduce((function(t,i,n){return t[i]||(t[i]=isNaN(Number(o[n+1]))?o.length-1==n?e[r]:{}:[])}),t)};for(var r in e)_loop(r);return t}(r),r}function registerParser(e){for(var t in Object.assign(no,e.cmdConfig),e.cmdMap){var r=e.cmdMap[t],o=e.cmdConfig[r];if(o)if(Array.isArray(so[t])){var i=!1;for(var n of so[t])if(n.cmd===r&&n.config.service===o.service){i=!0;break}i||so[t].push({config:o,cmd:r})}else so[t]=[{config:o,cmd:r}]}}var ao=function baseIsRegExp(e){return rt(e)&&"[object RegExp]"==he(e)},co=mt&&mt.isRegExp,lo=co?ht(co):ao;var _o=function setCacheAdd(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var uo=function setCacheHas(e){return this.__data__.has(e)};function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new sr;++t<r;)this.add(e[t])}SetCache.prototype.add=SetCache.prototype.push=_o,SetCache.prototype.has=uo;var Eo=SetCache;var ho=function baseFindIndex(e,t,r,o){for(var i=e.length,n=r+(o?1:-1);o?n--:++n<i;)if(t(e[n],n,e))return n;return-1};var mo=function baseIsNaN(e){return e!=e};var po=function strictIndexOf(e,t,r){for(var o=r-1,i=e.length;++o<i;)if(e[o]===t)return o;return-1};var go=function baseIndexOf(e,t,r){return t==t?po(e,t,r):ho(e,mo,r)};var To=function arrayIncludes(e,t){return!!(null==e?0:e.length)&&go(e,t,0)>-1};var fo=function arrayIncludesWith(e,t,r){for(var o=-1,i=null==e?0:e.length;++o<i;)if(r(t,e[o]))return!0;return!1};var Io=function cacheHas(e,t){return e.has(t)};var No=function baseDifference(e,t,r,o){var i=-1,n=To,s=!0,a=e.length,c=[],l=t.length;if(!a)return c;r&&(t=dr(t,ht(r))),o?(n=fo,s=!1):t.length>=200&&(n=Io,s=!1,t=new Eo(t));e:for(;++i<a;){var _=e[i],d=null==r?_:r(_);if(_=o||0!==_?_:0,s&&d==d){for(var u=l;u--;)if(t[u]===d)continue e;c.push(_)}else n(t,d,o)||c.push(_)}return c},Mo=qe((function(e,t){return Ur(e)?No(e,t):[]}));function replacer(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function validate(e,t={},r,o=!1){var i={};return Object.keys(e).forEach((n=>{var s=e[n].type,a=r?`In ${r}, `:"";if(null==t){var c=`${a}param is null or undefined`;throw o?new ValidateErrorV2({detail:{reason:c,data:{key:n},rules:"required"}}):new ValidateError(c,{key:n},"required")}if(void 0===t[n]){if(!1===e[n].required)return void(i[n]=t[n]);var l=`${a}param '${n}' is required`;throw o?new ValidateErrorV2({detail:{reason:l,data:{key:n},rules:"required"}}):new ValidateError(l,{key:n},"required")}var _=Oo[s];if(_&&!_(t,n,e[n],o)){var d=`${a}param '${n}' unexpected`,u={key:n,value:t[n]};throw o?new ValidateErrorV2({detail:{reason:d,data:u,rules:JSON.stringify(e[n],replacer)}}):new ValidateError(d,u,JSON.stringify(e[n],replacer))}i[n]=t[n]})),i}var Oo={string:function(e,t,r){var{allowEmpty:o,max:i,min:n,regExp:s}=r,a=e[t];return"string"==typeof a&&((!1!==o||""!==a)&&(!("number"==typeof i&&a.length>i)&&(!("number"==typeof n&&a.length<n)&&!(lo(s)&&!s.test(a)))))},number:function(e,t,r){var{min:o,max:i}=r,n=e[t];return"number"==typeof n&&(!("number"==typeof o&&n<o)&&!("number"==typeof i&&n>i))},boolean:function(e,t){return"boolean"==typeof e[t]},file:function(e,t){return!0},enum:function(e,t,r){var{values:o}=r,i=e[t];return!o||o.indexOf(i)>-1},jsonstr:function(e,t){try{var r=JSON.parse(e[t]);return"object"==typeof r&&null!==r}catch(e){return!1}},func:function(e,t){return"function"==typeof e[t]},array:function(e,t,r,o=!1){var{itemType:i,rules:n,min:s,max:a,values:c}=r,l=e[t];return!!Array.isArray(l)&&(!("number"==typeof a&&l.length>a)&&(!("number"==typeof s&&l.length<s)&&(!(i&&"enum"!==i&&!l.every((e=>typeof e===i)))&&(("enum"!==i||!c||!Mo(l,...c).length)&&(n&&l.forEach(((e,r)=>validate(n,e,`${t}[${r}]`,o))),!0)))))},object:function(e,t,r,o=!1){var{rules:i,allowEmpty:n}=r,s=e[t];if("object"!=typeof s||null===s)return!1;if(i){var a=Object.keys(i),c=Object.keys(s).filter((e=>a.indexOf(e)>-1));if(!1===n&&0===c.length)return!1;validate(i,s,t,o)}return!0}},yo=["error","warn","log","debug"],emptyFunc=function(){},So=["off","error","warn","log","debug"];class Logger{constructor(e){this.strategies={debug:{name:"debug",func:console.log},log:{name:"  log",func:console.log},warn:{name:" warn",func:console.warn},error:{name:"error",func:console.error}},this.debug=emptyFunc,this.log=emptyFunc,this.warn=emptyFunc,this.error=emptyFunc,So.includes(e)||(e="off"),this.setLogFunc(e)}setLogFunc(e){var t=yo.findIndex((t=>t===e));yo.forEach(((e,r)=>{r<=t&&(this[e]=function(){var t=Array.prototype.slice.call(arguments),r=this.strategies[e],o=this.formatArgs(t,r.name);r.func(o)})}))}formatArgs(e,t){var r=new Date;return`[NIM ${t} ${`${r.getMonth()+1}-${r.getDate()} ${r.getHours()}:${r.getMinutes()}:${r.getSeconds()}:${r.getMilliseconds()}`}] `+e.map((e=>e instanceof V2NIMErrorImpl?e.toString():e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?JSON.stringify(e):e)).join(" ")}destroy(){this.debug=emptyFunc,this.log=emptyFunc,this.warn=emptyFunc,this.error=emptyFunc}}class CoreAdapters{constructor(e){this.lastCommonHost="",this.core=e}getFileUploadInformation(e){return ro.getFileUploadInformation(e)}request(e,t,r){var o=(new Date).getTime(),i=(null==r?void 0:r.exception_service)||0;return ro.request(e,t).catch((r=>{var n,s,a,c,l=r;throw this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(s=null===(n=this.core)||void 0===n?void 0:n.auth)||void 0===s?void 0:s.account),trace_id:null===(c=null===(a=this.core.clientSocket)||void 0===a?void 0:a.socket)||void 0===c?void 0:c.sessionId,start_time:o,action:1,exception_service:i}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof l.code?l.code:0,description:l.message||`${l.code}`,operation_type:0,target:e,context:t?JSON.stringify(t):""},{asyncParams:ro.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),r}))}uploadFile(e){var t,r,o,i;return __awaiter(this,void 0,void 0,(function*(){for(var n=e.commonUploadHostBackupList.indexOf(e.commonUploadHost),s=-1===n?[e.commonUploadHost,...e.commonUploadHostBackupList]:[e.commonUploadHost,...e.commonUploadHostBackupList.slice(0,n),...e.commonUploadHostBackupList.slice(n+1)],a=Math.max(s.indexOf(this.lastCommonHost),0),c="BROWSER"===ro.platform?1:s.length,l=null,_=0;_<c;_++){var d=(new Date).getTime();this.lastCommonHost=s[(_+a)%s.length];try{return yield ro.uploadFile(Object.assign(Object.assign({},e),{commonUploadHost:this.lastCommonHost}))}catch(n){l=n;var u=n;this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(r=null===(t=this.core)||void 0===t?void 0:t.auth)||void 0===r?void 0:r.account),trace_id:null===(i=null===(o=this.core.clientSocket)||void 0===o?void 0:o.socket)||void 0===i?void 0:i.sessionId,start_time:d,action:1,exception_service:3});var E="BROWSER"===ro.platform?e.chunkUploadHost:`${this.lastCommonHost}/${e.nosToken&&e.nosToken.bucket}`;this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof u.code?u.code:0,description:u.message||`${u.code}`,operation_type:1,target:E},{asyncParams:ro.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)}}throw l}))}}var vo="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Ao="imElite_sdk_abtest_web";class ABTest{constructor(e,t){this.abtInfo={},this.core=e,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:vo,abtestProjectKey:Ao},t)}setOptions(e){this.config=assignOptions(this.config,e)}abtRequest(){var e,t;return __awaiter(this,void 0,void 0,(function*(){if(this.config.isAbtestEnable&&!this.abtInfo.experiments&&this.config.abtestUrl){var r;try{r=yield this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.4.0",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7})}catch(e){this.core.logger.warn("ABTest request failed")}this.abtInfo=(null===(t=null===(e=null==r?void 0:r.data)||void 0===e?void 0:e.data)||void 0===t?void 0:t.abtInfo)||{}}}))}}class TimerManager{constructor(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}addTimer(e,t=0,r=1){var o=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:r,count:0,timeout:o+t,interval:t,callback:e}),this.id++,this.checkTimer(o),i}checkTimer(e=(new Date).getTime()){if(this.removeFinished(),0!==this.timerList.length||null==this.timer){var t=0;for(var r of this.timerList)(0===t||t>r.timeout)&&(t=r.timeout);0!==this.timerList.length&&(null===this.timer||t<this.timeout||this.timeout<e)&&(this.timer=setTimeout(this.nowTime.bind(this),t-e),this.timeout=t)}}nowTime(){var e=(new Date).getTime();for(var t of this.timerList)e>=t.timeout&&(t.callback(),t.count++,t.timeout=e+t.interval);this.clerTime(),this.checkTimer(e)}clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}deleteTimer(e){for(var t=this.timerList.length-1;t>=0;t--){this.timerList[t].id===e&&this.timerList.splice(t,1)}}removeFinished(){for(var e=this.timerList.length-1;e>=0;e--){var t=this.timerList[e];t.loop>=0&&t.count>=t.loop&&this.timerList.splice(e,1)}}destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null}}class Service{constructor(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}process(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=fr(e,"error.detail.ignore");return e.error&&!r?Promise.reject(e.error):Promise.resolve(e)}}var Ro=Backoff;function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e};var Co=Pe(ie,"Set");var bo=function noop(){};var Po=function setToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},Do=Co&&1/Po(new Co([,-0]))[1]==1/0?function(e){return new Co(e)}:bo;var ko=function baseUniq(e,t,r){var o=-1,i=To,n=e.length,s=!0,a=[],c=a;if(r)s=!1,i=fo;else if(n>=200){var l=t?null:Do(e);if(l)return Po(l);s=!1,i=Io,c=new Eo}else c=t?[]:a;e:for(;++o<n;){var _=e[o],d=t?t(_):_;if(_=r||0!==_?_:0,s&&d==d){for(var u=c.length;u--;)if(c[u]===d)continue e;t&&c.push(d),a.push(_)}else i(c,d,r)||(c!==a&&c.push(d),a.push(_))}return a};var Vo,Lo=function uniq(e){return e&&e.length?ko(e):[]},wo=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Uo=["transport not supported","client not handshaken","unauthorized"],xo=["reconnect"];class BaseWebsocket extends z{constructor(e,t){super(),this.url=t,this.websocket=null,this.socketConnectTimer=0,this.core=e,this.url=t,this.status="disconnected",this.logger=e.logger,this.connect()}connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+Date.now(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((e=>{if("connecting"===this.status){var[t,r]=e.data.split(":");return this.sessionId=t,this.logger.log(`imsocket::XHR success. status ${this.status}, ${"connecting"===this.status?"continue websocket connection":"stop websocket connection"}`),this._createWebsocket("wss://"+this.url+"/socket.io/1/websocket/"+t)}})).catch((e=>{if("connecting"===this.status){var t=`imsocket::XHR fail. raw message: "${(e=e||{}).message}", code: "${e.code}"`,r=e.code;r="v2"===fr(this.core,"options.apiVersion")?e.code===Z.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Z.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Z.V2NIM_ERROR_CODE_CONNECT_FAILED:408===e.code?408:415;var o=new V2NIMErrorImpl({code:r,detail:{reason:t,rawError:e}});this.logger.error(t),this.status="disconnected",this.emit("handshakeFailed",o)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(e){this.logger.warn("imsocket::attempt to send encodePacket error",e)}try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}}clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(e){this.socketConnectTimer=setTimeout((()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",this.socketUrl),this.emit("handshakeFailed",new V2NIMErrorImpl({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${this.socketUrl}`}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new ro.WebSocket(e),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=e=>{var t=(null==e?void 0:e.reason)||(null==e?void 0:e.message)||(null==e?void 0:e.errMsg)||"websocket.onclose";this.logger.log(`imsocket::Websocket onclose done. code is ${null==e?void 0:e.code} and reason is ${t}`),this.clean(),this.emit("disconnect",{code:(null==e?void 0:e.code)||0,reason:t})},this.websocket.onerror=e=>{this.logger.error("imsocket::Websocket onerror",e),"logined"===this.core.status&&this.core.clientSocket.ping()}}onMessage(e){var t,r=this.decodePacket(e.data);if(r)switch(r.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",r.data);break;case"event":r.name&&this.emit(r.name,r.args);break;case"error":"unauthorized"===r.reason?this.emit("connect_failed",r.reason):this.emit("error",r.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new V2NIMErrorImpl({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:`imsocket::Websocket connect failed, onMessage socket error. url: ${this.socketUrl}`}}));break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",r.type)}}encodePacket(e){var t,r,{type:o,id:i="",endpoint:n="",ack:s}=e,a=null;if(!o)return"";switch(o){case"error":t=e.reason?Uo.indexOf(e.reason):"",r=e.advice?xo.indexOf(e.advice):"",""===t&&""===r||(a=t+(""!==r?"+"+r:""));break;case"message":""!==e.data&&(a=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},a=JSON.stringify(t);break;case"json":a=JSON.stringify(e.data);break;case"connect":e.qs&&(a=e.qs);break;case"ack":a=e.ackId+(e.args&&e.args.length?"+"+JSON.stringify(e.args):"")}var c=[wo.indexOf(o),i+("data"===s?"+":""),n];return null!=a&&c.push(a),c.join(":")}decodePacket(e){if(e)if("�"!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var r,[,o,i,n,s,a]=t,c={type:wo[+o],endpoint:s};switch(i&&(c.id=i,c.ack=!n||"data"),c.type){case"error":r=a.split("+"),c.reason=Uo[+r[0]]||"";break;case"message":c.data=a||"";break;case"connect":c.qs=a||"";break;case"event":try{var l=JSON.parse(a);c.name=l.name,c.args=l.args}catch(e){this.logger.error("imsocket::parseData::type::event error",e)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(a)}catch(e){this.logger.error("imsocket::parseData::type::json error",e)}break;case"ack":if((r=a.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=r[1],c.args=[],r[3]))try{c.args=r[3]?JSON.parse(r[3]):[]}catch(e){this.logger.error("imsocket::parseData::type::ack error",e)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",e.slice(0,20))}send(e){var t,r={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(r))}}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Vo||(Vo={}));class V1ClientSocket{constructor(e,t){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new Ro({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,t&&(this.auth=t),this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager}setSessionId(e){}connect(e={},t){return __awaiter(this,void 0,void 0,(function*(){if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},e),!/^(unconnected|waitReconnect)$/.test(this.core.status)){var r=`Core socket status is ${this.core.status}, and would not connect`;return this.logger.warn(r),Promise.reject(r)}this.core.status="connecting",e.linkUrls&&e.linkUrls.length>0&&(this.linkUrls=e.linkUrls.concat(this.linkUrls),this.linkUrls=Lo(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push("weblink.netease.im:443");for(var o=0;o<this.linkUrls.length;o++){var i=this.linkUrls[o],n=(new Date).getTime();try{return yield this.doConnect(i),this.core.status="connected",this.logger.log(`clientsocketV1::connect success with url: ${i}`),i}catch(e){var s=e;t&&t(s,i),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:n,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof s.code?s.code:0,description:s.message||`${s.code}`,operation_type:0,target:i},{asyncParams:ro.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn(`clientsocketV1::connect failed with url: ${i}`,e)}}throw 0===this.retryCount?this.doDisconnect(Vo.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(Vo.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed")}))}doConnect(e){var t=!1;return new Promise(((r,o)=>{this.socket=new BaseWebsocket(this.core,e),this.socket.on("connect",(()=>{this.logger.log("clientSocketV1::on connect",e),this.core.reporterHookLinkKeep&&(this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e})),t=!0,r()})),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",(r=>__awaiter(this,void 0,void 0,(function*(){this.logger.log("clientSocketV1::socket on disconnect",r),this.core.reporterHookLinkKeep&&(yield this.core.reporterHookLinkKeep.update({code:(null==r?void 0:r.code)||0,description:(null==r?void 0:r.reason)||"socket on disconnect",operation_type:1,target:e}),this.core.reporterHookLinkKeep.end(!1)),t=!0,this.doDisconnect(Vo.OFFLINE,"SocketOnDisconnect")})))),this.socket.on("handshakeFailed",(e=>{t?this.ping():(this.logger.error(`clientsocketV1::handshake failed: "${e&&e.message}"`),this.cleanSocket()),t=!0,o(e)}))}))}cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)}beforeConnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)}resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()}doDisconnect(e,t,r){var o,i,n,s,a;if(this.logger.log(`doDisconnect: type ${e}, description ${t}`),"unconnected"!==this.core.status){var c={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new V2NIMErrorImpl({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var l=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(e===Vo.ACTIVE||l)this.logger.log("doDisconnect: emit disconnect, type "+e,l),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(o=this.auth)||void 0===o||o.emit("disconnect"),this.destroyOnlineListener();else if(e===Vo.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var _="string"==typeof t?{reason:"unknow",message:t}:t;this.core.eventBus.emit("kicked",_),this.core.emit("kicked",_),null===(i=this.auth)||void 0===i||i.emit("kicked",_),this.destroyOnlineListener()}else e===Vo.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):e===Vo.OFFLINE&&(null===(s=null===(n=this.auth)||void 0===n?void 0:n.authenticator)||void 0===s?void 0:s.checkLoginTerminalCode(null==r?void 0:r.code))?(this.logger.log(`doDisconnect: login terminal code ${null==r?void 0:r.code}, no reconnect`),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(a=this.auth)||void 0===a||a.emit("disconnect")):e===Vo.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")}attempToReconnect(){var e,t;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(e=this.auth)||void 0===e||e.emit("disconnect"));var r=this.backoff.duration();this.retryCount++,this.logger.log(`willReconnect ${this.retryCount} ${r}`),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:r}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:r}),null===(t=this.auth)||void 0===t||t.emit("willReconnect",{retryCount:this.retryCount,duration:r}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){"waitReconnect"===this.core.status?!1===(yield ro.net.getNetworkStatus()).net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(Vo.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((()=>{this.logger.error(`clientsocketV1::attempToReconnect failed ${this.retryCount}`)})):this.logger.warn(`doDisconnect: reconnectTimer status is ${this.core.status}, would not go on reconnecting`)}))),r)}else this.logger.warn("doDisconnect: already is waiting reconnect")}sendCmd(e,t,r){if("logined"!==this.core.status&&"login"!==e&&"chatroomLogin"!==e&&"qchatLogin"!==e)return this.logger.warn(`instance status is ${this.core.status}, so can not sendCmd ${e}`),Promise.reject({cmd:e,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return Promise.reject("No_socket");var o="heartbeat"!==e,i=o?this.packetSer++:0,n=function createCmd(e,t,r,o){var i=no[e];if(!i)return r.error("createCmd:: can not find cmd config: ",e),null;var n={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&o&&i.params.forEach((function(e){var t=o[e.name];if(null!=t){var r=e.type,{reflectMapper:i,select:s}=e;switch(e.type){case"PropertyArray":r="ArrayMable",t=t.map((e=>({t:"Property",v:i?serialize(e,i,s):e})));break;case"Property":t=i?serialize(t,i,s):t;break;case"Bool":t=t?"true":"false"}n.Q.push({t:r,v:t})}})),{packet:n,hasPacketResponse:"boolean"!=typeof i.hasPacketResponse||i.hasPacketResponse,hasPacketTimer:"boolean"!=typeof i.hasPacketTimer||i.hasPacketTimer}}(e,i,this.logger,t);if(!n){var s=`SendCmd ${i} ${e} error`;return this.logger.error(s),Promise.reject(new Error(s))}var{packet:a,hasPacketResponse:c,hasPacketTimer:l}=n,_=JSON.stringify(a);o&&("debug"===this.core.options.debugLevel?this.logger.debug("clientsocketV1::sendCmd",e,`ser:${i}`,_):this.logger.log("clientsocketV1::sendCmd",e,`ser:${i}`));var d=(new Date).getTime();return new Promise(((o,n)=>{c&&this.sendingCmdMap.set(i,{cmd:e,params:t,callback:[o,n],timer:l?setTimeout((()=>{var t=new V2NIMErrorImpl({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:e,ser:i,timetag:Date.now()}});this.markCmdInvalid(i,t,e)}),r&&r.timeout?r.timeout:this.core.config.timeout):null});try{this.socket.send(_),c||o(a)}catch(t){var s=new V2NIMErrorImpl({code:415,detail:{reason:t&&t.message||"Unable to send packet",cmd:e,ser:i,timetag:Date.now(),rawError:t}});this.markCmdInvalid(i,s,e),n(t)}})).catch((e=>{var t;if(![408,415].includes(e.code))return Promise.reject(e);this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,trace_id:null===(t=this.socket)||void 0===t?void 0:t.sessionId,start_time:d,action:2,exception_service:6});var r=fr(e,"data.disconnect_reason")||"",o=408===e.code?"Send failed due to timeout":"Send failed. Reason unknown";return o=415===e.code?JSON.stringify({disconnect_reason:r}):o,this.reporter.reportTraceUpdateV2("exceptions",{code:e.code||415,description:o,operation_type:1,target:`${a.SID}-${a.CID}`,context:`${a.SER}`},{asyncParams:ro.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),Promise.reject(e)}))}onMessage(e){var t=function parseCmd(e,t){var r;try{r=JSON.parse(e)}catch(r){return void t.error(`Parse command error:"${e}"`)}var o=r.sid+"_"+r.cid,i=r.r;if(["4_1","4_2","4_10","4_11"].includes(o)){var n=r.r[1].headerPacket;o=`${n.sid}_${n.cid}`,r.sid=n.sid,r.cid=n.cid,i=r.r[1].body}var s=so[o],a=[];if(s){for(var c of s)a.push(parseEachCmd(r,c.config,c.cmd,i,t));return a}t.error("parseCmd:: mapper not exist",o,r.code)}(e,this.logger);if(t)for(var r of t){var o=r.raw.ser;if(r.error&&this.logger.error("core:onMessage packet error",`${r.raw.sid}_${r.raw.cid}, ser:${o},`,r.error),r.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",`${r.raw.sid}_${r.raw.cid}, ser:${o}`);"heartbeat"!==r.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug(`imsocket::recvCmd ser:${o}`,r.cmd,r.content):this.logger.log(`imsocket::recvCmd ser:${o}`,r.cmd)),this.packetHandler(r)}}packetHandler(e){var t,r;if(e){var o=e.raw.ser,i=this.sendingCmdMap.get(o);if(i&&i.cmd===e.cmd){var{callback:n,timer:s,params:a}=i;if(clearTimeout(s),e.params=a,this.sendingCmdMap.delete(o),"heartbeat"===e.cmd)return void n[0]();var c=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);c&&"function"==typeof c.then?c.then((e=>{n[0](e)})).catch((e=>{n[1](e)})):(this.logger.log("imsocket:: handlerFn without promise",e.service,e.cmd),n[0]())}else null===(r=this.core[e.service])||void 0===r||r.process(e)}}markCmdInvalid(e,t,r){var o=this.sendingCmdMap.get(e);if(o){var{callback:i,timer:n}=o;n&&clearTimeout(n),this.sendingCmdMap.delete(e),this.logger.warn(`packet ${e}, ${r} is invalid:`,t),i[1](t)}}markAllCmdInvaild(e){this.logger.log("markAllCmdInvaild",e),this.sendingCmdMap.forEach((t=>{var{callback:r,timer:o,cmd:i}=t;this.logger.debug(`markAllCmdInvaild:: cmd "${i}"`),o&&clearTimeout(o),r[1](e)})),this.sendingCmdMap.clear()}ping(){var e;return __awaiter(this,void 0,void 0,(function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(t){if(yield this.testHeartBeat5Timeout())return this.core.reporterHookLinkKeep&&(yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url}),this.core.reporterHookLinkKeep.end(!0)),void this.doDisconnect(Vo.OFFLINE,"PingError")}this.pingTimer=setTimeout((()=>{this.ping()}),3e4)}))}testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,(function*(){clearTimeout(this.pingTimer);for(var e=0;e<5;e++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch(t){this.logger.debug(`clientsocketV1:: test heartbeat ${e} Timeout`)}return!0}))}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,ro.net.onNetworkStatusChange((e=>{this.logger.log("clientsocketV1::onlineListener:network change",e),e.isConnected&&"logined"===this.core.status?this.ping():e.isConnected&&"waitReconnect"===this.core.status?(this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((()=>{this.logger.error(`clientsocketV1::attempToReconnect failed ${this.retryCount}`)}))):e.isConnected||this.doDisconnect(Vo.OFFLINE,"OfflineListener")})))}destroyOnlineListener(){this.logger.log("clientsocketV1::onlineListener:destroy"),ro.net.offNetworkStatusChange(),this.hasNetworkListener=!1}disconnect(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(Vo.ACTIVE,"UserActiveDisconnect"),Promise.resolve();default:return Promise.resolve()}}}var Fo=function baseForOwn(e,t){return e&&Ar(e,t,vt)};var Go=function baseInverter(e,t,r,o){return Fo(e,(function(e,i,n){t(o,r(e),i,n)})),o};var jo,Yo,Bo=function createInverter(e,t){return function(r,o){return Go(r,e,t(o),{})}},Ho=Object.prototype.toString,$o=Bo((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ho.call(t)),e[t]=r}),Ye(xe));function formatChatroom(e){var t=Object.assign({},e);return["announcement","broadcastUrl","ext"].forEach((e=>{void 0===t[e]&&(t[e]="")})),["createTime","updateTime","onlineMemberNum"].forEach((e=>{void 0!==t[e]&&(t[e]=parseInt(t[e]))})),["mute"].forEach((e=>{void 0!==t[e]&&(t[e]=1===parseInt(t[e]))})),t}!function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(jo||(jo={})),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(Yo||(Yo={}));var Ko=$o({unset:"-2",restricted:"-1",common:"0",owner:"1",manager:"2",guest:"3",anonymous:"4"});function formatChatroomMember(e){var t=Object.assign({},e),r={tempMuted:!1,tempMuteDuration:0};return Object.keys(r).forEach((e=>{t[e]=t[e]||r[e]})),["chatroomId"].forEach((e=>{void 0!==t[e]&&(t[e]=t[e].toString())})),["level","enterTime","updateTime","tempMuteDuration"].forEach((e=>{void 0!==t[e]&&(t[e]=parseInt(t[e]))})),["online","guest","blacked","muted","valid","tempMuted"].forEach((e=>{void 0!==t[e]&&(t[e]=1===parseInt(t[e]))})),void 0!==t.type&&(t.type=Ko[t.type]),t.avatar,t.online||delete t.enterTime,t.guest&&(t.type="guest",delete t.valid,delete t.guest),"common"!==t.type&&delete t.level,t}function formatChatroomMembers(e){return e&&e.length>0?e.map((e=>formatChatroomMember(e))):[]}var qo={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember",314:"addTempMute",315:"removeTempMute",316:"updateMemberInfo",317:"updateQueue",318:"muteRoom",319:"unmuteRoom",320:"batchUpdateQueue",321:"addTempMuteTag",322:"removeTempMuteTag",323:"deleteChatroomMsg",325:"updateChatroomTags"};function formatChatroomMsg(e,t){var r=__rest(e,["onUploadDone","onUploadProgress","onUploadStart"]);if(["time","userUpdateTime"].forEach((e=>{void 0!==r[e]&&(r[e]=parseInt(r[e]))})),["resend","needAntiSpam","antiSpamUsingYidun","skipHistory","highPriority","clientAntiSpam"].forEach((e=>{void 0!==r[e]&&(r[e]=1===parseInt(r[e]))})),r.type=getEnumKeyByEnumValue(Yo,r.type),r.fromClientType=getEnumKeyByEnumValue(jo,r.fromClientType),r.flow=r.from===t?"out":"in",r.status=r.status||"success","string"==typeof r.body)try{r.body=JSON.parse(r.body)}catch(e){}return"notification"===r.type&&(r.attach=r.body?function formatNotificationBody(e){var t={};if(t.type=qo[e.id]||e.id,!e.data)return e;t=Object.assign(t,e.data);var r={operator:"from",opeNick:"fromNick",target:"to",tarNick:"toNick"};if(Object.keys(r).forEach((e=>{void 0!==t[e]&&(t[r[e]]=t[e],delete t[e])})),["muteDuration"].forEach((e=>{void 0!==t[e]&&(t[e]=parseInt(t[e]))})),!t.queueChange)return t;var o={};try{o=JSON.parse(t.queueChange)}catch(e){return t}switch(o._e){case"OFFER":o={type:"OFFER",elementKey:o.key,elementValue:o.content};break;case"POLL":o={type:"POLL",elementKey:o.key,elementValue:o.content};break;case"DROP":o={type:"DROP"};break;case"PARTCLEAR":case"BATCH_UPDATE":o={type:o._e,elementKv:o.kvObject}}return t.queueChange=o,t}(r.body):{},r.body=""),r}function formatChatroomMsgs(e,t){return e&&e.length>0?e.map((e=>formatChatroomMsg(e,t))):[]}var Wo={1:{code:"chatroomClosed",message:"Chatroom is closed"},2:{code:"managerKick",message:"Kicked out by owners or administrators"},3:{code:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},4:{code:"silentlyKick",message:"Quietly kicked"},5:{code:"blacked",message:"Was blacklisted"}};class V1AuthAuthenticatorService{constructor(e){this.core=e}verifyAuthentication(e=!1){return __awaiter(this,void 0,void 0,(function*(){var t=this.core.options,r=ro.getSystemInfo(),o=Object.assign(Object.assign({},t),{appLogin:e?0:1,deviceId:this.core.config.deviceId,clientSession:this.core.config.clientSession,clientType:16,protocolVersion:1,sdkVersion:100400,sdkHumanVersion:"10.4.0",os:r.os,browser:r.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.4.0":r.userAgent.slice(0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:r.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:r.hostEnvEnum}),i=Object.assign(Object.assign({},t),{appkey:t.appkey,account:t.account,deviceId:this.core.config.deviceId,clientSession:this.core.config.clientSession,appLogin:1});t.isAnonymous&&(i.isAnonymous=1,i.account=i.account||`nimanon_${bt()}`,o.account=i.account,i.chatroomNick=i.account||`nimanon_${bt()}`,i.chatroomAvatar=i.chatroomAvatar||" "),t.tags&&t.tags.length>0&&(i.tags=JSON.stringify(t.tags));var n=yield this.core.clientSocket.sendCmd("chatroomLogin",{type:1,chatroomLogin:i,chatroomIMLogin:o});return this.core.status="logined",{chatroom:formatChatroom(n.content.chatroom),member:formatChatroomMember(n.content.chatroomMember)}}))}}class ChatroomAuthService extends Service{constructor(e){super("chatroomAuth",e),this.account="",this.token="",this.deviceId="",this.isManualLoginAttempt=!1,this.authenticatorService=new V1AuthAuthenticatorService(e)}login(e={}){return __awaiter(this,void 0,void 0,(function*(){e.isAutoReconnect||(this.isManualLoginAttempt=!0);var t=Date.now(),r=yield this._connect(e);this.core.abtest.abtRequest();try{yield this.doLogin(e.isAutoReconnect,r,t),this.isManualLoginAttempt=!1}catch(e){throw this.isManualLoginAttempt=!1,e}}))}_connect(e={}){return __awaiter(this,void 0,void 0,(function*(){if(!/^(unconnected|waitReconnect)$/.test(this.core.status)){var t=`Chatroom status is ${this.core.status}, and would not connect`;return this.logger.warn(t),Promise.reject(t)}this.core.clientSocket.beforeConnect();var r=e.isAutoReconnect||!1;return yield this.core.clientSocket.connect({linkUrls:this.core.options.chatroomAddresses,isAutoReconnect:r})}))}doLogin(e=!1,t,r){return __awaiter(this,void 0,void 0,(function*(){var o;try{o=yield this.authenticatorService.verifyAuthentication(e);var{net_connect:i}=yield ro.net.getNetworkStatus();this.core.status="logined",this.core.reporter.report("chatroomLogin",{accid:this.core.account,roomId:this.core.options.chatroomId,serverIps:this.core.options.chatroomAddresses,currentServerIp:t,rt:Date.now()-r,result:200,failReason:"",time:Date.now(),net_connect:i})}catch(e){this.logger.error("chatroom login error",e);var n=fr(e,"error.code")||fr(e,"code")||408,s=fr(e,"error.message")||fr(e,"message")||"login failed",{net_connect:a}=yield ro.net.getNetworkStatus();if(this.core.reporter.report("chatroomLogin",{accid:this.core.account,roomId:this.core.options.chatroomId,serverIps:this.core.options.chatroomAddresses,currentServerIp:t,rt:Date.now()-r,result:n,failReason:s,time:Date.now(),net_connect:a}),this.core.clientSocket.doDisconnect(Vo.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed"),this.isManualLoginAttempt)throw e;return}try{yield this.core.cloudStorage.init()}catch(e){this.logger.error("NIM:login cloudStorage init failed ",e)}this.core.eventBus.emit("logined",o),this.core.emit("logined",o),this.core.clientSocket.resetConnectStatus(),this.core.clientSocket.ping(),this.core.timeOrigin.setOriginTimetick()}))}beKickedFromChatroomHandler(e){var t=e.content,{reason:r,ext:o}=t,i=function formatKickedReason(e){var t=Wo[e];return{reason:t?t.code:"unknow",message:t?t.message:"Unknown reason"}}(r);this.logger.warn("beKickedFromChatroomHandler:: ",i.reason,i.message,o),this.core.clientSocket.doDisconnect(Vo.KICKED,i)}}class ChatroomService extends Service{constructor(e){super("chatroom",e)}getInfo(){var e;return __awaiter(this,void 0,void 0,(function*(){var t=yield this.core.sendCmd("getChatroom");return formatChatroom(null===(e=t.content)||void 0===e?void 0:e.chatroom)}))}updateInfo(e){return __awaiter(this,void 0,void 0,(function*(){validate({chatroom:{type:"object",rules:{name:{type:"string",required:!1},announcement:{type:"string",required:!1},broadcastUrl:{type:"string",required:!1},ext:{type:"string",required:!1},queuelevel:{type:"number",min:0,max:1,required:!1}}},needNotify:{type:"boolean"},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("updateChatroom",Object.assign(Object.assign({},e),{ext:e.ext||""}))}))}updateChatroomTagHandler(e){var t,r=e.content;this.logger.log("updateChatroomTagHandler:: ",r);var o=null===(t=null==r?void 0:r.updateTags)||void 0===t?void 0:t.currentTags;try{o=JSON.parse(o)}catch(e){this.logger.error("updateChatroomTagHandler:: ",e)}this.core.emit("tagsUpdate",o)}}var zo,Jo,Qo={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},Xo={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function getUploadResponseFormat(e="file"){var t=Qo[e]||{};return JSON.stringify(t).replace(/"/gi,'\\"')}!function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(zo||(zo={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(Jo||(Jo={}));var Zo={chunkUploadHost:"https://wannos-web.127.net",commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};var ei=function arraySome(e,t){for(var r=-1,o=null==e?0:e.length;++r<o;)if(t(e[r],r,e))return!0;return!1};var ti=function equalArrays(e,t,r,o,i,n){var s=1&r,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var l=n.get(e),_=n.get(t);if(l&&_)return l==t&&_==e;var d=-1,u=!0,E=2&r?new Eo:void 0;for(n.set(e,t),n.set(t,e);++d<a;){var h=e[d],m=t[d];if(o)var p=s?o(m,h,d,t,e,n):o(h,m,d,e,t,n);if(void 0!==p){if(p)continue;u=!1;break}if(E){if(!ei(t,(function(e,t){if(!Io(E,t)&&(h===e||i(h,e,r,o,n)))return E.push(t)}))){u=!1;break}}else if(h!==m&&!i(h,m,r,o,n)){u=!1;break}}return n.delete(e),n.delete(t),u};var ri=function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e,o){r[++t]=[o,e]})),r},oi=ne?ne.prototype:void 0,ii=oi?oi.valueOf:void 0;var ni=function equalByTag(e,t,r,o,i,n,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!n(new Cr(e),new Cr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ve(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=ri;case"[object Set]":var c=1&o;if(a||(a=Po),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;o|=2,s.set(e,t);var _=ti(a(e),a(t),o,i,n,s);return s.delete(e),_;case"[object Symbol]":if(ii)return ii.call(e)==ii.call(t)}return!1};var si=function arrayPush(e,t){for(var r=-1,o=t.length,i=e.length;++r<o;)e[i+r]=t[r];return e};var ai=function baseGetAllKeys(e,t,r){var o=t(e);return lt(e)?o:si(o,r(e))};var ci=function arrayFilter(e,t){for(var r=-1,o=null==e?0:e.length,i=0,n=[];++r<o;){var s=e[r];t(s,r,e)&&(n[i++]=s)}return n};var li=function stubArray(){return[]},_i=Object.prototype.propertyIsEnumerable,di=Object.getOwnPropertySymbols,ui=di?function(e){return null==e?[]:(e=Object(e),ci(di(e),(function(t){return _i.call(e,t)})))}:li;var Ei=function getAllKeys(e){return ai(e,vt,ui)},hi=Object.prototype.hasOwnProperty;var mi=function equalObjects(e,t,r,o,i,n){var s=1&r,a=Ei(e),c=a.length;if(c!=Ei(t).length&&!s)return!1;for(var l=c;l--;){var _=a[l];if(!(s?_ in t:hi.call(t,_)))return!1}var d=n.get(e),u=n.get(t);if(d&&u)return d==t&&u==e;var E=!0;n.set(e,t),n.set(t,e);for(var h=s;++l<c;){var m=e[_=a[l]],p=t[_];if(o)var g=s?o(p,m,_,t,e,n):o(m,p,_,e,t,n);if(!(void 0===g?m===p||i(m,p,r,o,n):g)){E=!1;break}h||(h="constructor"==_)}if(E&&!h){var T=e.constructor,f=t.constructor;T==f||!("constructor"in e)||!("constructor"in t)||"function"==typeof T&&T instanceof T&&"function"==typeof f&&f instanceof f||(E=!1)}return n.delete(e),n.delete(t),E},pi=Pe(ie,"DataView"),gi=Pe(ie,"Promise"),Ti=Pe(ie,"WeakMap"),fi="[object Map]",Ii="[object Promise]",Ni="[object Set]",Mi="[object WeakMap]",Oi="[object DataView]",yi=Me(pi),Si=Me(Xt),vi=Me(gi),Ai=Me(Co),Ri=Me(Ti),Ci=he;(pi&&Ci(new pi(new ArrayBuffer(1)))!=Oi||Xt&&Ci(new Xt)!=fi||gi&&Ci(gi.resolve())!=Ii||Co&&Ci(new Co)!=Ni||Ti&&Ci(new Ti)!=Mi)&&(Ci=function(e){var t=he(e),r="[object Object]"==t?e.constructor:void 0,o=r?Me(r):"";if(o)switch(o){case yi:return Oi;case Si:return fi;case vi:return Ii;case Ai:return Ni;case Ri:return Mi}return t});var bi=Ci,Pi="[object Arguments]",Di="[object Array]",ki="[object Object]",Vi=Object.prototype.hasOwnProperty;var Li=function baseIsEqualDeep(e,t,r,o,i,n){var s=lt(e),a=lt(t),c=s?Di:bi(e),l=a?Di:bi(t),_=(c=c==Pi?ki:c)==ki,d=(l=l==Pi?ki:l)==ki,u=c==l;if(u&&dt(e)){if(!dt(t))return!1;s=!0,_=!1}if(u&&!_)return n||(n=new Sr),s||gt(e)?ti(e,t,r,o,i,n):ni(e,t,c,r,o,i,n);if(!(1&r)){var E=_&&Vi.call(e,"__wrapped__"),h=d&&Vi.call(t,"__wrapped__");if(E||h){var m=E?e.value():e,p=h?t.value():t;return n||(n=new Sr),i(m,p,r,o,n)}}return!!u&&(n||(n=new Sr),mi(e,t,r,o,i,n))};var wi=function baseIsEqual(e,t,r,o,i){return e===t||(null==e||null==t||!rt(e)&&!rt(t)?e!=e&&t!=t:Li(e,t,r,o,baseIsEqual,i))};var Ui=function baseIsMatch(e,t,r,o){var i=r.length,n=i,s=!o;if(null==e)return!n;for(e=Object(e);i--;){var a=r[i];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<n;){var c=(a=r[i])[0],l=e[c],_=a[1];if(s&&a[2]){if(void 0===l&&!(c in e))return!1}else{var d=new Sr;if(o)var u=o(l,_,c,e,t,d);if(!(void 0===u?wi(_,l,3,o,d):u))return!1}}return!0};var xi=function isStrictComparable(e){return e==e&&!me(e)};var Fi=function getMatchData(e){for(var t=vt(e),r=t.length;r--;){var o=t[r],i=e[o];t[r]=[o,i,xi(i)]}return t};var Gi=function matchesStrictComparable(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}};var ji=function baseMatches(e){var t=Fi(e);return 1==t.length&&t[0][2]?Gi(t[0][0],t[0][1]):function(r){return r===e||Ui(r,e,t)}};var Yi=function baseHasIn(e,t){return null!=e&&t in Object(e)};var Bi=function hasPath(e,t,r){for(var o=-1,i=(t=pr(t,e)).length,n=!1;++o<i;){var s=gr(t[o]);if(!(n=null!=e&&r(e,s)))break;e=e[s]}return n||++o!=i?n:!!(i=null==e?0:e.length)&&We(i)&&Qe(s,i)&&(lt(e)||ct(e))};var Hi=function hasIn(e,t){return null!=e&&Bi(e,t,Yi)};var $i=function baseMatchesProperty(e,t){return Vt(e)&&xi(t)?Gi(gr(e),t):function(r){var o=fr(r,e);return void 0===o&&o===t?Hi(r,e):wi(t,o,3)}};var Ki=function baseProperty(e){return function(t){return null==t?void 0:t[e]}};var qi=function basePropertyDeep(e){return function(t){return Tr(t,e)}};var Wi=function property(e){return Vt(e)?Ki(gr(e)):qi(e)};var zi=function baseIteratee(e){return"function"==typeof e?e:null==e?xe:"object"==typeof e?lt(e)?$i(e[0],e[1]):ji(e):Wi(e)};var Ji=function baseSet(e,t,r,o){if(!me(e))return e;for(var i=-1,n=(t=pr(t,e)).length,s=n-1,a=e;null!=a&&++i<n;){var c=gr(t[i]),l=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=s){var _=a[c];void 0===(l=o?o(_,c,a):void 0)&&(l=me(_)?_:Qe(t[i+1])?[]:{})}we(a,c,l),a=a[c]}return e};var Qi=function basePickBy(e,t,r){for(var o=-1,i=t.length,n={};++o<i;){var s=t[o],a=Tr(e,s);r(a,s)&&Ji(n,pr(s,e),a)}return n},Xi=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)si(t,ui(e)),e=Lr(e);return t}:li;var Zi=function getAllKeysIn(e){return ai(e,Wr,Xi)};var en=function pickBy(e,t){if(null==e)return{};var r=dr(Zi(e),(function(e){return[e]}));return t=zi(t),Qi(e,r,(function(e,r){return t(e,r[0])}))};class NOS{constructor(e,t){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=e,this.cloudStorage=t}get config(){return this.cloudStorage.config}reset(){this.nosErrorCount=0}getNosAccessToken(e){return __awaiter(this,void 0,void 0,(function*(){var t=yield this.core.sendCmd("getNosAccessToken",{tag:e}),r=fr(t,"content.nosAccessTokenTag.token"),o=e.url;return{token:r,url:-1!==o.indexOf("?")?o+"&token="+r:o+"?token="+r}}))}deleteNosAccessToken(e){return __awaiter(this,void 0,void 0,(function*(){yield this.core.sendCmd("deleteNosAccessToken",{tag:e})}))}nosUpload(e,t){var r,o,i,n,s,a,c,l;return __awaiter(this,void 0,void 0,(function*(){var _=fr(this.core,"config.cdn.bucket"),d={tag:e.nosScenes||_||"nim"};e.nosSurvivalTime&&(d.expireSec=e.nosSurvivalTime);var u,E=this.core.adapters.getFileUploadInformation(e);if(!t&&!E)try{u=yield this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(e.type),nosToken:d})}catch(e){if(this.core.logger.error("uploadFile:: getNosToken error",e),e instanceof V2NIMErrorImpl)throw e;throw new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:e,curProvider:1}})}var h=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",E?null===(r=E.uploadInfo)||void 0===r?void 0:r.objectName:t?null==t?void 0:t.objectName:u.content.nosToken.objectName),m="";t&&t.shortUrl&&(m=t.shortUrl),(null===(n=null===(i=null===(o=null==E?void 0:E.uploadInfo)||void 0===o?void 0:o.payload)||void 0===i?void 0:i.mixStoreToken)||void 0===n?void 0:n.shortUrl)&&(m=E.uploadInfo.payload.mixStoreToken.shortUrl);var p,g=m||h;try{var T=E?{token:null===(s=null==E?void 0:E.uploadInfo)||void 0===s?void 0:s.token,bucket:null===(a=null==E?void 0:E.uploadInfo)||void 0===a?void 0:a.bucketName,objectName:null===(c=null==E?void 0:E.uploadInfo)||void 0===c?void 0:c.objectName}:t||u.content.nosToken;this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:T,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:ro.platform});var f="BROWSER"===ro.platform?this.config.chunkUploadHost:`${this.config.commonUploadHost}/${T&&T.bucket}`;this.core.reporterHookCloudStorage.update({remote_addr:f,operation_type:t?2:0}),p=yield this.core.adapters.uploadFile(Object.assign(Object.assign(Object.assign({},e),{nosToken:T,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:e.maxSize||this.config.chunkMaxSize}),t?{payload:{mixStoreToken:t}}:{}))}catch(r){this.core.logger.error("uploadFile::nos uploadFile error:",r);var I="v2"===fr(this.core,"options.apiVersion");if(r.code===Z.V2NIM_ERROR_CODE_CANCELLED||10499===r.errCode)throw new UploadError({code:I?Z.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:fr(r,"message")||"Request abort",rawError:r,curProvider:1}});if(I&&r.errCode===Z.V2NIM_ERROR_CODE_FILE_OPEN_FAILED)throw new V2NIMErrorImpl({code:Z.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:fr(r,"message")||"Read file failed",rawError:r,curProvider:1}});var{net_connect:N}=yield ro.net.getNetworkStatus();if(!1===N)throw new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:r,curProvider:1}});if(t){if(0===this.nosErrorCount){try{this.cloudStorage.mixStorage._addCircuitTimer()}catch(t){throw new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:t,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:e.file||e.filePath}})}return this.nosErrorCount=fr(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),this.cloudStorage._uploadFile(e)}return this.nosErrorCount--,this.nosUpload(e,t)}throw new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:r,curProvider:1}})}var M=null==p?void 0:p.type,O=M&&M.indexOf("/")>-1?M.slice(0,M.indexOf("/")):"";O||(O=e.type||"");var y,S={image:"imageInfo",video:"vinfo",audio:"vinfo"};if(!S[O])return Object.assign({url:g},p);try{y=yield this.core.adapters.request(`${h}?${S[O]}`,{method:"GET",dataType:"json",timeout:5e3},{exception_service:3})}catch(e){return this.core.logger.error("uploadFile:: fetch file info error",e),Object.assign({url:g},p)}if(y){var{data:v}=y,A="imageInfo"===S[O]?v:null===(l=null==v?void 0:v.GetVideoInfo)||void 0===l?void 0:l.VideoInfo,R={url:g,name:p.name,size:p.size,ext:p.ext,w:null==A?void 0:A.Width,h:null==A?void 0:A.Height,orientation:null==A?void 0:A.Orientation,dur:null==A?void 0:A.Duration,audioCodec:null==A?void 0:A.AudioCodec,videoCodec:null==A?void 0:A.VideoCodec,container:null==A?void 0:A.Container};return en(R,(function(e,t){return void 0!==t}))}return Object.assign({url:g},p)}))}_getNosCdnHost(){var e;return __awaiter(this,void 0,void 0,(function*(){var t;try{t=yield this.core.sendCmd("getNosCdnHost")}catch(e){return void this.core.logger.error("getNosCdnHost::error",e)}if(t){var r=null===(e=null==t?void 0:t.content)||void 0===e?void 0:e.nosConfigTag,o=parseInt(null==r?void 0:r.expire);0!==o&&r.cdnDomain?-1===o?(this.config.cdn.bucket=r.bucket,this.config.cdn.cdnDomain=r.cdnDomain,this.config.cdn.objectNamePrefix=r.objectNamePrefix):(this.config.cdn.bucket=r.bucket,this.config.cdn.cdnDomain=r.cdnDomain,this.config.cdn.objectNamePrefix=r.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((()=>{this._getNosCdnHost()}),1e3*o)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="")}}))}}var tn,rn={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},nn={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},sn={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:nn.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:$o(nn.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:nn.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:$o(nn.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:$o(nn.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:$o(nn.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:$o(nn.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:nn.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:$o(nn.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:nn.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:$o(nn.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:nn.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:$o(nn.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:nn.nosAccessTokenTag}]}};class MixStorage{constructor(e,t){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=zo.nos,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=e,this.cloudStorage=t,this.logger=e.logger}reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=zo.nos,this.mixStoreErrorCount=10}getGrayscaleConfig(e){var t;return __awaiter(this,void 0,void 0,(function*(){if(ro.localStorage)try{ro.localStorage.getItem&&ro.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(ro.localStorage.getItem(this.GRAYKEY))[e])}catch(e){ro.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",e)}if(!this.grayConfig||this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime()){var r=yield this.core.sendCmd("getGrayscaleConfig",{config:{}});if(r.content&&r.content.grayConfigTag){this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(r.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(r.content.grayConfigTag.ttl)}catch(e){this.logger.error("getGrayscaleConfig error",e)}if(!this.grayConfig)return;var o=ro.localStorage.getItem(this.GRAYKEY)?JSON.parse(ro.localStorage.getItem(this.GRAYKEY)):{};this.grayConfig.timeStamp=(new Date).getTime(),o[e]=this.grayConfig,ro.localStorage.setItem(this.GRAYKEY,JSON.stringify(o))}else this.logger.debug("uploadFile:: result grayConfig:",r.content)}(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable)&&(yield this._getMixStorePolicy(e))}))}_getMixStorePolicy(e){return __awaiter(this,void 0,void 0,(function*(){var t=(new Date).getTime();if(ro.localStorage)try{if(this.mixStorePolicy=JSON.parse(ro.localStorage.getItem(this.MIXSTOREKEY))[e],this.curProvider=parseInt(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>t){var r=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-t;this.core.timerManager.addTimer(this._getMixStorePolicy.bind(this,e),r)}}catch(t){ro.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(ro.localStorage.getItem(this.MIXSTOREKEY))[e]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",t)}if(!this.mixStorePolicy||this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=t)try{var o=(yield this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]})).content.mixStorePolicyTag;this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(o.ttl),this.mixStorePolicy.providers=o.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=parseInt(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=o.nosPolicy?JSON.parse(o.nosPolicy):null,this.mixStorePolicy.s3Policy=o.s3Policy?JSON.parse(o.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(this._getMixStorePolicy.bind(this,e),1e3*this.mixStorePolicy.ttl);var i=ro.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(ro.localStorage.getItem(this.MIXSTOREKEY)):{};this.mixStorePolicy.timeStamp=(new Date).getTime(),i[e]=this.mixStorePolicy,ro.localStorage.setItem(this.MIXSTOREKEY,JSON.stringify(i))}catch(t){if(this.logger.error("getMixStorePolicy error",t),0===this.mixStoreErrorCount)throw new Error("getMixStorePolicy all count error");this._getMixStorePolicy(e),this.mixStoreErrorCount--}this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry)}))}_addCircuitTimer(){var e=this.mixStorePolicy.providers,t=e[(e.indexOf(String(this.curProvider))+1)%e.length];if(!t)throw new Error("uploadFile nextProvider error");if(t===e[0])throw new Error("uploadFile all policy fail");if(this.logger.log(`uploadFile:: upload policy will change,now policy:${this.curProvider} nextProvider:${t}`),this.curProvider=parseInt(t),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var r=this.mixStorePolicy[this.curProvider===zo.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!r||0===r)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((()=>{this.logger.log(`uploadFile:: upload policy will change,now policy:${this.curProvider} nextProvider:${parseInt(this.mixStorePolicy.providers[0])}`),this.curProvider=parseInt(this.mixStorePolicy.providers[0]),this.core.timerManager.deleteTimer(this.circuitTimer)}),1e3*r)}throw new Error("uploadFile will not retry again")}getFileAuthToken(e){return __awaiter(this,void 0,void 0,(function*(){return(yield this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:e})).content.mixStoreAuthTokenResTag}))}}class AWS{constructor(e,t){this.s3=null,this.core=e,this.cloudStorage=t,this.logger=e.logger}get mixStorePolicy(){return this.cloudStorage.mixStorage.mixStorePolicy}s3Upload(e,t){return __awaiter(this,void 0,void 0,(function*(){var r;if(e.file)r=e.file;else if("string"==typeof e.fileInput){this.logger.warn("fileInput will abandon,Please use file or filepath");var o=document.getElementById(e.fileInput);if(!(o&&o.files&&o.files[0]))throw new Error("Can not get file from fileInput");r=o.files[0]}else{if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0]))throw new Error(`Can not get file from fileInput ${e.fileInput}`);r=e.fileInput.files[0]}if(!this.mixStorePolicy.s3Policy)throw new Error("dont get s3 policy");var i={accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,sessionToken:t.sessionToken,region:t.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},n=new(0,this.s3);n.config.update(i);var s=decodeURIComponent(t.bucket),a=decodeURIComponent(t.objectName),c=r,l={Bucket:s,Key:a,Body:c,Metadata:{token:t.token},ContentType:c.type||"application/octet-stream"};this.core.logger.debug("uploadFile:: s3 upload params:",l);var _=n.upload(l);return _.on("httpUploadProgress",(t=>{var r=parseFloat((t.loaded/t.total).toFixed(2));e.onUploadProgress&&e.onUploadProgress({total:t.total,loaded:t.loaded,percentage:r,percentageText:Math.round(100*r)+"%"})})),new Promise(((r,o)=>{var i=(new Date).getTime();_.send(((n,l)=>__awaiter(this,void 0,void 0,(function*(){var _,d,u;if(n&&"RequestAbortedError"===n.code)this.logger.error("uploadFile:","api::s3:upload file abort.",n),o(new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:n,curProvider:2}}));else{if(!n){var E=this.mixStorePolicy.s3Policy.cdnSchema;E=E.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn),this.core.reporterHookCloudStorage.update({remote_addr:E,operation_type:1}),E=E.replace("{objectName}",l.Key);var h={size:c.size,name:c.name,url:t.shortUrl?t.shortUrl:E,ext:c.name.split(".")[1]||"unknown"},m=e.type||"",p={image:"imageInfo"};return r(p[m]?yield this.getS3FileInfo({url:E,infoSuffix:p[m],s3Result:h}):h)}this.logger.error("uploadFile:","api::s3:upload file failed.",n),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(d=null===(_=this.core)||void 0===_?void 0:_.auth)||void 0===d?void 0:d.account),trace_id:null===(u=this.core.clientSocket.socket)||void 0===u?void 0:u.sessionId,start_time:i,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof n.status?n.status:"number"==typeof n.code?n.code:0,description:n.message||`${n.code}`,operation_type:1,target:JSON.stringify({bucket:s,object:a})},{asyncParams:ro.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1);var{net_connect:g}=yield ro.net.getNetworkStatus();if(!1===g)return o(new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:n,curProvider:this.cloudStorage.mixStorage.curProvider}}));try{this.cloudStorage.mixStorage._addCircuitTimer()}catch(t){return o(new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:t,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:e.file||e.filePath}}))}r(this.cloudStorage._uploadFile(e))}})))),e.onUploadStart&&e.onUploadStart(_)}))}))}getS3FileInfo(e){var t;return __awaiter(this,void 0,void 0,(function*(){var r,{url:o,infoSuffix:i,s3Result:n}=e;try{r=yield this.core.adapters.request(`${o}?${i}`,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3})}catch(e){return this.core.logger.error("uploadFile:: fetch file info error",e),n}if(r){var{data:s}=r,a="imageInfo"===i?s:null===(t=null==s?void 0:s.GetVideoInfo)||void 0===t?void 0:t.VideoInfo,c=Object.assign(Object.assign({},n),{w:null==a?void 0:a.Width,h:null==a?void 0:a.Height,orientation:null==a?void 0:a.Orientation,dur:null==a?void 0:a.Duration,audioCodec:null==a?void 0:a.AudioCodec,videoCodec:null==a?void 0:a.VideoCodec,container:null==a?void 0:a.Container});return en(c,(function(e,t){return void 0!==t}))}return this.core.logger.error("uploadFile:: fetch s3 file info no result",`${o}?${i}`),n}))}}class CloudStorageService{constructor(e,t={}){this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=e.logger,this.core=e,this.nos=new NOS(e,this),this.mixStorage=new MixStorage(e,this),this.aws=new AWS(e,this),registerParser({cmdMap:rn,cmdConfig:sn}),this.setOptions(t),this.setListeners()}setOptions(e={}){var t=e.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=t+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=t+"-AllMixStorePolicy";var{s3:r}=e,o=__rest(e,["s3"]),i=Object.assign({},Zo,this.config);if(o&&Object.prototype.hasOwnProperty.call(o,"cdn")){var n=Object.assign(Object.assign({},i.cdn),o.cdn);this.config=Object.assign({},i,o),this.config.cdn=n}else this.config=Object.assign({},i,o);r&&(this.aws.s3=r)}setListeners(){this.core.eventBus.on("kicked",this._clearUnCompleteTask.bind(this)),this.core.eventBus.on("disconnect",this._clearUnCompleteTask.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",this._clearUnCompleteTask.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",this._clearUnCompleteTask.bind(this))}_clearUnCompleteTask(){Object.keys(this.uploadTaskMap).forEach((e=>{var t=this.uploadTaskMap[e];t&&t.abort&&t.abort()})),this.uploadTaskMap={}}init(){return __awaiter(this,void 0,void 0,(function*(){this.mixStorage.reset(),this.nos.reset(),this.config.isNeedToGetUploadPolicyFromServer&&(yield this.mixStorage.getGrayscaleConfig(this.core.options.appkey)),yield this.nos._getNosCdnHost()}))}processCallback(e,t){var r=e.onUploadProgress,o=e.onUploadDone,i=e.onUploadStart;return{onUploadStart:"function"==typeof i?e=>{this.uploadTaskMap[t]=e;try{i(e)}catch(e){this.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",e)}}:e=>{this.uploadTaskMap[t]=e},onUploadProgress:"function"==typeof r?e=>{this.core.reporterHookCloudStorage.update({transferred_size:e.loaded});try{r(e)}catch(e){this.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",e)}}:e=>{this.core.reporterHookCloudStorage.update({transferred_size:e.loaded})},onUploadDone:"function"==typeof o?e=>{this.core.reporterHookCloudStorage.end(0);try{o(e)}catch(e){this.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",e)}}:()=>{this.core.reporterHookCloudStorage.end(0)},taskKey:t}}uploadFile(e){return __awaiter(this,void 0,void 0,(function*(){if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},e),!e.fileInput&&!e.file&&!e.filePath)throw new Error("uploadFile needs target file object or a filePath");if(e.type&&"file"!==e.type){var t=fr(e,"file.type");if(t&&"string"==typeof t&&-1===t.indexOf(e.type))throw new Error(`The meta type "${t}" does not match "${e.type}"`)}if(this.core.reporterHookCloudStorage.start(),e.file)this.core.reporterHookCloudStorage.update({full_size:e.file.size});else if("string"==typeof e.fileInput){var r=document.getElementById(e.fileInput);r&&r.files&&r.files[0]&&this.core.reporterHookCloudStorage.update({full_size:r.files[0].size})}else e.fileInput&&e.fileInput.files&&e.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:e.fileInput.files[0].size});var o=bt(),{onUploadStart:i,onUploadProgress:n,onUploadDone:s}=this.processCallback(e,o);e.onUploadStart=i,e.onUploadProgress=n,e.onUploadDone=s;var a=null;try{a=yield this._uploadFile(e),e.md5&&(a.md5=e.md5),delete this.uploadTaskMap[o]}catch(e){throw delete this.uploadTaskMap[o],this.core.reporterHookCloudStorage.end((e&&e.code)===Z.V2NIM_ERROR_CODE_CANCELLED?3:1),e}return a&&(a.size=void 0===a.size?void 0:Number(a.size),a.w=void 0===a.w?void 0:Number(a.w),a.h=void 0===a.h?void 0:Number(a.h),a.dur=void 0===a.dur?void 0:Number(a.dur)),a.url=decodeURIComponent(a.url),e.onUploadDone({size:a.size,name:a.name,url:a.url,ext:a.name.split(".")[1]||"unknown"}),a}))}_uploadFile(e){var t,r;return __awaiter(this,void 0,void 0,(function*(){if(!fr(this.mixStorage,"grayConfig.mixStoreEnable")||!fr(this.mixStorage,"mixStorePolicy.providers.length"))return this.logger.log("uploadFile:: uploadFile begin, use old nos"),this.nos.nosUpload(e);this.logger.log(`uploadFile::_uploadFile, grayConfig enable:${fr(this.mixStorage,"grayConfig.mixStoreEnable")} curProvider:${fr(this.mixStorage,"curProvider")}`);var o=this.core.adapters.getFileUploadInformation(e),i=!0;o?!1===o.complete&&this.mixStorage.curProvider===zo.s3&&(i=!1):i=!1,this.aws.s3||(this.mixStorage.curProvider=zo.nos);var n=Xo;if(!i)try{n=(yield this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:e.nosSurvivalTime,returnBody:getUploadResponseFormat(e.type)}})).content.mixStoreTokenResTag}catch(e){if(this.core.logger.error("uploadFile:: getMixStoreToken error",e),e instanceof V2NIMErrorImpl)throw e;throw new UploadError({code:"v2"===fr(this.core,"options.apiVersion")?Z.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:e,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}})}return i?this.nos.nosUpload(e,null===(r=null===(t=null==o?void 0:o.uploadInfo)||void 0===t?void 0:t.payload)||void 0===r?void 0:r.mixStoreToken):this.mixStorage.curProvider===zo.s3?this.aws.s3Upload(e,n):this.nos.nosUpload(e,n)}))}getThumbUrl(e,t){var r,o,i,n,s;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var[a,c,l,_,d,u,E,h]=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);if(null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var m=this._getUrlType(e);if(m===zo.s3&&this.mixStorePolicy.s3Policy&&fr(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(i=null===(o=this.mixStorePolicy.s3Policy)||void 0===o?void 0:o.thumbPolicy)||void 0===i?void 0:i.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",u).replace("{x}",t.width.toString()).replace("{y}",t.height.toString());if(m===zo.nos&&this.mixStorePolicy.nosPolicy&&fr(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(s=null===(n=this.mixStorePolicy.nosPolicy)||void 0===n?void 0:n.thumbPolicy)||void 0===s?void 0:s.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",u).replace("{x}",t.width.toString()).replace("{y}",t.height.toString())}return e.includes("?")?e+`&imageView&thumbnail=${t.width}x${t.height}`:e+`?imageView&thumbnail=${t.width}x${t.height}`}getVideoCoverUrl(e,t){var r,o,i,n,s;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var[a,c,l,_,d,u,E,h]=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);if(null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var m=this._getUrlType(e);if(m===zo.s3&&this.mixStorePolicy.s3Policy&&fr(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(i=null===(o=this.mixStorePolicy.s3Policy)||void 0===o?void 0:o.thumbPolicy)||void 0===i?void 0:i.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",u).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png");if(m===zo.nos&&this.mixStorePolicy.nosPolicy&&fr(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(s=null===(n=this.mixStorePolicy.nosPolicy)||void 0===n?void 0:n.thumbPolicy)||void 0===s?void 0:s.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",u).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png")}return e.includes("?")?e+`&vframe&offset=0&resize=${t.width}x${t.height}&type=png`:e+`?vframe&offset=0&resize=${t.width}x${t.height}&type=png`}getPrivateUrl(e){var t;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),"";var[r,o,i,n,s,a,c,l]=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);if(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable){var _=this._getUrlType(e);return _===zo.s3&&this.mixStorePolicy.s3Policy&&(e=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",a)),_===zo.nos&&this.mixStorePolicy.nosPolicy&&(e=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",a)),e}var{downloadUrl:d,downloadHostList:u,nosCdnEnable:E}=this.config,h=this.config.cdn.cdnDomain,m=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",p=decodeURIComponent(a),g=p.indexOf(m);if(h&&g>-1&&E)return`${o}${h}/${p.slice(g)}`;if(u.includes(n)&&a.includes("/")){var T=a.indexOf("/"),f=a.substring(0,T),I=a.substring(T+1);return d.replace("{bucket}",f).replace("{object}",I)}var N=u.filter((e=>"string"==typeof n&&n.includes(e)))[0],M=N?n.replace(N,"").replace(/\W/g,""):null;return M?d.replace("{bucket}",M).replace("{object}",a):e}getOriginUrl(e){return __awaiter(this,void 0,void 0,(function*(){return"string"==typeof e&&e.includes("_im_url=1")?(yield this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:e}})).content.nosSafeUrlTag.originUrl:e}))}getFileToken(e){return __awaiter(this,void 0,void 0,(function*(){validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},e);var t=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,r=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null;if(t===String(Jo.dontNeed)&&r===String(Jo.dontNeed))throw this.logger.error("don't need token"),new Error("don't need token");if(e.type===Jo.time){if(t&&t.indexOf(String(Jo.time))>=0||r&&r.indexOf(String(Jo.time))>0)return this.mixStorage.getFileAuthToken(e);throw this.logger.error("don't support time token "),new Error("don't support type time token ")}if(!e.urls||!e.urls.length)throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");var o=[],i=[];if(e.urls.forEach((e=>{var t=this._getUrlType(e);t===zo.nos&&i.push(e),t===zo.s3&&o.push(e)})),(!r||0!==o.length&&r.indexOf(String(Jo.urls))<0)&&(this.logger.warn("s3 url don't support url token"),o=[]),(!t||0!==i.length&&t.indexOf(String(Jo.urls))<0)&&(this.logger.warn("nos url don't support url token"),i=[]),0===o.length&&0===i.length)throw this.logger.error("not support urls"),new Error("not support urls");if(0===o.length||0===i.length)return e.urls=JSON.stringify(e.urls),this.mixStorage.getFileAuthToken(e)}))}_getUrlType(e){return this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.nosPolicy.dlcdns.some((t=>e.indexOf(t)>=0))?zo.nos:this.mixStorePolicy.s3Policy&&this.mixStorePolicy.s3Policy.dlcdns.some((t=>e.indexOf(t)>=0))?zo.s3:null}getNosAccessToken(e){return validate({url:{type:"string",allowEmpty:!1}},e),this.nos.getNosAccessToken(e)}deleteNosAccessToken(e){return validate({token:{type:"string",allowEmpty:!1}},e),this.nos.deleteNosAccessToken(e)}get grayConfig(){return this.mixStorage.grayConfig}get mixStorePolicy(){return this.mixStorage.mixStorePolicy}process(e){var t=fr(e,"error.detail.ignore");return e.error&&!t?Promise.reject(e.error):Promise.resolve(e)}}class ChatroomMsgService extends Service{constructor(e){super("chatroomMsg",e)}sendTextMsg(e){return validate({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"text"}))}sendGeoLocationMsg(e){return validate({body:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"geo",body:JSON.stringify(e.body)}))}sendTipMsg(e){return __awaiter(this,void 0,void 0,(function*(){return validate({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"tip"}))}))}sendCustomMsg(e){return __awaiter(this,void 0,void 0,(function*(){return validate({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"custom"}))}))}sendImageMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"image"}))}sendFileMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"file"}))}sendAudioMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"audio"}))}sendVideoMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"video"}))}doSendFile(e){return __awaiter(this,void 0,void 0,(function*(){validate({type:{type:"string",allowEmpty:!1},body:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e);var t=e.body;if(!t){if(!this.core.cloudStorage||!this.core.cloudStorage.uploadFile)throw new Error('Service "cloudStorage" does not exist');try{t=yield this.core.cloudStorage.uploadFile(e)}catch(e){throw this.logger.error("sendFile:: upload File error or abort.",e),e}}return this.sendMsg(Object.assign(Object.assign({},e),{body:JSON.stringify(t),type:e.type}))}))}queryMessageHistory(e){return __awaiter(this,void 0,void 0,(function*(){validate({timetag:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e);var t=yield this.core.sendCmd("chatroomQueryMessageHistory",Object.assign(Object.assign({timetag:0,limit:100,reverse:!1},e),{msgTypes:e.msgTypes?e.msgTypes.map((e=>Yo[e])):[]})),{chatroomMsgs:r}=t.content;return formatChatroomMsgs(r,this.core.account)}))}getHistoryMsgsByTags(e){return __awaiter(this,void 0,void 0,(function*(){validate({tags:{type:"array",itemType:"string",required:!0},types:{type:"array",itemType:"string",required:!1},fromTime:{type:"number",min:0,required:!1},toTime:{type:"number",min:0,required:!1},limit:{type:"number",min:0,required:!1},reverse:{type:"number",required:!1}},e);var t=Object.assign(Object.assign({fromTime:0,toTime:0,limit:100,reverse:0},e),{types:e.types?e.types.filter((e=>void 0!==Yo[e])).map((e=>Yo[e])):[]}),r=yield this.core.sendCmd("getHistoryMsgsByTags",{chatRoomTagHistoryMsgRequestTag:Object.assign(t,{tags:JSON.stringify(t.tags),types:JSON.stringify(t.types)})}),{chatroomMsgs:o}=r.content;return formatChatroomMsgs(o,this.core.account)}))}onChatroomMsgHandler(e){var t=e.content,r=formatChatroomMsg(null==t?void 0:t.chatroomMsg,this.core.account);"debug"===this.core.options.debugLevel?this.logger.debug("onChatroomMsgHandler::recvMsg",r.type,r.idClient,r):this.logger.log("onChatroomMsgHandler::recvMsg",r.type,r.idClient),this.core.emit("chatroomMsg",r),"out"!==r.flow&&this.doMsgReceiveReport(r,e)}doMsgReceiveReport(e,t){if(e.from!==this.core.account){var r=fr(e,"__clientExt.statistics.apiCallingTime")||0,o=fr(e,"__clientExt.statistics.sendTime")||0,i=fr(e,"__clientExt.statistics.attachUploadDuration")||0,n=this.core.timeOrigin.getNTPTime(),s=e.time,a=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):n;this.core.reporter.report("msgReceive",{msgId:"",clientId:e.idClient,serverTime:s,receiveTime:a,fromAccid:e.from,toAccid:this.core.account,type:4,roomId:e.chatroomId,apiCallingTime:r,sendTime:o,attachUploadDuration:i,callbackTime:n,preHandleTime:n,result:200,failReason:"",rt:n-s})}}sendMsg(e){return __awaiter(this,void 0,void 0,(function*(){validate({type:{type:"enum",values:getEnumKeys(Yo)},subType:{type:"number",min:1,required:!1}},e);var t=function generatorMsgForCmd(e,t,r){var o=__rest(e,["onSendBefore"]);return e.resend||(o.idClient=bt()),o.type=Yo[e.type],o.from=t,o.fromClientType=16,o.fromDeviceId=r,o.status=o.status||"sending",["resend","needAntiSpam","antiSpamUsingYidun","skipHistory","highPriority","clientAntiSpam"].forEach((t=>{void 0!==e[t]&&(o[t]=e[t]?1:0)})),["subType"].forEach((t=>{void 0!==e[t]&&(o[t]=parseInt(e[t]))})),["body","antiSpamContent","antiSpamBusinessId","ext"].forEach((t=>{void 0!==e[t]&&(o[t]="string"==typeof e[t]?e[t]:JSON.stringify(e[t]))})),o}(e,this.core.account,this.core.config.deviceId),r=formatChatroomMsg(Object.assign(Object.assign({},t),{status:"sending",time:(new Date).getTime()}),this.core.account);try{e.onSendBefore&&e.onSendBefore(r)}catch(e){this.core.logger.error("sendMsg: options.onSendBefore error",e)}try{var o=yield this.core.sendCmd("sendChatroomMsg",{chatroomMsg:t}),i=formatChatroomMsg(Object.assign(Object.assign(Object.assign({},t),o.content.chatroomMsg),{status:"success"}),this.core.account);return this.core.reporter.report("msgSend",{msgId:"",clientId:i.idClient,msgTime:i.time,fromAccid:this.core.account,toAccid:"",type:4,roomId:i.chatroomId,tid:"",result:200,failReason:"",rt:Date.now()-r.time}),i}catch(e){var n=formatChatroomMsg(Object.assign(Object.assign({},t),{status:"fail"}),this.core.account);throw e.msg=n,this.core.reporter.report("msgSend",{msgId:"",clientId:n.idClient,fromAccid:this.core.account,toAccid:"",type:4,roomId:n.chatroomId,tid:"",result:null==e?void 0:e.code,failReason:(null==e?void 0:e.message)||"",rt:Date.now()-t.time}),e}}))}}!function(e){e[e.regular=0]="regular",e[e.temp=1]="temp",e[e.regularOnline=2]="regularOnline",e[e.regularReverse=3]="regularReverse"}(tn||(tn={}));class ChatroomMemberService extends Service{constructor(e){super("chatroomMember",e)}updateMyRoomRole(e){return __awaiter(this,void 0,void 0,(function*(){validate({member:{type:"object",rules:{nick:{type:"string",required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}}},needNotify:{type:"boolean"},ext:{type:"string",required:!1},needSave:{type:"boolean",required:!1}},e),yield this.core.sendCmd("chatroomUpdateMyRoomRole",Object.assign(Object.assign({},e),{chatroomMember:e.member,ext:e.ext||""}))}))}setMemberManager(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.markChatroomMember(Object.assign(Object.assign({},e),{type:1}))}))}setMemberNormal(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.markChatroomMember(Object.assign(Object.assign({},e),{type:2}))}))}setMemberMute(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.markChatroomMember(Object.assign(Object.assign({},e),{type:-2}))}))}setMemberBlackList(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.markChatroomMember(Object.assign(Object.assign({},e),{type:-1}))}))}queryMembers(e){var t;return __awaiter(this,void 0,void 0,(function*(){validate({type:{type:"enum",values:getEnumKeys(tn)},time:{type:"number",required:!1},limit:{type:"number",required:!1}},e);var r=yield this.core.sendCmd("chatroomQueryMembers",Object.assign(Object.assign({time:0,limit:100},e),{type:tn[e.type]}));return formatChatroomMembers(null===(t=r.content)||void 0===t?void 0:t.members)}))}queryMembersByAccounts(e){var t;return __awaiter(this,void 0,void 0,(function*(){validate({accounts:{type:"array",min:1,max:20,itemType:"string"}},e);var r=yield this.core.sendCmd("chatroomQueryMembersByAccounts",e);return formatChatroomMembers(null===(t=r.content)||void 0===t?void 0:t.members)}))}setMemberTempMute(e){return __awaiter(this,void 0,void 0,(function*(){validate({account:{type:"string",allowEmpty:!1},duration:{type:"number",min:0},needNotify:{type:"boolean",required:!1},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("chatroomSetMemberTempMute",Object.assign(Object.assign({},e),{ext:e.ext||""}))}))}kickMember(e){return __awaiter(this,void 0,void 0,(function*(){validate({account:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("chatroomKickMember",Object.assign(Object.assign({},e),{ext:e.ext||""}))}))}queryMembersCountByTag(e){return __awaiter(this,void 0,void 0,(function*(){return validate({tag:{type:"string",allowEmpty:!1}},e),(yield this.core.sendCmd("chatroomQueryMembersCountByTag",Object.assign({},e))).content.count}))}queryMembersByTag(e){var t;return __awaiter(this,void 0,void 0,(function*(){validate({tag:{type:"string",allowEmpty:!1},time:{type:"number",required:!1},limit:{type:"number",max:100,required:!1}},e);var r=yield this.core.sendCmd("chatroomQueryMembersByTag",{chatroomTagMemberReq:Object.assign({time:0,limit:100},e)});return formatChatroomMembers(null===(t=r.content)||void 0===t?void 0:t.members)}))}setMembersTempMuteByTag(e){return __awaiter(this,void 0,void 0,(function*(){validate({tag:{type:"string",allowEmpty:!1},duration:{type:"number",min:0},needNotify:{type:"boolean"},notifyTargetTags:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("chatroomSetMembersTempMuteByTag",{chatroomTagMuteReq:Object.assign(Object.assign({},e),{needNotify:e.needNotify?1:0,ext:e.ext||""})})}))}markChatroomMember(e){var t;return __awaiter(this,void 0,void 0,(function*(){validate({account:{type:"string"},isAdd:{type:"boolean"},ext:{type:"string",required:!1},level:{type:"number",required:!1}},e);var r=yield this.core.sendCmd("markChatroomMember",Object.assign(Object.assign({level:0},e),{ext:e.ext||""}));return formatChatroomMember(null===(t=r.content)||void 0===t?void 0:t.chatroomMember)}))}}class ChatroomQueueService extends Service{constructor(e){super("chatroomQueue",e)}init(e){return __awaiter(this,void 0,void 0,(function*(){validate({maxItemCount:{type:"number",min:0,max:1e3}},e),yield this.core.sendCmd("chatroomQueueInit",e)}))}update(e){return __awaiter(this,void 0,void 0,(function*(){validate({elementKey:{type:"string",allowEmpty:!1},elementValue:{type:"string",max:4096,allowEmpty:!1},transient:{type:"boolean",required:!1},account:{type:"string",required:!1}},e),yield this.core.sendCmd("chatroomQueueOffer",Object.assign(Object.assign({},e),{transient:!!e.transient}))}))}poll(e){return __awaiter(this,void 0,void 0,(function*(){return validate({key:{type:"string",required:!1}},e),e.key||(e.key=""),(yield this.core.sendCmd("chatroomQueuePoll",e||{})).content}))}batchUpdate(e){return __awaiter(this,void 0,void 0,(function*(){return validate({itemList:{type:"object"},needNotify:{type:"boolean",required:!1},notifyExtension:{type:"string",required:!1}},e),(yield this.core.sendCmd("chatroomQueueChange",Object.assign(Object.assign({},e),{needNotify:!!e.needNotify}))).content.invalidKeyList}))}fetch(){return __awaiter(this,void 0,void 0,(function*(){return(yield this.core.sendCmd("chatroomQueueList")).content.itemList}))}pickHeader(){return __awaiter(this,void 0,void 0,(function*(){var e=yield this.core.sendCmd("chatroomQueuePeak");return{[e.content.elementKey]:e.content.elementValue}}))}clear(){return __awaiter(this,void 0,void 0,(function*(){yield this.core.sendCmd("chatroomQueueDrop")}))}}var an={"1_2":"heartbeat","6_23":"getServerTime","13_2":"chatroomLogin","13_3":"beKickedFromChatroom","13_4":"chatroomExit","13_6":"sendChatroomMsg","13_7":"onChatroomMsg","13_8":"chatroomQueryMembers","13_9":"chatroomQueryMessageHistory","13_11":"markChatroomMember","13_12":"closeChatroom","13_13":"getChatroom","13_14":"updateChatroom","13_15":"chatroomUpdateMyRoomRole","13_16":"chatroomQueryMembersByAccounts","13_17":"chatroomKickMember","13_19":"chatroomSetMemberTempMute","13_20":"chatroomQueueOffer","13_21":"chatroomQueuePoll","13_22":"chatroomQueueList","13_23":"chatroomQueuePeak","13_24":"chatroomQueueDrop","13_25":"chatroomQueueInit","13_26":"chatroomQueueChange","13_30":"chatroomSetMembersTempMuteByTag","13_31":"chatroomQueryMembersByTag","13_32":"chatroomQueryMembersCountByTag","13_36":"getHistoryMsgsByTags","13_101":"updateChatroomTag"},cn={chatroomLogin:{appkey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomExt:22,chatroomEnterExt:23,clientSession:26,isAnonymous:38,tags:39,notifyTargetTags:40,authType:41,loginExt:42},chatroomIMLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,isReactNative:112,authType:115,loginExt:116},chatroomMsg:{idClient:1,type:2,body:3,ext:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromExt:9,needAntiSpam:10,antiSpamContent:11,skipHistory:12,messageBody:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25,callbackExt:27,subType:28,yidunAntiCheating:29,env:30,notifyTargetTags:31,yidunAntiSpamExt:32,yidunAntiSpamRes:33,__clientExt:{id:39,converter:function objectToJSONString(e){if(e&&"object"==typeof e)try{return JSON.stringify(e)}catch(e){return}},retConverter:function stringToJSONObject(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(e){return}}}},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,ext:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,ext:7,online:8,guest:9,enterTime:10,blacked:12,muted:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17},chatroomTagMemberReq:{tag:1,time:2,limit:3},chatroomTagMuteReq:{tag:1,duration:2,needNotify:3,ext:4,notifyTargetTags:5},chatroomCdnInfo:{enable:1,cdnUrls:2,timestamp:3,interval:4,decryptType:5,decryptKey:6,timeout:7},chatRoomTagHistoryMsgRequestTag:{tags:1,types:2,fromTime:3,toTime:4,limit:5,reverse:6},updateTags:{currentTags:1}},getDeserializeTag=()=>function invertSerializeMap(e){var t={};return Object.keys(e).forEach((r=>{t[r]=function invertSerializeItem(e){var t={};for(var r in e){var o=e[r];"number"==typeof o?t[o]=r:"object"==typeof o&&(t[o.id]={prop:r,type:o.retType,access:o.retAccess?o.retAccess:o.access?o.access:r,def:o.retDef,converter:o.retConverter})}return t}(e[r])})),t}(cn),ln={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]};class ReporterHookLinkKeep{constructor(e,t){this.traceData=ln,this.core=e,this.traceData=Object.assign({},ln,t),this.traceData.extension=[]}reset(){this.traceData=Object.assign({},ln),this.traceData.extension=[]}start(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time=(new Date).getTime()}update(e){return __awaiter(this,void 0,void 0,(function*(){var{net_type:t,net_connect:r}=yield ro.net.getNetworkStatus();this.traceData.extension.push(Object.assign({code:0,foreground:!0,foreg_backg_switch:!1,net_type:t,net_connect:r},e))}))}end(e){var t=this.traceData.extension[0],r=this.traceData.extension[1];if(t&&0===t.operation_type&&r&&1===r.operation_type){var o=t.net_type!==r.net_type||t.net_connect!==r.net_connect;if(e||!o)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()}}var _n={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},dn="ReporterHook::setMonitorForResources:";class ReporterHookCloudStorage{constructor(e,t){this.traceData=_n,this.core=e,this.traceData=Object.assign({},_n,t)}reset(){this.traceData=Object.assign({},_n)}start(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now()}update(e){return __awaiter(this,void 0,void 0,(function*(){this.traceData.user_id&&(this.core.logger.log(`${dn} upload update`,e),Object.assign(this.traceData,e))}))}end(e){this.traceData.user_id&&(this.core.logger.log(`${dn} upload end cause of ${e}`),this.traceData.state=e,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=_n)}}function getIsDataReportEnable(e){var t,r,o=!0;return"boolean"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.enableCompass)?o=e.reporterConfig.enableCompass:"boolean"==typeof(null===(r=null==e?void 0:e.reporterConfig)||void 0===r?void 0:r.isDataReportEnable)&&(o=e.reporterConfig.isDataReportEnable),o}function getReportConfigUrl(e){var t,r,o="https://statistic.live.126.net/dispatcher/req";return"string"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.compassDataEndpoint)?((o=e.reporterConfig.compassDataEndpoint).endsWith("/")&&(o=o.slice(0,-1)),o+="/dispatcher/req"):"string"==typeof(null===(r=null==e?void 0:e.reporterConfig)||void 0===r?void 0:r.reportConfigUrl)&&(o=e.reporterConfig.reportConfigUrl),o}function getReportUrl(e){var t,r,o="https://statistic.live.126.net/statics/report/common/form";return"string"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.compassDataEndpoint)?((o=e.reporterConfig.compassDataEndpoint).endsWith("/")&&(o=o.slice(0,-1)),o+="/statics/report/common/form"):"string"==typeof(null===(r=null==e?void 0:e.reporterConfig)||void 0===r?void 0:r.reportUrl)&&(o=e.reporterConfig.reportUrl),o}var un={debugLevel:"off",needReconnect:!0,reconnectionAttempts:Number.MAX_SAFE_INTEGER,autoMarkRead:!0,isAbtestEnable:!0,abtestUrl:vo,abtestProjectKey:Ao};class Chatroom extends z{constructor(e,t={}){var r;super(),this.instanceName="Chatroom",this.status="unconnected",this.account="",this.eventBus=new z,this.options={},this.chatroom={},this.chatroomMsg={},this.chatroomMember={},this.chatroomQueue={},this.cloudStorage={},this.logger=new Logger(e.debugLevel),this.setInitOptions(e),registerParser({cmdMap:an,cmdConfig:(r=getDeserializeTag(),{heartbeat:{sid:1,cid:2,service:"chatroom"},getServerTime:{sid:6,cid:23,service:"chatroom",response:[{type:"Long",name:"time"}]},chatroomLogin:{sid:13,cid:2,service:"chatroom",params:[{type:"Byte",name:"type"},{type:"Property",name:"chatroomLogin",reflectMapper:cn.chatroomLogin},{type:"Property",name:"chatroomIMLogin",reflectMapper:cn.chatroomIMLogin}],response:[{type:"Property",name:"chatroom",reflectMapper:r.chatroom},{type:"Property",name:"chatroomMember",reflectMapper:r.chatroomMember},{type:"Property",name:"chatroomCdnInfo",reflectMapper:r.chatroomCdnInfo}]},chatroomExit:{sid:13,cid:4,service:"chatroom"},sendChatroomMsg:{sid:13,cid:6,service:"chatroomMsg",params:[{type:"Property",name:"chatroomMsg",reflectMapper:cn.chatroomMsg}],response:[{type:"Property",name:"chatroomMsg",reflectMapper:r.chatroomMsg}]},chatroomQueryMessageHistory:{sid:13,cid:9,service:"chatroomMsg",params:[{type:"Long",name:"timetag"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"chatroomMsgs",reflectMapper:r.chatroomMsg}]},getHistoryMsgsByTags:{sid:13,cid:36,service:"chatroomMsg",params:[{type:"Property",name:"chatRoomTagHistoryMsgRequestTag",reflectMapper:cn.chatRoomTagHistoryMsgRequestTag}],response:[{type:"PropertyArray",name:"chatroomMsgs",reflectMapper:r.chatroomMsg}]},getChatroom:{sid:13,cid:13,service:"chatroom",response:[{type:"Property",name:"chatroom",reflectMapper:r.chatroom}]},updateChatroom:{sid:13,cid:14,service:"chatroom",params:[{type:"Property",name:"chatroom",reflectMapper:cn.chatroom},{type:"Bool",name:"needNotify"},{type:"String",name:"ext"}]},chatroomUpdateMyRoomRole:{sid:13,cid:15,service:"chatroomMember",params:[{type:"Property",name:"chatroomMember",reflectMapper:cn.chatroomMember},{type:"Bool",name:"needNotify"},{type:"String",name:"ext"},{type:"Bool",name:"needSave"}]},markChatroomMember:{sid:13,cid:11,service:"chatroomMember",params:[{type:"String",name:"account"},{type:"Int",name:"type"},{type:"Bool",name:"isAdd"},{type:"Int",name:"level"},{type:"String",name:"ext"}],response:[{type:"Property",name:"chatroomMember",reflectMapper:r.chatroomMember}]},chatroomQueryMembers:{sid:13,cid:8,service:"chatroomMember",params:[{type:"Byte",name:"type"},{type:"Long",name:"time"},{type:"Int",name:"limit"}],response:[{type:"PropertyArray",name:"members",reflectMapper:r.chatroomMember}]},chatroomQueryMembersByAccounts:{sid:13,cid:16,service:"chatroomMember",params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"members",reflectMapper:r.chatroomMember}]},chatroomKickMember:{sid:13,cid:17,service:"chatroomMember",params:[{type:"String",name:"account"},{type:"String",name:"ext"}]},chatroomSetMemberTempMute:{sid:13,cid:19,service:"chatroomMember",params:[{type:"String",name:"account"},{type:"Long",name:"duration"},{type:"Bool",name:"needNotify"},{type:"String",name:"ext"}]},closeChatroom:{sid:13,cid:12,service:"chatroom",params:[{type:"String",name:"ext"}]},chatroomQueryMembersCountByTag:{sid:13,cid:32,service:"chatroomMember",params:[{type:"String",name:"tag"}],response:[{type:"Long",name:"count"}]},chatroomQueryMembersByTag:{sid:13,cid:31,service:"chatroomMember",params:[{type:"Property",name:"chatroomTagMemberReq",reflectMapper:cn.chatroomTagMemberReq}],response:[{type:"PropertyArray",name:"members",reflectMapper:r.chatroomMember}]},chatroomSetMembersTempMuteByTag:{sid:13,cid:30,service:"chatroomMember",params:[{type:"Property",name:"chatroomTagMuteReq",reflectMapper:cn.chatroomTagMuteReq}]},chatroomQueueOffer:{sid:13,cid:20,service:"chatroomQueue",params:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"},{type:"Bool",name:"transient"},{type:"String",name:"account"}]},chatroomQueuePoll:{sid:13,cid:21,service:"chatroomQueue",params:[{type:"String",name:"key"}],response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},chatroomQueueChange:{sid:13,cid:26,service:"chatroomQueue",params:[{type:"StrStrMap",name:"itemList"},{type:"Bool",name:"needNotify"},{type:"String",name:"notifyExtension"}],response:[{type:"StrArray",name:"invalidKeyList"}]},chatroomQueueList:{sid:13,cid:22,service:"chatroomQueue",response:[{type:"KVArray",name:"itemList"}]},chatroomQueuePeak:{sid:13,cid:23,service:"chatroomQueue",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},chatroomQueueDrop:{sid:13,cid:24,service:"chatroomQueue"},chatroomQueueInit:{sid:13,cid:25,service:"chatroomQueue",params:[{type:"Int",name:"maxItemCount"}]},onChatroomMsg:{sid:13,cid:7,service:"chatroomMsg",response:[{type:"Property",name:"chatroomMsg",reflectMapper:r.chatroomMsg}]},beKickedFromChatroom:{sid:13,cid:3,service:"auth",response:[{type:"Int",name:"reason"},{type:"String",name:"ext"}]},updateChatroomTag:{sid:13,cid:101,service:"chatroom",response:[{type:"Property",name:"updateTags",reflectMapper:r.updateTags}]}})}),this.otherOptions=t,this.timerManager=new TimerManager,this.adapters=new CoreAdapters(this),this.timeOrigin=new TimeOrigin(this),this.abtest=new ABTest(this,{isAbtestEnable:this.options.isAbtestEnable,abtestUrl:this.options.abtestUrl,abtestProjectKey:Ao});var o="",i="";this.options.isFixedDeviceId?(o=ro.localStorage.getItem("__CHATROOM_DEVC_ID__")||bt(),i=ro.localStorage.getItem("__CHATROOM_CLIENT_SESSION_ID__")||bt(),ro.localStorage.setItem("__CHATROOM_DEVC_ID__",o),ro.localStorage.setItem("__CHATROOM_CLIENT_SESSION_ID__",i)):(o=bt(),i=bt()),this.config={timeout:8e3,deviceId:o,clientSession:i};var n=ro.getSystemInfo();this.reporter=new J({reportConfigUrl:getReportConfigUrl(t),reportUrl:getReportUrl(t),isDataReportEnable:getIsDataReportEnable(t),common:{app_key:e.appkey,dev_id:this.config.deviceId,platform:"Web",sdk_ver:"10.4.0",env:"online",os_name:n.os,os_ver:n.osVer,lib_env:n.libEnv,host_env:n.hostEnv,host_env_ver:n.hostEnvVer,manufactor:n.manufactor,model:n.model,v2:!1},request:ro.request,logger:this.logger,autoStart:!0}),this.reporterHookLinkKeep=new ReporterHookLinkKeep(this),this.reporterHookCloudStorage=new ReporterHookCloudStorage(this),ro.setLogger(this.logger),this.auth=new ChatroomAuthService(this),this.V1NIMLoginService=this.auth,this.clientSocket=new V1ClientSocket(this),this.chatroom=new ChatroomService(this),this.chatroomMsg=new ChatroomMsgService(this),this.chatroomMember=new ChatroomMemberService(this),this.chatroomQueue=new ChatroomQueueService(this),this.cloudStorage=new CloudStorageService(this,Object.assign({storageKeyPrefix:this.instanceName},t.cloudStorageConfig)),Chatroom.instance=this,this.logger.log("Chatroom init, version ","10.4.0"," sdk version ",100400," appkey ",e.appkey)}static getInstance(e,t){if(!Chatroom.instance){if(e)return new Chatroom(e,t);throw new Error("Instance not exist, please input options")}if(e){if(Chatroom.instance.options.account===e.account&&Chatroom.instance.options.appkey===e.appkey)return Chatroom.instance.setOptions(e),Chatroom.instance;throw new Error("Unexpected login")}return Chatroom.instance}setOptions(e){if("object"==typeof e&&null!==e&&(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey))throw new Error("chatroom::setOptions account and appkey is not allowed to reset");validate({token:{type:"string",required:!1},chatroomId:{type:"string",required:!1},chatroomAddresses:{type:"array",itemType:"string",min:1,required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},isAnonymous:{type:"boolean",required:!1},tags:{type:"array",itemType:"string",required:!1}},e),this.logger.log("chatroom::setOptions options is",e),this.options=Object.assign(Object.assign({},this.options),e)}setInitOptions(e){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},chatroomId:{type:"string"},chatroomAddresses:{type:"array",itemType:"string",min:1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},isAnonymous:{type:"boolean",required:!1},tags:{type:"array",itemType:"string",required:!1}},e),this.logger&&this.logger.log("chatroom::setInitOptions options is",e),this.account=e.account,this.options=Object.assign(Object.assign({},un),e)}connect(e={}){return this.auth.login(e)}disconnect(){switch(this.status){case"logined":return this.sendCmd("chatroomExit",void 0,{timeout:1e3}).then((()=>{this.clientSocket.doDisconnect(Vo.ACTIVE,"UserActiveDisconnect")})).catch((e=>{this.logger.error("Instance::disconnect sendCmd:logout error",e),this.clientSocket.doDisconnect(Vo.ACTIVE,"UserActiveDisconnect")}));case"connected":case"connecting":case"waitReconnect":return this.clientSocket.doDisconnect(Vo.ACTIVE,"UserActiveDisconnect"),Promise.resolve();case"unconnected":case"destroyed":return Promise.resolve()}}destroy(){return Chatroom.instance=void 0,this.disconnect().then((()=>{this.status="destroyed",this.removeAllListeners(),this.eventBus.removeAllListeners(),this.logger.destroy(),this.reporter.destroy(),this.timerManager.destroy(),this.connect=emptyFuncWithPromise,this.disconnect=emptyFuncWithPromise,this.destroy=emptyFuncWithPromise}))}sendCmd(e,t,r){return this.clientSocket.sendCmd(e,t,r)}emit(e,...t){try{var r=Date.now(),o=super.emit(e,...t),i=Date.now()-r;return i>=10&&this.logger.warn(`Core::emit event: ${e} process takes: ${i}ms`),o}catch(t){return this.logger.error(`Core::emit event: ${e}. Error: ${t}`),setTimeout((()=>{throw this.logger.error(`Core::emit throw error in setTimeout. event: ${e}. Error: ${t}`),t}),0),!1}}}var En=console,hn={clear(){try{my.clearStorageSync()}catch(e){En.error("ali-app::ws: clearStorage ",e)}},getItem:e=>my.getStorageSync({key:e}).data,setItem:(e,t)=>my.setStorageSync({key:e,data:t}),removeItem:e=>my.removeStorageSync({key:e})};class WebSocket$3{constructor(e,t=""){if(this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",this.onclose=function(e){En.log("my-app: sockets on close ",e)},this.onerror=function(e){En.error("my-app: sockets error ",e)},this.onmessage=function(e){},this.onopen=function(){},!e)throw new Error("Failed to construct 'socket': url required");this.url=e.replace(/:443(\/|$)/,"$1"),this.protocol=t,this.readyState=this.CONNECTING,this.socketTask=my.connectSocket({url:this.url,multiple:!0,fail:e=>{this.errorHandler(e)},success:()=>{this.readyState=this.OPEN}}),this.socketTask.onOpen((e=>{this.readyState=this.OPEN,this.binaryType?this.onopen():this.onmessage&&this.onmessage({type:"open",header:e})})),this.socketTask.onError((e=>{this.errorHandler(e)})),this.socketTask.onClose((e=>{this.readyState=this.CLOSED;var{code:t,reason:r,wasClean:o}=e;"function"==typeof this.onclose&&this.onclose&&this.onclose({code:t,reason:r,wasClean:o,type:"close"}),this.socketTask=null})),this.socketTask.onMessage((e=>{var t,r=null===(t=e.data)||void 0===t?void 0:t.data,o=r;e.data.isBuffer&&(o=base64ToArrayBuffer(r)),this.onmessage&&this.onmessage({data:o})}))}close(){this.socketTask&&this.socketTask.close({code:1e3,reason:"user force close websocket",complete:()=>{this.socketTask=null}})}send(e){if(this.readyState!==this.OPEN)throw new Error(`my-app: socket sendMsg when readyState=${this.readyState}`);if(!("string"==typeof e||e instanceof ArrayBuffer))throw new TypeError("my-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask&&this.socketTask.send({data:e,isBuffer:e instanceof ArrayBuffer})}errorHandler(e){En.error("my-app::ws: onerror ",e),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:e&&e.errMsg})}}function request$3(e,t){return t&&(t.data=t.data||(null==t?void 0:t.params)||{}),new Promise(((r,o)=>{my.request(Object.assign(Object.assign({url:e},t),{success:function(e){e={data:e.data,status:e.status,errMsg:e.errMsg,header:e.header},r(e)},fail:function(e){e.code=13===e.error?Z.V2NIM_ERROR_CODE_TIMEOUT:e.error,e.message=e.errorMessage,o(e)}}))}))}function uploadFile$3(e){return __awaiter(this,void 0,void 0,(function*(){return yield new Promise(((t,r)=>{var o=my.uploadFile(Object.assign(Object.assign({url:`${e.commonUploadHost}/${e.nosToken.bucket}`},e.md5?{header:{"Content-MD5":e.md5}}:{}),{formData:{Object:decodeURIComponent(e.nosToken.objectName),"x-nos-token":e.nosToken.token,"x-nos-entity-type":"json"},fileType:e.type,fileName:"file",filePath:e.filePath,success(o){if(200==o.statusCode)try{var i=JSON.parse(o.data);i.name=e.filePath,i.ext=i.name.lastIndexOf(".")>-1?i.name.slice(i.name.lastIndexOf(".")+1).toLowerCase():"",t(i)}catch(e){r(new Error(`Upload Error parse result error: ${o.data}`))}else r(new Error(`Upload error ${o.statusCode}: ${o.errMsg}`))},fail(e){e.code=9===e.error?Z.V2NIM_ERROR_CODE_CANCELLED:e.error,e.message=e.errorMessage,r(e)}}));try{e.onUploadStart&&e.onUploadStart(o)}catch(e){En.error("uploadFile: options.onUploadStart error",e),o.abort(),r(e)}e.onUploadProgress&&o.onProgressUpdate((function(t){e.onUploadProgress&&e.onUploadProgress({total:t.totalBytesExpectedToWrite,loaded:t.totalBytesWritten,percentage:t.progress,percentageText:t.progress+"%"})}))}))}))}function getFileUploadInformation$3(e){return null}function getSystemInfo$3(){var e=my.getSystemInfoSync()||{};return{libEnv:"MINIAPP",os:e.platform||"",osVer:e.system||"",browser:"",browserVer:"",hostEnv:"Ali",hostEnvEnum:Qr.Ali,hostEnvVer:e.version,userAgent:`Ali MiniApp: model/${e.model} system/${e.system}`,model:my.SDKVersion,manufactor:"Ali",pushDeviceInfo:{PRODUCT:e.model,DEVICE:e.model,MANUFACTURER:e.brand}}}var mn=console,pn={clear(){try{wx.clearStorageSync()}catch(e){mn.error("wx-app::ws: clearStorage ",e)}},getItem:e=>wx.getStorageSync(e),setItem:(e,t)=>wx.setStorageSync(e,t),removeItem:e=>wx.removeStorageSync(e)};class WebSocket$2{constructor(e,t=""){if(this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",this.onclose=function(e){mn.log("wx-app: sockets on close ",e)},this.onerror=function(e){mn.error("wx-app: sockets error ",e)},this.onmessage=function(e){},this.onopen=function(){},!e)throw new Error("Failed to construct 'socket': url required");this.url=e.replace(/:443(\/|$)/,"$1"),this.protocol=t,this.readyState=this.CONNECTING;var r=this.protocol?{protocols:[this.protocol]}:{};this.socketTask=wx.connectSocket(Object.assign(Object.assign({url:this.url},r),{fail:e=>{this.errorHandler(e)},success:()=>{}})),this.socketTask.onOpen((e=>{this.readyState=this.OPEN,this.binaryType?this.onopen():this.onmessage&&this.onmessage({type:"open",header:e})})),this.socketTask.onError((e=>{this.errorHandler(e)})),this.socketTask.onClose((e=>{this.readyState=this.CLOSED;var{code:t,reason:r,wasClean:o}=e;"function"==typeof this.onclose&&this.onclose&&this.onclose({code:t,reason:r,wasClean:o,type:"close"})})),this.socketTask.onMessage((e=>{this.onmessage&&this.onmessage(e)}))}close(){this.socketTask.close({code:1e3,reason:"user force close websocket",complete:()=>{this.socketTask=null}})}send(e){if(this.readyState!==this.OPEN)throw new Error(`wx-app: socket sendMsg when readyState=${this.readyState}`);if(!("string"==typeof e||e instanceof ArrayBuffer))throw new TypeError("wx-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask.send({data:e})}errorHandler(e){mn.error("wx-app::ws: onerror ",e),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:e&&e.errMsg})}}function request$2(e,t){return t&&(t.header=t.headers,t.data=t.data||(null==t?void 0:t.params)||{}),new Promise(((r,o)=>{wx.request(Object.assign(Object.assign({url:e},t),{success:function(e){e={data:e.data,status:e.statusCode,errMsg:e.errMsg,header:e.header},r(e)},fail:function(e){e.code=5===e.errno?Z.V2NIM_ERROR_CODE_TIMEOUT:e.errno,e.message=e.errMsg,o(e)}}))}))}function uploadFile$2(e){return __awaiter(this,void 0,void 0,(function*(){return yield new Promise(((t,r)=>{var o=wx.uploadFile(Object.assign(Object.assign({url:`${e.commonUploadHost}/${e.nosToken.bucket}`},e.md5?{header:{"Content-MD5":e.md5}}:{}),{formData:{Object:decodeURIComponent(e.nosToken.objectName),"x-nos-token":e.nosToken.token,"x-nos-entity-type":"json"},name:"file",filePath:e.filePath,success(o){if(200==o.statusCode)try{var i=JSON.parse(o.data);i.name=e.filePath,i.ext=i.name.lastIndexOf(".")>-1?i.name.slice(i.name.lastIndexOf(".")+1).toLowerCase():"",t(i)}catch(e){r(new Error(`Upload Error parse result error: ${o.data}`))}else r(new Error(`Upload error ${o.statusCode}: ${o.errMsg}`))},fail(e){e.code="uploadFile:fail abort"===e.errMsg?Z.V2NIM_ERROR_CODE_CANCELLED:e.errno,e.message=e.errMsg,r(e)}}));try{e.onUploadStart&&e.onUploadStart(o)}catch(e){mn.error("uploadFile: options.onUploadStart error",e),o.abort(),r(e)}e.onUploadProgress&&o.onProgressUpdate((function(t){e.onUploadProgress&&e.onUploadProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:t.progress,percentageText:t.progress+"%"})}))}))}))}function getSystemInfo$2(){var e=wx.getSystemInfoSync()||{};return{os:e.platform||"",osVer:e.system||"",browser:"",browserVer:"",libEnv:"MINIAPP",hostEnv:"WeiXin",hostEnvEnum:Qr.WeiXin,hostEnvVer:e.version,model:e.SDKVersion,manufactor:"WeiXin",userAgent:`WeChat MiniApp: model/${e.model} system/${e.system}`,pushDeviceInfo:{PRODUCT:e.model,DEVICE:e.model,MANUFACTURER:e.brand}}}function getFileUploadInformation$2(e){return null}var gn=console,Tn={clear(){try{swan.clearStorageSync()}catch(e){gn.error("baidu-app::ws: clearStorage ",e)}},getItem:e=>swan.getStorageSync(e),setItem:(e,t)=>swan.setStorageSync(e,t),removeItem:e=>swan.removeStorageSync(e)};class WebSocket$1{constructor(e,t=""){if(this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",this.onclose=function(e){gn.log("baidu-app: sockets on close ",e)},this.onerror=function(e){gn.error("baidu-app: sockets error ",e)},this.onmessage=function(e){},this.onopen=function(){},!e)throw new Error("Failed to construct 'socket': url required");this.url=e.replace(/:443(\/|$)/,"$1"),this.protocol=t,this.readyState=this.CONNECTING;var r=this.protocol?{protocols:[this.protocol]}:{};this.socketTask=swan.connectSocket(Object.assign(Object.assign({url:this.url},r),{fail:e=>{this.errorHandler(e)},success:()=>{}})),this.socketTask.onOpen((e=>{this.readyState=this.OPEN,this.binaryType?this.onopen():this.onmessage&&this.onmessage({type:"open",header:e})})),this.socketTask.onError((e=>{this.errorHandler(e)})),this.socketTask.onClose((e=>{this.readyState=this.CLOSED;var{code:t,reason:r,wasClean:o}=e;"function"==typeof this.onclose&&this.onclose&&this.onclose({code:t,reason:r,wasClean:o,type:"close"})})),this.socketTask.onMessage((e=>{this.onmessage&&this.onmessage({data:e.data})}))}close(){this.socketTask.close({code:1e3,reason:"user force close websocket",complete:()=>{this.socketTask=null}})}send(e){if(this.readyState!==this.OPEN)throw new Error(`wx-app: socket sendMsg when readyState=${this.readyState}`);if(!("string"==typeof e||e instanceof ArrayBuffer))throw new TypeError("wx-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask.send({data:e})}errorHandler(e){this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:e&&e.errMsg})}}function request$1(e,t){return t&&(t.header=t.headers,t.data=t.data||(null==t?void 0:t.params)||{}),new Promise(((r,o)=>{swan.request(Object.assign(Object.assign({url:e},t),{success:function(e){e={data:e.data,status:e.statusCode,errMsg:e.errMsg,header:e.header},r(e)},fail:function(e){e.code=1===e.errCode?Z.V2NIM_ERROR_CODE_TIMEOUT:e.errCode,e.message=e.errMsg,o(e)}}))}))}function uploadFile$1(e){return __awaiter(this,void 0,void 0,(function*(){return yield new Promise(((t,r)=>{var o=swan.uploadFile(Object.assign(Object.assign({url:`${e.commonUploadHost}/${e.nosToken.bucket}`},e.md5?{header:{"Content-MD5":e.md5}}:{}),{formData:{Object:decodeURIComponent(e.nosToken.objectName),"x-nos-token":e.nosToken.token,"x-nos-entity-type":"json"},name:"file",filePath:e.filePath,success(o){if(200==o.statusCode)try{var i=JSON.parse(o.data);i.name=e.filePath,i.ext=i.name.lastIndexOf(".")>-1?i.name.slice(i.name.lastIndexOf(".")+1).toLowerCase():"",t(i)}catch(e){r(new Error(`Upload Error parse result error: ${o.data}`))}else r(new Error(`Upload error ${o.statusCode}: ${o.errMsg}`))},fail(e){e.code="uploadFile:fail abort"===e.errMsg?Z.V2NIM_ERROR_CODE_CANCELLED:e.errCode,e.message=e.errMsg,r(e)}}));try{e.onUploadStart&&e.onUploadStart(o)}catch(e){gn.error("uploadFile: options.onUploadStart error",e),o.abort(),r(e)}e.onUploadProgress&&o.onProgressUpdate((function(t){e.onUploadProgress&&e.onUploadProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:t.progress,percentageText:t.progress+"%"})}))}))}))}function getFileUploadInformation$1(e){return null}function getSystemInfo$1(){var e=swan.getSystemInfoSync()||{};return{os:e.platform||"",osVer:e.system||"",browser:"",browserVer:"",libEnv:"MINIAPP",hostEnv:"Baidu",userAgent:`Baidu MiniApp: model/${e.model} system/${e.system}`,hostEnvVer:e.version,hostEnvEnum:Qr.Baidu,model:e.SDKVersion,manufactor:"Baidu",pushDeviceInfo:{PRODUCT:e.model,DEVICE:e.model,MANUFACTURER:e.brand}}}var fn=console,In={clear(){try{tt.clearStorageSync()}catch(e){fn.error("tt-app::ws: clearStorage ",e)}},getItem:e=>tt.getStorageSync(e),setItem:(e,t)=>tt.setStorageSync(e,t),removeItem:e=>tt.removeStorageSync(e)};class WebSocket{constructor(e,t=""){if(this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",this.onclose=function(e){fn.log("wx-app: sockets on close ",e)},this.onerror=function(e){fn.error("wx-app: sockets error ",e)},this.onmessage=function(e){},this.onopen=function(){},!e)throw new Error("Failed to construct 'socket': url required");this.url=e.replace(/:443(\/|$)/,"$1"),this.protocol=t,this.readyState=this.CONNECTING;var r=this.protocol?{protocols:[this.protocol]}:{};this.socketTask=tt.connectSocket(Object.assign(Object.assign({url:this.url},r),{fail:e=>{this.errorHandler(e)},success:()=>{}})),this.socketTask.onOpen((e=>{this.readyState=this.OPEN,this.binaryType?this.onopen():this.onmessage&&this.onmessage({type:"open",header:e.header})})),this.socketTask.onError((e=>{this.errorHandler(e)})),this.socketTask.onClose((e=>{this.readyState=this.CLOSED;var{code:t,reason:r,wasClean:o}=e;"function"==typeof this.onclose&&this.onclose&&this.onclose({code:t,reason:r,wasClean:o,type:"close"})})),this.socketTask.onMessage((e=>{this.onmessage&&this.onmessage({data:e.data})}))}close(){this.socketTask&&this.socketTask.close({code:1e3,reason:"user force close websocket",complete:()=>{}})}send(e){if(this.readyState!==this.OPEN)throw new Error(`tt-app: socket sendMsg when readyState=${this.readyState}`);if(!("string"==typeof e||e instanceof ArrayBuffer))throw new TypeError("tt-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask&&this.socketTask.send({data:e})}errorHandler(e){fn.error("tt-app::ws: onerror ",e),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:e&&e.errMsg})}}function request(e,t){return t&&(t.header=t.headers,t.data=t.data||(null==t?void 0:t.params)||{}),new Promise(((r,o)=>{tt.request(Object.assign(Object.assign({url:e},t),{success:function(e){e={data:e.data,status:e.statusCode,errMsg:e.errMsg,header:e.header},r(e)},fail:function(e){e.code=21103===e.errNo?Z.V2NIM_ERROR_CODE_TIMEOUT:e.errNo,e.message=e.errMsg,o(e)}}))}))}function uploadFile(e){return __awaiter(this,void 0,void 0,(function*(){return yield new Promise(((t,r)=>{var o=tt.uploadFile(Object.assign(Object.assign({url:`${e.commonUploadHost}/${e.nosToken.bucket}`},e.md5?{header:{"Content-MD5":e.md5}}:{}),{formData:{Object:decodeURIComponent(e.nosToken.objectName),"x-nos-token":e.nosToken.token,"x-nos-entity-type":"json"},name:"file",filePath:e.filePath,success(o){if(200==o.statusCode)try{var i=JSON.parse(o.data);i.name=e.filePath,i.ext=i.name.lastIndexOf(".")>-1?i.name.slice(i.name.lastIndexOf(".")+1).toLowerCase():"",t(i)}catch(e){r(new Error(`Upload Error parse result error: ${o.data}`))}else r(new Error(`Upload error ${o.statusCode}: ${o.errMsg}`))},fail(e){e.code=21104===e.errNo?Z.V2NIM_ERROR_CODE_CANCELLED:e.errNo,e.message=e.errMsg,r(e)}}));try{e.onUploadStart&&e.onUploadStart(o)}catch(e){fn.error("uploadFile: options.onUploadStart error",e),o.abort(),r(e)}e.onUploadProgress&&o.onProgressUpdate((function(t){e.onUploadProgress&&e.onUploadProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:t.progress,percentageText:t.progress+"%"})}))}))}))}function getFileUploadInformation(e){return null}function getSystemInfo(){var e=tt.getSystemInfoSync()||{};return{os:e.platform||"",osVer:e.system||"",browser:"",browserVer:"",libEnv:"MINIAPP",hostEnv:"Tiktok",hostEnvEnum:Qr.Tiktok,hostEnvVer:e.version,model:e.SDKVersion,manufactor:"Tiktok",userAgent:`Tiktok MiniApp: model/${e.model} system/${e.system}`,pushDeviceInfo:{PRODUCT:e.model,DEVICE:e.model,MANUFACTURER:e.brand}}}var Nn={WX:()=>({setLogger(e){mn=e},platform:"WXAPP",localStorage:pn,request:request$2,WebSocket:WebSocket$2,uploadFile:uploadFile$2,getFileUploadInformation:getFileUploadInformation$2,getSystemInfo:getSystemInfo$2,net:{__getEnv:()=>wx}}),ALI:()=>({setLogger(e){En=e},platform:"ALIAPP",localStorage:hn,request:request$3,WebSocket:WebSocket$3,uploadFile:uploadFile$3,getSystemInfo:getSystemInfo$3,getFileUploadInformation:getFileUploadInformation$3,net:{__getEnv:()=>my}}),BAIDU:()=>({setLogger(e){gn=e},platform:"BAIDUAPP",localStorage:Tn,request:request$1,WebSocket:WebSocket$1,uploadFile:uploadFile$1,getFileUploadInformation:getFileUploadInformation$1,getSystemInfo:getSystemInfo$1,net:{__getEnv:()=>swan}}),TT:()=>({setLogger(e){fn=e},platform:"TTAPP",localStorage:In,request:request,WebSocket:WebSocket,uploadFile:uploadFile,getSystemInfo:getSystemInfo,getFileUploadInformation:getFileUploadInformation,net:{__getEnv:()=>tt}})};return function setAdapters(e){eo(ro,e())}((()=>Nn[function getMiniappEnv(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}()]())),Chatroom}));
