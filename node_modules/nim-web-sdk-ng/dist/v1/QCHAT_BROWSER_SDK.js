/**
 * 
 *   Version: 10.4.0
 * 
 *   Git Hash: 18a110e8a09523bcccd386391747f378b0b20912
 * 
 *   Created At: 2024/8/21 19:52:27
 * 
 *   Target: QCHAT_BROWSER_SDK.js
 *   
 */

!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t="undefined"!=typeof globalThis?globalThis:t||self).QChat=a()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var a,c,h=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),check=function(t){return t&&t.Math==Math&&t},m=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},g=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),E=Function.prototype,I=E.apply,M=E.call,C="object"==typeof Reflect&&Reflect.apply||(g?M.bind(I):function(){return M.apply(I,arguments)}),b=Function.prototype,S=b.bind,T=b.call,R=g&&S.bind(T,T),A=g?function(t){return t&&R(t)}:function(t){return t&&function(){return T.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},N=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),O=Function.prototype.call,w=g?O.bind(O):function(){return O.apply(O,arguments)},k={}.propertyIsEnumerable,x=Object.getOwnPropertyDescriptor,P={f:x&&!k.call({1:2},1)?function propertyIsEnumerable(t){var a=x(this,t);return!!a&&a.enumerable}:k},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},q=A({}.toString),L=A("".slice),classofRaw=function(t){return L(q(t),8,-1)},D=Object,V=A("".split),U=fails((function(){return!D("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?V(t,""):D(t)}:D,isNullOrUndefined=function(t){return null==t},G=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw G("Can't call method on "+t);return t},toIndexedObject=function(t){return U(requireObjectCoercible(t))},B="object"==typeof document&&document.all,j=void 0===B&&void 0!==B?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===B}:function(t){return"object"==typeof t?null!==t:isCallable(t)},W={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(W[t])||aFunction(m[t]):W[t]&&W[t][a]||m[t]&&m[t][a]},Y=A({}.isPrototypeOf),$=getBuiltIn("navigator","userAgent")||"",H=m.process,Q=m.Deno,K=H&&H.versions||Q&&Q.version,z=K&&K.v8;z&&(c=(a=z.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!c&&$&&(!(a=$.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=$.match(/Chrome\/(\d+)/))&&(c=+a[1]);var J,X=c,Z=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),ee=Z&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,te=Object,re=ee?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&Y(a.prototype,te(t))},ne=String,tryToString=function(t){try{return ne(t)}catch(t){return"Object"}},ae=TypeError,aCallable=function(t){if(isCallable(t))return t;throw ae(tryToString(t)+" is not a function")},getMethod=function(t,a){var c=t[a];return isNullOrUndefined(c)?void 0:aCallable(c)},oe=TypeError,ie=Object.defineProperty,se="__core-js_shared__",ce=m[se]||function(t,a){try{ie(m,t,{value:a,configurable:!0,writable:!0})}catch(c){m[t]=a}return a}(se,{}),le=createCommonjsModule((function(t){(t.exports=function(t,a){return ce[t]||(ce[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),ue=Object,toObject=function(t){return ue(requireObjectCoercible(t))},de=A({}.hasOwnProperty),pe=Object.hasOwn||function hasOwn(t,a){return de(toObject(t),a)},he=0,fe=Math.random(),me=A(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+me(++he+fe,36)},ge=le("wks"),ve=m.Symbol,ye=ve&&ve.for,_e=ee?ve:ve&&ve.withoutSetter||uid,wellKnownSymbol=function(t){if(!pe(ge,t)||!Z&&"string"!=typeof ge[t]){var a="Symbol."+t;Z&&pe(ve,t)?ge[t]=ve[t]:ge[t]=ee&&ye?ye(a):_e(a)}return ge[t]},Ee=TypeError,Ie=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!j(t)||re(t))return t;var c,h=getMethod(t,Ie);if(h){if(void 0===a&&(a="default"),c=w(h,t,a),!j(c)||re(c))return c;throw Ee("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var c,h;if("string"===a&&isCallable(c=t.toString)&&!j(h=w(c,t)))return h;if(isCallable(c=t.valueOf)&&!j(h=w(c,t)))return h;if("string"!==a&&isCallable(c=t.toString)&&!j(h=w(c,t)))return h;throw oe("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return re(a)?a:a+""},Me=m.document,Ce=j(Me)&&j(Me.createElement),documentCreateElement=function(t){return Ce?Me.createElement(t):{}},be=!N&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),Se=Object.getOwnPropertyDescriptor,Te={f:N?Se:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),be)try{return Se(t,a)}catch(t){}if(pe(t,a))return createPropertyDescriptor(!w(P.f,t,a),t[a])}},Re=/#|\.prototype\./,isForced=function(t,a){var c=Ne[Ae(t)];return c==we||c!=Oe&&(isCallable(a)?fails(a):!!a)},Ae=isForced.normalize=function(t){return String(t).replace(Re,".").toLowerCase()},Ne=isForced.data={},Oe=isForced.NATIVE="N",we=isForced.POLYFILL="P",ke=isForced,xe=A(A.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:g?xe(t,a):function(){return t.apply(a,arguments)}},Pe=N&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),qe=String,Le=TypeError,anObject=function(t){if(j(t))return t;throw Le(qe(t)+" is not an object")},De=TypeError,Ve=Object.defineProperty,Ue=Object.getOwnPropertyDescriptor,Ge="enumerable",Fe="configurable",Be="writable",je={f:N?Pe?function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),"function"==typeof t&&"prototype"===a&&"value"in c&&Be in c&&!c.writable){var h=Ue(t,a);h&&h.writable&&(t[a]=c.value,c={configurable:Fe in c?c.configurable:h.configurable,enumerable:Ge in c?c.enumerable:h.enumerable,writable:!1})}return Ve(t,a,c)}:Ve:function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),be)try{return Ve(t,a,c)}catch(t){}if("get"in c||"set"in c)throw De("Accessors not supported");return"value"in c&&(t[a]=c.value),t}},We=N?function(t,a,c){return je.f(t,a,createPropertyDescriptor(1,c))}:function(t,a,c){return t[a]=c,t},Ye=Te.f,wrapConstructor=function(t){var Wrapper=function(a,c,h){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,c)}return new t(a,c,h)}return C(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var c,h,g,E,I,M,C,b,S=t.target,T=t.global,R=t.stat,N=t.proto,O=T?m:R?m[S]:(m[S]||{}).prototype,w=T?W:W[S]||We(W,S,{})[S],k=w.prototype;for(g in a)c=!ke(T?g:S+(R?".":"#")+g,t.forced)&&O&&pe(O,g),I=w[g],c&&(M=t.dontCallGetSet?(b=Ye(O,g))&&b.value:O[g]),E=c&&M?M:a[g],c&&typeof I==typeof E||(C=t.bind&&c?functionBindContext(E,m):t.wrap&&c?wrapConstructor(E):N&&isCallable(E)?A(E):E,(t.sham||E&&E.sham||I&&I.sham)&&We(C,"sham",!0),We(w,g,C),N&&(pe(W,h=S+"Prototype")||We(W,h,{}),We(W[h],g,E),t.real&&k&&!k[g]&&We(k,g,E)))},$e=Math.ceil,He=Math.floor,Qe=Math.trunc||function trunc(t){var a=+t;return(a>0?He:$e)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:Qe(a)},Ke=Math.max,ze=Math.min,toAbsoluteIndex=function(t,a){var c=toIntegerOrInfinity(t);return c<0?Ke(c+a,0):ze(c,a)},Je=Math.min,toLength=function(t){return t>0?Je(toIntegerOrInfinity(t),9007199254740991):0},lengthOfArrayLike=function(t){return toLength(t.length)},createMethod$4=function(t){return function(a,c,h){var m,g=toIndexedObject(a),E=lengthOfArrayLike(g),I=toAbsoluteIndex(h,E);if(t&&c!=c){for(;E>I;)if((m=g[I++])!=m)return!0}else for(;E>I;I++)if((t||I in g)&&g[I]===c)return t||I||0;return!t&&-1}},Xe={includes:createMethod$4(!0),indexOf:createMethod$4(!1)},Ze={},et=Xe.indexOf,tt=A([].push),objectKeysInternal=function(t,a){var c,h=toIndexedObject(t),m=0,g=[];for(c in h)!pe(Ze,c)&&pe(h,c)&&tt(g,c);for(;a.length>m;)pe(h,c=a[m++])&&(~et(g,c)||tt(g,c));return g},rt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],nt=Object.keys||function keys(t){return objectKeysInternal(t,rt)},at=N&&!Pe?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var c,h=toIndexedObject(a),m=nt(a),g=m.length,E=0;g>E;)je.f(t,c=m[E++],h[c]);return t},ot={f:at},it=getBuiltIn("document","documentElement"),st=le("keys"),sharedKey=function(t){return st[t]||(st[t]=uid(t))},ct=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{J=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&J?NullProtoObjectViaActiveX(J):((a=documentCreateElement("iframe")).style.display="none",it.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX(J);for(var c=rt.length;c--;)delete NullProtoObject.prototype[rt[c]];return NullProtoObject()};Ze[ct]=!0;var lt=Object.create||function create(t,a){var c;return null!==t?(EmptyConstructor.prototype=anObject(t),c=new EmptyConstructor,EmptyConstructor.prototype=null,c[ct]=t):c=NullProtoObject(),void 0===a?c:ot.f(c,a)};_export({target:"Object",stat:!0,sham:!N},{create:lt});var ut=W.Object,dt=function create(t,a){return ut.create(t,a)},pt=String,ht=TypeError,ft=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,c={};try{(t=A(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(c,[]),a=c instanceof Array}catch(t){}return function setPrototypeOf(c,h){return anObject(c),function(t){if("object"==typeof t||isCallable(t))return t;throw ht("Can't set "+pt(t)+" as a prototype")}(h),a?t(c,h):c.__proto__=h,c}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:ft});var mt=W.Object.setPrototypeOf,gt=A([].slice),vt=Function,yt=A([].concat),_t=A([].join),Et={},construct$8=function(t,a,c){if(!pe(Et,a)){for(var h=[],m=0;m<a;m++)h[m]="a["+m+"]";Et[a]=vt("C,a","return new C("+_t(h,",")+")")}return Et[a](t,c)},It=g?vt.bind:function bind(t){var a=aCallable(this),c=a.prototype,h=gt(arguments,1),m=function bound(){var c=yt(h,gt(arguments));return this instanceof m?construct$8(a,c.length,c):a.apply(t,c)};return j(c)&&(m.prototype=c),m};_export({target:"Function",proto:!0,forced:Function.bind!==It},{bind:It});var entryVirtual=function(t){return W[t+"Prototype"]},Mt=entryVirtual("Function").bind,Ct=Function.prototype,bind$1=function(t){var a=t.bind;return t===Ct||Y(Ct,t)&&a===Ct.bind?Mt:a},bt=createCommonjsModule((function(t){function _setPrototypeOf(a,c){var h;return t.exports=_setPrototypeOf=mt?bind$1(h=mt).call(h):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,c)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),St=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=dt(a.prototype),t.prototype.constructor=t,bt(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports})));_export({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var Tt={f:Object.getOwnPropertySymbols},Rt=Object.assign,At=Object.defineProperty,Nt=A([].concat),Ot=!Rt||fails((function(){if(N&&1!==Rt({b:1},Rt(At({},"a",{enumerable:!0,get:function(){At(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},c=Symbol(),h="abcdefghijklmnopqrst";return t[c]=7,h.split("").forEach((function(t){a[t]=t})),7!=Rt({},t)[c]||nt(Rt({},a)).join("")!=h}))?function assign(t,a){for(var c=toObject(t),h=arguments.length,m=1,g=Tt.f,E=P.f;h>m;)for(var I,M=U(arguments[m++]),C=g?Nt(nt(M),g(M)):nt(M),b=C.length,S=0;b>S;)I=C[S++],N&&!w(E,M,I)||(c[I]=M[I]);return c}:Rt;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==Ot},{assign:Ot});var wt=W.Object.assign,kt=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),xt=sharedKey("IE_PROTO"),Pt=Object,qt=Pt.prototype,Lt=kt?Pt.getPrototypeOf:function(t){var a=toObject(t);if(pe(a,xt))return a[xt];var c=a.constructor;return isCallable(c)&&a instanceof c?c.prototype:a instanceof Pt?qt:null},Dt=rt.concat("length","prototype"),Vt={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,Dt)}},Ut=A([].concat),Gt=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=Vt.f(anObject(t)),c=Tt.f;return c?Ut(a,c(t)):a},Ft=Error,Bt=A("".replace),jt=String(Ft("zxcasd").stack),Wt=/\n\s*at [^:]*:[^\n]*/,Yt=Wt.test(jt),errorStackClear=function(t,a){if(Yt&&"string"==typeof t&&!Ft.prepareStackTrace)for(;a--;)t=Bt(t,Wt,"");return t},installErrorCause=function(t,a){j(a)&&"cause"in a&&We(t,"cause",a.cause)},$t={},Ht=wellKnownSymbol("iterator"),Qt=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&($t.Array===t||Qt[Ht]===t)},Kt={};Kt[wellKnownSymbol("toStringTag")]="z";var zt="[object z]"===String(Kt),Jt=wellKnownSymbol("toStringTag"),Xt=Object,Zt="Arguments"==classofRaw(function(){return arguments}()),er=zt?classofRaw:function(t){var a,c,h;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(c=function(t,a){try{return t[a]}catch(t){}}(a=Xt(t),Jt))?c:Zt?classofRaw(a):"Object"==(h=classofRaw(a))&&isCallable(a.callee)?"Arguments":h},tr=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,tr)||getMethod(t,"@@iterator")||$t[er(t)]},rr=TypeError,getIterator=function(t,a){var c=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(c))return anObject(w(c,t));throw rr(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,c){var h,m;anObject(t);try{if(!(h=getMethod(t,"return"))){if("throw"===a)throw c;return c}h=w(h,t)}catch(t){m=!0,h=t}if("throw"===a)throw c;if(m)throw h;return anObject(h),c},nr=TypeError,Result=function(t,a){this.stopped=t,this.result=a},ar=Result.prototype,iterate=function(t,a,c){var h,m,g,E,I,M,C,b=c&&c.that,S=!(!c||!c.AS_ENTRIES),T=!(!c||!c.IS_RECORD),R=!(!c||!c.IS_ITERATOR),A=!(!c||!c.INTERRUPTED),N=functionBindContext(a,b),stop=function(t){return h&&iteratorClose(h,"normal",t),new Result(!0,t)},callFn=function(t){return S?(anObject(t),A?N(t[0],t[1],stop):N(t[0],t[1])):A?N(t,stop):N(t)};if(T)h=t.iterator;else if(R)h=t;else{if(!(m=getIteratorMethod$5(t)))throw nr(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(m)){for(g=0,E=lengthOfArrayLike(t);E>g;g++)if((I=callFn(t[g]))&&Y(ar,I))return I;return new Result(!1)}h=getIterator(t,m)}for(M=T?t.next:h.next;!(C=w(M,h)).done;){try{I=callFn(C.value)}catch(t){iteratorClose(h,"throw",t)}if("object"==typeof I&&I&&Y(ar,I))return I}return new Result(!1)},or=String,toString$1=function(t){if("Symbol"===er(t))throw TypeError("Cannot convert a Symbol value to a string");return or(t)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString$1(t)},ir=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),sr=wellKnownSymbol("toStringTag"),cr=Error,lr=[].push,ur=function AggregateError(t,a){var c,h=arguments.length>2?arguments[2]:void 0,m=Y(dr,this);ft?c=ft(cr(),m?Lt(this):dr):(c=m?this:lt(dr),We(c,sr,"Error")),void 0!==a&&We(c,"message",normalizeStringArgument(a)),ir&&We(c,"stack",errorStackClear(c.stack,1)),installErrorCause(c,h);var g=[];return iterate(t,lr,{that:g}),We(c,"errors",g),c};ft?ft(ur,cr):function(t,a,c){for(var h=Gt(a),m=je.f,g=Te.f,E=0;E<h.length;E++){var I=h[E];pe(t,I)||c&&pe(c,I)||m(t,I,g(a,I))}}(ur,cr,{name:!0});var dr=ur.prototype=lt(cr.prototype,{constructor:createPropertyDescriptor(1,ur),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:ur});var pr,hr,fr,mr=m.WeakMap,gr=isCallable(mr)&&/native code/.test(String(mr)),vr="Object already initialized",yr=m.TypeError,_r=m.WeakMap;if(gr||ce.state){var Er=ce.state||(ce.state=new _r),Ir=A(Er.get),Mr=A(Er.has),Cr=A(Er.set);pr=function(t,a){if(Mr(Er,t))throw yr(vr);return a.facade=t,Cr(Er,t,a),a},hr=function(t){return Ir(Er,t)||{}},fr=function(t){return Mr(Er,t)}}else{var br=sharedKey("state");Ze[br]=!0,pr=function(t,a){if(pe(t,br))throw yr(vr);return a.facade=t,We(t,br,a),a},hr=function(t){return pe(t,br)?t[br]:{}},fr=function(t){return pe(t,br)}}var Sr,Tr,Rr,Ar={set:pr,get:hr,has:fr,enforce:function(t){return fr(t)?hr(t):pr(t,{})},getterFor:function(t){return function(a){var c;if(!j(a)||(c=hr(a)).type!==t)throw yr("Incompatible receiver, "+t+" required");return c}}},Nr=Function.prototype,Or=N&&Object.getOwnPropertyDescriptor,wr=pe(Nr,"name"),kr={EXISTS:wr,PROPER:wr&&"something"===function something(){}.name,CONFIGURABLE:wr&&(!N||N&&Or(Nr,"name").configurable)},defineBuiltIn=function(t,a,c,h){return h&&h.enumerable?t[a]=c:We(t,a,c),t},xr=wellKnownSymbol("iterator"),Pr=!1;[].keys&&("next"in(Rr=[].keys())?(Tr=Lt(Lt(Rr)))!==Object.prototype&&(Sr=Tr):Pr=!0);var qr=!j(Sr)||fails((function(){var t={};return Sr[xr].call(t)!==t}));Sr=qr?{}:lt(Sr),isCallable(Sr[xr])||defineBuiltIn(Sr,xr,(function(){return this}));var Lr={IteratorPrototype:Sr,BUGGY_SAFARI_ITERATORS:Pr},Dr=zt?{}.toString:function toString(){return"[object "+er(this)+"]"},Vr=je.f,Ur=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,c,h){if(t){var m=c?t:t.prototype;pe(m,Ur)||Vr(m,Ur,{configurable:!0,value:a}),h&&!zt&&We(m,"toString",Dr)}},Gr=Lr.IteratorPrototype,returnThis$1=function(){return this},Fr=kr.PROPER,Br=Lr.BUGGY_SAFARI_ITERATORS,jr=wellKnownSymbol("iterator"),Wr="keys",Yr="values",$r="entries",returnThis=function(){return this},iteratorDefine=function(t,a,c,h,m,g,E){!function(t,a,c,h){var m=a+" Iterator";t.prototype=lt(Gr,{next:createPropertyDescriptor(+!h,c)}),setToStringTag(t,m,!1,!0),$t[m]=returnThis$1}(c,a,h);var I,M,C,getIterationMethod=function(t){if(t===m&&A)return A;if(!Br&&t in T)return T[t];switch(t){case Wr:return function keys(){return new c(this,t)};case Yr:return function values(){return new c(this,t)};case $r:return function entries(){return new c(this,t)}}return function(){return new c(this)}},b=a+" Iterator",S=!1,T=t.prototype,R=T[jr]||T["@@iterator"]||m&&T[m],A=!Br&&R||getIterationMethod(m),N="Array"==a&&T.entries||R;if(N&&(I=Lt(N.call(new t)))!==Object.prototype&&I.next&&(setToStringTag(I,b,!0,!0),$t[b]=returnThis),Fr&&m==Yr&&R&&R.name!==Yr&&(S=!0,A=function values(){return w(R,this)}),m)if(M={values:getIterationMethod(Yr),keys:g?A:getIterationMethod(Wr),entries:getIterationMethod($r)},E)for(C in M)(Br||S||!(C in T))&&defineBuiltIn(T,C,M[C]);else _export({target:a,proto:!0,forced:Br||S},M);return E&&T[jr]!==A&&defineBuiltIn(T,jr,A,{name:m}),$t[a]=A,M};je.f;var Hr="Array Iterator",Qr=Ar.set,Kr=Ar.getterFor(Hr);iteratorDefine(Array,"Array",(function(t,a){Qr(this,{type:Hr,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=Kr(this),a=t.target,c=t.kind,h=t.index++;return!a||h>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==c?{value:h,done:!1}:"values"==c?{value:a[h],done:!1}:{value:[h,a[h]],done:!1}}),"values"),$t.Arguments=$t.Array;var zr="process"==classofRaw(m.process),Jr=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),c=je.f;N&&a&&!a[Jr]&&c(a,Jr,{configurable:!0,get:function(){return this}})},Xr=TypeError,anInstance=function(t,a){if(Y(a,t))return t;throw Xr("Incorrect invocation")},Zr=A(Function.toString);isCallable(ce.inspectSource)||(ce.inspectSource=function(t){return Zr(t)});var en=ce.inspectSource,noop$1=function(){},tn=[],rn=getBuiltIn("Reflect","construct"),nn=/^\s*(?:class|function)\b/,an=A(nn.exec),sn=!nn.exec(noop$1),cn=function isConstructor(t){if(!isCallable(t))return!1;try{return rn(noop$1,tn,t),!0}catch(t){return!1}},ln=function isConstructor(t){if(!isCallable(t))return!1;switch(er(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return sn||!!an(nn,en(t))}catch(t){return!0}};ln.sham=!0;var un,dn,pn,hn,fn=!rn||fails((function(){var t;return cn(cn.call)||!cn(Object)||!cn((function(){t=!0}))||t}))?ln:cn,mn=TypeError,aConstructor=function(t){if(fn(t))return t;throw mn(tryToString(t)+" is not a constructor")},gn=wellKnownSymbol("species"),speciesConstructor=function(t,a){var c,h=anObject(t).constructor;return void 0===h||isNullOrUndefined(c=anObject(h)[gn])?a:aConstructor(c)},vn=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw vn("Not enough arguments");return t},yn=/(?:ipad|iphone|ipod).*applewebkit/i.test($),_n=m.setImmediate,En=m.clearImmediate,In=m.process,Mn=m.Dispatch,Cn=m.Function,bn=m.MessageChannel,Sn=m.String,Tn=0,Rn={},An="onreadystatechange";try{un=m.location}catch(t){}var run=function(t){if(pe(Rn,t)){var a=Rn[t];delete Rn[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){m.postMessage(Sn(t),un.protocol+"//"+un.host)};_n&&En||(_n=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:Cn(t),c=gt(arguments,1);return Rn[++Tn]=function(){C(a,void 0,c)},dn(Tn),Tn},En=function clearImmediate(t){delete Rn[t]},zr?dn=function(t){In.nextTick(runner(t))}:Mn&&Mn.now?dn=function(t){Mn.now(runner(t))}:bn&&!yn?(hn=(pn=new bn).port2,pn.port1.onmessage=listener,dn=functionBindContext(hn.postMessage,hn)):m.addEventListener&&isCallable(m.postMessage)&&!m.importScripts&&un&&"file:"!==un.protocol&&!fails(post)?(dn=post,m.addEventListener("message",listener,!1)):dn=An in documentCreateElement("script")?function(t){it.appendChild(documentCreateElement("script")).onreadystatechange=function(){it.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var Nn,On,wn,kn,xn,Pn,qn,Ln,Dn={set:_n,clear:En},Vn=/ipad|iphone|ipod/i.test($)&&void 0!==m.Pebble,Un=/web0s(?!.*chrome)/i.test($),Gn=Te.f,Fn=Dn.set,Bn=m.MutationObserver||m.WebKitMutationObserver,jn=m.document,Wn=m.process,Yn=m.Promise,$n=Gn(m,"queueMicrotask"),Hn=$n&&$n.value;Hn||(Nn=function(){var t,a;for(zr&&(t=Wn.domain)&&t.exit();On;){a=On.fn,On=On.next;try{a()}catch(t){throw On?kn():wn=void 0,t}}wn=void 0,t&&t.enter()},yn||zr||Un||!Bn||!jn?!Vn&&Yn&&Yn.resolve?((qn=Yn.resolve(void 0)).constructor=Yn,Ln=functionBindContext(qn.then,qn),kn=function(){Ln(Nn)}):zr?kn=function(){Wn.nextTick(Nn)}:(Fn=functionBindContext(Fn,m),kn=function(){Fn(Nn)}):(xn=!0,Pn=jn.createTextNode(""),new Bn(Nn).observe(Pn,{characterData:!0}),kn=function(){Pn.data=xn=!xn}));var Qn=Hn||function(t){var a={fn:t,next:void 0};wn&&(wn.next=a),On||(On=a,kn()),wn=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Kn,zn,Jn=Queue,Xn=m.Promise,Zn="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,ea=!Zn&&!zr&&"object"==typeof window&&"object"==typeof document,ta=Xn&&Xn.prototype,ra=wellKnownSymbol("species"),na=!1,aa=isCallable(m.PromiseRejectionEvent),oa=ke("Promise",(function(){var t=en(Xn),a=t!==String(Xn);if(!a&&66===X)return!0;if(!ta.catch||!ta.finally)return!0;if(!X||X<51||!/native code/.test(t)){var c=new Xn((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((c.constructor={})[ra]=FakePromise,!(na=c.then((function(){}))instanceof FakePromise))return!0}return!a&&(ea||Zn)&&!aa})),ia={CONSTRUCTOR:oa,REJECTION_EVENT:aa,SUBCLASSING:na},sa=TypeError,PromiseCapability=function(t){var a,c;this.promise=new t((function(t,h){if(void 0!==a||void 0!==c)throw sa("Bad Promise constructor");a=t,c=h})),this.resolve=aCallable(a),this.reject=aCallable(c)},ca={f:function(t){return new PromiseCapability(t)}},la=Dn.set,ua="Promise",da=ia.CONSTRUCTOR,pa=ia.REJECTION_EVENT,ha=Ar.getterFor(ua),fa=Ar.set,ma=Xn&&Xn.prototype,ga=Xn,va=ma,ya=m.TypeError,_a=m.document,Ea=m.process,Ia=ca.f,Ma=Ia,Ca=!!(_a&&_a.createEvent&&m.dispatchEvent),ba="unhandledrejection",isThenable=function(t){var a;return!(!j(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var c,h,m,g=a.value,E=1==a.state,I=E?t.ok:t.fail,M=t.resolve,C=t.reject,b=t.domain;try{I?(E||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===I?c=g:(b&&b.enter(),c=I(g),b&&(b.exit(),m=!0)),c===t.promise?C(ya("Promise-chain cycle")):(h=isThenable(c))?w(h,c,M,C):M(c)):C(g)}catch(t){b&&!m&&b.exit(),C(t)}},notify=function(t,a){t.notified||(t.notified=!0,Qn((function(){for(var c,h=t.reactions;c=h.get();)callReaction(c,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,c){var h,g;Ca?((h=_a.createEvent("Event")).promise=a,h.reason=c,h.initEvent(t,!1,!0),m.dispatchEvent(h)):h={promise:a,reason:c},!pa&&(g=m["on"+t])?g(h):t===ba&&function(t,a){var c=m.console;c&&c.error&&(1==arguments.length?c.error(t):c.error(t,a))}("Unhandled promise rejection",c)},onUnhandled=function(t){w(la,m,(function(){var a,c=t.facade,h=t.value;if(isUnhandled(t)&&(a=perform((function(){zr?Ea.emit("unhandledRejection",h,c):dispatchEvent(ba,c,h)})),t.rejection=zr||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){w(la,m,(function(){var a=t.facade;zr?Ea.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,c){return function(h){t(a,h,c)}},internalReject=function(t,a,c){t.done||(t.done=!0,c&&(t=c),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,c){if(!t.done){t.done=!0,c&&(t=c);try{if(t.facade===a)throw ya("Promise can't be resolved itself");var h=isThenable(a);h?Qn((function(){var c={done:!1};try{w(h,a,bind(internalResolve,c,t),bind(internalReject,c,t))}catch(a){internalReject(c,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};da&&(va=(ga=function Promise(t){anInstance(this,va),aCallable(t),w(Kn,this);var a=ha(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(Kn=function Promise(t){fa(this,{type:ua,done:!1,notified:!1,parent:!1,reactions:new Jn,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn(va,"then",(function then(t,a){var c=ha(this),h=Ia(speciesConstructor(this,ga));return c.parent=!0,h.ok=!isCallable(t)||t,h.fail=isCallable(a)&&a,h.domain=zr?Ea.domain:void 0,0==c.state?c.reactions.add(h):Qn((function(){callReaction(h,c)})),h.promise})),zn=function(){var t=new Kn,a=ha(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},ca.f=Ia=function(t){return t===ga||undefined===t?new zn(t):Ma(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:da},{Promise:ga}),setToStringTag(ga,ua,!1,!0),setSpecies(ua);var Sa=wellKnownSymbol("iterator"),Ta=!1;try{var Ra=0,Aa={next:function(){return{done:!!Ra++}},return:function(){Ta=!0}};Aa[Sa]=function(){return this},Array.from(Aa,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!Ta)return!1;var c=!1;try{var h={};h[Sa]=function(){return{next:function(){return{done:c=!0}}}},t(h)}catch(t){}return c},Na=ia.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){Xn.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:Na},{all:function all(t){var a=this,c=ca.f(a),h=c.resolve,m=c.reject,g=perform((function(){var c=aCallable(a.resolve),g=[],E=0,I=1;iterate(t,(function(t){var M=E++,C=!1;I++,w(c,a,t).then((function(t){C||(C=!0,g[M]=t,--I||h(g))}),m)})),--I||h(g)}));return g.error&&m(g.value),c.promise}});var Oa=ia.CONSTRUCTOR;Xn&&Xn.prototype,_export({target:"Promise",proto:!0,forced:Oa,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:Na},{race:function race(t){var a=this,c=ca.f(a),h=c.reject,m=perform((function(){var m=aCallable(a.resolve);iterate(t,(function(t){w(m,a,t).then(c.resolve,h)}))}));return m.error&&h(m.value),c.promise}}),_export({target:"Promise",stat:!0,forced:ia.CONSTRUCTOR},{reject:function reject(t){var a=ca.f(this);return w(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),j(a)&&a.constructor===t)return a;var c=ca.f(t);return(0,c.resolve)(a),c.promise},wa=ia.CONSTRUCTOR,ka=getBuiltIn("Promise"),xa=!wa;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(xa&&this===ka?Xn:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,c=ca.f(a),h=c.resolve,m=c.reject,g=perform((function(){var c=aCallable(a.resolve),m=[],g=0,E=1;iterate(t,(function(t){var I=g++,M=!1;E++,w(c,a,t).then((function(t){M||(M=!0,m[I]={status:"fulfilled",value:t},--E||h(m))}),(function(t){M||(M=!0,m[I]={status:"rejected",reason:t},--E||h(m))}))})),--E||h(m)}));return g.error&&m(g.value),c.promise}});var Pa="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,c=getBuiltIn("AggregateError"),h=ca.f(a),m=h.resolve,g=h.reject,E=perform((function(){var h=aCallable(a.resolve),E=[],I=0,M=1,C=!1;iterate(t,(function(t){var b=I++,S=!1;M++,w(h,a,t).then((function(t){S||C||(C=!0,m(t))}),(function(t){S||C||(S=!0,E[b]=t,--M||g(new c(E,Pa)))}))})),--M||g(new c(E,Pa))}));return E.error&&g(E.value),h.promise}});var qa=Xn&&Xn.prototype,La=!!Xn&&fails((function(){qa.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:La},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),c=isCallable(t);return this.then(c?function(c){return promiseResolve(a,t()).then((function(){return c}))}:t,c?function(c){return promiseResolve(a,t()).then((function(){throw c}))}:t)}});var Da=A("".charAt),Va=A("".charCodeAt),Ua=A("".slice),createMethod$3=function(t){return function(a,c){var h,m,g=toString$1(requireObjectCoercible(a)),E=toIntegerOrInfinity(c),I=g.length;return E<0||E>=I?t?"":void 0:(h=Va(g,E))<55296||h>56319||E+1===I||(m=Va(g,E+1))<56320||m>57343?t?Da(g,E):h:t?Ua(g,E,E+2):m-56320+(h-55296<<10)+65536}},Ga={codeAt:createMethod$3(!1),charAt:createMethod$3(!0)}.charAt,Fa="String Iterator",Ba=Ar.set,ja=Ar.getterFor(Fa);iteratorDefine(String,"String",(function(t){Ba(this,{type:Fa,string:toString$1(t),index:0})}),(function next(){var t,a=ja(this),c=a.string,h=a.index;return h>=c.length?{value:void 0,done:!0}:(t=Ga(c,h),a.index+=t.length,{value:t,done:!1})}));var Wa=W.Promise,Ya=wellKnownSymbol("toStringTag");for(var $a in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Ha=m[$a],Qa=Ha&&Ha.prototype;Qa&&er(Qa)!==Ya&&We(Qa,Ya,$a),$t[$a]=$t.Array}var Ka=Wa;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=ca.f(this),c=perform(t);return(c.error?a.reject:a.resolve)(c.value),a.promise}});var za=Ka,Ja=Date,Xa=A(Ja.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return Xa(new Ja)}});var Za=W.Date.now,eo=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},to=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw to("Maximum allowed index exceeded");return t},createProperty=function(t,a,c){var h=toPropertyKey(a);h in t?je.f(t,h,createPropertyDescriptor(0,c)):t[h]=c},ro=wellKnownSymbol("species"),no=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return eo(t)&&(a=t.constructor,(fn(a)&&(a===no||eo(a.prototype))||j(a)&&null===(a=a[ro]))&&(a=void 0)),void 0===a?no:a}(t))(0===a?0:a)},ao=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return X>=51||!fails((function(){var a=[];return(a.constructor={})[ao]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},oo=wellKnownSymbol("isConcatSpreadable"),io=X>=51||!fails((function(){var t=[];return t[oo]=!1,t.concat()[0]!==t})),so=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!j(t))return!1;var a=t[oo];return void 0!==a?!!a:eo(t)};_export({target:"Array",proto:!0,arity:1,forced:!io||!so},{concat:function concat(t){var a,c,h,m,g,E=toObject(this),I=arraySpeciesCreate(E,0),M=0;for(a=-1,h=arguments.length;a<h;a++)if(isConcatSpreadable(g=-1===a?E:arguments[a]))for(m=lengthOfArrayLike(g),doesNotExceedSafeInteger(M+m),c=0;c<m;c++,M++)c in g&&createProperty(I,M,g[c]);else doesNotExceedSafeInteger(M+1),createProperty(I,M++,g);return I.length=M,I}});var co=entryVirtual("Array").concat,lo=Array.prototype,concat=function(t){var a=t.concat;return t===lo||Y(lo,t)&&a===lo.concat?co:a},uo=/MSIE .\./.test($),po=m.Function,wrap$1=function(t){return uo?function(a,c){var h=validateArgumentsLength(arguments.length,1)>2,m=isCallable(a)?a:po(a),g=h?gt(arguments,2):void 0;return t(h?function(){C(m,this,g)}:m,c)}:t},ho={setTimeout:wrap$1(m.setTimeout),setInterval:wrap$1(m.setInterval)},fo=ho.setInterval;_export({global:!0,bind:!0,forced:m.setInterval!==fo},{setInterval:fo});var mo=ho.setTimeout;_export({global:!0,bind:!0,forced:m.setTimeout!==mo},{setTimeout:mo});var go=W.setTimeout,vo=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,c="~";function Events(){}function EE(t,a,c){this.fn=t,this.context=a,this.once=c||!1}function addListener(t,a,h,m,g){if("function"!=typeof h)throw new TypeError("The listener must be a function");var E=new EE(h,m||t,g),I=c?c+a:a;return t._events[I]?t._events[I].fn?t._events[I]=[t._events[I],E]:t._events[I].push(E):(t._events[I]=E,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(c=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,h,m=[];if(0===this._eventsCount)return m;for(h in t=this._events)a.call(t,h)&&m.push(c?h.slice(1):h);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(t)):m},EventEmitter.prototype.listeners=function listeners(t){var a=c?c+t:t,h=this._events[a];if(!h)return[];if(h.fn)return[h.fn];for(var m=0,g=h.length,E=new Array(g);m<g;m++)E[m]=h[m].fn;return E},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=c?c+t:t,h=this._events[a];return h?h.fn?1:h.length:0},EventEmitter.prototype.emit=function emit(t,a,h,m,g,E){var I=c?c+t:t;if(!this._events[I])return!1;var M,C,b=this._events[I],S=arguments.length;if(b.fn){switch(b.once&&this.removeListener(t,b.fn,void 0,!0),S){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,a),!0;case 3:return b.fn.call(b.context,a,h),!0;case 4:return b.fn.call(b.context,a,h,m),!0;case 5:return b.fn.call(b.context,a,h,m,g),!0;case 6:return b.fn.call(b.context,a,h,m,g,E),!0}for(C=1,M=new Array(S-1);C<S;C++)M[C-1]=arguments[C];b.fn.apply(b.context,M)}else{var T,R=b.length;for(C=0;C<R;C++)switch(b[C].once&&this.removeListener(t,b[C].fn,void 0,!0),S){case 1:b[C].fn.call(b[C].context);break;case 2:b[C].fn.call(b[C].context,a);break;case 3:b[C].fn.call(b[C].context,a,h);break;case 4:b[C].fn.call(b[C].context,a,h,m);break;default:if(!M)for(T=1,M=new Array(S-1);T<S;T++)M[T-1]=arguments[T];b[C].fn.apply(b[C].context,M)}}return!0},EventEmitter.prototype.on=function on(t,a,c){return addListener(this,t,a,c,!1)},EventEmitter.prototype.once=function once(t,a,c){return addListener(this,t,a,c,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,h,m){var g=c?c+t:t;if(!this._events[g])return this;if(!a)return clearEvent(this,g),this;var E=this._events[g];if(E.fn)E.fn!==a||m&&!E.once||h&&E.context!==h||clearEvent(this,g);else{for(var I=0,M=[],C=E.length;I<C;I++)(E[I].fn!==a||m&&!E[I].once||h&&E[I].context!==h)&&M.push(E[I]);M.length?this._events[g]=1===M.length?M[0]:M:clearEvent(this,g)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=c?c+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=c,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter}));_export({global:!0},{globalThis:m});var yo=je.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==yo,sham:!N},{defineProperty:yo});var _o=createCommonjsModule((function(t){var a=W.Object,c=t.exports=function defineProperty(t,c,h){return a.defineProperty(t,c,h)};a.defineProperty.sham&&(c.sham=!0)})),Eo=_o,Io=A([].push),createMethod$2=function(t){var a=1==t,c=2==t,h=3==t,m=4==t,g=6==t,E=7==t,I=5==t||g;return function(M,C,b,S){for(var T,R,A=toObject(M),N=U(A),O=functionBindContext(C,b),w=lengthOfArrayLike(N),k=0,x=S||arraySpeciesCreate,P=a?x(M,w):c||E?x(M,0):void 0;w>k;k++)if((I||k in N)&&(R=O(T=N[k],k,A),t))if(a)P[k]=R;else if(R)switch(t){case 3:return!0;case 5:return T;case 6:return k;case 2:Io(P,T)}else switch(t){case 4:return!1;case 7:Io(P,T)}return g?-1:h||m?m:P}},Mo={forEach:createMethod$2(0),map:createMethod$2(1),filter:createMethod$2(2),some:createMethod$2(3),every:createMethod$2(4),find:createMethod$2(5),findIndex:createMethod$2(6),filterReject:createMethod$2(7)},arrayMethodIsStrict=function(t,a){var c=[][t];return!!c&&fails((function(){c.call(null,a||function(){return 1},1)}))},Co=Mo.forEach,bo=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return Co(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=bo},{forEach:bo});var So=entryVirtual("Array").forEach,To=Array.prototype,Ro={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===To||Y(To,t)&&a===To.forEach||pe(Ro,er(t))?So:a},Ao=Xe.includes,No=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:No},{includes:function includes(t){return Ao(this,t,arguments.length>1?arguments[1]:void 0)}});var Oo=entryVirtual("Array").includes,wo=wellKnownSymbol("match"),ko=TypeError,notARegexp=function(t){if(function(t){var a;return j(t)&&(void 0!==(a=t[wo])?!!a:"RegExp"==classofRaw(t))}(t))throw ko("The method doesn't accept regular expressions");return t},xo=wellKnownSymbol("match"),correctIsRegexpLogic=function(t){var a=/./;try{"/./"[t](a)}catch(c){try{return a[xo]=!1,"/./"[t](a)}catch(t){}}return!1},Po=A("".indexOf);_export({target:"String",proto:!0,forced:!correctIsRegexpLogic("includes")},{includes:function includes(t){return!!~Po(toString$1(requireObjectCoercible(this)),toString$1(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var qo=entryVirtual("String").includes,Lo=Array.prototype,Do=String.prototype,includes=function(t){var a=t.includes;return t===Lo||Y(Lo,t)&&a===Lo.includes?Oo:"string"==typeof t||t===Do||Y(Do,t)&&a===Do.includes?qo:a},Vo=fails((function(){nt(1)}));_export({target:"Object",stat:!0,forced:Vo},{keys:function keys(t){return nt(toObject(t))}});var Uo=W.Object.keys,Go=Mo.filter,Fo=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!Fo},{filter:function filter(t){return Go(this,t,arguments.length>1?arguments[1]:void 0)}});var Bo=entryVirtual("Array").filter,jo=Array.prototype,filter=function(t){var a=t.filter;return t===jo||Y(jo,t)&&a===jo.filter?Bo:a},Wo=arrayMethodHasSpeciesSupport("slice"),Yo=wellKnownSymbol("species"),$o=Array,Ho=Math.max;_export({target:"Array",proto:!0,forced:!Wo},{slice:function slice(t,a){var c,h,m,g=toIndexedObject(this),E=lengthOfArrayLike(g),I=toAbsoluteIndex(t,E),M=toAbsoluteIndex(void 0===a?E:a,E);if(eo(g)&&(c=g.constructor,(fn(c)&&(c===$o||eo(c.prototype))||j(c)&&null===(c=c[Yo]))&&(c=void 0),c===$o||void 0===c))return gt(g,I,M);for(h=new(void 0===c?$o:c)(Ho(M-I,0)),m=0;I<M;I++,m++)I in g&&createProperty(h,m,g[I]);return h.length=m,h}});var Qo=entryVirtual("Array").slice,Ko=Array.prototype,slice$1=function(t){var a=t.slice;return t===Ko||Y(Ko,t)&&a===Ko.slice?Qo:a},zo=createCommonjsModule((function(t,a){t.exports=function(){function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var c=0;c<a.length;c++){var h=a[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Eo(t,h.key,h)}}function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),Eo(t,"prototype",{writable:!1}),t}var t={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:6e5},a=function emptyFn(){},c=function(){function Reporter(a){_classCallCheck(this,Reporter),this.isUploadEnable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.traceMsgCache={},this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Za(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(a),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){var a=wt({},this.reportConfig.common,t.common);this.reportConfig=wt({},this.reportConfig,t),this.reportConfig.common=a,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function reportImmediately(t,a){var c=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(t,wt({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,h;null===(h=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===h||h.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(a,c){var h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(h.priority||(h.priority=this.getEventPriority(a,c)),this.reportConfig.isDataReportEnable&&a){if("login"===a&&!1===c.succeed&&c.process_id){var m=this.lastFailLogin[c.process_id]||0;if(c.start_time-m<t.loginFailIgnoreInterval)return;this.lastFailLogin[c.process_id]=c.start_time}var g=Za();"HIGH"===h.priority?this.highPriorityMsgList.push({module:a,msg:c,createTime:g}):"NORMAL"===h.priority?this.msgList.push({module:a,msg:c,createTime:g}):"LOW"===h.priority&&this.lowPriorityMsgList.push({module:a,msg:c,createTime:g}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(this.reportConfig.isDataReportEnable&&t&&!this.traceMsgCache[t]){var c=wt(wt({start_time:Za()},a),{extension:[]});this.traceMsgCache[t]=c}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a,c){var h,m=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t]){var g=this.traceMsgCache[t].extension,E=g.length,I=(new Date).getTime();0===E?a.duration=I-this.traceMsgCache[t].start_time:g[E-1].end_time?a.duration=I-g[E-1].end_time:a.duration=I-this.traceMsgCache[t].start_time,g.push(wt({end_time:I},a));var M=g.length-1;(null==c?void 0:c.asyncParams)&&((h=this.traceMsgCache[t]).asyncPromiseArray||(h.asyncPromiseArray=[]),this.traceMsgCache[t].asyncPromiseArray.push(c.asyncParams.then((function(a){m.traceMsgCache[t]&&m.traceMsgCache[t].extension[M]&&wt(m.traceMsgCache[t].extension[M],a)}))))}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a,c,h=this,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t])if("nos"!==t||!1===m){"boolean"==typeof m?this.traceMsgCache[t].succeed=!!m:this.traceMsgCache[t].state=m,this.traceMsgCache[t].duration=Za()-this.traceMsgCache[t].start_time,forEach$1(a=this.traceMsgCache[t].extension).call(a,(function(t){delete t.end_time}));var g=this.traceMsgCache[t];if(this.traceMsgCache[t]=null,g.asyncPromiseArray){(c=this.endedAsyncMsgByModule)[t]||(c[t]=[]),this.endedAsyncMsgByModule[t].push(g);var E=function asyncCallback(){var a;h.endedAsyncMsgByModule[t]&&includes(a=h.endedAsyncMsgByModule[t]).call(a,g)&&(delete g.asyncPromiseArray,h.report(t,g,{priority:h.getEventPriority(t,g)}))};za.all(g.asyncPromiseArray).then(E).catch(E)}else this.report(t,g,{priority:this.getEventPriority(t,g)})}else this.traceMsgCache[t]=null}},{key:"getEventPriority",value:function getEventPriority(t,a){if("exceptions"===t){if(0===a.action)return"HIGH";if(2===a.action)return"HIGH";if(1===a.action&&0!==a.exception_service)return"HIGH"}else{if("msgReceive"===t)return"LOW";if("nim_api_trace"===t)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function reportTraceCancel(t){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[t]=[],this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function restore(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function destroy(){var t,c=this;this.reportConfig.isDataReportEnable&&(forEach$1(t=Uo(this.traceMsgCache)).call(t,(function(t){c.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=a,this.report=a,this.reportTraceStart=a,this.reportTraceUpdate=a,this.reportTraceEnd=a,this.pause=a,this.restore=a,this.destroy=a,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function initUploadConfig(){var t,a,c=this;if(!this.loading){this.loading=!0;var h=this.reportConfig.common||{};try{this.reportConfig.request(this.reportConfig.reportConfigUrl,{method:"GET",dataType:"json",params:{deviceId:h.dev_id,sdkVer:h.sdk_ver,platform:h.platform,appkey:h.app_key},timeout:this.reportConfig.timeout}).then((function(t){var a,h;if(!c.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){var m=t.data.data||{};c.reportConfig.maxSize=m.maxSize>1e3?1e3:m.maxSize,c.reportConfig.maxInterval=m.maxInterval>1e4?1e4:m.maxInterval,c.reportConfig.maxInterval=m.maxInterval<10?10:m.maxInterval,c.reportConfig.minInterval=m.minInterval<2?2:m.minInterval,c.reportConfig.maxDelay=m.maxDelay||300,c.reportConfig.maxInterval=1e3*c.reportConfig.maxInterval,c.reportConfig.minInterval=1e3*c.reportConfig.minInterval,c.reportConfig.maxDelay=1e3*c.reportConfig.maxDelay,c.isUploadEnable=!0,c.initConfigLoaded=!0,c.loading=!1,c.reportHeartBeat()}null===(h=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===h||h.log("Get reporter upload config success")}})).catch((function(t){var a,h;c.loading=!1,null===(h=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===h||h.error("Get reporter upload config failed",t)}))}catch(c){this.loading=!1,null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.error("Exec reporter request failed",c)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=go((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Za()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t,a,c,h,m,g,E=this,I={},M=Za();this.highPriorityMsgList=filter(t=this.highPriorityMsgList).call(t,(function(t){return M-t.createTime<E.reportConfig.maxDelay})),this.msgList=filter(a=this.msgList).call(a,(function(t){return M-t.createTime<E.reportConfig.maxDelay})),this.lowPriorityMsgList=filter(c=this.lowPriorityMsgList).call(c,(function(t){return M-t.createTime<E.reportConfig.maxDelay})),this.cacheMsgList=filter(h=this.cacheMsgList).call(h,(function(t){return M-t.createTime<E.reportConfig.maxDelay}));var C=slice$1(m=this.highPriorityMsgList).call(m,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=slice$1(g=this.highPriorityMsgList).call(g,C.length),C.length<this.reportConfig.maxSize){var b,S,T=this.reportConfig.maxSize-C.length;C=concat(C).call(C,slice$1(b=this.msgList).call(b,0,T)),this.msgList=slice$1(S=this.msgList).call(S,T)}if(C.length<this.reportConfig.maxSize){var R,A,N=this.reportConfig.maxSize-C.length;C=concat(C).call(C,slice$1(R=this.lowPriorityMsgList).call(R,0,N)),this.lowPriorityMsgList=slice$1(A=this.lowPriorityMsgList).call(A,N)}if(C.length<this.reportConfig.maxSize){var O,w,k=this.reportConfig.maxSize-C.length;C=concat(C).call(C,slice$1(O=this.cacheMsgList).call(O,0,k)),this.cacheMsgList=slice$1(w=this.cacheMsgList).call(w,k)}return forEach$1(C).call(C,(function(t){I[t.module]?I[t.module].push(t.msg):I[t.module]=[t.msg]})),{uploadMsgArr:C,uploadMsg:I}}},{key:"upload",value:function upload(){var t,a,c=this;if(this.isUploadEnable&&!(this.lastReportTime&&Za()-this.lastReportTime<this.reportConfig.minInterval)){var h=this.getUploadMsg(),m=h.uploadMsgArr,g=h.uploadMsg;if(m.length){this.lastReportTime=Za();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:g},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,h,g,E;c.cacheMsgList=slice$1(a=concat(h=c.cacheMsgList).call(h,m)).call(a,0,c.reportConfig.cacheMaxSize),null===(E=null===(g=c.reportConfig)||void 0===g?void 0:g.logger)||void 0===E||E.warn("Reporter upload failed",t)}))}catch(c){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",c)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return c}()})),Jo=getDefaultExportFromCjs(createCommonjsModule((function(t){function _defineProperties(t,a){for(var c=0;c<a.length;c++){var h=a[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Eo(t,h.key,h)}}t.exports=function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),Eo(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),Xo=Array,Zo=Math.max,arraySliceSimple=function(t,a,c){for(var h=lengthOfArrayLike(t),m=toAbsoluteIndex(a,h),g=toAbsoluteIndex(void 0===c?h:c,h),E=Xo(Zo(g-m,0)),I=0;m<g;m++,I++)createProperty(E,I,t[m]);return E.length=I,E},ei=Vt.f,ti="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ri={f:function getOwnPropertyNames(t){return ti&&"Window"==classofRaw(t)?function(t){try{return ei(t)}catch(t){return arraySliceSimple(ti)}}(t):ei(toIndexedObject(t))}},ni={f:wellKnownSymbol},ai=je.f,wellKnownSymbolDefine=function(t){var a=W.Symbol||(W.Symbol={});pe(a,t)||ai(a,t,{value:ni.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,c=a&&a.valueOf,h=wellKnownSymbol("toPrimitive");a&&!a[h]&&defineBuiltIn(a,h,(function(t){return w(c,this)}),{arity:1})},oi=Mo.forEach,ii=sharedKey("hidden"),si="Symbol",ci=Ar.set,li=Ar.getterFor(si),ui=Object.prototype,di=m.Symbol,pi=di&&di.prototype,hi=m.TypeError,fi=m.QObject,mi=Te.f,gi=je.f,vi=ri.f,yi=P.f,_i=A([].push),Ei=le("symbols"),Ii=le("op-symbols"),Mi=le("wks"),Ci=!fi||!fi.prototype||!fi.prototype.findChild,bi=N&&fails((function(){return 7!=lt(gi({},"a",{get:function(){return gi(this,"a",{value:7}).a}})).a}))?function(t,a,c){var h=mi(ui,a);h&&delete ui[a],gi(t,a,c),h&&t!==ui&&gi(ui,a,h)}:gi,wrap=function(t,a){var c=Ei[t]=lt(pi);return ci(c,{type:si,tag:t,description:a}),N||(c.description=a),c},Si=function defineProperty(t,a,c){t===ui&&Si(Ii,a,c),anObject(t);var h=toPropertyKey(a);return anObject(c),pe(Ei,h)?(c.enumerable?(pe(t,ii)&&t[ii][h]&&(t[ii][h]=!1),c=lt(c,{enumerable:createPropertyDescriptor(0,!1)})):(pe(t,ii)||gi(t,ii,createPropertyDescriptor(1,{})),t[ii][h]=!0),bi(t,h,c)):gi(t,h,c)},Ti=function defineProperties(t,a){anObject(t);var c=toIndexedObject(a),h=nt(c).concat($getOwnPropertySymbols(c));return oi(h,(function(a){N&&!w(Ri,c,a)||Si(t,a,c[a])})),t},Ri=function propertyIsEnumerable(t){var a=toPropertyKey(t),c=w(yi,this,a);return!(this===ui&&pe(Ei,a)&&!pe(Ii,a))&&(!(c||!pe(this,a)||!pe(Ei,a)||pe(this,ii)&&this[ii][a])||c)},Ai=function getOwnPropertyDescriptor(t,a){var c=toIndexedObject(t),h=toPropertyKey(a);if(c!==ui||!pe(Ei,h)||pe(Ii,h)){var m=mi(c,h);return!m||!pe(Ei,h)||pe(c,ii)&&c[ii][h]||(m.enumerable=!0),m}},Ni=function getOwnPropertyNames(t){var a=vi(toIndexedObject(t)),c=[];return oi(a,(function(t){pe(Ei,t)||pe(Ze,t)||_i(c,t)})),c},$getOwnPropertySymbols=function(t){var a=t===ui,c=vi(a?Ii:toIndexedObject(t)),h=[];return oi(c,(function(t){!pe(Ei,t)||a&&!pe(ui,t)||_i(h,Ei[t])})),h};Z||(di=function Symbol(){if(Y(pi,this))throw hi("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString$1(arguments[0]):void 0,a=uid(t),setter=function(t){this===ui&&w(setter,Ii,t),pe(this,ii)&&pe(this[ii],a)&&(this[ii][a]=!1),bi(this,a,createPropertyDescriptor(1,t))};return N&&Ci&&bi(ui,a,{configurable:!0,set:setter}),wrap(a,t)},pi=di.prototype,defineBuiltIn(pi,"toString",(function toString(){return li(this).tag})),defineBuiltIn(di,"withoutSetter",(function(t){return wrap(uid(t),t)})),P.f=Ri,je.f=Si,ot.f=Ti,Te.f=Ai,Vt.f=ri.f=Ni,Tt.f=$getOwnPropertySymbols,ni.f=function(t){return wrap(wellKnownSymbol(t),t)},N&&gi(pi,"description",{configurable:!0,get:function description(){return li(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!Z,sham:!Z},{Symbol:di}),oi(nt(Mi),(function(t){wellKnownSymbolDefine(t)})),_export({target:si,stat:!0,forced:!Z},{useSetter:function(){Ci=!0},useSimple:function(){Ci=!1}}),_export({target:"Object",stat:!0,forced:!Z,sham:!N},{create:function create(t,a){return void 0===a?lt(t):Ti(lt(t),a)},defineProperty:Si,defineProperties:Ti,getOwnPropertyDescriptor:Ai}),_export({target:"Object",stat:!0,forced:!Z},{getOwnPropertyNames:Ni}),symbolDefineToPrimitive(),setToStringTag(di,si),Ze[ii]=!0;var Oi=Z&&!!Symbol.for&&!!Symbol.keyFor,wi=le("string-to-symbol-registry"),ki=le("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Oi},{for:function(t){var a=toString$1(t);if(pe(wi,a))return wi[a];var c=getBuiltIn("Symbol")(a);return wi[a]=c,ki[c]=a,c}});var xi=le("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Oi},{keyFor:function keyFor(t){if(!re(t))throw TypeError(tryToString(t)+" is not a symbol");if(pe(xi,t))return xi[t]}});var Pi=getBuiltIn("JSON","stringify"),qi=A(/./.exec),Li=A("".charAt),Di=A("".charCodeAt),Vi=A("".replace),Ui=A(1..toString),Gi=/[\uD800-\uDFFF]/g,Fi=/^[\uD800-\uDBFF]$/,Bi=/^[\uDC00-\uDFFF]$/,ji=!Z||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=Pi([t])||"{}"!=Pi({a:t})||"{}"!=Pi(Object(t))})),Wi=fails((function(){return'"\\udf06\\ud834"'!==Pi("\udf06\ud834")||'"\\udead"'!==Pi("\udead")})),stringifyWithSymbolsFix=function(t,a){var c=gt(arguments),h=a;if((j(a)||void 0!==t)&&!re(t))return eo(a)||(a=function(t,a){if(isCallable(h)&&(a=w(h,this,t,a)),!re(a))return a}),c[1]=a,C(Pi,null,c)},fixIllFormed=function(t,a,c){var h=Li(c,a-1),m=Li(c,a+1);return qi(Fi,t)&&!qi(Bi,m)||qi(Bi,t)&&!qi(Fi,h)?"\\u"+Ui(Di(t,0),16):t};Pi&&_export({target:"JSON",stat:!0,arity:3,forced:ji||Wi},{stringify:function stringify(t,a,c){var h=gt(arguments),m=C(ji?stringifyWithSymbolsFix:Pi,null,h);return Wi&&"string"==typeof m?Vi(m,Gi,fixIllFormed):m}});var Yi=!Z||fails((function(){Tt.f(1)}));_export({target:"Object",stat:!0,forced:Yi},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=Tt.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(m.JSON,"JSON",!0);var $i=W.Symbol;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var Hi=$i,Qi=ni.f("iterator"),Ki=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof Hi&&"symbol"==typeof Qi?function(t){return typeof t}:function(t){return t&&"function"==typeof Hi&&t.constructor===Hi&&t!==Hi.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),zi=fails((function(){Lt(1)}));_export({target:"Object",stat:!0,forced:zi,sham:!kt},{getPrototypeOf:function getPrototypeOf(t){return Lt(toObject(t))}});var Ji=W.Object.getPrototypeOf,Xi=A([].reverse),Zi=[1,2];_export({target:"Array",proto:!0,forced:String(Zi)===String(Zi.reverse())},{reverse:function reverse(){return eo(this)&&(this.length=this.length),Xi(this)}});var es=entryVirtual("Array").reverse,ts=Array.prototype,reverse=function(t){var a=t.reverse;return t===ts||Y(ts,t)&&a===ts.reverse?es:a},rs=createCommonjsModule((function(t){var a=Ki.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return c},t.exports.__esModule=!0,t.exports.default=t.exports;var c={},h=Object.prototype,m=h.hasOwnProperty,g="function"==typeof Hi?Hi:{},E=g.iterator||"@@iterator",I=g.asyncIterator||"@@asyncIterator",M=g.toStringTag||"@@toStringTag";function define(t,a,c){return Eo(t,a,{value:c,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,c){return t[a]=c}}function wrap(t,a,c,h){var m=a&&a.prototype instanceof Generator?a:Generator,g=dt(m.prototype),E=new Context(h||[]);return g._invoke=function(t,a,c){var h="suspendedStart";return function(m,g){if("executing"===h)throw new Error("Generator is already running");if("completed"===h){if("throw"===m)throw g;return doneResult()}for(c.method=m,c.arg=g;;){var E=c.delegate;if(E){var I=maybeInvokeDelegate(E,c);if(I){if(I===C)continue;return I}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===h)throw h="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);h="executing";var M=tryCatch(t,a,c);if("normal"===M.type){if(h=c.done?"completed":"suspendedYield",M.arg===C)continue;return{value:M.arg,done:c.done}}"throw"===M.type&&(h="completed",c.method="throw",c.arg=M.arg)}}}(t,c,E),g}function tryCatch(t,a,c){try{return{type:"normal",arg:t.call(a,c)}}catch(t){return{type:"throw",arg:t}}}c.wrap=wrap;var C={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var b={};define(b,E,(function(){return this}));var S=Ji&&Ji(Ji(values([])));S&&S!==h&&m.call(S,E)&&(b=S);var T=GeneratorFunctionPrototype.prototype=Generator.prototype=dt(b);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,c){function invoke(h,g,E,I){var M=tryCatch(t[h],t,g);if("throw"!==M.type){var C=M.arg,b=C.value;return b&&"object"==a(b)&&m.call(b,"__await")?c.resolve(b.__await).then((function(t){invoke("next",t,E,I)}),(function(t){invoke("throw",t,E,I)})):c.resolve(b).then((function(t){C.value=t,E(C)}),(function(t){return invoke("throw",t,E,I)}))}I(M.arg)}var h;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new c((function(c,h){invoke(t,a,c,h)}))}return h=h?h.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var c=t.iterator[a.method];if(void 0===c){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return C;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}var h=tryCatch(c,t.iterator,a.arg);if("throw"===h.type)return a.method="throw",a.arg=h.arg,a.delegate=null,C;var m=h.arg;return m?m.done?(a[t.resultName]=m.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,C):m:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,C)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[E];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var c=-1,h=function next(){for(;++c<t.length;)if(m.call(t,c))return next.value=t[c],next.done=!1,next;return next.value=void 0,next.done=!0,next};return h.next=h}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(T,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,M,"GeneratorFunction"),c.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},c.mark=function(t){return mt?mt(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,M,"GeneratorFunction")),t.prototype=dt(T),t},c.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,I,(function(){return this})),c.AsyncIterator=AsyncIterator,c.async=function(t,a,h,m,g){void 0===g&&(g=za);var E=new AsyncIterator(wrap(t,a,h,m),g);return c.isGeneratorFunction(a)?E:E.next().then((function(t){return t.done?t.value:E.next()}))},defineIteratorMethods(T),define(T,M,"Generator"),define(T,E,(function(){return this})),define(T,"toString",(function(){return"[object Generator]"})),c.keys=function(t){var a=[];for(var c in t)a.push(c);return reverse(a).call(a),function next(){for(;a.length;){var c=a.pop();if(c in t)return next.value=c,next.done=!1,next}return next.done=!0,next}},c.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var c in this)"t"===c.charAt(0)&&m.call(this,c)&&!isNaN(+slice$1(c).call(c,1))&&(this[c]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(c,h){return g.type="throw",g.arg=t,a.next=c,h&&(a.method="next",a.arg=void 0),!!h}for(var c=this.tryEntries.length-1;c>=0;--c){var h=this.tryEntries[c],g=h.completion;if("root"===h.tryLoc)return handle("end");if(h.tryLoc<=this.prev){var E=m.call(h,"catchLoc"),I=m.call(h,"finallyLoc");if(E&&I){if(this.prev<h.catchLoc)return handle(h.catchLoc,!0);if(this.prev<h.finallyLoc)return handle(h.finallyLoc)}else if(E){if(this.prev<h.catchLoc)return handle(h.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return handle(h.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var c=this.tryEntries.length-1;c>=0;--c){var h=this.tryEntries[c];if(h.tryLoc<=this.prev&&m.call(h,"finallyLoc")&&this.prev<h.finallyLoc){var g=h;break}}g&&("break"===t||"continue"===t)&&g.tryLoc<=a&&a<=g.finallyLoc&&(g=null);var E=g?g.completion:{};return E.type=t,E.arg=a,g?(this.method="next",this.next=g.finallyLoc,C):this.complete(E)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),C},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.finallyLoc===t)return this.complete(c.completion,c.afterLoc),resetTryEntry(c),C}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.tryLoc===t){var h=c.completion;if("throw"===h.type){var m=h.arg;resetTryEntry(c)}return m}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,c){return this.delegate={iterator:values(t),resultName:a,nextLoc:c},"next"===this.method&&(this.arg=void 0),C}},c}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),ns=rs(),as=ns;try{regeneratorRuntime=ns}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=ns:Function("r","regeneratorRuntime = r")(ns)}var os=Xe.indexOf,is=A([].indexOf),ss=!!is&&1/is([1],1,-0)<0,cs=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:ss||!cs},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return ss?is(this,t,a)||0:os(this,t,a)}});var ls=entryVirtual("Array").indexOf,us=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===us||Y(us,t)&&a===us.indexOf?ls:a};W.JSON||(W.JSON={stringify:JSON.stringify});var ds=function stringify(t,a,c){return C(W.JSON.stringify,null,arguments)},ps=ds,hs=Mo.some,fs=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!fs},{some:function some(t){return hs(this,t,arguments.length>1?arguments[1]:void 0)}});var ms=entryVirtual("Array").some,gs=Array.prototype,some=function(t){var a=t.some;return t===gs||Y(gs,t)&&a===gs.some?ms:a};function __rest(t,a){var c={};for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&a.indexOf(h)<0&&(c[h]=t[h]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var m=0;for(h=Object.getOwnPropertySymbols(t);m<h.length;m++)a.indexOf(h[m])<0&&Object.prototype.propertyIsEnumerable.call(t,h[m])&&(c[h[m]]=t[h[m]])}return c}function __awaiter(t,a,c,h){return new(c||(c=Promise))((function(m,g){function fulfilled(t){try{step(h.next(t))}catch(t){g(t)}}function rejected(t){try{step(h.throw(t))}catch(t){g(t)}}function step(t){t.done?m(t.value):function adopt(t){return t instanceof c?t:new c((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((h=h.apply(t,a||[])).next())}))}var vs=Array.isArray,ys="object"==typeof t&&t&&t.Object===Object&&t,_s="object"==typeof self&&self&&self.Object===Object&&self,Es=ys||_s||Function("return this")(),Is=Es.Symbol,Ms=Object.prototype,Cs=Ms.hasOwnProperty,bs=Ms.toString,Ss=Is?Is.toStringTag:void 0;var Ts=function getRawTag(t){var a=Cs.call(t,Ss),c=t[Ss];try{t[Ss]=void 0;var h=!0}catch(t){}var m=bs.call(t);return h&&(a?t[Ss]=c:delete t[Ss]),m},Rs=Object.prototype.toString;var As=function objectToString(t){return Rs.call(t)},Ns=Is?Is.toStringTag:void 0;var Os=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ns&&Ns in Object(t)?Ts(t):As(t)};var ws=function isObjectLike(t){return null!=t&&"object"==typeof t};var ks=function isSymbol(t){return"symbol"==typeof t||ws(t)&&"[object Symbol]"==Os(t)},xs=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ps=/^\w*$/;var qs=function isKey(t,a){if(vs(t))return!1;var c=typeof t;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=t&&!ks(t))||(Ps.test(t)||!xs.test(t)||null!=a&&t in Object(a))};var Ls=function isObject$1(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var Ds=function isFunction(t){if(!Ls(t))return!1;var a=Os(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},Vs=Es["__core-js_shared__"],Us=function(){var t=/[^.]+$/.exec(Vs&&Vs.keys&&Vs.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Gs=function isMasked(t){return!!Us&&Us in t},Fs=Function.prototype.toString;var Bs=function toSource(t){if(null!=t){try{return Fs.call(t)}catch(t){}try{return t+""}catch(t){}}return""},js=/^\[object .+?Constructor\]$/,Ws=Function.prototype,Ys=Object.prototype,$s=Ws.toString,Hs=Ys.hasOwnProperty,Qs=RegExp("^"+$s.call(Hs).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ks=function baseIsNative(t){return!(!Ls(t)||Gs(t))&&(Ds(t)?Qs:js).test(Bs(t))};var zs=function getValue(t,a){return null==t?void 0:t[a]};var Js=function getNative(t,a){var c=zs(t,a);return Ks(c)?c:void 0},Xs=Js(Object,"create");var Zs=function hashClear(){this.__data__=Xs?Xs(null):{},this.size=0};var ec=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},tc=Object.prototype.hasOwnProperty;var rc=function hashGet(t){var a=this.__data__;if(Xs){var c=a[t];return"__lodash_hash_undefined__"===c?void 0:c}return tc.call(a,t)?a[t]:void 0},nc=Object.prototype.hasOwnProperty;var ac=function hashHas(t){var a=this.__data__;return Xs?void 0!==a[t]:nc.call(a,t)};var oc=function hashSet(t,a){var c=this.__data__;return this.size+=this.has(t)?0:1,c[t]=Xs&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var h=t[a];this.set(h[0],h[1])}}Hash.prototype.clear=Zs,Hash.prototype.delete=ec,Hash.prototype.get=rc,Hash.prototype.has=ac,Hash.prototype.set=oc;var ic=Hash;var sc=function listCacheClear(){this.__data__=[],this.size=0};var cc=function eq(t,a){return t===a||t!=t&&a!=a};var lc=function assocIndexOf(t,a){for(var c=t.length;c--;)if(cc(t[c][0],a))return c;return-1},uc=Array.prototype.splice;var dc=function listCacheDelete(t){var a=this.__data__,c=lc(a,t);return!(c<0)&&(c==a.length-1?a.pop():uc.call(a,c,1),--this.size,!0)};var pc=function listCacheGet(t){var a=this.__data__,c=lc(a,t);return c<0?void 0:a[c][1]};var hc=function listCacheHas(t){return lc(this.__data__,t)>-1};var fc=function listCacheSet(t,a){var c=this.__data__,h=lc(c,t);return h<0?(++this.size,c.push([t,a])):c[h][1]=a,this};function ListCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var h=t[a];this.set(h[0],h[1])}}ListCache.prototype.clear=sc,ListCache.prototype.delete=dc,ListCache.prototype.get=pc,ListCache.prototype.has=hc,ListCache.prototype.set=fc;var mc=ListCache,gc=Js(Es,"Map");var vc=function mapCacheClear(){this.size=0,this.__data__={hash:new ic,map:new(gc||mc),string:new ic}};var yc=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var _c=function getMapData(t,a){var c=t.__data__;return yc(a)?c["string"==typeof a?"string":"hash"]:c.map};var Ec=function mapCacheDelete(t){var a=_c(this,t).delete(t);return this.size-=a?1:0,a};var Ic=function mapCacheGet(t){return _c(this,t).get(t)};var Mc=function mapCacheHas(t){return _c(this,t).has(t)};var Cc=function mapCacheSet(t,a){var c=_c(this,t),h=c.size;return c.set(t,a),this.size+=c.size==h?0:1,this};function MapCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var h=t[a];this.set(h[0],h[1])}}MapCache.prototype.clear=vc,MapCache.prototype.delete=Ec,MapCache.prototype.get=Ic,MapCache.prototype.has=Mc,MapCache.prototype.set=Cc;var bc=MapCache;function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var c=arguments,h=a?a.apply(this,c):c[0],m=memoized.cache;if(m.has(h))return m.get(h);var g=t.apply(this,c);return memoized.cache=m.set(h,g)||m,g};return memoized.cache=new(memoize.Cache||bc),memoized}memoize.Cache=bc;var Sc=memoize;var Tc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rc=/\\(\\)?/g,Ac=function memoizeCapped(t){var a=Sc(t,(function(t){return 500===c.size&&c.clear(),t})),c=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(Tc,(function(t,c,h,m){a.push(h?m.replace(Rc,"$1"):c||t)})),a})),Nc=Ac;var Oc=function arrayMap(t,a){for(var c=-1,h=null==t?0:t.length,m=Array(h);++c<h;)m[c]=a(t[c],c,t);return m},wc=Is?Is.prototype:void 0,kc=wc?wc.toString:void 0;var xc=function baseToString(t){if("string"==typeof t)return t;if(vs(t))return Oc(t,baseToString)+"";if(ks(t))return kc?kc.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Pc=function toString(t){return null==t?"":xc(t)};var qc=function castPath(t,a){return vs(t)?t:qs(t,a)?[t]:Nc(Pc(t))};var Lc=function toKey(t){if("string"==typeof t||ks(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Dc=function baseGet(t,a){for(var c=0,h=(a=qc(a,t)).length;null!=t&&c<h;)t=t[Lc(a[c++])];return c&&c==h?t:void 0};var Vc=function get(t,a,c){var h=null==t?void 0:Dc(t,a);return void 0===h?c:h},Uc=Mo.map,Gc=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!Gc},{map:function map(t){return Uc(this,t,arguments.length>1?arguments[1]:void 0)}});var Fc=entryVirtual("Array").map,Bc=Array.prototype,map$6=function(t){var a=t.map;return t===Bc||Y(Bc,t)&&a===Bc.map?Fc:a},jc="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Wc=A("".replace),Yc="["+jc+"]",$c=RegExp("^"+Yc+Yc+"*"),Hc=RegExp(Yc+Yc+"*$"),createMethod$1=function(t){return function(a){var c=toString$1(requireObjectCoercible(a));return 1&t&&(c=Wc(c,$c,"")),2&t&&(c=Wc(c,Hc,"")),c}},Qc={start:createMethod$1(1),end:createMethod$1(2),trim:createMethod$1(3)},Kc=Qc.trim,zc=m.parseInt,Jc=m.Symbol,Xc=Jc&&Jc.iterator,Zc=/^[+-]?0x/i,el=A(Zc.exec),tl=8!==zc(jc+"08")||22!==zc(jc+"0x16")||Xc&&!fails((function(){zc(Object(Xc))}))?function parseInt(t,a){var c=Kc(toString$1(t));return zc(c,a>>>0||(el(Zc,c)?16:10))}:zc;_export({global:!0,forced:parseInt!=tl},{parseInt:tl});var rl=W.parseInt,nl=Math.min,al=[].lastIndexOf,ol=!!al&&1/[1].lastIndexOf(1,-0)<0,il=arrayMethodIsStrict("lastIndexOf"),sl=ol||!il?function lastIndexOf(t){if(ol)return C(al,this,arguments)||0;var a=toIndexedObject(this),c=lengthOfArrayLike(a),h=c-1;for(arguments.length>1&&(h=nl(h,toIntegerOrInfinity(arguments[1]))),h<0&&(h=c+h);h>=0;h--)if(h in a&&a[h]===t)return h||0;return-1}:al;_export({target:"Array",proto:!0,forced:sl!==[].lastIndexOf},{lastIndexOf:sl});var cl=entryVirtual("Array").lastIndexOf,ll=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===ll||Y(ll,t)&&a===ll.lastIndexOf?cl:a},ul=Mo.findIndex,dl="findIndex",pl=!0;dl in[]&&Array(1).findIndex((function(){pl=!1})),_export({target:"Array",proto:!0,forced:pl},{findIndex:function findIndex(t){return ul(this,t,arguments.length>1?arguments[1]:void 0)}});var hl=entryVirtual("Array").findIndex,fl=Array.prototype,findIndex=function(t){var a=t.findIndex;return t===fl||Y(fl,t)&&a===fl.findIndex?hl:a},ml=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),gl=Object.isExtensible,vl=fails((function(){gl(1)}))||ml?function isExtensible(t){return!!j(t)&&((!ml||"ArrayBuffer"!=classofRaw(t))&&(!gl||gl(t)))}:gl,yl=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),_l=createCommonjsModule((function(t){var a=je.f,c=!1,h=uid("meta"),m=0,setMetadata=function(t){a(t,h,{value:{objectID:"O"+m++,weakData:{}}})},g=t.exports={enable:function(){g.enable=function(){},c=!0;var t=Vt.f,a=A([].splice),m={};m[h]=1,t(m).length&&(Vt.f=function(c){for(var m=t(c),g=0,E=m.length;g<E;g++)if(m[g]===h){a(m,g,1);break}return m},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ri.f}))},fastKey:function(t,a){if(!j(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!pe(t,h)){if(!vl(t))return"F";if(!a)return"E";setMetadata(t)}return t[h].objectID},getWeakData:function(t,a){if(!pe(t,h)){if(!vl(t))return!0;if(!a)return!1;setMetadata(t)}return t[h].weakData},onFreeze:function(t){return yl&&c&&vl(t)&&!pe(t,h)&&setMetadata(t),t}};Ze[h]=!0})),El=je.f,Il=Mo.forEach,Ml=Ar.set,Cl=Ar.getterFor,collection=function(t,a,c){var h,g=-1!==t.indexOf("Map"),E=-1!==t.indexOf("Weak"),I=g?"set":"add",M=m[t],C=M&&M.prototype,b={};if(N&&isCallable(M)&&(E||C.forEach&&!fails((function(){(new M).entries().next()})))){var S=(h=a((function(a,c){Ml(anInstance(a,S),{type:t,collection:new M}),null!=c&&iterate(c,a[I],{that:a,AS_ENTRIES:g})}))).prototype,T=Cl(t);Il(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in C)||E&&"clear"==t||We(S,t,(function(c,h){var m=T(this).collection;if(!a&&E&&!j(c))return"get"==t&&void 0;var g=m[t](0===c?0:c,h);return a?this:g}))})),E||El(S,"size",{configurable:!0,get:function(){return T(this).collection.size}})}else h=c.getConstructor(a,t,g,I),_l.enable();return setToStringTag(h,t,!1,!0),b[t]=h,_export({global:!0,forced:!0},b),E||c.setStrong(h,t,g),h},defineBuiltIns=function(t,a,c){for(var h in a)c&&c.unsafe&&t[h]?t[h]=a[h]:defineBuiltIn(t,h,a[h],c);return t},bl=je.f,Sl=_l.fastKey,Tl=Ar.set,Rl=Ar.getterFor,Al={getConstructor:function(t,a,c,h){var m=t((function(t,m){anInstance(t,g),Tl(t,{type:a,index:lt(null),first:void 0,last:void 0,size:0}),N||(t.size=0),isNullOrUndefined(m)||iterate(m,t[h],{that:t,AS_ENTRIES:c})})),g=m.prototype,E=Rl(a),define=function(t,a,c){var h,m,g=E(t),I=getEntry(t,a);return I?I.value=c:(g.last=I={index:m=Sl(a,!0),key:a,value:c,previous:h=g.last,next:void 0,removed:!1},g.first||(g.first=I),h&&(h.next=I),N?g.size++:t.size++,"F"!==m&&(g.index[m]=I)),t},getEntry=function(t,a){var c,h=E(t),m=Sl(a);if("F"!==m)return h.index[m];for(c=h.first;c;c=c.next)if(c.key==a)return c};return defineBuiltIns(g,{clear:function clear(){for(var t=E(this),a=t.index,c=t.first;c;)c.removed=!0,c.previous&&(c.previous=c.previous.next=void 0),delete a[c.index],c=c.next;t.first=t.last=void 0,N?t.size=0:this.size=0},delete:function(t){var a=this,c=E(a),h=getEntry(a,t);if(h){var m=h.next,g=h.previous;delete c.index[h.index],h.removed=!0,g&&(g.next=m),m&&(m.previous=g),c.first==h&&(c.first=m),c.last==h&&(c.last=g),N?c.size--:a.size--}return!!h},forEach:function forEach(t){for(var a,c=E(this),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:c.first;)for(h(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(g,c?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),N&&bl(g,"size",{get:function(){return E(this).size}}),m},setStrong:function(t,a,c){var h=a+" Iterator",m=Rl(a),g=Rl(h);iteratorDefine(t,a,(function(t,a){Tl(this,{type:h,target:t,state:m(t),kind:a,last:void 0})}),(function(){for(var t=g(this),a=t.kind,c=t.last;c&&c.removed;)c=c.previous;return t.target&&(t.last=c=c?c.next:t.state.first)?"keys"==a?{value:c.key,done:!1}:"values"==a?{value:c.value,done:!1}:{value:[c.key,c.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),c?"entries":"values",!c,!0),setSpecies(a)}};collection("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),Al);var Nl=W.Map,Ol=[].push,wl=function from(t){var a,c,h,m,g=arguments.length,E=g>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==E)&&aCallable(E),isNullOrUndefined(t)?new this:(c=[],a?(h=0,m=functionBindContext(E,g>2?arguments[2]:void 0),iterate(t,(function(t){w(Ol,c,m(t,h++))}))):iterate(t,Ol,{that:c}),new this(c))};_export({target:"Map",stat:!0,forced:!0},{from:wl});var kl=function of(){return new this(gt(arguments))};_export({target:"Map",stat:!0,forced:!0},{of:kl});var xl=function deleteAll(){for(var t,a=anObject(this),c=aCallable(a.delete),h=!0,m=0,g=arguments.length;m<g;m++)t=w(c,a,arguments[m]),h=h&&t;return!!h};_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:xl});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var c,h,m=anObject(this),g=aCallable(m.get),E=aCallable(m.has),I=aCallable(m.set);return w(E,m,t)?(c=w(g,m,t),"update"in a&&(c=a.update(c,t,m),w(I,m,t,c)),c):(h=a.insert(t,m),w(I,m,t,h),h)}});var Pl=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c,m){if(!h(c,t,a))return m()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(m.set);return iterate(c,(function(t,c){h(c,t,a)&&w(g,m,t,c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,m){if(h(c,t,a))return m(c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,m){if(h(c,t,a))return m(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var ql=A([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var c=getIterator(t),h=new this,m=aCallable(h.has),g=aCallable(h.get),E=aCallable(h.set);return iterate(c,(function(t){var c=a(t);w(m,h,c)?ql(w(g,h,c),t):w(E,h,c,[t])}),{IS_ITERATOR:!0}),h}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(Pl(anObject(this)),(function(a,c,h){if((m=c)===(g=t)||m!=m&&g!=g)return h();var m,g}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var c=new this;aCallable(a);var h=aCallable(c.set);return iterate(t,(function(t){w(h,c,a(t),t)})),c}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(Pl(anObject(this)),(function(a,c,h){if(c===t)return h(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(m.set);return iterate(c,(function(t,c){w(g,m,h(c,t,a),c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(m.set);return iterate(c,(function(t,c){w(g,m,t,h(c,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),c=aCallable(a.set),h=arguments.length,m=0;m<h;)iterate(arguments[m++],c,{that:a,AS_ENTRIES:!0});return a}});var Ll=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=Pl(a),h=arguments.length<2,m=h?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c,g){h?(h=!1,m=g):m=t(m,g,c,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h)throw Ll("Reduce of empty map with no initial value");return m}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=Pl(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,m){if(h(c,t,a))return m()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Dl=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var c=anObject(this),h=aCallable(c.get),m=aCallable(c.has),g=aCallable(c.set),E=arguments.length;aCallable(a);var I=w(m,c,t);if(!I&&E<3)throw Dl("Updating absent value");var M=I?w(h,c,t):aCallable(E>2?arguments[2]:void 0)(t,c);return w(g,c,t,a(M,t,c)),c}});var Vl=TypeError,Ul=function upsert(t,a){var c,h=anObject(this),m=aCallable(h.get),g=aCallable(h.has),E=aCallable(h.set),I=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(I))throw Vl("At least one callback required");return w(g,h,t)?(c=w(m,h,t),isCallable(a)&&(c=a(c),w(E,h,t,c))):isCallable(I)&&(c=I(),w(E,h,t,c)),c};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:Ul}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:Ul});var Gl=Nl,Fl=createCommonjsModule((function(t){function _getPrototypeOf(a){var c;return t.exports=_getPrototypeOf=mt?bind$1(c=Ji).call(c):function _getPrototypeOf(t){return t.__proto__||Ji(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Bl=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),jl=getBuiltIn("Reflect","construct"),Wl=Object.prototype,Yl=[].push,$l=fails((function(){function F(){}return!(jl((function(){}),[],F)instanceof F)})),Hl=!fails((function(){jl((function(){}))})),Ql=$l||Hl;_export({target:"Reflect",stat:!0,forced:Ql,sham:Ql},{construct:function construct(t,a){aConstructor(t),anObject(a);var c=arguments.length<3?t:aConstructor(arguments[2]);if(Hl&&!$l)return jl(t,a,c);if(t==c){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var h=[null];return C(Yl,h,a),new(C(It,t,h))}var m=c.prototype,g=lt(j(m)?m:Wl),E=C(t,g,a);return j(E)?E:g}});var Kl=W.Reflect.construct,zl=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Kl)return!1;if(Kl.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Kl(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),Jl=createCommonjsModule((function(t){function _construct(a,c,h){var m;zl()?(t.exports=_construct=bind$1(m=Kl).call(m),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,c){var h=[null];h.push.apply(h,a);var m=new(bind$1(Function).apply(t,h));return c&&bt(m,c.prototype),m},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),Xl=createCommonjsModule((function(t){function _wrapNativeSuper(a){var c="function"==typeof Gl?new Gl:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!Bl(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(t))return c.get(t);c.set(t,Wrapper)}function Wrapper(){return Jl(t,arguments,Fl(this).constructor)}return Wrapper.prototype=dt(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),bt(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),Zl=getDefaultExportFromCjs(Xl),eu=TypeError,createMethod=function(t){return function(a,c,h,m){aCallable(c);var g=toObject(a),E=U(g),I=lengthOfArrayLike(g),M=t?I-1:0,C=t?-1:1;if(h<2)for(;;){if(M in E){m=E[M],M+=C;break}if(M+=C,t?M<0:I<=M)throw eu("Reduce of empty array with no initial value")}for(;t?M>=0:I>M;M+=C)M in E&&(m=c(m,E[M],M,g));return m}},tu={left:createMethod(!1),right:createMethod(!0)}.left,ru=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!ru||!zr&&X>79&&X<83},{reduce:function reduce(t){var a=arguments.length;return tu(this,t,a,a>1?arguments[1]:void 0)}});var nu,au,ou,iu,su,cu,lu,uu,du,pu,hu,fu,mu,gu,vu,yu,_u,Eu,Iu,Mu,Cu,bu,Su,Tu,Ru,Au,Nu,Ou,wu,ku,xu,Pu,qu,Lu,Du,Vu,Uu,Gu,Fu,Bu,ju,Wu,Yu,$u,Hu,Qu,Ku,zu,Ju=entryVirtual("Array").reduce,Xu=Array.prototype,reduce=function(t){var a=t.reduce;return t===Xu||Y(Xu,t)&&a===Xu.reduce?Ju:a};!function(t){t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(nu||(nu={})),function(t){t[t.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",t[t.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",t[t.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(au||(au={})),function(t){t[t.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",t[t.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",t[t.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(ou||(ou={})),function(t){t[t.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",t[t.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",t[t.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",t[t.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(iu||(iu={})),function(t){t[t.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",t[t.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",t[t.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(su||(su={})),function(t){t[t.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",t[t.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(cu||(cu={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(lu||(lu={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(uu||(uu={})),function(t){t[t.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",t[t.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(du||(du={})),function(t){t[t.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",t[t.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",t[t.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",t[t.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(pu||(pu={})),function(t){t[t.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",t[t.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",t[t.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(hu||(hu={})),function(t){t[t.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",t[t.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",t[t.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",t[t.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(fu||(fu={})),function(t){t[t.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",t[t.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",t[t.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",t[t.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",t[t.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",t[t.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",t[t.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",t[t.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",t[t.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(mu||(mu={})),function(t){t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",t[t.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(gu||(gu={})),function(t){t[t.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(vu||(vu={})),function(t){t[t.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",t[t.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(yu||(yu={})),function(t){t[t.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",t[t.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",t[t.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(_u||(_u={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(Eu||(Eu={})),function(t){t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(Iu||(Iu={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(Mu||(Mu={})),function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(Cu||(Cu={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(bu||(bu={})),function(t){t[t.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(Su||(Su={})),function(t){t[t.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(Tu||(Tu={})),function(t){t[t.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",t[t.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(Ru||(Ru={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(Au||(Au={})),function(t){t[t.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",t[t.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(Nu||(Nu={})),function(t){t[t.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",t[t.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",t[t.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",t[t.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",t[t.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",t[t.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",t[t.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",t[t.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(Ou||(Ou={})),function(t){t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(wu||(wu={})),function(t){t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(ku||(ku={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(xu||(xu={})),function(t){t[t.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",t[t.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",t[t.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(Pu||(Pu={})),function(t){t[t.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",t[t.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",t[t.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(qu||(qu={})),function(t){t[t.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",t[t.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(Lu||(Lu={})),function(t){t[t.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",t[t.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(Du||(Du={})),function(t){t[t.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(Vu||(Vu={})),function(t){t[t.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(Uu||(Uu={})),function(t){t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(Gu||(Gu={})),function(t){t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL=0]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER=1]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE=2]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE"}(Fu||(Fu={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",t[t.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(Bu||(Bu={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(ju||(ju={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(Wu||(Wu={})),function(t){t[t.teamApply=0]="teamApply",t[t.teamApplyReject=1]="teamApplyReject",t[t.teamInvite=2]="teamInvite",t[t.teamInviteReject=3]="teamInviteReject",t[t.tlistUpdate=4]="tlistUpdate",t[t.superTeamApply=15]="superTeamApply",t[t.superTeamApplyReject=16]="superTeamApplyReject",t[t.superTeamInvite=17]="superTeamInvite",t[t.superTeamInviteReject=18]="superTeamInviteReject"}(Yu||(Yu={})),function(t){t[t.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",t[t.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",t[t.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",t[t.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}($u||($u={})),function(t){t.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",t.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",t.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(Hu||(Hu={})),function(t){t[t.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",t[t.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",t[t.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",t[t.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(Qu||(Qu={})),function(t){t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(Ku||(Ku={})),function(t){t[t.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",t[t.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",t[t.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",t[t.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(zu||(zu={}));var Zu={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failedï¼use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},ed=Uo(Zu),td=reduce(ed).call(ed,(function(t,a){var c=Zu[a];return t[a]=c.code,t}),{}),rd=reduce(ed).call(ed,(function(t,a){var c=Zu[a];return t[c.code]=c.message,t}),{}),nd=function(t){function V2NIMErrorImpl(a){var c;return(c=t.call(this,a.desc)||this).name="V2NIMError",c.code=a.code||0,c.desc=a.desc||rd[c.code]||ld[c.code]||"",c.message=c.desc,c.detail=a.detail||{},c}return St(V2NIMErrorImpl,t),V2NIMErrorImpl.prototype.toString=function toString(){var t,a=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?ps(this.detail):"");return(null===(t=null==this?void 0:this.detail)||void 0===t?void 0:t.rawError)&&(a+="\n rawError: "+this.detail.rawError.message),a},V2NIMErrorImpl}(Zl(Error));var ad=function(t){function ValidateError(a,c,h){var m;return void 0===c&&(c={}),(m=t.call(this,{code:td.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:a,rules:h,data:c}})||this).name="validateError",m.message=m.message+"\n"+ps(m.detail,null,2),m.data=c,m.rules=h,m}return St(ValidateError,t),ValidateError}(nd),od=function(t){function ValidateErrorV2(a){var c,h,m,g;return(c=t.call(this,{code:td.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(h=a.detail)||void 0===h?void 0:h.reason,rules:null===(m=a.detail)||void 0===m?void 0:m.rules,data:null===(g=a.detail)||void 0===g?void 0:g.data}})||this).name="ValidateErrorV2",c}return St(ValidateErrorV2,t),ValidateErrorV2}(nd),id=function(t){function FormatError(a,c,h){var m;return(m=t.call(this,{code:td.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:a,key:c,rules:h}})||this).name="formatError",m}return St(FormatError,t),FormatError}(nd),sd=function(t){function UploadError(a){var c;return(c=t.call(this,wt({code:400},a))||this).desc=c.desc||"upload file error",c.message=c.desc,c.name="uploadError",c}return St(UploadError,t),UploadError}(nd),cd=function(t){function CustomError(a,c,h){var m;return void 0===c&&(c={}),void 0===h&&(h=400),(m=t.call(this,{code:h,desc:a,detail:c})||this).name="customError",m.data=c,m}return St(CustomError,t),CustomError}(nd),ld={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},ud=function(){try{var t=Js(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var dd=function baseAssignValue(t,a,c){"__proto__"==a&&ud?ud(t,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):t[a]=c},pd=Object.prototype.hasOwnProperty;var hd=function assignValue(t,a,c){var h=t[a];pd.call(t,a)&&cc(h,c)&&(void 0!==c||a in t)||dd(t,a,c)};var fd=function copyObject(t,a,c,h){var m=!c;c||(c={});for(var g=-1,E=a.length;++g<E;){var I=a[g],M=h?h(c[I],t[I],I,c,t):void 0;void 0===M&&(M=t[I]),m?dd(c,I,M):hd(c,I,M)}return c};var md=function identity(t){return t};var gd=function apply(t,a,c){switch(c.length){case 0:return t.call(a);case 1:return t.call(a,c[0]);case 2:return t.call(a,c[0],c[1]);case 3:return t.call(a,c[0],c[1],c[2])}return t.apply(a,c)},vd=Math.max;var yd=function overRest(t,a,c){return a=vd(void 0===a?t.length-1:a,0),function(){for(var h=arguments,m=-1,g=vd(h.length-a,0),E=Array(g);++m<g;)E[m]=h[a+m];m=-1;for(var I=Array(a+1);++m<a;)I[m]=h[m];return I[a]=c(E),gd(t,this,I)}};var _d=function constant(t){return function(){return t}},Ed=ud?function(t,a){return ud(t,"toString",{configurable:!0,enumerable:!1,value:_d(a),writable:!0})}:md,Id=Date.now;var Md=function shortOut(t){var a=0,c=0;return function(){var h=Id(),m=16-(h-c);if(c=h,m>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}},Cd=Md(Ed);var bd=function baseRest(t,a){return Cd(yd(t,a,md),t+"")};var Sd=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var Td=function isArrayLike(t){return null!=t&&Sd(t.length)&&!Ds(t)},Rd=/^(?:0|[1-9]\d*)$/;var Ad=function isIndex(t,a){var c=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==c||"symbol"!=c&&Rd.test(t))&&t>-1&&t%1==0&&t<a};var Nd=function isIterateeCall(t,a,c){if(!Ls(c))return!1;var h=typeof a;return!!("number"==h?Td(c)&&Ad(a,c.length):"string"==h&&a in c)&&cc(c[a],t)};var Od=function createAssigner(t){return bd((function(a,c){var h=-1,m=c.length,g=m>1?c[m-1]:void 0,E=m>2?c[2]:void 0;for(g=t.length>3&&"function"==typeof g?(m--,g):void 0,E&&Nd(c[0],c[1],E)&&(g=m<3?void 0:g,m=1),a=Object(a);++h<m;){var I=c[h];I&&t(a,I,h,g)}return a}))};var wd=function baseTimes(t,a){for(var c=-1,h=Array(t);++c<t;)h[c]=a(c);return h};var kd=function baseIsArguments(t){return ws(t)&&"[object Arguments]"==Os(t)},xd=Object.prototype,Pd=xd.hasOwnProperty,qd=xd.propertyIsEnumerable,Ld=kd(function(){return arguments}())?kd:function(t){return ws(t)&&Pd.call(t,"callee")&&!qd.call(t,"callee")},Dd=Ld;var Vd=function stubFalse(){return!1},Ud=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,h=c&&t&&!t.nodeType&&t,m=h&&h.exports===c?Es.Buffer:void 0,g=(m?m.isBuffer:void 0)||Vd;t.exports=g})),Gd={};Gd["[object Float32Array]"]=Gd["[object Float64Array]"]=Gd["[object Int8Array]"]=Gd["[object Int16Array]"]=Gd["[object Int32Array]"]=Gd["[object Uint8Array]"]=Gd["[object Uint8ClampedArray]"]=Gd["[object Uint16Array]"]=Gd["[object Uint32Array]"]=!0,Gd["[object Arguments]"]=Gd["[object Array]"]=Gd["[object ArrayBuffer]"]=Gd["[object Boolean]"]=Gd["[object DataView]"]=Gd["[object Date]"]=Gd["[object Error]"]=Gd["[object Function]"]=Gd["[object Map]"]=Gd["[object Number]"]=Gd["[object Object]"]=Gd["[object RegExp]"]=Gd["[object Set]"]=Gd["[object String]"]=Gd["[object WeakMap]"]=!1;var Fd=function baseIsTypedArray(t){return ws(t)&&Sd(t.length)&&!!Gd[Os(t)]};var Bd=function baseUnary(t){return function(a){return t(a)}},jd=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,h=c&&t&&!t.nodeType&&t,m=h&&h.exports===c&&ys.process,g=function(){try{var t=h&&h.require&&h.require("util").types;return t||m&&m.binding&&m.binding("util")}catch(t){}}();t.exports=g})),Wd=jd&&jd.isTypedArray,Yd=Wd?Bd(Wd):Fd,$d=Object.prototype.hasOwnProperty;var Hd=function arrayLikeKeys(t,a){var c=vs(t),h=!c&&Dd(t),m=!c&&!h&&Ud(t),g=!c&&!h&&!m&&Yd(t),E=c||h||m||g,I=E?wd(t.length,String):[],M=I.length;for(var C in t)!a&&!$d.call(t,C)||E&&("length"==C||m&&("offset"==C||"parent"==C)||g&&("buffer"==C||"byteLength"==C||"byteOffset"==C)||Ad(C,M))||I.push(C);return I},Qd=Object.prototype;var Kd=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||Qd)};var zd=function overArg(t,a){return function(c){return t(a(c))}},Jd=zd(Object.keys,Object),Xd=Object.prototype.hasOwnProperty;var Zd=function baseKeys(t){if(!Kd(t))return Jd(t);var a=[];for(var c in Object(t))Xd.call(t,c)&&"constructor"!=c&&a.push(c);return a};var ep=function keys(t){return Td(t)?Hd(t):Zd(t)},tp=Od((function(t,a,c,h){fd(a,ep(a),t,h)}));var rp,np=function isUndefined(t){return void 0===t},ap=(rp=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return rp()+rp()+rp()+rp()+rp()+rp()+rp()+rp()});function getEnumKeys(t){var a;return filter(a=Uo(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumKeyByEnumValue(t,a){var c,h=filter(c=Uo(t)).call(c,(function(c){return t[c]==a}));return h.length>0?h[0]:void 0}function assignOptions(t,a){return tp({},t,a,(function(t,a){return np(a)?t:a}))}function emptyFuncWithPromise(){return za.resolve()}var op,ip,sp={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},cp={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function getUploadResponseFormat(t){return void 0===t&&(t="file"),ps(sp[t]||{}).replace(/"/gi,'\\"')}!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(op||(op={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(ip||(ip={}));var lp={chunkUploadHost:"https://wannos-web.127.net",commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};var up=function stackClear(){this.__data__=new mc,this.size=0};var dp=function stackDelete(t){var a=this.__data__,c=a.delete(t);return this.size=a.size,c};var pp=function stackGet(t){return this.__data__.get(t)};var hp=function stackHas(t){return this.__data__.has(t)};var fp=function stackSet(t,a){var c=this.__data__;if(c instanceof mc){var h=c.__data__;if(!gc||h.length<199)return h.push([t,a]),this.size=++c.size,this;c=this.__data__=new bc(h)}return c.set(t,a),this.size=c.size,this};function Stack(t){var a=this.__data__=new mc(t);this.size=a.size}Stack.prototype.clear=up,Stack.prototype.delete=dp,Stack.prototype.get=pp,Stack.prototype.has=hp,Stack.prototype.set=fp;var mp=Stack;var gp=function assignMergeValue(t,a,c){(void 0!==c&&!cc(t[a],c)||void 0===c&&!(a in t))&&dd(t,a,c)};var vp=function createBaseFor(t){return function(a,c,h){for(var m=-1,g=Object(a),E=h(a),I=E.length;I--;){var M=E[t?I:++m];if(!1===c(g[M],M,g))break}return a}}(),yp=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,h=c&&t&&!t.nodeType&&t,m=h&&h.exports===c?Es.Buffer:void 0,g=m?m.allocUnsafe:void 0;t.exports=function cloneBuffer(t,a){if(a)return t.slice();var c=t.length,h=g?g(c):new t.constructor(c);return t.copy(h),h}})),_p=Es.Uint8Array;var Ep=function cloneArrayBuffer(t){var a=new t.constructor(t.byteLength);return new _p(a).set(new _p(t)),a};var Ip=function cloneTypedArray(t,a){var c=a?Ep(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.length)};var Mp=function copyArray(t,a){var c=-1,h=t.length;for(a||(a=Array(h));++c<h;)a[c]=t[c];return a},Cp=Object.create,bp=function(){function object(){}return function(t){if(!Ls(t))return{};if(Cp)return Cp(t);object.prototype=t;var a=new object;return object.prototype=void 0,a}}(),Sp=zd(Object.getPrototypeOf,Object);var Tp=function initCloneObject(t){return"function"!=typeof t.constructor||Kd(t)?{}:bp(Sp(t))};var Rp=function isArrayLikeObject(t){return ws(t)&&Td(t)},Ap=Function.prototype,Np=Object.prototype,Op=Ap.toString,wp=Np.hasOwnProperty,kp=Op.call(Object);var xp=function isPlainObject(t){if(!ws(t)||"[object Object]"!=Os(t))return!1;var a=Sp(t);if(null===a)return!0;var c=wp.call(a,"constructor")&&a.constructor;return"function"==typeof c&&c instanceof c&&Op.call(c)==kp};var Pp=function safeGet(t,a){if(("constructor"!==a||"function"!=typeof t[a])&&"__proto__"!=a)return t[a]};var qp=function nativeKeysIn(t){var a=[];if(null!=t)for(var c in Object(t))a.push(c);return a},Lp=Object.prototype.hasOwnProperty;var Dp=function baseKeysIn(t){if(!Ls(t))return qp(t);var a=Kd(t),c=[];for(var h in t)("constructor"!=h||!a&&Lp.call(t,h))&&c.push(h);return c};var Vp=function keysIn(t){return Td(t)?Hd(t,!0):Dp(t)};var Up=function toPlainObject(t){return fd(t,Vp(t))};var Gp=function baseMergeDeep(t,a,c,h,m,g,E){var I=Pp(t,c),M=Pp(a,c),C=E.get(M);if(C)gp(t,c,C);else{var b=g?g(I,M,c+"",t,a,E):void 0,S=void 0===b;if(S){var T=vs(M),R=!T&&Ud(M),A=!T&&!R&&Yd(M);b=M,T||R||A?vs(I)?b=I:Rp(I)?b=Mp(I):R?(S=!1,b=yp(M,!0)):A?(S=!1,b=Ip(M,!0)):b=[]:xp(M)||Dd(M)?(b=I,Dd(I)?b=Up(I):Ls(I)&&!Ds(I)||(b=Tp(M))):S=!1}S&&(E.set(M,b),m(b,M,h,g,E),E.delete(M)),gp(t,c,b)}};var Fp,Bp,jp=function baseMerge(t,a,c,h,m){t!==a&&vp(a,(function(g,E){if(m||(m=new mp),Ls(g))Gp(t,a,E,c,baseMerge,h,m);else{var I=h?h(Pp(t,E),g,E+"",t,a,m):void 0;void 0===I&&(I=g),gp(t,E,I)}}),Vp)},Wp=Od((function(t,a,c){jp(t,a,c)}));!function(t){t[t.Unset=0]="Unset",t[t.RN=2]="RN",t[t.UNIAPP=3]="UNIAPP",t[t.Electron=5]="Electron",t[t.WeiXin=6]="WeiXin",t[t.BROWSER=100]="BROWSER",t[t.H5=101]="H5",t[t.Ali=102]="Ali",t[t.Baidu=103]="Baidu",t[t.Tiktok=104]="Tiktok"}(Fp||(Fp={})),function(t){t[t.kStatNetTypeUnkonw=0]="kStatNetTypeUnkonw",t[t.kStatNetTypeEthernet=1]="kStatNetTypeEthernet",t[t.kStatNetTypeWifi=2]="kStatNetTypeWifi",t[t.kStatNetType2G=3]="kStatNetType2G",t[t.kStatNetType3G=4]="kStatNetType3G",t[t.kStatNetType4G=5]="kStatNetType4G",t[t.kStatNetType5G=6]="kStatNetType5G"}(Bp||(Bp={}));var Yp={wifi:Bp.kStatNetTypeWifi,"2g":Bp.kStatNetType2G,"3g":Bp.kStatNetType3G,"4g":Bp.kStatNetType4G,"5g":Bp.kStatNetType5G,ethernet:Bp.kStatNetTypeEthernet,unknown:Bp.kStatNetTypeUnkonw,none:Bp.kStatNetTypeUnkonw,notreachable:Bp.kStatNetTypeUnkonw,wwan:Bp.kStatNetTypeUnkonw};function isMobile(){if(!navigator||!navigator.userAgent)return!1;var t=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return some(t).call(t,(function(t){return navigator.userAgent.match(t)}))}function isElectron(){var t;return!(!navigator||!navigator.userAgent)&&("object"==typeof navigator&&"string"==typeof navigator.userAgent&&indexOf(t=navigator.userAgent).call(t,"Electron")>=0)}function isBrowser(){return navigator&&navigator.userAgent}var $p={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")},getFileUploadInformation:function getFileUploadInformation(t){throw new Error("Function not implemented.")},net:{__getEnv:function __getEnv(){return null},__onNetworkStatusChangeFn:null,getNetworkStatus:function getNetworkStatus(){var t=this.__getEnv();return new za((function(a,c){t.getNetworkType({success:function success(t){var c=!1;c="boolean"==typeof t.networkAvailable?t.networkAvailable:"none"!==t.networkType.toLowerCase(),a({net_type:Yp[t.networkType.toLowerCase()],net_connect:c})},fail:function fail(){c(new Error("getNetworkType failed"))}})}))},onNetworkStatusChange:function onNetworkStatusChange(t){var a=this.__getEnv();this.offNetworkStatusChange(),a.onNetworkStatusChange&&(this.__onNetworkStatusChangeFn=function(a){var c=a.networkType.toLowerCase();t({isConnected:a.isConnected||"none"!==c,networkType:Yp[c]})},a.onNetworkStatusChange(this.__onNetworkStatusChangeFn))},offNetworkStatusChange:function offNetworkStatusChange(){var t=this.__getEnv();t.offNetworkStatusChange&&(this.__onNetworkStatusChangeFn&&t.offNetworkStatusChange(this.__onNetworkStatusChangeFn),this.__onNetworkStatusChangeFn=null)}}};var Hp=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Qp=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,c=null==t?0:t.length;for(this.__data__=new bc;++a<c;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=Hp,SetCache.prototype.has=Qp;var Kp=SetCache;var zp=function arraySome(t,a){for(var c=-1,h=null==t?0:t.length;++c<h;)if(a(t[c],c,t))return!0;return!1};var Jp=function cacheHas(t,a){return t.has(a)};var Xp=function equalArrays(t,a,c,h,m,g){var E=1&c,I=t.length,M=a.length;if(I!=M&&!(E&&M>I))return!1;var C=g.get(t),b=g.get(a);if(C&&b)return C==a&&b==t;var S=-1,T=!0,R=2&c?new Kp:void 0;for(g.set(t,a),g.set(a,t);++S<I;){var A=t[S],N=a[S];if(h)var O=E?h(N,A,S,a,t,g):h(A,N,S,t,a,g);if(void 0!==O){if(O)continue;T=!1;break}if(R){if(!zp(a,(function(t,a){if(!Jp(R,a)&&(A===t||m(A,t,c,h,g)))return R.push(a)}))){T=!1;break}}else if(A!==N&&!m(A,N,c,h,g)){T=!1;break}}return g.delete(t),g.delete(a),T};var Zp=function mapToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t,h){c[++a]=[h,t]})),c};var eh=function setToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t){c[++a]=t})),c},th=Is?Is.prototype:void 0,rh=th?th.valueOf:void 0;var nh=function equalByTag(t,a,c,h,m,g,E){switch(c){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!g(new _p(t),new _p(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return cc(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var I=Zp;case"[object Set]":var M=1&h;if(I||(I=eh),t.size!=a.size&&!M)return!1;var C=E.get(t);if(C)return C==a;h|=2,E.set(t,a);var b=Xp(I(t),I(a),h,m,g,E);return E.delete(t),b;case"[object Symbol]":if(rh)return rh.call(t)==rh.call(a)}return!1};var ah=function arrayPush(t,a){for(var c=-1,h=a.length,m=t.length;++c<h;)t[m+c]=a[c];return t};var oh=function baseGetAllKeys(t,a,c){var h=a(t);return vs(t)?h:ah(h,c(t))};var ih=function arrayFilter(t,a){for(var c=-1,h=null==t?0:t.length,m=0,g=[];++c<h;){var E=t[c];a(E,c,t)&&(g[m++]=E)}return g};var sh=function stubArray(){return[]},ch=Object.prototype.propertyIsEnumerable,lh=Object.getOwnPropertySymbols,uh=lh?function(t){return null==t?[]:(t=Object(t),ih(lh(t),(function(a){return ch.call(t,a)})))}:sh,dh=uh;var ph=function getAllKeys(t){return oh(t,ep,dh)},hh=Object.prototype.hasOwnProperty;var fh=function equalObjects(t,a,c,h,m,g){var E=1&c,I=ph(t),M=I.length;if(M!=ph(a).length&&!E)return!1;for(var C=M;C--;){var b=I[C];if(!(E?b in a:hh.call(a,b)))return!1}var S=g.get(t),T=g.get(a);if(S&&T)return S==a&&T==t;var R=!0;g.set(t,a),g.set(a,t);for(var A=E;++C<M;){var N=t[b=I[C]],O=a[b];if(h)var w=E?h(O,N,b,a,t,g):h(N,O,b,t,a,g);if(!(void 0===w?N===O||m(N,O,c,h,g):w)){R=!1;break}A||(A="constructor"==b)}if(R&&!A){var k=t.constructor,x=a.constructor;k==x||!("constructor"in t)||!("constructor"in a)||"function"==typeof k&&k instanceof k&&"function"==typeof x&&x instanceof x||(R=!1)}return g.delete(t),g.delete(a),R},mh=Js(Es,"DataView"),gh=Js(Es,"Promise"),vh=Js(Es,"Set"),yh=Js(Es,"WeakMap"),_h="[object Map]",Eh="[object Promise]",Ih="[object Set]",Mh="[object WeakMap]",Ch="[object DataView]",bh=Bs(mh),Sh=Bs(gc),Th=Bs(gh),Rh=Bs(vh),Ah=Bs(yh),Nh=Os;(mh&&Nh(new mh(new ArrayBuffer(1)))!=Ch||gc&&Nh(new gc)!=_h||gh&&Nh(gh.resolve())!=Eh||vh&&Nh(new vh)!=Ih||yh&&Nh(new yh)!=Mh)&&(Nh=function(t){var a=Os(t),c="[object Object]"==a?t.constructor:void 0,h=c?Bs(c):"";if(h)switch(h){case bh:return Ch;case Sh:return _h;case Th:return Eh;case Rh:return Ih;case Ah:return Mh}return a});var Oh=Nh,wh="[object Arguments]",kh="[object Array]",xh="[object Object]",Ph=Object.prototype.hasOwnProperty;var qh=function baseIsEqualDeep(t,a,c,h,m,g){var E=vs(t),I=vs(a),M=E?kh:Oh(t),C=I?kh:Oh(a),b=(M=M==wh?xh:M)==xh,S=(C=C==wh?xh:C)==xh,T=M==C;if(T&&Ud(t)){if(!Ud(a))return!1;E=!0,b=!1}if(T&&!b)return g||(g=new mp),E||Yd(t)?Xp(t,a,c,h,m,g):nh(t,a,M,c,h,m,g);if(!(1&c)){var R=b&&Ph.call(t,"__wrapped__"),A=S&&Ph.call(a,"__wrapped__");if(R||A){var N=R?t.value():t,O=A?a.value():a;return g||(g=new mp),m(N,O,c,h,g)}}return!!T&&(g||(g=new mp),fh(t,a,c,h,m,g))};var Lh=function baseIsEqual(t,a,c,h,m){return t===a||(null==t||null==a||!ws(t)&&!ws(a)?t!=t&&a!=a:qh(t,a,c,h,baseIsEqual,m))};var Dh=function baseIsMatch(t,a,c,h){var m=c.length,g=m,E=!h;if(null==t)return!g;for(t=Object(t);m--;){var I=c[m];if(E&&I[2]?I[1]!==t[I[0]]:!(I[0]in t))return!1}for(;++m<g;){var M=(I=c[m])[0],C=t[M],b=I[1];if(E&&I[2]){if(void 0===C&&!(M in t))return!1}else{var S=new mp;if(h)var T=h(C,b,M,t,a,S);if(!(void 0===T?Lh(b,C,3,h,S):T))return!1}}return!0};var Vh=function isStrictComparable(t){return t==t&&!Ls(t)};var Uh=function getMatchData(t){for(var a=ep(t),c=a.length;c--;){var h=a[c],m=t[h];a[c]=[h,m,Vh(m)]}return a};var Gh=function matchesStrictComparable(t,a){return function(c){return null!=c&&(c[t]===a&&(void 0!==a||t in Object(c)))}};var Fh=function baseMatches(t){var a=Uh(t);return 1==a.length&&a[0][2]?Gh(a[0][0],a[0][1]):function(c){return c===t||Dh(c,t,a)}};var Bh=function baseHasIn(t,a){return null!=t&&a in Object(t)};var jh=function hasPath(t,a,c){for(var h=-1,m=(a=qc(a,t)).length,g=!1;++h<m;){var E=Lc(a[h]);if(!(g=null!=t&&c(t,E)))break;t=t[E]}return g||++h!=m?g:!!(m=null==t?0:t.length)&&Sd(m)&&Ad(E,m)&&(vs(t)||Dd(t))};var Wh=function hasIn(t,a){return null!=t&&jh(t,a,Bh)};var Yh=function baseMatchesProperty(t,a){return qs(t)&&Vh(a)?Gh(Lc(t),a):function(c){var h=Vc(c,t);return void 0===h&&h===a?Wh(c,t):Lh(a,h,3)}};var $h=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var Hh=function basePropertyDeep(t){return function(a){return Dc(a,t)}};var Qh=function property(t){return qs(t)?$h(Lc(t)):Hh(t)};var Kh=function baseIteratee(t){return"function"==typeof t?t:null==t?md:"object"==typeof t?vs(t)?Yh(t[0],t[1]):Fh(t):Qh(t)};var zh=function baseSet(t,a,c,h){if(!Ls(t))return t;for(var m=-1,g=(a=qc(a,t)).length,E=g-1,I=t;null!=I&&++m<g;){var M=Lc(a[m]),C=c;if("__proto__"===M||"constructor"===M||"prototype"===M)return t;if(m!=E){var b=I[M];void 0===(C=h?h(b,M,I):void 0)&&(C=Ls(b)?b:Ad(a[m+1])?[]:{})}hd(I,M,C),I=I[M]}return t};var Jh=function basePickBy(t,a,c){for(var h=-1,m=a.length,g={};++h<m;){var E=a[h],I=Dc(t,E);c(I,E)&&zh(g,qc(E,t),I)}return g},Xh=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)ah(a,dh(t)),t=Sp(t);return a}:sh;var Zh=function getAllKeysIn(t){return oh(t,Vp,Xh)};var ef=function pickBy(t,a){if(null==t)return{};var c=Oc(Zh(t),(function(t){return[t]}));return a=Kh(a),Jh(t,c,(function(t,c){return a(t,c[0])}))},tf=function(){function NOS(t,a){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=t,this.cloudStorage=a}var t=NOS.prototype;return t.reset=function reset(){this.nosErrorCount=0},t.getNosAccessToken=function getNosAccessToken(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c,h;return as.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("getNosAccessToken",{tag:t});case 2:return a=m.sent,c=Vc(a,"content.nosAccessTokenTag.token"),h=t.url,m.abrupt("return",{token:c,url:-1!==indexOf(h).call(h,"?")?h+"&token="+c:h+"?token="+c});case 6:case"end":return m.stop()}}),_callee,this)})))},t.deleteNosAccessToken=function deleteNosAccessToken(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:t});case 2:case"end":return a.stop()}}),_callee2,this)})))},t.nosUpload=function nosUpload(t,a){var c,h,m,g,E,I,M,C;return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var b,S,T,R,A,N,O,w,k,x,P,q,L,D,V,U,G,B,j;return as.wrap((function _callee3$(W){for(;;)switch(W.prev=W.next){case 0:if(b=Vc(this.core,"config.cdn.bucket"),S={tag:t.nosScenes||b||"nim"},t.nosSurvivalTime&&(S.expireSec=t.nosSurvivalTime),T=this.core.adapters.getFileUploadInformation(t),!(!a&&!T)){W.next=18;break}return W.prev=6,W.next=9,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:S});case 9:R=W.sent,W.next=18;break;case 12:if(W.prev=12,W.t0=W.catch(6),this.core.logger.error("uploadFile:: getNosToken error",W.t0),!(W.t0 instanceof nd)){W.next=17;break}throw W.t0;case 17:throw new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:W.t0,curProvider:1}});case 18:return A=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",T?null===(c=T.uploadInfo)||void 0===c?void 0:c.objectName:a?null==a?void 0:a.objectName:R.content.nosToken.objectName),N="",a&&a.shortUrl&&(N=a.shortUrl),(null===(g=null===(m=null===(h=null==T?void 0:T.uploadInfo)||void 0===h?void 0:h.payload)||void 0===m?void 0:m.mixStoreToken)||void 0===g?void 0:g.shortUrl)&&(N=T.uploadInfo.payload.mixStoreToken.shortUrl),O=N||A,W.prev=23,k=T?{token:null===(E=null==T?void 0:T.uploadInfo)||void 0===E?void 0:E.token,bucket:null===(I=null==T?void 0:T.uploadInfo)||void 0===I?void 0:I.bucketName,objectName:null===(M=null==T?void 0:T.uploadInfo)||void 0===M?void 0:M.objectName}:a||R.content.nosToken,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:k,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:$p.platform}),x="BROWSER"===$p.platform?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(k&&k.bucket),this.core.reporterHookCloudStorage.update({remote_addr:x,operation_type:a?2:0}),W.next=30,this.core.adapters.uploadFile(wt(wt(wt({},t),{nosToken:k,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:t.maxSize||this.config.chunkMaxSize}),a?{payload:{mixStoreToken:a}}:{}));case 30:w=W.sent,W.next=65;break;case 33:if(W.prev=33,W.t1=W.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",W.t1),P="v2"===Vc(this.core,"options.apiVersion"),W.t1.code!==td.V2NIM_ERROR_CODE_CANCELLED&&10499!==W.t1.errCode){W.next=39;break}throw new sd({code:P?td.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Vc(W.t1,"message")||"Request abort",rawError:W.t1,curProvider:1}});case 39:if(!P||W.t1.errCode!==td.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){W.next=41;break}throw new nd({code:td.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Vc(W.t1,"message")||"Read file failed",rawError:W.t1,curProvider:1}});case 41:return W.next=43,$p.net.getNetworkStatus();case 43:if(q=W.sent,!1!==q.net_connect){W.next=47;break}throw new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:W.t1,curProvider:1}});case 47:if(!a){W.next=64;break}if(0!==this.nosErrorCount){W.next=60;break}W.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),W.next=56;break;case 53:throw W.prev=53,W.t2=W.catch(49),new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:W.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:t.file||t.filePath}});case 56:return this.nosErrorCount=Vc(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),W.abrupt("return",this.cloudStorage._uploadFile(t));case 60:return this.nosErrorCount--,W.abrupt("return",this.nosUpload(t,a));case 62:W.next=65;break;case 64:throw new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:W.t1,curProvider:1}});case 65:if(L=null==w?void 0:w.type,(D=L&&indexOf(L).call(L,"/")>-1?slice$1(L).call(L,0,indexOf(L).call(L,"/")):"")||(D=t.type||""),(V={image:"imageInfo",video:"vinfo",audio:"vinfo"})[D]){W.next=71;break}return W.abrupt("return",wt({url:O},w));case 71:return W.prev=71,W.next=74,this.core.adapters.request(A+"?"+V[D],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:U=W.sent,W.next=81;break;case 77:return W.prev=77,W.t3=W.catch(71),this.core.logger.error("uploadFile:: fetch file info error",W.t3),W.abrupt("return",wt({url:O},w));case 81:if(!U){W.next=88;break}return G=U.data,B="imageInfo"===V[D]?G:null===(C=null==G?void 0:G.GetVideoInfo)||void 0===C?void 0:C.VideoInfo,j={url:O,name:w.name,size:w.size,ext:w.ext,w:null==B?void 0:B.Width,h:null==B?void 0:B.Height,orientation:null==B?void 0:B.Orientation,dur:null==B?void 0:B.Duration,audioCodec:null==B?void 0:B.AudioCodec,videoCodec:null==B?void 0:B.VideoCodec,container:null==B?void 0:B.Container},W.abrupt("return",ef(j,(function(t,a){return void 0!==a})));case 88:return W.abrupt("return",wt({url:O},w));case 89:case"end":return W.stop()}}),_callee3,this,[[6,12],[23,33],[49,53],[71,77]])})))},t._getNosCdnHost=function _getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a,c,h,m=this;return as.wrap((function _callee4$(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=g.sent,g.next=10;break;case 6:return g.prev=6,g.t0=g.catch(0),this.core.logger.error("getNosCdnHost::error",g.t0),g.abrupt("return");case 10:if(a){g.next=12;break}return g.abrupt("return");case 12:c=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(h=rl(null==c?void 0:c.expire))&&c.cdnDomain?-1===h?(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix):(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){m._getNosCdnHost()}),1e3*h)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return g.stop()}}),_callee4,this,[[0,6]])})))},Jo(NOS,[{key:"config",get:function get(){return this.cloudStorage.config}}]),NOS}(),rf=entryVirtual("Array").values,nf=Array.prototype,af={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===nf||Y(nf,t)&&a===nf.values||pe(af,er(t))?rf:a};_export({target:"Array",stat:!0},{isArray:eo});var sf=W.Array.isArray,cf=Mo.every,lf=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!lf},{every:function every(t){return cf(this,t,arguments.length>1?arguments[1]:void 0)}});var uf=entryVirtual("Array").every,df=Array.prototype,every=function(t){var a=t.every;return t===df||Y(df,t)&&a===df.every?uf:a};var pf=function baseIsRegExp(t){return ws(t)&&"[object RegExp]"==Os(t)},hf=jd&&jd.isRegExp,ff=hf?Bd(hf):pf;var mf=function baseFindIndex(t,a,c,h){for(var m=t.length,g=c+(h?1:-1);h?g--:++g<m;)if(a(t[g],g,t))return g;return-1};var gf=function baseIsNaN(t){return t!=t};var vf=function strictIndexOf(t,a,c){for(var h=c-1,m=t.length;++h<m;)if(t[h]===a)return h;return-1};var yf=function baseIndexOf(t,a,c){return a==a?vf(t,a,c):mf(t,gf,c)};var _f=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&yf(t,a,0)>-1};var Ef=function arrayIncludesWith(t,a,c){for(var h=-1,m=null==t?0:t.length;++h<m;)if(c(a,t[h]))return!0;return!1};var If=function baseDifference(t,a,c,h){var m=-1,g=_f,E=!0,I=t.length,M=[],C=a.length;if(!I)return M;c&&(a=Oc(a,Bd(c))),h?(g=Ef,E=!1):a.length>=200&&(g=Jp,E=!1,a=new Kp(a));e:for(;++m<I;){var b=t[m],S=null==c?b:c(b);if(b=h||0!==b?b:0,E&&S==S){for(var T=C;T--;)if(a[T]===S)continue e;M.push(b)}else g(a,S,h)||M.push(b)}return M},Mf=bd((function(t,a){return Rp(t)?If(t,a):[]})),Cf=Mf;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,c,h){var m;void 0===a&&(a={}),void 0===h&&(h=!1);var g={};return forEach$1(m=Uo(t)).call(m,(function(m){var E=t[m].type,I=c?"In "+c+", ":"";if(null==a){var M=I+"param is null or undefined";throw h?new od({detail:{reason:M,data:{key:m},rules:"required"}}):new ad(M,{key:m},"required")}if(void 0===a[m]){if(!1===t[m].required)return void(g[m]=a[m]);var C=I+"param '"+m+"' is required";throw h?new od({detail:{reason:C,data:{key:m},rules:"required"}}):new ad(C,{key:m},"required")}var b=bf[E];if(b&&!b(a,m,t[m],h)){var S=I+"param '"+m+"' unexpected",T={key:m,value:a[m]};throw h?new od({detail:{reason:S,data:T,rules:ps(t[m],replacer)}}):new ad(S,T,ps(t[m],replacer))}g[m]=a[m]})),g}var bf={string:function string(t,a,c){var h=c.allowEmpty,m=c.max,g=c.min,E=c.regExp,I=t[a];return"string"==typeof I&&((!1!==h||""!==I)&&(!("number"==typeof m&&I.length>m)&&(!("number"==typeof g&&I.length<g)&&!(ff(E)&&!E.test(I)))))},number:function number(t,a,c){var h=c.min,m=c.max,g=t[a];return"number"==typeof g&&(!("number"==typeof h&&g<h)&&!("number"==typeof m&&g>m))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},file:function file(t,a){return!0},enum:function _enum(t,a,c){var h=values(c),m=t[a];return!h||indexOf(h).call(h,m)>-1},jsonstr:function jsonstr(t,a){try{var c=JSON.parse(t[a]);return"object"==typeof c&&null!==c}catch(t){return!1}},func:function func(t,a){return"function"==typeof t[a]},array:function array(t,a,c,h){var m;void 0===h&&(h=!1);var g=c.itemType,E=c.rules,I=c.min,M=c.max,C=values(c),b=t[a];return!!sf(b)&&(!("number"==typeof M&&b.length>M)&&(!("number"==typeof I&&b.length<I)&&(!(g&&"enum"!==g&&!every(b).call(b,(function(t){return typeof t===g})))&&(("enum"!==g||!C||!Cf.apply(void 0,concat(m=[b]).call(m,C)).length)&&(E&&forEach$1(b).call(b,(function(t,c){return validate(E,t,a+"["+c+"]",h)})),!0)))))},object:function object(t,a,c,h){void 0===h&&(h=!1);var m=c.rules,g=c.allowEmpty,E=t[a];if("object"!=typeof E||null===E)return!1;if(m){var I=Uo(m),M=Uo(E),C=filter(M).call(M,(function(t){return indexOf(I).call(I,t)>-1}));if(!1===g&&0===C.length)return!1;validate(m,E,a,h)}return!0}},callWithSafeIterationClosing=function(t,a,c,h){try{return h?a(anObject(c)[0],c[1]):a(c)}catch(a){iteratorClose(t,"throw",a)}},Sf=Array,Tf=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:Tf},{from:function from(t){var a=toObject(t),c=fn(this),h=arguments.length,m=h>1?arguments[1]:void 0,g=void 0!==m;g&&(m=functionBindContext(m,h>2?arguments[2]:void 0));var E,I,M,C,b,S,T=getIteratorMethod$5(a),R=0;if(!T||this===Sf&&isArrayIteratorMethod(T))for(E=lengthOfArrayLike(a),I=c?new this(E):Sf(E);E>R;R++)S=g?m(a[R],R):a[R],createProperty(I,R,S);else for(b=(C=getIterator(a,T)).next,I=c?new this:[];!(M=w(b,C)).done;R++)S=g?callWithSafeIterationClosing(C,m,[M.value,R],!0):M.value,createProperty(I,R,S);return I.length=R,I}});var Rf=W.Array.from,Af=getIteratorMethod$5;function getPromiseWithAbort(t){var a={},c=new za((function(t,c){a.abort=c}));return a.promise=za.race([t,c]),a}za.reject;var Nf=function(){function PromiseManager(){this.abortFns=[]}var t=PromiseManager.prototype;return t.add=function add(t){var a=getPromiseWithAbort(t);return this.abortFns.push(a.abort),a.promise},t.clear=function clear(t){var a;forEach$1(a=this.abortFns).call(a,(function(a){return a(t||new nd({code:td.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function destroy(){this.clear()},PromiseManager}(),Of={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},wf={timestamp:0,rtt:0,baseClock:0,baseTime:0},kf=function(){function TimeOrigin(t,a,c){void 0===c&&(c="getServerTime"),this.serverOrigin=wf,this.config=Of,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=t,this.logger=t.logger,this.promiseManager=new Nf,this.cmdName=c,a&&this.setOptions(a)}var t=TimeOrigin.prototype;return t.setOptions=function setOptions(t){this.config=wt({},Of,this.config,t)},t.reset=function reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=wf,this.currentChance=0},t.setOriginTimetick=function setOriginTimetick(){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var t,a,c,h,m,g,E,I,M,C;return as.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(this.config.enable){b.next=2;break}return b.abrupt("return");case 2:if(!this.isSettingNTP){b.next=4;break}return b.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){b.next=6;break}return b.abrupt("return");case 6:if(t=Vc(this.core,"auth.status"),a=Vc(this.core,"status"),c=Vc(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===a||c===fu.V2NIM_LOGIN_STATUS_LOGINED){b.next=11;break}return b.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,h="TimeOrigin::setOriginTimetick:",m=Za(),this.core.logger.log(h+" getServerTime start, times "+this.currentChance),b.prev=18,b.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:E=b.sent,g=Vc(E,"content.time"),this.isSettingNTP=!1,b.next=33;break;case 26:return b.prev=26,b.t0=b.catch(18),I=b.t0,this.isSettingNTP=!1,this.logger.warn(h+" Calculate Delay time, getServerTime error",I),I.code!==td.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=go(bind$1(M=this.setOriginTimetick).call(M,this),this.failedDelay)),b.abrupt("return");case 33:if(g){b.next=37;break}return this.core.logger.warn(h+" Calculate Delay time incorrect format"),this.config.enable=!1,b.abrupt("return");case 37:C=Za()-m,this.doSet(g,C);case 39:case"end":return b.stop()}}),_callee,this,[[18,26]])})))},t.doSet=function doSet(t,a){var c,h="TimeOrigin::setOriginTimetick:";if(a>this.config.tolerantRTT)this.logger.warn(h+" Denied, cause of exceeding the maximum tolerance range of RTT: "+a),this.timer=go(bind$1(c=this.setOriginTimetick).call(c,this),this.failedDelay);else if(a>this.config.bestRTT){var m;this.serverOrigin.rtt&&a>=this.serverOrigin.rtt?this.logger.log(h+" Denied, cause of current.RTT >= serverOrigin.RTT: "+a):(this.setServerOrigin(a,t),this.logger.log(h+" Accept within maximum tolerance range of RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime)),this.timer=go(bind$1(m=this.setOriginTimetick).call(m,this),this.failedDelay)}else{var g;this.setServerOrigin(a,t),this.logger.log(h+" Accept within best RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime),this.currentChance=0,this.timer=go(bind$1(g=this.setOriginTimetick).call(g,this),this.successDelay)}},t.getNTPTime=function getNTPTime(t){if(void 0===t&&(t=this.getTimeNode()),this.checkNodeReliable(t)){var a=Math.floor(t.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+a}return Za()},t.checkNodeReliable=function checkNodeReliable(t){if(void 0===t&&(t=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var a=t.clock-this.serverOrigin.baseClock,c=t.time-this.serverOrigin.baseTime;return Math.abs(c-a)<500}return!1},t.checkPerformance=function checkPerformance(){return"BROWSER"===$p.platform&&!("undefined"==typeof performance||!performance.now)},TimeOrigin.checkPerformance=function checkPerformance(){return"BROWSER"===$p.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Za()}},TimeOrigin.getTimeNode=function getTimeNode(){return{clock:TimeOrigin.checkPerformance()?performance.now():0,time:Za()}},t.setServerOrigin=function setServerOrigin(t,a){this.serverOrigin={timestamp:a+Math.floor(t/2),rtt:t,baseClock:this.checkPerformance()?performance.now():0,baseTime:Za()}},TimeOrigin}();function _createForOfIteratorHelperLoose$4(t,a){var c,h=void 0!==Hi&&Af(t)||t["@@iterator"];if(h)return bind$1(c=(h=h.call(t)).next).call(c,h);if(sf(t)||(h=function _unsupportedIterableToArray$4(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$4(t,a);var h=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===h&&t.constructor&&(h=t.constructor.name);if("Map"===h||"Set"===h)return Rf(t);if("Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return _arrayLikeToArray$4(t,a)}(t))||a&&t&&"number"==typeof t.length){h&&(t=h);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$4(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,h=new Array(a);c<a;c++)h[c]=t[c];return h}var xf={},Pf={};function parseEachCmd(t,a,c,h,m){var g,E={cmd:c,raw:t,error:null,service:null==a?void 0:a.service,content:{},__receiveTimeNode:kf.getTimeNode()};if(!c||!a)return E.notFound=!0,E;(18===a.sid||a.sid>=26&&a.sid<100)&&(t.code=function toReadableCode(t){if("number"!=typeof t||t!=t)throw new nd({code:td.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+t}});if(t<0||t>=0&&t<1e3||t>=2e4&&t<=20099)return t;var a=(65535&t)>>9;a-=a<=38?1:2;return 1e5+1e3*a+(511&t)}(t.code));var I,M=function genCmdError(t,a){var c=rd[t],h=ld[t];return null===h?null:new nd({code:t,desc:c||h||t,detail:{cmd:a,timetag:Za()}})}(t.code,c);if(E.error=M,E.error){if(E.error.detail.cmd=c,!(null===(g=null==a?void 0:a.ignoreErrCodes)||void 0===g?void 0:includes(g).call(g,t.code)))return E;m.warn("parseCmd:: ignore error ",E.error),E.error.detail.ignore=!0}a.response&&forEach$1(I=a.response).call(I,(function(t,a){var c=h[a],m=t.type,g=t.name,I=t.reflectMapper;if(!np(c))switch(m){case"Property":E.content[g]=I?deserialize(c,I):c;break;case"PropertyArray":E.content[g]=map$6(c).call(c,(function(t){return I?deserialize(t,I):t}));break;case"Int":case"Long":case"Byte":E.content[g]=+c;break;case"Bool":E.content[g]="true"===c||!0===c||1===c;break;default:E.content[g]=c}}));return E}function serialize(t,a,c){var h={};for(var m in t=function flattenObjByMapper(t,a){var c={};for(var h in a){for(var m,g=a[h],E="number"==typeof g?h:g.access?g.access:h,I=t,M=_createForOfIteratorHelperLoose$4(E.split("."));!(m=M()).done;){var C=m.value;if(void 0===I[C]||null===I[C]){I=void 0;break}I=I[C]}void 0!==I&&(c[E]=I)}return c}(t,a),a){var g=a[m],E="number"==typeof g?m:g.access?g.access:m;if(!c||includes(c).call(c,m))if(E in t){if("number"==typeof g)h[g]=t[E];else if("object"==typeof g)if(g.converter){var I=g.converter(t[E],t);void 0!==I&&(h[g.id]=I)}else h[g.id]=t[E]}else"object"==typeof g&&g.def&&("function"==typeof g.def?h[g.id]=g.def(t):h[g.id]=g.def)}return h}function deserialize(t,a){var c={};for(var h in t){var m=a[h];if("string"==typeof m)c[m]=t[h];else if("object"==typeof m&&"prop"in m){var g=m.access?m.access:m.prop;if(m.converter){var E=m.converter(t[h],t);void 0!==E&&(c[g]=E)}else m.type&&"number"===m.type?c[g]=+t[h]:m.type&&"boolean"===m.type?c[g]=!("0"===t[h]||!t[h]):c[g]=t[h]}}for(var I in a){var M=a[I];if(M&&void 0!==M.def){var C=M.access?M.access:M.prop;C in c||("function"==typeof M.def?c[C]=M.def(t):c[C]=M.def)}}return c=function unflattenObj(t){var a={},c=function _loop(c){var h=c.split(".");reduce(h).call(h,(function(a,m,g){return a[m]||(a[m]=isNaN(Number(h[g+1]))?h.length-1==g?t[c]:{}:[])}),a)};for(var h in t)c(h);return a}(c),c}function registerParser(t){for(var a in wt(xf,t.cmdConfig),t.cmdMap){var c=t.cmdMap[a],h=t.cmdConfig[c];if(h)if(sf(Pf[a])){for(var m,g=!1,E=_createForOfIteratorHelperLoose$4(Pf[a]);!(m=E()).done;){var I=m.value;if(I.cmd===c&&I.config.service===h.service){g=!0;break}}g||Pf[a].push({config:h,cmd:c})}else Pf[a]=[{config:h,cmd:c}]}}function invertSerializeMap(t){var a,c={};return forEach$1(a=Uo(t)).call(a,(function(a){c[a]=function invertSerializeItem(t){var a={};for(var c in t){var h=t[c];"number"==typeof h?a[h]=c:"object"==typeof h&&(a[h.id]={prop:c,type:h.retType,access:h.retAccess?h.retAccess:h.access?h.access:c,def:h.retDef,converter:h.retConverter})}return a}(t[a])})),c}var qf=function baseForOwn(t,a){return t&&vp(t,a,ep)};var Lf=function baseInverter(t,a,c,h){return qf(t,(function(t,m,g){a(h,c(t),m,g)})),h};var Df=function createInverter(t,a){return function(c,h){return Lf(c,t,a(h),{})}},Vf=Object.prototype.toString,Uf=Df((function(t,a,c){null!=a&&"function"!=typeof a.toString&&(a=Vf.call(a)),t[a]=c}),_d(md)),Gf={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Ff={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},Bf={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Ff.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:Uf(Ff.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Ff.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Uf(Ff.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Uf(Ff.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:Uf(Ff.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Uf(Ff.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Ff.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Uf(Ff.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Ff.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Uf(Ff.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Ff.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:Uf(Ff.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Ff.nosAccessTokenTag}]}},jf=function(){function MixStorage(t,a){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=op.nos,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=MixStorage.prototype;return t.reset=function reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=op.nos,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee(){var c,h;return as.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if($p.localStorage)try{$p.localStorage.getItem&&$p.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse($p.localStorage.getItem(this.GRAYKEY))[t])}catch(t){$p.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){m.next=17;break}return m.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(c=m.sent).content||!c.content.grayConfigTag){m.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(c.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(c.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){m.next=10;break}return m.abrupt("return");case 10:h=$p.localStorage.getItem(this.GRAYKEY)?JSON.parse($p.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),h[t]=this.grayConfig,$p.localStorage.setItem(this.GRAYKEY,ps(h)),m.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",c.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){m.next=20;break}return m.next=20,this._getMixStorePolicy(t);case 20:case"end":return m.stop()}}),_callee,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c,h,m,g,E,I;return as.wrap((function _callee2$(M){for(;;)switch(M.prev=M.next){case 0:if(a=(new Date).getTime(),$p.localStorage)try{this.mixStorePolicy=JSON.parse($p.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=rl(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(h=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(c=this._getMixStorePolicy).call(c,this,t),h))}catch(a){$p.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse($p.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){M.next=30;break}return M.prev=3,M.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:g=M.sent,E=g.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(E.ttl),this.mixStorePolicy.providers=E.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=rl(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=E.nosPolicy?JSON.parse(E.nosPolicy):null,this.mixStorePolicy.s3Policy=E.s3Policy?JSON.parse(E.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(m=this._getMixStorePolicy).call(m,this,t),1e3*this.mixStorePolicy.ttl),I=$p.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse($p.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),I[t]=this.mixStorePolicy,$p.localStorage.setItem(this.MIXSTOREKEY,ps(I)),M.next=30;break;case 23:if(M.prev=23,M.t0=M.catch(3),this.logger.error("getMixStorePolicy error",M.t0),0!==this.mixStoreErrorCount){M.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return M.stop()}}),_callee2,this,[[3,23]])})))},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,c=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(!c)throw new Error("uploadFile nextProvider error");if(c===a[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+c),this.curProvider=rl(c),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var h=this.mixStorePolicy[this.curProvider===op.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!h||0===h)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+rl(t.mixStorePolicy.providers[0])),t.curProvider=rl(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*h)}throw new Error("uploadFile will not retry again")},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=c.sent,c.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return c.stop()}}),_callee3,this)})))},MixStorage}(),Wf=Qc.trim,Yf=A("".charAt),$f=m.parseFloat,Hf=m.Symbol,Qf=Hf&&Hf.iterator,Kf=1/$f(jc+"-0")!=-1/0||Qf&&!fails((function(){$f(Object(Qf))}))?function parseFloat(t){var a=Wf(toString$1(t)),c=$f(a);return 0===c&&"-"==Yf(a,0)?-0:c}:$f;_export({global:!0,forced:parseFloat!=Kf},{parseFloat:Kf});var zf=W.parseFloat,Jf=function(){function AWS(t,a){this.s3=null,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=AWS.prototype;return t.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var c,h,m,g,E,I,M,C,b,S,T=this;return as.wrap((function _callee2$(R){for(;;)switch(R.prev=R.next){case 0:if(!t.file){R.next=4;break}c=t.file,R.next=19;break;case 4:if("string"!=typeof t.fileInput){R.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((h=document.getElementById(t.fileInput))&&h.files&&h.files[0])){R.next=11;break}c=h.files[0],R.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:R.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){R.next=18;break}c=t.fileInput.files[0],R.next=19;break;case 18:throw new Error("Can not get file from fileInput "+t.fileInput);case 19:if(this.mixStorePolicy.s3Policy){R.next=21;break}throw new Error("dont get s3 policy");case 21:return m={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},g=this.s3,(E=new g).config.update(m),I=decodeURIComponent(a.bucket),M=decodeURIComponent(a.objectName),b={Bucket:I,Key:M,Body:C=c,Metadata:{token:a.token},ContentType:C.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",b),(S=E.upload(b)).on("httpUploadProgress",(function(a){var c=zf((a.loaded/a.total).toFixed(2));t.onUploadProgress&&t.onUploadProgress({total:a.total,loaded:a.loaded,percentage:c,percentageText:Math.round(100*c)+"%"})})),R.abrupt("return",new za((function(c,h){var m=(new Date).getTime();S.send((function(g,E){return __awaiter(T,void 0,void 0,as.mark((function _callee(){var b,S,T,R,A,N,O,w;return as.wrap((function _callee$(k){for(;;)switch(k.prev=k.next){case 0:if(!g||"RequestAbortedError"!==g.code){k.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",g),h(new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:g,curProvider:2}})),k.next=42;break;case 5:if(!g){k.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",g),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(S=null===(b=this.core)||void 0===b?void 0:b.auth)||void 0===S?void 0:S.account),trace_id:null===(T=this.core.clientSocket.socket)||void 0===T?void 0:T.sessionId,start_time:m,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof g.status?g.status:"number"==typeof g.code?g.code:0,description:g.message||""+g.code,operation_type:1,target:ps({bucket:I,object:M})},{asyncParams:$p.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),k.next=12,$p.net.getNetworkStatus();case 12:if(R=k.sent,!1!==R.net_connect){k.next=16;break}return k.abrupt("return",h(new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:g,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:k.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),k.next=23;break;case 20:return k.prev=20,k.t0=k.catch(16),k.abrupt("return",h(new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:k.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:t.file||t.filePath}})));case 23:c(this.cloudStorage._uploadFile(t)),k.next=42;break;case 26:if(A=(A=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn),this.core.reporterHookCloudStorage.update({remote_addr:A,operation_type:1}),A=A.replace("{objectName}",E.Key),N={size:C.size,name:C.name,url:a.shortUrl?a.shortUrl:A,ext:C.name.split(".")[1]||"unknown"},O=t.type||"",(w={image:"imageInfo"})[O]){k.next=37;break}return k.abrupt("return",c(N));case 37:return k.t1=c,k.next=40,this.getS3FileInfo({url:A,infoSuffix:w[O],s3Result:N});case 40:return k.t2=k.sent,k.abrupt("return",(0,k.t1)(k.t2));case 42:case"end":return k.stop()}}),_callee,this,[[16,20]])})))})),t.onUploadStart&&t.onUploadStart(S)})));case 33:case"end":return R.stop()}}),_callee2,this)})))},t.getS3FileInfo=function getS3FileInfo(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var c,h,m,g,E,I,M;return as.wrap((function _callee3$(C){for(;;)switch(C.prev=C.next){case 0:return c=t.url,h=t.infoSuffix,m=t.s3Result,C.prev=1,C.next=4,this.core.adapters.request(c+"?"+h,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:g=C.sent,C.next=11;break;case 7:return C.prev=7,C.t0=C.catch(1),this.core.logger.error("uploadFile:: fetch file info error",C.t0),C.abrupt("return",m);case 11:if(!g){C.next=18;break}return E=g.data,I="imageInfo"===h?E:null===(a=null==E?void 0:E.GetVideoInfo)||void 0===a?void 0:a.VideoInfo,M=wt(wt({},m),{w:null==I?void 0:I.Width,h:null==I?void 0:I.Height,orientation:null==I?void 0:I.Orientation,dur:null==I?void 0:I.Duration,audioCodec:null==I?void 0:I.AudioCodec,videoCodec:null==I?void 0:I.VideoCodec,container:null==I?void 0:I.Container}),C.abrupt("return",ef(M,(function(t,a){return void 0!==a})));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",c+"?"+h),C.abrupt("return",m);case 20:case"end":return C.stop()}}),_callee3,this,[[1,7]])})))},Jo(AWS,[{key:"mixStorePolicy",get:function get(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),AWS}(),Xf=function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=t.logger,this.core=t,this.nos=new tf(t,this),this.mixStorage=new jf(t,this),this.aws=new Jf(t,this),registerParser({cmdMap:Gf,cmdConfig:Bf}),this.setOptions(a),this.setListeners()}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=a+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=a+"-AllMixStorePolicy";var c=t.s3,h=__rest(t,["s3"]),m=wt({},lp,this.config);if(h&&Object.prototype.hasOwnProperty.call(h,"cdn")){var g=wt(wt({},m.cdn),h.cdn);this.config=wt({},m,h),this.config.cdn=g}else this.config=wt({},m,h);c&&(this.aws.s3=c)},t.setListeners=function setListeners(){var t,a,c,h;this.core.eventBus.on("kicked",bind$1(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("disconnect",bind$1(a=this._clearUnCompleteTask).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._clearUnCompleteTask).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(h=this._clearUnCompleteTask).call(h,this))},t._clearUnCompleteTask=function _clearUnCompleteTask(){var t,a=this;forEach$1(t=Uo(this.uploadTaskMap)).call(t,(function(t){var c=a.uploadTaskMap[t];c&&c.abort&&c.abort()})),this.uploadTaskMap={}},t.init=function init(){return __awaiter(this,void 0,void 0,as.mark((function _callee(){return as.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){t.next=5;break}return t.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return t.next=7,this.nos._getNosCdnHost();case 7:case"end":return t.stop()}}),_callee,this)})))},t.processCallback=function processCallback(t,a){var c=this,h=t.onUploadProgress,m=t.onUploadDone,g=t.onUploadStart;return{onUploadStart:"function"==typeof g?function(t){c.uploadTaskMap[a]=t;try{g(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",t)}}:function(t){c.uploadTaskMap[a]=t},onUploadProgress:"function"==typeof h?function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded});try{h(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded})},onUploadDone:"function"==typeof m?function(t){c.core.reporterHookCloudStorage.end(0);try{m(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:function(){c.core.reporterHookCloudStorage.end(0)},taskKey:a}},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c,h,m,g,E,I,M;return as.wrap((function _callee2$(C){for(;;)switch(C.prev=C.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){C.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){C.next=7;break}if(!(a=Vc(t,"file.type"))||"string"!=typeof a||-1!==indexOf(a).call(a,t.type)){C.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),t.file?this.core.reporterHookCloudStorage.update({full_size:t.file.size}):"string"==typeof t.fileInput?(c=document.getElementById(t.fileInput))&&c.files&&c.files[0]&&this.core.reporterHookCloudStorage.update({full_size:c.files[0].size}):t.fileInput&&t.fileInput.files&&t.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:t.fileInput.files[0].size}),h=ap(),m=this.processCallback(t,h),g=m.onUploadStart,E=m.onUploadProgress,I=m.onUploadDone,t.onUploadStart=g,t.onUploadProgress=E,t.onUploadDone=I,M=null,C.prev=15,C.next=18,this._uploadFile(t);case 18:M=C.sent,t.md5&&(M.md5=t.md5),delete this.uploadTaskMap[h],C.next=28;break;case 23:throw C.prev=23,C.t0=C.catch(15),delete this.uploadTaskMap[h],this.core.reporterHookCloudStorage.end((C.t0&&C.t0.code)===td.V2NIM_ERROR_CODE_CANCELLED?3:1),C.t0;case 28:return M&&(M.size=void 0===M.size?void 0:Number(M.size),M.w=void 0===M.w?void 0:Number(M.w),M.h=void 0===M.h?void 0:Number(M.h),M.dur=void 0===M.dur?void 0:Number(M.dur)),M.url=decodeURIComponent(M.url),t.onUploadDone({size:M.size,name:M.name,url:M.url,ext:M.name.split(".")[1]||"unknown"}),C.abrupt("return",M);case 32:case"end":return C.stop()}}),_callee2,this,[[15,23]])})))},t._uploadFile=function _uploadFile(t){var a,c;return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var h,m,g,E;return as.wrap((function _callee3$(I){for(;;)switch(I.prev=I.next){case 0:if(Vc(this.mixStorage,"grayConfig.mixStoreEnable")&&Vc(this.mixStorage,"mixStorePolicy.providers.length")){I.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),I.abrupt("return",this.nos.nosUpload(t));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+Vc(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+Vc(this.mixStorage,"curProvider")),h=this.core.adapters.getFileUploadInformation(t),m=!0,h?!1===h.complete&&this.mixStorage.curProvider===op.s3&&(m=!1):m=!1,this.aws.s3||(this.mixStorage.curProvider=op.nos),g=cp,m){I.next=23;break}return I.prev=10,I.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:t.nosSurvivalTime,returnBody:getUploadResponseFormat(t.type)}});case 13:E=I.sent,g=E.content.mixStoreTokenResTag,I.next=23;break;case 17:if(I.prev=17,I.t0=I.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",I.t0),!(I.t0 instanceof nd)){I.next=22;break}throw I.t0;case 22:throw new sd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:I.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(m){I.next=27;break}return I.abrupt("return",this.mixStorage.curProvider===op.s3?this.aws.s3Upload(t,g):this.nos.nosUpload(t,g));case 27:return I.abrupt("return",this.nos.nosUpload(t,null===(c=null===(a=null==h?void 0:h.uploadInfo)||void 0===a?void 0:a.payload)||void 0===c?void 0:c.mixStoreToken));case 28:case"end":return I.stop()}}),_callee3,this,[[10,17]])})))},t.getThumbUrl=function getThumbUrl(t,a){var c,h,m,g,E;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var I=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);I[0],I[1],I[2],I[3],I[4];var M=I[5];if(I[6],I[7],null===(c=this.grayConfig)||void 0===c?void 0:c.mixStoreEnable){var C=this._getUrlType(t);if(C===op.s3&&this.mixStorePolicy.s3Policy&&Vc(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(m=null===(h=this.mixStorePolicy.s3Policy)||void 0===h?void 0:h.thumbPolicy)||void 0===m?void 0:m.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",M).replace("{x}",a.width.toString()).replace("{y}",a.height.toString());if(C===op.nos&&this.mixStorePolicy.nosPolicy&&Vc(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(E=null===(g=this.mixStorePolicy.nosPolicy)||void 0===g?void 0:g.thumbPolicy)||void 0===E?void 0:E.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",M).replace("{x}",a.width.toString()).replace("{y}",a.height.toString())}return includes(t).call(t,"?")?t+"&imageView&thumbnail="+a.width+"x"+a.height:t+"?imageView&thumbnail="+a.width+"x"+a.height},t.getVideoCoverUrl=function getVideoCoverUrl(t,a){var c,h,m,g,E;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var I=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);I[0],I[1],I[2],I[3],I[4];var M=I[5];if(I[6],I[7],null===(c=this.grayConfig)||void 0===c?void 0:c.mixStoreEnable){var C=this._getUrlType(t);if(C===op.s3&&this.mixStorePolicy.s3Policy&&Vc(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(m=null===(h=this.mixStorePolicy.s3Policy)||void 0===h?void 0:h.thumbPolicy)||void 0===m?void 0:m.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",M).replace("{x}",a.width.toString()).replace("{y}",a.height.toString()).replace("{offset}","0").replace("{type}","png");if(C===op.nos&&this.mixStorePolicy.nosPolicy&&Vc(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(E=null===(g=this.mixStorePolicy.nosPolicy)||void 0===g?void 0:g.thumbPolicy)||void 0===E?void 0:E.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",M).replace("{x}",a.width.toString()).replace("{y}",a.height.toString()).replace("{offset}","0").replace("{type}","png")}return includes(t).call(t,"?")?t+"&vframe&offset=0&resize="+a.width+"x"+a.height+"&type=png":t+"?vframe&offset=0&resize="+a.width+"x"+a.height+"&type=png"},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var c=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);c[0];var h=c[1];c[2];var m=c[3];c[4];var g=c[5];if(c[6],c[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var E=this._getUrlType(t);return E===op.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",g)),E===op.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",g)),t}var I=this.config,M=I.downloadUrl,C=I.downloadHostList,b=I.nosCdnEnable,S=this.config.cdn.cdnDomain,T=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",R=decodeURIComponent(g),A=indexOf(R).call(R,T);if(S&&A>-1&&b)return""+h+S+"/"+slice$1(R).call(R,A);if(includes(C).call(C,m)&&includes(g).call(g,"/")){var N=indexOf(g).call(g,"/"),O=g.substring(0,N),w=g.substring(N+1);return M.replace("{bucket}",O).replace("{object}",w)}var k=filter(C).call(C,(function(t){return"string"==typeof m&&includes(m).call(m,t)}))[0],x=k?m.replace(k,"").replace(/\W/g,""):null;return x?M.replace("{bucket}",x).replace("{object}",g):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a;return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if("string"==typeof t&&includes(t).call(t,"_im_url=1")){c.next=2;break}return c.abrupt("return",t);case 2:return c.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 4:return a=c.sent,c.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 6:case"end":return c.stop()}}),_callee4,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a,c,h,m,g,E=this;return as.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,c=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(ip.dontNeed)||c!==String(ip.dontNeed)){I.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==ip.time){I.next=17;break}if(!(a&&indexOf(a).call(a,String(ip.time))>=0||c&&indexOf(c).call(c,String(ip.time))>0)){I.next=13;break}return I.abrupt("return",this.mixStorage.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:I.next=33;break;case 17:if(t.urls&&t.urls.length){I.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(m=[],g=[],forEach$1(h=t.urls).call(h,(function(t){var a=E._getUrlType(t);a===op.nos&&g.push(t),a===op.s3&&m.push(t)})),(!c||0!==m.length&&indexOf(c).call(c,String(ip.urls))<0)&&(this.logger.warn("s3 url don't support url token"),m=[]),(!a||0!==g.length&&indexOf(a).call(a,String(ip.urls))<0)&&(this.logger.warn("nos url don't support url token"),g=[]),0!==m.length||0!==g.length){I.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==m.length&&0!==g.length){I.next=33;break}return t.urls=ps(t.urls),I.abrupt("return",this.mixStorage.getFileAuthToken(t));case 33:case"end":return I.stop()}}),_callee5,this)})))},t._getUrlType=function _getUrlType(t){var a,c;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?op.nos:this.mixStorePolicy.s3Policy&&some(c=this.mixStorePolicy.s3Policy.dlcdns).call(c,(function(a){return indexOf(t).call(t,a)>=0}))?op.s3:null},t.getNosAccessToken=function getNosAccessToken(t){return validate({url:{type:"string",allowEmpty:!1}},t),this.nos.getNosAccessToken(t)},t.deleteNosAccessToken=function deleteNosAccessToken(t){return validate({token:{type:"string",allowEmpty:!1}},t),this.nos.deleteNosAccessToken(t)},t.process=function process(t){var a=Vc(t,"error.detail.ignore");return t.error&&!a?za.reject(t.error):za.resolve(t)},Jo(CloudStorageService,[{key:"grayConfig",get:function get(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function get(){return this.mixStorage.mixStorePolicy}}]),CloudStorageService}(),Zf=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw Zf("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},em=Math.floor,mergeSort=function(t,a){var c=t.length,h=em(c/2);return c<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,h),a),mergeSort(arraySliceSimple(t,h),a),a)},insertionSort=function(t,a){for(var c,h,m=t.length,g=1;g<m;){for(h=g,c=t[g];h&&a(t[h-1],c)>0;)t[h]=t[--h];h!==g++&&(t[h]=c)}return t},merge=function(t,a,c,h){for(var m=a.length,g=c.length,E=0,I=0;E<m||I<g;)t[E+I]=E<m&&I<g?h(a[E],c[I])<=0?a[E++]:c[I++]:E<m?a[E++]:c[I++];return t},tm=mergeSort,rm=$.match(/firefox\/(\d+)/i),nm=!!rm&&+rm[1],am=/MSIE|Trident/.test($),om=$.match(/AppleWebKit\/(\d+)\./),im=!!om&&+om[1],sm=[],cm=A(sm.sort),lm=A(sm.push),um=fails((function(){sm.sort(void 0)})),dm=fails((function(){sm.sort(null)})),pm=arrayMethodIsStrict("sort"),hm=!fails((function(){if(X)return X<70;if(!(nm&&nm>3)){if(am)return!0;if(im)return im<603;var t,a,c,h,m="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:c=3;break;case 68:case 71:c=4;break;default:c=2}for(h=0;h<47;h++)sm.push({k:a+h,v:c})}for(sm.sort((function(t,a){return a.v-t.v})),h=0;h<sm.length;h++)a=sm[h].k.charAt(0),m.charAt(m.length-1)!==a&&(m+=a);return"DGBEFHACIJK"!==m}}));_export({target:"Array",proto:!0,forced:um||!dm||!pm||!hm},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if(hm)return void 0===t?cm(a):cm(a,t);var c,h,m=[],g=lengthOfArrayLike(a);for(h=0;h<g;h++)h in a&&lm(m,a[h]);for(tm(m,function(t){return function(a,c){return void 0===c?-1:void 0===a?1:void 0!==t?+t(a,c)||0:toString$1(a)>toString$1(c)?1:-1}}(t)),c=lengthOfArrayLike(m),h=0;h<c;)a[h]=m[h++];for(;h<g;)deletePropertyOrThrow(a,h++);return a}});var fm,mm,gm,vm=entryVirtual("Array").sort,ym=Array.prototype,sort=function(t){var a=t.sort;return t===ym||Y(ym,t)&&a===ym.sort?vm:a};!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(fm||(fm={})),function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime",t[t.totalMember=2]="totalMember"}(mm||(mm={})),function(t){t[t.square=1]="square",t[t.person=2]="person"}(gm||(gm={}));var _m=function(t){function Service(a,c){var h;return(h=t.call(this)||this).name=a,h.core=c,h.name=a,h.logger=c.logger,h.core=c,h}St(Service,t);var a=Service.prototype;return a.emit=function emit(a){var c=this;try{for(var h,m,g=arguments.length,E=new Array(g>1?g-1:0),I=1;I<g;I++)E[I-1]=arguments[I];var M=(h=t.prototype.emit).call.apply(h,concat(m=[this,a]).call(m,E));return M}catch(t){return go((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var c=Vc(t,"error.detail.ignore");return t.error&&!c?za.reject(t.error):za.resolve(t)},Service}(vo),Em={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},Im={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},Mm={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:Im,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},Cm=function getDeserializeTag(){return invertSerializeMap(Mm)},bm=function getCmdConfig(){var t=Cm();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:Mm.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:Mm.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:Mm.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:Mm.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:t.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:Mm.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:Mm.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:Mm.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:Mm.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:Mm.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:Mm.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:Mm.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:Mm.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:Mm.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:Mm.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:t.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:Mm.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:t.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:t.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:Mm.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:Mm.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:Mm.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:Mm.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:Mm.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:Mm.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:Mm.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:Mm.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:Mm.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:Mm.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:t.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:t.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:Mm.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:Mm.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:Mm.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:Mm.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:Mm.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:t.qchatChannelIdInfoTag}]}}},Sm={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},Tm={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:Im},Rm=function getDeserializeTag(){return invertSerializeMap(Tm)},Am=function getCmdConfig(){var t=Rm();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:Tm.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:Tm.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:t.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:Tm.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:Tm.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:t.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:t.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Tm.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:t.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:Tm.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:Tm.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:t.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:Tm.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:Tm.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:Tm.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:Tm.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:t.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:Tm.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:Tm.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:t.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:t.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Tm.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Tm.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Tm.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Tm.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Tm.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:t.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:t.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:t.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}};function format(t,a){if(!xp(a))return{};var c=JSON.parse(ps(a)),h=doFormat(t,c);return JSON.parse(ps(wt(wt({},c),h)))}function doFormat(t,a){if(!xp(a))return{};var c={},h=Uo(t);return forEach$1(h).call(h,(function(h){var m=t[h].type;if("string"!=typeof m){var g=doFormat(t[h],a);Uo(g).length>0&&(c[h]=g)}else{var E=t[h],I=E.rawKey||h,M=Nm[m](a,I,E);void 0!==M&&(a[I]=void 0,c[h]=M)}})),c}var Nm={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,c){return values(c)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!xp(a))return{};var c=JSON.parse(ps(a)),h=doFormatReverse(t,c);return JSON.parse(ps(wt(wt({},c),h)))}function doFormatReverse(t,a){var c;if(!xp(a))return reduce(c=Uo(t)).call(c,(function(a,c){return a[t[c].rawKey||c]=void 0,a}),{});var h={},m=Uo(t);return forEach$1(m).call(m,(function(c){var m=t[c].type;if("string"!=typeof m){var g=doFormatReverse(t[c],a[c]);return wt(h,g),void(a[c]=void 0)}var E=t[c],I=E.rawKey||c,M=Om[m](a,c,E);a[I]=void 0,h[I]=M})),h}var Om={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,c){return values(c)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return ps(t[a])}catch(t){return""}}},wm=Om,km={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},xm={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Pm={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatServer(t){return format(km,t)}function formatServers(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatServer(t)})):[]}function formatMember$1(t){return format(xm,t)}function formatMembers$1(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatMember$1(t)})):[]}function formatServerMemberBanInfos(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatServerMemberBanInfo(t){return format(Pm,t)}(t)})):[]}function generateAntispamTag(t){var a,c,h;if(!t.antispamTag)return{};var m=wt({},t.antispamTag);return(null===(a=t.antispamTag)||void 0===a?void 0:a.antiSpamBusinessId)&&"string"!=typeof(null===(c=t.antispamTag)||void 0===c?void 0:c.antiSpamBusinessId)&&(m.antiSpamBusinessId=ps(null===(h=t.antispamTag)||void 0===h?void 0:h.antiSpamBusinessId)),m}var qm={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function formatInviteApplyRecord(t){return format(qm,t)}function formatInviteApplyRecords(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatInviteApplyRecord(t)})):[]}var Lm,Dm,Vm,Um,Gm={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function formatClearServersUnread(t){return format(Gm,t)}!function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime"}(Lm||(Lm={})),function(t){t[t.white=1]="white",t[t.black=2]="black"}(Dm||(Dm={})),function(t){t[t.add=1]="add",t[t.remove=2]="remove"}(Vm||(Vm={})),function(t){t[t.message=0]="message",t[t.media=1]="media",t[t.ext=100]="ext"}(Um||(Um={}));var Fm={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:Um},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},Bm={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},jm={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Dm},opeType:{type:"enum",values:Vm},toAccids:{type:"object"}},Wm={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Dm},opeType:{type:"enum",values:Vm},roleId:{type:"string"}},Ym={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},$m={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatUpdateWhiteBlackRole(t){return format(Wm,t)}function formatChannel(t){return format(Fm,t)}function formatChannels(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatChannel(t)})):[]}function formatUnreadInfo(t){return format(Bm,t)}function formatUnreadInfos(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatUnreadInfo(t)})):[]}function formatChannelCategory(t){return format(Ym,t)}function formatChannelCategorys(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatChannelCategory(t)})):[]}function formatChannelMembers(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatChannelMember(t){return format($m,t)}(t)})):[]}function formatFailServerIds(t){try{return JSON.parse(t)}catch(t){return[]}}var Hm=Is?Is.isConcatSpreadable:void 0;var Qm=function isFlattenable(t){return vs(t)||Dd(t)||!!(Hm&&t&&t[Hm])};var Km=function baseFlatten(t,a,c,h,m){var g=-1,E=t.length;for(c||(c=Qm),m||(m=[]);++g<E;){var I=t[g];a>0&&c(I)?a>1?baseFlatten(I,a-1,c,h,m):ah(m,I):h||(m[m.length]=I)}return m},zm=bd((function(t,a){return Rp(t)?If(t,Km(a,1,Rp,!0)):[]})),Jm=zm;function _createForOfIteratorHelperLoose$3(t,a){var c,h=void 0!==Hi&&Af(t)||t["@@iterator"];if(h)return bind$1(c=(h=h.call(t)).next).call(c,h);if(sf(t)||(h=function _unsupportedIterableToArray$3(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$3(t,a);var h=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===h&&t.constructor&&(h=t.constructor.name);if("Map"===h||"Set"===h)return Rf(t);if("Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return _arrayLikeToArray$3(t,a)}(t))||a&&t&&"number"==typeof t.length){h&&(t=h);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$3(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,h=new Array(a);c<a;c++)h[c]=t[c];return h}var Xm,Zm,eg,tg,rg=function(t){function QChatServerService(a){var c;return(c=t.call(this,"qchatServer",a)||this).core=a,registerParser({cmdMap:Sm,cmdConfig:Am()}),c}St(QChatServerService,t);var a=QChatServerService.prototype;return a.createServer=function createServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a;return as.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:wt(wt({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return c.stop()}}),_callee,this)})))},a.deleteServer=function deleteServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatDeleteServer",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateServer=function updateServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:wt(wt({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return c.stop()}}),_callee3,this)})))},a.getServers=function getServers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a;return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetServers",t);case 3:return a=c.sent,c.abrupt("return",formatServers(a.content.serverList));case 5:case"end":return c.stop()}}),_callee4,this)})))},a.getServersByPage=function getServersByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a,c,h,m;return as.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:t});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatServers(h)});case 6:case"end":return g.stop()}}),_callee5,this)})))},a.inviteServerMembers=function inviteServerMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var a,c;return as.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),h.next=3,this.core.sendCmd("qchatInviteServerMembers",t);case 3:return a=h.sent,c=a.content.record||{},h.abrupt("return",{failByOverAccids:a.content.failByOverAccids,failByBanAccids:a.content.failByBanAccids,recordInfo:formatInviteApplyRecord(c)});case 6:case"end":return h.stop()}}),_callee6,this)})))},a.acceptServerInvite=function acceptServerInvite(t){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){return as.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerInvite",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.rejectInviteServer=function rejectInviteServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){return as.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectInviteServer",t);case 3:case"end":return a.stop()}}),_callee8,this)})))},a.applyServerJoin=function applyServerJoin(t){return __awaiter(this,void 0,void 0,as.mark((function _callee9(){var a;return as.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),c.next=3,this.core.sendCmd("qchatApplyServerJoin",t);case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecord(a.content.data));case 5:case"end":return c.stop()}}),_callee9,this)})))},a.acceptServerApply=function acceptServerApply(t){return __awaiter(this,void 0,void 0,as.mark((function _callee10(){return as.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerApply",t);case 3:case"end":return a.stop()}}),_callee10,this)})))},a.rejectServerApply=function rejectServerApply(t){return __awaiter(this,void 0,void 0,as.mark((function _callee11(){return as.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectServerApply",t);case 3:case"end":return a.stop()}}),_callee11,this)})))},a.kickServerMembers=function kickServerMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee12(){return as.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatKickServerMembers",t);case 3:case"end":return a.stop()}}),_callee12,this)})))},a.leaveServer=function leaveServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee13(){return as.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatLeaveServer",t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,as.mark((function _callee14(){var a;return as.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return c.stop()}}),_callee14,this)})))},a.updateServerMemberInfo=function updateServerMemberInfo(t){return __awaiter(this,void 0,void 0,as.mark((function _callee15(){var a;return as.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.getServerMembers=function getServerMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee16(){var a,c,h,m,g;return as.wrap((function _callee16$(E){for(;;)switch(E.prev=E.next){case 0:if(validate({accids:{type:"array"}},t),a=[],t.accids.length)for(c=_createForOfIteratorHelperLoose$3(t.accids);!(h=c()).done;)m=h.value,a.push(m.serverId+"|"+m.accid);return E.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:a});case 5:return g=E.sent,E.abrupt("return",formatMembers$1(g.content.accidList));case 7:case"end":return E.stop()}}),_callee16,this)})))},a.getServerMembersByPage=function getServerMembersByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee17(){var a,c,h,m;return as.wrap((function _callee17$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:t});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatMembers$1(h)});case 6:case"end":return g.stop()}}),_callee17,this)})))},a.subscribeServer=function subscribeServer(t){var a,c,h,m;return __awaiter(this,void 0,void 0,as.mark((function _callee18(){var g,E,I,M;return as.wrap((function _callee18$(C){for(;;)switch(C.prev=C.next){case 0:if(validate({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},t),!(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)||t.isInternalTrigger){C.next=3;break}throw new cd("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(t.type||(t.type=4),!t.servers.length){C.next=12;break}return E=wt(wt({},t),{channels:map$6(g=t.servers).call(g,(function(t){return{serverId:t.serverId,channelId:""}}))}),C.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(E);case 8:return I=C.sent,M=I.failedChannels,(null===(m=null===(h=this.core.qchatChannel)||void 0===h?void 0:h.config)||void 0===m?void 0:m.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(E):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(E),C.abrupt("return",{failedServers:M});case 12:case"end":return C.stop()}}),_callee18,this)})))},a.banServerMember=function banServerMember(t){return __awaiter(this,void 0,void 0,as.mark((function _callee19(){return as.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:wt(wt({},t),{opeType:1})});case 3:case"end":return a.stop()}}),_callee19,this)})))},a.unbanServerMember=function unbanServerMember(t){return __awaiter(this,void 0,void 0,as.mark((function _callee20(){return as.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:wt(wt({},t),{opeType:2})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getBannedMembersByPage=function getBannedMembersByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee21(){var a,c,h,m;return as.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:t});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatServerMemberBanInfos(h)});case 6:case"end":return g.stop()}}),_callee21,this)})))},a.serverSearchByPage=function serverSearchByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee22(){var a,c,h,m;return as.wrap((function _callee22$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:getEnumKeys(fm),required:!1},searchType:{type:"enum",values:getEnumKeys(gm)},sort:{type:"enum",values:getEnumKeys(mm),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){g.next=3;break}throw new ad("startTime more than endTime",t,"timeRule");case 3:return g.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:wt(wt({},t),{order:t.order&&fm[t.order],searchType:gm[t.searchType],sort:sort(t)&&mm[sort(t)],serverType:ps(t.serverType)})});case 5:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag),cursor:m.cursor},datas:formatServers(h)});case 8:case"end":return g.stop()}}),_callee22,this)})))},a.serverMemberSearchByPage=function serverMemberSearchByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee23(){var a;return as.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:t});case 3:return a=c.sent,c.abrupt("return",formatMembers$1(a.content.members));case 5:case"end":return c.stop()}}),_callee23,this)})))},a.generateInviteCode=function generateInviteCode(t){return __awaiter(this,void 0,void 0,as.mark((function _callee24(){var a;return as.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},t),c.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:t});case 3:return a=c.sent,c.abrupt("return",format({expireTime:{type:"number"}},a.content.data));case 5:case"end":return c.stop()}}),_callee24,this)})))},a.joinByInviteCode=function joinByInviteCode(t){return __awaiter(this,void 0,void 0,as.mark((function _callee25(){return as.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:t});case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getInviteApplyRecordOfServer=function getInviteApplyRecordOfServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee26(){var a;return as.wrap((function _callee26$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:wt(wt({},t),{reverse:reverse(t)?1:0})});case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return c.stop()}}),_callee26,this)})))},a.getInviteApplyRecordOfSelf=function getInviteApplyRecordOfSelf(t){return __awaiter(this,void 0,void 0,as.mark((function _callee27(){var a;return as.wrap((function _callee27$(c){for(;;)switch(c.prev=c.next){case 0:return validate({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:wt(wt({},t),{reverse:reverse(t)?1:0})});case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return c.stop()}}),_callee27,this)})))},a.markRead=function markRead(t){return __awaiter(this,void 0,void 0,as.mark((function _callee28(){var a,c,h,m;return as.wrap((function _callee28$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverIds:{type:"array",itemType:"string",required:!0}},t),g.next=3,this.core.sendCmd("qchatClearServersUnread",t);case 3:return a=g.sent,c=formatClearServersUnread(a.content.clearServersUnreadTag),h=c.successServerIds,m=c.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",h,m),g.abrupt("return",c);case 9:case"end":return g.stop()}}),_callee28,this)})))},a.subscribeAllChannel=function subscribeAllChannel(t){var a,c;return __awaiter(this,void 0,void 0,as.mark((function _callee29(){var h,m,g;return as.wrap((function _callee29$(E){for(;;)switch(E.prev=E.next){case 0:if(validate({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},t),!(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)){E.next=3;break}throw new cd("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return E.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",t,{timeout:3e4});case 5:return(m=E.sent).content.unreadInfos=formatUnreadInfos(m.content.unreadInfos),m.content.failServerIds=formatFailServerIds(m.content.failServerIds),g={type:t.type,opeType:1,channels:map$6(h=m.content.unreadInfos).call(h,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",g),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",t.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",m.content.unreadInfos),E.abrupt("return",m.content);case 13:case"end":return E.stop()}}),_callee29,this)})))},a.enterAsVisitor=function enterAsVisitor(t){return __awaiter(this,void 0,void 0,as.mark((function _callee30(){var a,c,h;return as.wrap((function _callee30$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:ps(t.serverIds)}});case 3:return a=m.sent,c=formatFailServerIds(a.content.failServerIds),h=Jm(t.serverIds,c),this.core.qchatChannel.subscribeForVisitorService.cacheServer(h),m.abrupt("return",{failedServers:c});case 8:case"end":return m.stop()}}),_callee30,this)})))},a.leaveAsVisitor=function leaveAsVisitor(t){return __awaiter(this,void 0,void 0,as.mark((function _callee31(){var a,c,h,m=this;return as.wrap((function _callee31$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),g.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:ps(t.serverIds)}});case 3:return a=g.sent,c=formatFailServerIds(a.content.failServerIds),h=Jm(t.serverIds,c),forEach$1(h).call(h,(function(t){m.core.qchatChannel.subscribeForVisitorService.deleteServer(t)})),g.abrupt("return",{failedServers:c});case 8:case"end":return g.stop()}}),_callee31,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,as.mark((function _callee32(){return as.wrap((function _callee32$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},t),!t.serverIds.length){a.next=5;break}return a.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(t);case 4:return a.abrupt("return",a.sent);case 5:return a.abrupt("return",{failedServers:[]});case 6:case"end":return a.stop()}}),_callee32,this)})))},QChatServerService}(_m);!function(t){t[t.everyone=1]="everyone",t[t.custom=2]="custom"}(Xm||(Xm={})),function(t){t[t.normal=0]="normal",t[t.owner=1]="owner"}(Zm||(Zm={})),function(t){t[t.ignore=0]="ignore",t[t.deny=-1]="deny",t[t.allow=1]="allow"}(eg||(eg={})),function(t){t[t.manageServer=1]="manageServer",t[t.manageChannel=2]="manageChannel",t[t.manageRole=3]="manageRole",t[t.sendMsg=4]="sendMsg",t[t.accountInfoSelf=5]="accountInfoSelf",t[t.inviteServer=6]="inviteServer",t[t.kickServer=7]="kickServer",t[t.accountInfoOther=8]="accountInfoOther",t[t.recallMsg=9]="recallMsg",t[t.deleteMsg=10]="deleteMsg",t[t.remindOther=11]="remindOther",t[t.remindEveryone=12]="remindEveryone",t[t.manageBlackWhiteList=13]="manageBlackWhiteList",t[t.banServerMember=14]="banServerMember",t[t.RTCChannelConnect=15]="RTCChannelConnect",t[t.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",t[t.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",t[t.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",t[t.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",t[t.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",t[t.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",t[t.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",t[t.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",t[t.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",t[t.manageInviteApply=25]="manageInviteApply",t[t.manageInviteApplyHistory=26]="manageInviteApplyHistory",t[t.mentionedRole=27]="mentionedRole"}(tg||(tg={}));var ng={type:{type:"enum",values:Xm},memberType:{type:"enum",values:Zm},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},ag={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:Xm},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},og={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:Zm},joinTime:{type:"number"},inviter:{type:"string"}};function generatorRoleForCmd(t){var a=wt({},t),c=formatReverse(ng,a);return c.auths&&(c.auths=function generateRoleAuthsForCmd(t){var a,c=reduce(a=Uo(t)).call(a,(function(a,c){var h=tg[c];return h?a[h]=eg[t[c]]:a[c]=eg[t[c]],a}),{});return ps(c)}(c.auths)),c}function formatRoleAuths(t){var a;return reduce(a=Uo(t)).call(a,(function(a,c){var h=getEnumKeyByEnumValue(tg,c);h?a[h]=eg[t[c]]:a[rl(c)]=eg[t[c]];return a}),{})}function formatRole(t){var a=format(ng,t);return t.auths&&(a.auths=formatRoleAuths(JSON.parse(a.auths))),a.isMember&&delete a.isMember,a}function formatRoles(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return formatRole(t)})):[]}function formatChannelCategoryRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(ag,t)}function formatChannelCategoryMemberRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(og,t)}collection("Set",(function(t){return function Set(){return t(this,arguments.length?arguments[0]:void 0)}}),Al);var ig=W.Set;_export({target:"Set",stat:!0,forced:!0},{from:wl}),_export({target:"Set",stat:!0,forced:!0},{of:kl});_export({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function addAll(){for(var t=anObject(this),a=aCallable(t.add),c=0,h=arguments.length;c<h;c++)w(a,t,arguments[c]);return t}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:xl});var sg=getIterator;_export({target:"Set",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=sg(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c){if(!h(t,t,a))return c()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{difference:function difference(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a),h=aCallable(c.delete);return iterate(t,(function(t){w(h,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=sg(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Set"))),g=aCallable(m.add);return iterate(c,(function(t){h(t,t,a)&&w(g,m,t)}),{IS_ITERATOR:!0}),m}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=sg(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c){if(h(t,t,a))return c(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function intersection(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set"))),h=aCallable(a.has),m=aCallable(c.add);return iterate(t,(function(t){w(h,a,t)&&w(m,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function isDisjointFrom(t){var a=anObject(this),c=aCallable(a.has);return!iterate(t,(function(t,h){if(!0===w(c,a,t))return h()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function isSubsetOf(t){var a=getIterator(this),c=anObject(t),h=c.has;return isCallable(h)||(c=new(getBuiltIn("Set"))(t),h=aCallable(c.has)),!iterate(a,(function(t,a){if(!1===w(h,c,t))return a()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function isSupersetOf(t){var a=anObject(this),c=aCallable(a.has);return!iterate(t,(function(t,h){if(!1===w(c,a,t))return h()}),{INTERRUPTED:!0}).stopped}});var cg=A([].join),lg=[].push;_export({target:"Set",proto:!0,real:!0,forced:!0},{join:function join(t){var a=anObject(this),c=sg(a),h=void 0===t?",":toString$1(t),m=[];return iterate(c,lg,{that:m,IS_ITERATOR:!0}),cg(m,h)}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{map:function map(t){var a=anObject(this),c=sg(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Set"))),g=aCallable(m.add);return iterate(c,(function(t){w(g,m,h(t,t,a))}),{IS_ITERATOR:!0}),m}});var ug=TypeError;_export({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=sg(a),h=arguments.length<2,m=h?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c){h?(h=!1,m=c):m=t(m,c,c,a)}),{IS_ITERATOR:!0}),h)throw ug("Reduce of empty set with no initial value");return m}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=sg(a),h=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c){if(h(t,t,a))return c()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function symmetricDifference(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a),h=aCallable(c.delete),m=aCallable(c.add);return iterate(t,(function(t){w(h,c,t)||w(m,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{union:function union(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a);return iterate(t,aCallable(c.add),{that:c}),c}});var dg,pg,hg,fg,mg,gg,vg,yg,_g=ig;function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)}!function(t){t[t.default=1]="default",t[t.sync=2]="sync"}(dg||(dg={})),function(t){t[t.sendTime=1]="sendTime"}(pg||(pg={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(hg||(hg={})),function(t){t[t.sending=1]="sending",t[t.success=2]="success",t[t.failed=3]="failed"}(fg||(fg={})),function(t){t[t.notifyAll=1]="notifyAll",t[t.notifySubscribe=2]="notifySubscribe"}(mg||(mg={})),function(t){t[t.unknown=0]="unknown",t[t.server=1]="server",t[t.channel=2]="channel",t[t.serverAccids=3]="serverAccids",t[t.channelAccids=4]="channelAccids",t[t.accids=5]="accids"}(gg||(gg={})),function(t){t[t.serverMemberInvite=1]="serverMemberInvite",t[t.serverMemberInviteReject=2]="serverMemberInviteReject",t[t.serverMemberApply=3]="serverMemberApply",t[t.serverMemberApplyReject=4]="serverMemberApplyReject",t[t.serverCreate=5]="serverCreate",t[t.serverRemove=6]="serverRemove",t[t.serverUpdate=7]="serverUpdate",t[t.serverMemberInviteDone=8]="serverMemberInviteDone",t[t.serverMemberInviteAccept=9]="serverMemberInviteAccept",t[t.serverMemberApplyDone=10]="serverMemberApplyDone",t[t.serverMemberApplyAccept=11]="serverMemberApplyAccept",t[t.serverMemberKick=12]="serverMemberKick",t[t.serverMemberLeave=13]="serverMemberLeave",t[t.serverMemberUpdate=14]="serverMemberUpdate",t[t.channelCreate=15]="channelCreate",t[t.channelRemove=16]="channelRemove",t[t.channelUpdate=17]="channelUpdate",t[t.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",t[t.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",t[t.updateQuickComment=20]="updateQuickComment",t[t.channelCategoryCreate=21]="channelCategoryCreate",t[t.channelCategoryRemove=22]="channelCategoryRemove",t[t.channelCategoryUpdate=23]="channelCategoryUpdate",t[t.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",t[t.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",t[t.serverIdentifyAdd=26]="serverIdentifyAdd",t[t.serverIdentifyRemove=27]="serverIdentifyRemove",t[t.serverIdentifyUpdate=28]="serverIdentifyUpdate",t[t.channelIdentifyUpdate=29]="channelIdentifyUpdate",t[t.userIdentifyUpdate=30]="userIdentifyUpdate",t[t.channelVisibilityUpdate=31]="channelVisibilityUpdate",t[t.serverEnterLeave=32]="serverEnterLeave",t[t.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",t[t.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",t[t.myMemberInfoUpdated=35]="myMemberInfoUpdated",t[t.custom=100]="custom",t[t.msgTyping=101]="msgTyping"}(vg||(vg={})),function(t){t[t.reply=1]="reply",t[t.thread=2]="thread",t[t.all=3]="all"}(yg||(yg={}));var Eg=Math.max,Ig=Math.min;function debounce(t,a,c){var h,m,g,E,I,M,C=0,b=!1,S=!1,T=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function invokeFunc(a){var c=h,g=m;return h=m=void 0,C=a,E=t.apply(g,c)}function leadingEdge(t){return C=t,I=go(timerExpired,a),b?invokeFunc(t):E}function shouldInvoke(t){var c=t-M;return void 0===M||c>=a||c<0||S&&t-C>=g}function timerExpired(){var t=Za();if(shouldInvoke(t))return trailingEdge(t);I=go(timerExpired,function remainingWait(t){var c=a-(t-M);return S?Ig(c,g-(t-C)):c}(t))}function trailingEdge(t){return I=void 0,T&&h?invokeFunc(t):(h=m=void 0,E)}function debounced(){var t=Za(),c=shouldInvoke(t);if(h=arguments,m=this,M=t,c){if(void 0===I)return leadingEdge(M);if(S)return clearTimeout(I),I=go(timerExpired,a),invokeFunc(M)}return void 0===I&&(I=go(timerExpired,a)),E}return a=Number(a)||0,isObject(c)&&(b=!!c.leading,g=(S="maxWait"in c)?Eg(Number(c.maxWait)||0,a):g,T="trailing"in c?!!c.trailing:T),debounced.cancel=function cancel(){void 0!==I&&clearTimeout(I),C=0,h=M=m=I=void 0},debounced.flush=function flush(){return void 0===I?E:trailingEdge(Za())},debounced}function throttle(t,a,c){var h=!0,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return isObject(c)&&(h="leading"in c?!!c.leading:h,m="trailing"in c?!!c.trailing:m),debounce(t,a,{leading:h,maxWait:a,trailing:m})}var Mg=function baseSlice(t,a,c){var h=-1,m=t.length;a<0&&(a=-a>m?0:m+a),(c=c>m?m:c)<0&&(c+=m),m=a>c?0:c-a>>>0,a>>>=0;for(var g=Array(m);++h<m;)g[h]=t[h+a];return g},Cg=/\s/;var bg=function trimmedEndIndex(t){for(var a=t.length;a--&&Cg.test(t.charAt(a)););return a},Sg=/^\s+/;var Tg=function baseTrim(t){return t?t.slice(0,bg(t)+1).replace(Sg,""):t},Rg=/^[-+]0x[0-9a-f]+$/i,Ag=/^0b[01]+$/i,Ng=/^0o[0-7]+$/i,Og=parseInt;var wg=function toNumber(t){if("number"==typeof t)return t;if(ks(t))return NaN;if(Ls(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=Ls(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=Tg(t);var c=Ag.test(t);return c||Ng.test(t)?Og(t.slice(2),c?2:8):Rg.test(t)?NaN:+t},kg=1/0;var xg=function toFinite(t){return t?(t=wg(t))===kg||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Pg=function toInteger(t){var a=xg(t),c=a%1;return a==a?c?a-c:a:0},qg=Math.ceil,Lg=Math.max;var Dg,Vg=function chunk(t,a,c){a=(c?Nd(t,a,c):void 0===a)?1:Lg(Pg(a),0);var h=null==t?0:t.length;if(!h||a<1)return[];for(var m=0,g=0,E=Array(qg(h/a));m<h;)E[g++]=Mg(t,m,m+=a);return E};!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(Dg||(Dg={}));var Ug=function(){function UnreadInfoModuleService(t){var a=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=throttle((function(t){a.core.emit("serverUnreadInfo",a.getServerUnreadInfo(t)),Vc(a.core,"qchatServer.emit")&&a.core.qchatServer.emit("serverUnreadInfo",a.getServerUnreadInfo(t))}),100),this.core=t}var t=UnreadInfoModuleService.prototype;return t.changeCacheServerRoleIds=function changeCacheServerRoleIds(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c,h,m,g,E,I,M=this;return as.wrap((function _callee$(C){for(;;)switch(C.prev=C.next){case 0:if(c=t.attach.serverIdentifyInfo,h=c.serverId,m=c.roleId,this.serverRoleIdsMap[h]){C.next=4;break}return C.next=4,this.getRoleIdsByServerId([h]);case 4:if(g=this.serverRoleIdsMap[h],!(t.time<g.timeTag)){C.next=7;break}return C.abrupt("return");case 7:if(t.type===vg[vg.serverIdentifyAdd]?g.roleIds.add(m):g.roleIds.delete(m),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+h+" roleIds is",concat(a=[]).call(a,g.roleIds)),E=this.unreadServerCount[h]){C.next=12;break}return C.abrupt("return");case 12:I=Vg(Uo(E),100),forEach$1(I).call(I,(function(t){M.core.qchatChannel.getChannelUnreadInfos({channels:map$6(t).call(t,(function(t){return{serverId:h,channelId:t}}))})}));case 14:case"end":return C.stop()}}),_callee,this)})))},t.getRoleIdsByServerId=function getRoleIdsByServerId(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c,h,m,g=this;return as.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:if((c=filter(t).call(t,(function(t){return!g.serverRoleIdsMap[t]}))).length){E.next=3;break}return E.abrupt("return");case 3:return h={serverIdTimeTags:c},E.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:h});case 6:m=E.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",h,"result is",m),forEach$1(a=m.content.serverRoles).call(a,(function(t){try{t.roleIds=JSON.parse(t.roleIds)}catch(t){g.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}g.serverRoleIdsMap[t.serverId]={roleIds:new _g(t.roleIds),timeTag:t.timeTag}}));case 9:case"end":return E.stop()}}),_callee2,this)})))},t._unSubscribeChannel=function _unSubscribeChannel(t,a){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var c,h,m,g,E;return as.wrap((function _callee3$(I){for(;;)switch(I.prev=I.next){case 0:if(c=t+"_"+a,h=[],this.manualSubscribeUnreadMap[c]?h.push(this.manualSubscribeUnreadMap[c]):this.autoSubscribeUnreadMap[c]&&h.push(this.autoSubscribeUnreadMap[c]),this.manualSubscribeTypingMap[c]&&h.push(this.manualSubscribeTypingMap[c]),0!==h.length){I.next=6;break}return I.abrupt("return");case 6:for(m=0,g=h;m<g.length;m++)E=g[m],this.subscribe({opeType:Dg.unSub,type:E,channels:[{serverId:t,channelId:a}]});this.manualSubscribeUnreadMap[c]?this.manualSubscribeUnreadMap[c]=void 0:this.autoSubscribeUnreadMap[c]&&(this.autoSubscribeUnreadMap[c]=void 0),this.manualSubscribeTypingMap[c]&&(this.manualSubscribeTypingMap[c]=void 0);case 9:case"end":return I.stop()}}),_callee3,this)})))},t._unSubscribeServer=function _unSubscribeServer(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a,c;return as.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:if(a=t,c=this.manualSubscribeServerMap[a]||this.autoSubscribeServerMap[a]){h.next=4;break}return h.abrupt("return");case 4:this.subscribe({opeType:Dg.unSub,type:c,channels:[{serverId:t,channelId:""}]}),this.manualSubscribeServerMap[a]?this.manualSubscribeServerMap[a]=void 0:this.autoSubscribeServerMap[a]&&(this.autoSubscribeServerMap[a]=void 0);case 6:case"end":return h.stop()}}),_callee4,this)})))},t.subscribe=function subscribe(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var a,c,h,m,g=this;return as.wrap((function _callee6$(E){for(;;)switch(E.prev=E.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),E.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return c=E.sent,h=new _g,forEach$1(a=t.channels).call(a,(function(t){return __awaiter(g,void 0,void 0,as.mark((function _callee5(){return as.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:this.serverRoleIdsMap[t.serverId]||h.add(t.serverId);case 1:case"end":return a.stop()}}),_callee5,this)})))})),m=Vg(Rf(h),10),forEach$1(m).call(m,(function(t){g.getRoleIdsByServerId(t)})),E.abrupt("return",c.content);case 9:case"end":return E.stop()}}),_callee6,this)})))},t.autoSubscribe=function autoSubscribe(){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){return as.wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return t.stop()}}),_callee7,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,as.mark((function _callee10(){var a,c,h,m,g,E,I,M=this;return as.wrap((function _callee10$(C){for(;;)switch(C.prev=C.next){case 0:if(this.serverRoleIdsMap={},g=100,t){C.next=6;break}return this.unreadServerCount={},this.unreadCount={},C.abrupt("return");case 6:return E={},forEach$1(a=Uo(this.manualSubscribeUnreadMap)).call(a,(function(t){var a=M.manualSubscribeUnreadMap[t];if(a){var c=t.split("_"),h={serverId:c[0],channelId:c[1]};E[a]=E[a]||[],E[a].push(h)}})),E[5]=[],forEach$1(c=Uo(this.manualSubscribeTypingMap)).call(c,(function(t){return __awaiter(M,void 0,void 0,as.mark((function _callee8(){var a,c,h,m;return as.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:this.manualSubscribeTypingMap[t]&&(a=t.split("_"),c=a[0],h=a[1],m={serverId:c,channelId:h},E[5].push(m));case 2:case"end":return g.stop()}}),_callee8,this)})))})),E[4]=[],forEach$1(h=Uo(this.manualSubscribeServerMap)).call(h,(function(t){return __awaiter(M,void 0,void 0,as.mark((function _callee9(){var a;return as.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:this.manualSubscribeServerMap[t]&&(a={serverId:t},E[4].push(a));case 2:case"end":return c.stop()}}),_callee9,this)})))})),I=[],forEach$1(m=Uo(E)).call(m,(function(t){var a=E[t];if(a&&0===a.length)return za.resolve();if(a.length>g){var c=Vg(a,100);return forEach$1(c).call(c,(function(a){I.push(M.createSubscribePromise(a,t))}))}I.push(M.createSubscribePromise(a,t))})),C.next=16,za.all(I);case 16:case"end":return C.stop()}}),_callee10,this)})))},t.createSubscribePromise=function createSubscribePromise(t,a){var c=this,h={type:rl(a),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",h),this.subscribe(h).then((function(t){var a=t.unreadInfos;a&&a.length>0&&(a=formatUnreadInfos(a),c.updateUnreads(a))})).catch((function(t){c.core.logger.error("qchatChannel:: autoSubscribeUnread error ",t)}))},t.cacheSubscribe=function cacheSubscribe(t){var a,c=this;forEach$1(a=t.channels).call(a,(function(a){var h=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,m=5===t.type?c.manualSubscribeTypingMap:4===t.type?c.manualSubscribeServerMap:c.manualSubscribeUnreadMap;t.opeType===Dg.sub?m[h]=t.type:t.opeType===Dg.unSub&&(m[h]=void 0)}))},t.cacheAutoSubscribe=function cacheAutoSubscribe(t){var a,c=this;forEach$1(a=t.channels).call(a,(function(a){var h=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,m=4===t.type?c.autoSubscribeServerMap:c.autoSubscribeUnreadMap;t.opeType===Dg.sub?m[h]=t.type:t.opeType===Dg.unSub&&(m[h]=void 0)}))},t.cacheUnreadCount=function cacheUnreadCount(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.serverId+"_"+t.channelId;a.unreadCount[c]=wt({},t),a.unreadServerCount[t.serverId]||(a.unreadServerCount[t.serverId]={}),a.unreadServerCount[t.serverId][t.channelId]=!0}))},t.getServerUnreadInfo=function getServerUnreadInfo(t){var a,c=this,h={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0},m=this.unreadServerCount[t];m&&(forEach$1(a=Uo(m)).call(a,(function(a){var m=t+"_"+a,g=c.unreadCount[m];h.unreadCount+=g.unreadCount,h.mentionedCount+=g.mentionedCount,void 0!==g.maxCount&&(h.maxCount=g.maxCount)})),h.unreadCount=h.unreadCount>h.maxCount?h.maxCount:h.unreadCount,h.mentionedCount=h.mentionedCount>h.maxCount?h.maxCount:h.mentionedCount);return h},t.getUnreadInfo=function getUnreadInfo(t){validate({serverId:{type:"string"},channelId:{type:"string"}},t);var a=t.serverId+"_"+t.channelId;return this.unreadCount[a]?this.unreadCount[a]:null},t.shouldChangeUnread=function shouldChangeUnread(t,a){if(!t.serverId||!t.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(t.serverId,t.channelId))return!1;if(!1===t.historyEnable)return!1;if(!1===t.needBadge)return!1;if(t.fromAccount===this.core.account)return!1;if(a&&2!==(null==t?void 0:t.status))return!1;if(t.notifyReason&&t.notifyReason===getEnumKeyByEnumValue(mg,mg.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var c=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),h=a?"ackTimestamp":"lastMsgTime";if(!c)return!1;if(t.time&&c[h]&&c[h]>t.time)return!1}return!0},t.shouldChangeMentionedUnread=function shouldChangeMentionedUnread(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,as.mark((function _callee11(){var c,h;return as.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:if(!t.accidsOfMentionedRoles||!includes(c=t.accidsOfMentionedRoles).call(c,this.core.account)){m.next=2;break}return m.abrupt("return",!0);case 2:if(!t.mentionRoleIds||!t.serverId){m.next=16;break}if(this.serverRoleIdsMap[t.serverId]){m.next=9;break}if(a){m.next=7;break}return this.handledRoleMsg(t),m.abrupt("return",!1);case 7:return m.next=9,this.getRoleIdsByServerId([t.serverId]);case 9:h=0;case 10:if(!(h<t.mentionRoleIds.length)){m.next=16;break}if(!this.serverRoleIdsMap[t.serverId].roleIds.has(t.mentionRoleIds[h])){m.next=13;break}return m.abrupt("return",!0);case 13:h++,m.next=10;break;case 16:return m.abrupt("return",!1);case 17:case"end":return m.stop()}}),_callee11,this)})))},t.handledRoleMsg=function handledRoleMsg(t){return __awaiter(this,void 0,void 0,as.mark((function _callee12(){var a,c,h,m,g,E=this;return as.wrap((function _callee12$(I){for(;;)switch(I.prev=I.next){case 0:if(t.mentionRoleIds){I.next=2;break}return I.abrupt("return");case 2:if(this.serverRoleIdsMap[t.serverId]){I.next=5;break}return I.next=5,this.getRoleIdsByServerId([t.serverId]);case 5:if(this.serverRoleIdsMap[t.serverId]){I.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",t.serverId),I.abrupt("return");case 8:if(c=!1,forEach$1(a=t.mentionRoleIds).call(a,(function(a){E.serverRoleIdsMap[t.serverId].roleIds.has(a)&&(c=!0,E.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCountï¼message is ",t))})),c){I.next=12;break}return I.abrupt("return");case 12:if(h=this.unreadCount[t.serverId+"_"+t.channelId],m=2===(null==t?void 0:t.status),h.mentionedCount=m?h.mentionedCount?h.mentionedCount-1:0:h.mentionedCount?h.mentionedCount+1:1,"number"!=typeof h.maxCount){I.next=25;break}if(!((g=(g=h.mentionedCount)>h.maxCount?h.maxCount:g)>h.maxCount)){I.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),I.abrupt("return");case 21:this.core.emit("unreadInfo",wt(wt({},h),{mentionedCount:g})),this.core.emit("unreadInfos",[wt(wt({},h),{mentionedCount:g})]),this.core.qchatChannel.emit("unreadInfos",[wt(wt({},h),{mentionedCount:g})]),this._serverUnreadInfo(t.serverId);case 25:case"end":return I.stop()}}),_callee12,this)})))},t.getMentionedFlag=function getMentionedFlag(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,as.mark((function _callee13(){var c;return as.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:if(!t.mentionAll){h.next=4;break}return h.abrupt("return",!0);case 4:if(!t.mentionRoleIds&&!t.accidsOfMentionedRoles){h.next=10;break}return h.next=7,this.shouldChangeMentionedUnread(t,a);case 7:return h.abrupt("return",h.sent);case 10:if(!t.mentionAccids||!includes(c=t.mentionAccids).call(c,this.core.account)){h.next=12;break}return h.abrupt("return",!0);case 12:return h.abrupt("return",!1);case 13:case"end":return h.stop()}}),_callee13,this)})))},t.changeUnread=function changeUnread(t,a){return __awaiter(this,void 0,void 0,as.mark((function _callee14(){var c,h,m,g,E,I,M;return as.wrap((function _callee14$(C){for(;;)switch(C.prev=C.next){case 0:if(c=t.serverId,h=t.channelId,m=c+"_"+h,this.shouldChangeUnread(t,a)){C.next=6;break}return this.core.logger.debug("changeUnread: "+m+" does not need to update unreadInfo"),C.abrupt("return");case 6:if(this.unreadCount[m]){C.next=11;break}return C.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:c,channelId:h}]});case 9:return!this.serverRoleIdsMap[c]&&t.mentionRoleIds&&this.getRoleIdsByServerId([c]),C.abrupt("return");case 11:return g=this.unreadCount[m],E=2===(null==t?void 0:t.status),C.next=15,this.getMentionedFlag(t);case 15:if(I=C.sent,E?(g.unreadCount=g.unreadCount?g.unreadCount-1:0,I&&(g.mentionedCount=g.mentionedCount?g.mentionedCount-1:0),delete g.lastMsgTime,this.core.logger.debug("changeUnread: "+m+" unread reduce ",g)):(g.unreadCount=g.unreadCount?g.unreadCount+1:1,I&&(g.mentionedCount=g.mentionedCount?g.mentionedCount+1:1),t.time&&(g.lastMsgTime=t.time),this.core.logger.debug("changeUnread: "+m+" unread add ",g)),M="number"==typeof g.maxCount?g.maxCount:100,!(g.unreadCount>M)){C.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),C.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",wt(wt({},g),{mentionedCount:g.mentionedCount>M?M:g.mentionedCount,unreadCount:g.unreadCount>M?M:g.unreadCount})),this.core.emit("unreadInfos",[wt(wt({},g),{mentionedCount:g.mentionedCount>M?M:g.mentionedCount,unreadCount:g.unreadCount>M?M:g.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[wt(wt({},g),{mentionedCount:g.mentionedCount>M?M:g.mentionedCount,unreadCount:g.unreadCount>M?M:g.unreadCount})]),this._serverUnreadInfo(c);case 26:case"end":return C.stop()}}),_callee14,this)})))},t.updateUnreads=function updateUnreads(t){var a,c,h=this;if(t&&t.length>0){var m=[],g=[],E=map$6(a=filter(t).call(t,(function(t){var a=t.serverId+"_"+t.channelId,c=h.unreadCount[a],m=Vc(c,"ackTimestamp"),g=Vc(t,"ackTimestamp");return!(m&&g&&g<m)&&(Vc(c,"unreadCount")!==Vc(t,"unreadCount")||Vc(c,"mentionedCount")!==Vc(t,"mentionedCount"))}))).call(a,(function(t){m.push(h.getServerUnreadInfo(t.serverId)),g.push(h.unreadServerCount[t.serverId]);var a=t.serverId,c=t.channelId,E=a+"_"+c;return h.core.logger.debug("qchat channel updateUnread: ",t),h.unreadCount[E]=wt({},t),h.unreadServerCount[a]||(h.unreadServerCount[a]={}),h.unreadServerCount[a][c]=!0,t}));if(0!==E.length){this.core.emit("unreadInfos",E),this.core.qchatChannel.emit("unreadInfos",E);var I={};forEach$1(E).call(E,(function(t,a){h.core.emit("unreadInfo",t);var c=m[a],E=g[a],M=h.getServerUnreadInfo(t.serverId),C=h.unreadServerCount[t.serverId],b=c.unreadCount!==M.unreadCount,S=!E||0===Uo(E).length,T=C&&Uo(C).length>0,R=c.mentionedCount!==M.mentionedCount;(b||R||S&&T)&&(I[t.serverId]=!0)})),forEach$1(c=Uo(I)).call(c,(function(t){h.core.emit("serverUnreadInfo",h.getServerUnreadInfo(t)),Vc(h.core,"qchatServer.emit")&&h.core.qchatServer.emit("serverUnreadInfo",h.getServerUnreadInfo(t))}))}}},t.clearUnreadCountByServers=function clearUnreadCountByServers(t,a){var c=this,h=[];forEach$1(t).call(t,(function(t){var a;c.unreadServerCount[t]&&forEach$1(a=Uo(c.unreadServerCount[t])).call(a,(function(a){h.push(t+"_"+a)}))}));var m=[];forEach$1(h).call(h,(function(t){m.push(wt(wt({},c.unreadCount[t]),{unreadCount:0,mentionedCount:0,ackTimestamp:a}))})),this.updateUnreads(m)},UnreadInfoModuleService}(),Gg=function(){function SubscribeForVisitorService(t){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new _g,this.autoVisitorSubscribeServer=new _g,this.autoVisitorSubscribeChannel=new _g,this.core=t}var t=SubscribeForVisitorService.prototype;return t.subscribeChannelAsVisitor=function subscribeChannelAsVisitor(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c,h,m,g=this;return as.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||6,opeType:t.opeType},datas:t.channels});case 2:return c=E.sent,h=c.content.failedArr,m=filter(a=t.channels).call(a,(function(t){return!some(h).call(h,(function(a){return a.channelId===t.channelId&&a.serverId===t.serverId}))})),forEach$1(m).call(m,(function(a){1===t.opeType?g.autoVisitorSubscribeChannel.add(a.serverId+"&"+a.channelId):g.autoVisitorSubscribeChannel.delete(a.serverId+"&"+a.channelId)})),E.abrupt("return",{failedChannels:h});case 7:case"end":return E.stop()}}),_callee,this)})))},t.subscribeServerAsVisitor=function subscribeServerAsVisitor(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c,h,m,g,E,I=this;return as.wrap((function _callee2$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||7,opeType:t.opeType},datas:map$6(a=t.serverIds).call(a,(function(t){return{serverId:t}}))});case 2:return m=M.sent,g=m.content.failedArr,E=filter(c=t.serverIds).call(c,(function(t){return!some(g).call(g,(function(a){return a.serverId===t}))})),forEach$1(E).call(E,(function(a){1===t.opeType?I.autoVisitorSubscribeServer.add(a):I.autoVisitorSubscribeServer.delete(a)})),M.abrupt("return",{failedServers:map$6(h=m.content.failedArr).call(h,(function(t){return t.serverId}))});case 7:case"end":return M.stop()}}),_callee2,this)})))},t.deleteServer=function deleteServer(t){var a;this.autoServers.delete(t),this.autoVisitorSubscribeServer.has(t)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[t]});var c=[];forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){if(0===indexOf(a).call(a,t)){var h=a.replace(t+"&","");c.push({serverId:t,channelId:h})}})),c.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:c})},t.deleteAutoSetInServerId=function deleteAutoSetInServerId(t){var a,c=this;this.autoServers.delete(t),this.autoVisitorSubscribeServer.delete(t),forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){0===indexOf(a).call(a,t)&&c.autoVisitorSubscribeChannel.delete(a)}))},t.deleteAutoSetInChannel=function deleteAutoSetInChannel(t,a){this.autoVisitorSubscribeChannel.delete(t+"&"+a)},t.unSubscribeChannel=function unSubscribeChannel(t,a){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:t,channelId:a}]})},t.isInSubscribeChannels=function isInSubscribeChannels(t,a){return this.autoVisitorSubscribeChannel.has(t+"&"+a)},t.isInAutoServers=function isInAutoServers(t){return this.autoServers.has(t)},t.doAutoSubscribe=function doAutoSubscribe(){var t=this,a=[],c=Vg(Rf(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);forEach$1(c).call(c,(function(c){a.push(t.subscribeServerAsVisitor({opeType:1,serverIds:c}))}));var h=Vg(Rf(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return forEach$1(h).call(h,(function(c){a.push(t.subscribeChannelAsVisitor({opeType:1,channels:map$6(c).call(c,(function(t){var a=indexOf(t).call(t,"&");return{serverId:slice$1(t).call(t,0,a),channelId:slice$1(t).call(t,a+1)}}))}))})),za.all(a)},t.doAutoEnterServer=function doAutoEnterServer(){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var t,a,c,h=this;return as.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return t=Vg(Rf(this.autoServers),this.limitForBatchEnter),a=[],forEach$1(t).call(t,(function(t){a.push(h.core.qchatServer.enterAsVisitor({serverIds:t}))})),m.next=5,za.all(a);case 5:c=m.sent,forEach$1(c).call(c,(function(t){var a;forEach$1(a=t.failedServers).call(a,(function(t){h.deleteAutoSetInServerId(t)}))}));case 7:case"end":return m.stop()}}),_callee3,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){return as.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!t){a.next=7;break}return a.next=3,this.doAutoEnterServer();case 3:return a.next=5,this.doAutoSubscribe();case 5:a.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return a.stop()}}),_callee4,this)})))},t.cacheServer=function cacheServer(t){var a=this;forEach$1(t).call(t,(function(t){return a.autoServers.add(t)}))},SubscribeForVisitorService}();function _createForOfIteratorHelperLoose$2(t,a){var c,h=void 0!==Hi&&Af(t)||t["@@iterator"];if(h)return bind$1(c=(h=h.call(t)).next).call(c,h);if(sf(t)||(h=function _unsupportedIterableToArray$2(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,a);var h=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===h&&t.constructor&&(h=t.constructor.name);if("Map"===h||"Set"===h)return Rf(t);if("Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return _arrayLikeToArray$2(t,a)}(t))||a&&t&&"number"==typeof t.length){h&&(t=h);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$2(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,h=new Array(a);c<a;c++)h[c]=t[c];return h}var Fg=function(t){function QChatChannelService(a,c){var h;return(h=t.call(this,"qchatChannel",a)||this).config={autoSubscribe:!1},h.core=a,registerParser({cmdMap:Em,cmdConfig:bm()}),c&&h.setOptions(c),h.subscribeModuleService=new Ug(a),h.subscribeForVisitorService=new Gg(a),h.setListener(),h}St(QChatChannelService,t);var a=QChatChannelService.prototype;return a.setOptions=function setOptions(t){t&&(this.config=wt(this.config,t))},a.setListener=function setListener(){var t,a,c,h,m,g=this;this.core.eventBus.on("logined",(function(t){g.subscribeModuleService.resumeSubscribe(t.isAutoReconnect),g.subscribeForVisitorService.resumeSubscribe(t.isAutoReconnect),g.config.autoSubscribe&&(g.subscribeModuleService.autoSubscribeServerMap={},g.subscribeModuleService.autoSubscribeUnreadMap={},g.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(t){g.subscribeModuleService.resumeSubscribe(t.isReconnect),g.subscribeForVisitorService.resumeSubscribe(t.isReconnect),g.config.autoSubscribe&&(g.subscribeModuleService.autoSubscribeServerMap={},g.subscribeModuleService.autoSubscribeUnreadMap={},g.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("qchatChannel/changeUnread",bind$1(t=this.subscribeModuleService.changeUnread).call(t,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",bind$1(a=this.subscribeModuleService.updateUnreads).call(a,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",bind$1(c=this.subscribeModuleService.cacheSubscribe).call(c,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",bind$1(h=this.subscribeModuleService.clearUnreadCountByServers).call(h,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",bind$1(m=this.subscribeModuleService.getRoleIdsByServerId).call(m,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(t){if(g.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",t),t.type===vg[vg.channelVisibilityUpdate])g.logger.log("QChatChannel::begin autoUnSubscribe channel key is",t.serverId+"_"+t.channelId),g.subscribeModuleService._unSubscribeChannel(t.serverId,t.channelId),g.logger.log("QChatChannel::autoUnSubscribe channel done key is",t.serverId+"_"+t.channelId);else if(t.type===vg[vg.serverEnterLeave]){var a;(g.subscribeModuleService.manualSubscribeServerMap[t.serverId]||g.subscribeModuleService.autoSubscribeServerMap[t.serverId])&&(g.logger.log("QChatChannel::begin autoUnSubscribe server key is",t.serverId),g.subscribeModuleService._unSubscribeServer(t.serverId),g.logger.log("QChatChannel::autoUnSubscribe server done key is",t.serverId));var c=g.subscribeModuleService.unreadServerCount[t.serverId];if(!c)return;g.logger.log("QChatChannel::begin autoUnSubscribe channels key is",Uo(c)),forEach$1(a=Uo(c)).call(a,(function(a){g.subscribeModuleService._unSubscribeChannel(t.serverId,a)})),g.logger.log("QChatChannel::autoUnSubscribe channels done key is",Uo(c))}})),this.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(t){g.subscribeModuleService.changeCacheServerRoleIds(t)}))},a.createChannel=function createChannel(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a;return as.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Um)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:wt(wt({},t),{type:Um[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return c.stop()}}),_callee,this)})))},a.deleteChannel=function deleteChannel(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteChannel",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateChannel=function updateChannel(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a,c;return as.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:getEnumKeys(Um),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),a=t,t.type&&(a.type=Um[t.type]),h.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:a,antispamTag:generateAntispamTag(t)});case 5:return c=h.sent,h.abrupt("return",formatChannel(c.content.channelInfo));case 7:case"end":return h.stop()}}),_callee3,this)})))},a.getChannels=function getChannels(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a;return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannels",t);case 3:return a=c.sent,c.abrupt("return",formatChannels(a.content.channelList));case 5:case"end":return c.stop()}}),_callee4,this)})))},a.getChannelsByPage=function getChannelsByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a,c,h,m;return as.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:wt({limit:100},t)});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatChannels(h)});case 6:case"end":return g.stop()}}),_callee5,this)})))},a.getMembersByPage=function getMembersByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var a,c,h,m;return as.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:t});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatMembers$1(h)});case 6:case"end":return g.stop()}}),_callee6,this)})))},a.updateWhiteBlackRole=function updateWhiteBlackRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){return as.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Dm)},opeType:{type:"enum",values:getEnumKeys(Vm)}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:wt(wt({},t),{type:Dm[t.type],opeType:Vm[t.opeType]})});case 3:case"end":return a.stop()}}),_callee7,this)})))},a.getWhiteBlackRolesPage=function getWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){var a,c,h,m;return as.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Dm)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:wt(wt({},t),{type:Dm[t.type]})});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatRoles(h)});case 6:case"end":return g.stop()}}),_callee8,this)})))},a.updateWhiteBlackMembers=function updateWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee9(){return as.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Dm)},opeType:{type:"enum",values:getEnumKeys(Vm)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:wt(wt({},t),{type:Dm[t.type],opeType:Vm[t.opeType],toAccids:ps(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.getWhiteBlackMembersPage=function getWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee10(){var a,c,h,m;return as.wrap((function _callee10$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Dm)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:wt(wt({limit:100},t),{type:Dm[t.type]})});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatMembers$1(h)});case 6:case"end":return g.stop()}}),_callee10,this)})))},a.getExistingWhiteBlackRoles=function getExistingWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,as.mark((function _callee11(){var a,c;return as.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Dm)},roleIds:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:wt(wt({},t),{type:Dm[t.type],roleIds:ps(t.roleIds)})});case 3:return a=h.sent,c=a.content.datas,h.abrupt("return",{datas:formatRoles(c)});case 6:case"end":return h.stop()}}),_callee11,this)})))},a.getExistingWhiteBlackMembers=function getExistingWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee12(){var a,c;return as.wrap((function _callee12$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Dm)},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:wt(wt({},t),{type:Dm[t.type],accids:ps(t.accids)})});case 3:return a=h.sent,c=a.content.datas,h.abrupt("return",{datas:formatMembers$1(c)});case 6:case"end":return h.stop()}}),_callee12,this)})))},a.updateCategoryInfoOfChannel=function updateCategoryInfoOfChannel(t){return __awaiter(this,void 0,void 0,as.mark((function _callee13(){var a;return as.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.createChannelCategory=function createChannelCategory(t){return __awaiter(this,void 0,void 0,as.mark((function _callee14(){var a;return as.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return c.stop()}}),_callee14,this)})))},a.removeChannelCategory=function removeChannelCategory(t){return __awaiter(this,void 0,void 0,as.mark((function _callee15(){return as.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategory",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateChannelCategory=function updateChannelCategory(t){return __awaiter(this,void 0,void 0,as.mark((function _callee16(){var a;return as.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return c.stop()}}),_callee16,this)})))},a.getChannelCategoriesByID=function getChannelCategoriesByID(t){return __awaiter(this,void 0,void 0,as.mark((function _callee17(){var a;return as.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",t);case 3:return a=c.sent,c.abrupt("return",formatChannelCategorys(a.content.channelCategoryList));case 5:case"end":return c.stop()}}),_callee17,this)})))},a.updateChannelCategoryWhiteBlackRole=function updateChannelCategoryWhiteBlackRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee18(){return as.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Dm)},opeType:{type:"enum",values:getEnumKeys(Vm)},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:wt(wt({},t),{type:Dm[t.type],opeType:Vm[t.opeType]})});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getChannelCategoryWhiteBlackRolesPage=function getChannelCategoryWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee19(){var a,c,h,m;return as.wrap((function _callee19$(g){for(;;)switch(g.prev=g.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Dm)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:wt(wt({},t),{type:Dm[t.type]})});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatRoles(h)});case 6:case"end":return g.stop()}}),_callee19,this)})))},a.updateChannelCategoryWhiteBlackMembers=function updateChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee20(){return as.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Dm)},opeType:{type:"enum",values:getEnumKeys(Vm)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:wt(wt({},t),{type:Dm[t.type],opeType:Vm[t.opeType],toAccids:ps(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getChannelCategoryWhiteBlackMembersPage=function getChannelCategoryWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee21(){var a,c,h,m;return as.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Dm)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:wt(wt({},t),{type:Dm[t.type]})});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatMembers$1(h)});case 6:case"end":return g.stop()}}),_callee21,this)})))},a.getChannelCategoryWhiteBlackRoles=function getChannelCategoryWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,as.mark((function _callee22(){var a,c;return as.wrap((function _callee22$(h){for(;;)switch(h.prev=h.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Dm)},roleIds:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:wt(wt({},t),{type:Dm[t.type],roleIds:ps(t.roleIds)})});case 3:return a=h.sent,c=a.content.datas,h.abrupt("return",formatRoles(c));case 6:case"end":return h.stop()}}),_callee22,this)})))},a.getChannelCategoryWhiteBlackMembers=function getChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee23(){var a,c;return as.wrap((function _callee23$(h){for(;;)switch(h.prev=h.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Dm)},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:wt(wt({},t),{type:Dm[t.type],accids:ps(t.accids)})});case 3:return a=h.sent,c=a.content.datas,h.abrupt("return",formatMembers$1(c));case 6:case"end":return h.stop()}}),_callee23,this)})))},a.getChannelCategoriesPage=function getChannelCategoriesPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee24(){var a,c,h,m;return as.wrap((function _callee24$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:t});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatChannelCategorys(h)});case 6:case"end":return g.stop()}}),_callee24,this)})))},a.getChannelCategoryChannelsPage=function getChannelCategoryChannelsPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee25(){var a,c,h,m;return as.wrap((function _callee25$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:t});case 3:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag)},datas:formatChannels(h)});case 6:case"end":return g.stop()}}),_callee25,this)})))},a.subscribeChannel=function subscribeChannel(t){return __awaiter(this,void 0,void 0,as.mark((function _callee26(){var a,c;return as.wrap((function _callee26$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),!this.config.autoSubscribe||t.isInternalTrigger||5===t.type){h.next=3;break}throw new cd("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return h.next=5,this.subscribeModuleService.subscribe(t);case 5:if((a=h.sent).unreadInfos=formatUnreadInfos(a.unreadInfos),5!==t.type){h.next=10;break}return this.subscribeModuleService.cacheSubscribe(t),h.abrupt("return");case 10:return 1===t.opeType&&(t.channels=map$6(c=a.unreadInfos).call(c,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",t),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(t):this.subscribeModuleService.cacheSubscribe(t),this.subscribeModuleService.updateUnreads(a.unreadInfos),h.abrupt("return",a);case 15:case"end":return h.stop()}}),_callee26,this)})))},a.getChannelUnreadInfos=function getChannelUnreadInfos(t){return __awaiter(this,void 0,void 0,as.mark((function _callee27(){var a,c;return as.wrap((function _callee27$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetUnreadInfo",t);case 2:return a=h.sent,c=formatUnreadInfos(a.content.unreadInfos),this.subscribeModuleService.updateUnreads(c),h.abrupt("return",c);case 6:case"end":return h.stop()}}),_callee27,this)})))},a.getChannelSearchByPage=function getChannelSearchByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee28(){var a,c,h,m;return as.wrap((function _callee28$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:getEnumKeys(fm),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:getEnumKeys(Lm),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){g.next=3;break}throw new ad("startTime more than endTime",t,"timeRule");case 3:return g.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:wt(wt({},t),{order:t.order&&fm[t.order],sort:sort(t)&&Lm[sort(t)]})});case 5:return a=g.sent,c=a.content,h=c.datas,m=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:rl(m.nextTimetag),cursor:m.cursor},datas:formatChannels(h)});case 8:case"end":return g.stop()}}),_callee28,this)})))},a.channelMemberSearch=function channelMemberSearch(t){return __awaiter(this,void 0,void 0,as.mark((function _callee29(){var a;return as.wrap((function _callee29$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelMembers(a.content.datas));case 5:case"end":return c.stop()}}),_callee29,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,as.mark((function _callee30(){return as.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee30,this)})))},a.qchatAutoSubscribeNotificationHandler=function qchatAutoSubscribeNotificationHandler(t){var a=formatUnreadInfos(t.content.unreadInfos),c=t.content.serverIds;this.subscribeModuleService.updateUnreads(a);var h=[];if(c.length){var m={opeType:1};m.channels=map$6(c).call(c,(function(t){return{serverId:t.serverId,channelId:""}})),m.type=4,h.push(m)}if(a.length){var g={opeType:1};g.channels=map$6(a).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}})),g.type=1,h.push(g)}if(h.length)for(var E,I=_createForOfIteratorHelperLoose$2(h);!(E=I()).done;){var M=E.value;this.subscribeModuleService.cacheAutoSubscribe(M)}},QChatChannelService}(_m),Bg={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},jg={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Wg=function getDeserializeTag(){return invertSerializeMap(jg)},Yg=function getCmdConfig(){var t=Wg();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:jg.serverRole},{type:"Property",name:"antispamTag",reflectMapper:jg.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:t.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:jg.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:t.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:jg.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:t.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:t.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:t.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:jg.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:t.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:jg.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:t.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:t.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:t.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:t.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:jg.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:jg.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:t.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:jg.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:t.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:jg.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:t.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:jg.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:t.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:jg.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:t.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:jg.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:t.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:jg.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},$g=function(){function CategoryModuleService(t){this.core=t}var t=CategoryModuleService.prototype;return t.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a;return as.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 5:case"end":return c.stop()}}),_callee,this)})))},t.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},t.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new cd("No update required",{},406);case 6:return c.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 7:case"end":return c.stop()}}),_callee3,this)})))},t.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a;return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return a=c.sent,c.abrupt("return",(h=a.content.list,sf(h)&&h.length>0?map$6(h).call(h,(function(t){return formatChannelCategoryRole(t)})):[]));case 5:case"end":return c.stop()}var h}),_callee4,this)})))},t.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a;return as.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 5:case"end":return c.stop()}}),_callee5,this)})))},t.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){return as.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},t.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){var a;return as.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new cd("No update required",{},406);case 6:return c.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 7:case"end":return c.stop()}}),_callee7,this)})))},t.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){var a;return as.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return a=c.sent,c.abrupt("return",(h=a.content.list,sf(h)&&h.length>0?map$6(h).call(h,(function(t){return formatChannelCategoryMemberRole(t)})):[]));case 5:case"end":return c.stop()}var h}),_callee8,this)})))},CategoryModuleService}(),Hg=function(t){function QChatRoleService(a){var c;return(c=t.call(this,"qchatRole",a)||this).core=a,registerParser({cmdMap:Bg,cmdConfig:Yg()}),c.category=new $g(a),c}St(QChatRoleService,t);var a=QChatRoleService.prototype;return a.createServerRole=function createServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a;return as.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:wt(wt({},generatorRoleForCmd(t)),{type:Xm.custom}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return c.stop()}}),_callee,this)})))},a.updateServerRole=function updateServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a;return as.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:generatorRoleForCmd(t),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.deleteServerRole=function deleteServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){return as.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteServerRole",t);case 3:case"end":return a.stop()}}),_callee3,this)})))},a.getServerRoles=function getServerRoles(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a,c,h;return as.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},t),m.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:generatorRoleForCmd(t)});case 3:return c=m.sent,h=filter(a=c.content.serverRoles).call(a,(function(t){return 1===rl(t.isMember)})),h=map$6(h).call(h,(function(t){return t.roleId})),m.abrupt("return",{roles:formatRoles(c.content.serverRoles),isMemberRoles:h});case 7:case"end":return m.stop()}}),_callee4,this)})))},a.addChannelRole=function addChannelRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a;return as.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:generatorRoleForCmd(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.channelRole));case 5:case"end":return c.stop()}}),_callee5,this)})))},a.getChannelRoles=function getChannelRoles(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var a;return as.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return c.stop()}}),_callee6,this)})))},a.removeChannelRole=function removeChannelRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){return as.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelRole",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateChannelRole=function updateChannelRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){var a;return as.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new cd("No update required",{},406);case 6:return c.abrupt("return",formatRole(a.content.channelRole));case 7:case"end":return c.stop()}}),_callee8,this)})))},a.addMemberRole=function addMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee9(){var a;return as.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:t});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.memberRole));case 5:case"end":return c.stop()}}),_callee9,this)})))},a.getMemberRoles=function getMemberRoles(t){return __awaiter(this,void 0,void 0,as.mark((function _callee10(){var a;return as.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.memberRoles));case 5:case"end":return c.stop()}}),_callee10,this)})))},a.removeMemberRole=function removeMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee11(){return as.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:t});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberRole=function updateMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee12(){var a;return as.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new cd("No update required",{},406);case 6:return c.abrupt("return",formatRole(a.content.memberRole));case 7:case"end":return c.stop()}}),_callee12,this)})))},a.addMembersToServerRole=function addMembersToServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee13(){var a,c,h;return as.wrap((function _callee13$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatAddMembersToServerRole",wt(wt({},t),{accids:ps(t.accids)}));case 3:return a=m.sent,c=Vc(a,"content.accids.successAccids"),h=Vc(a,"content.accids.failedAccids"),m.abrupt("return",{successAccids:c?JSON.parse(c):[],failedAccids:h?JSON.parse(h):[]});case 7:case"end":return m.stop()}}),_callee13,this)})))},a.removeMembersFromServerRole=function removeMembersFromServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee14(){var a,c,h;return as.wrap((function _callee14$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",wt(wt({},t),{accids:ps(t.accids)}));case 3:return a=m.sent,c=Vc(a,"content.accids.successAccids"),h=Vc(a,"content.accids.failedAccids"),m.abrupt("return",{successAccids:c?JSON.parse(c):[],failedAccids:h?JSON.parse(h):[]});case 7:case"end":return m.stop()}}),_callee14,this)})))},a.getMembersFromServerRole=function getMembersFromServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee15(){var a;return as.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.members));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.getServerRolesByAccid=function getServerRolesByAccid(t){return __awaiter(this,void 0,void 0,as.mark((function _callee16(){var a;return as.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.serverRoles));case 5:case"end":return c.stop()}}),_callee16,this)})))},a.getExistingServerRolesByAccids=function getExistingServerRolesByAccids(t){return __awaiter(this,void 0,void 0,as.mark((function _callee17(){var a,c,h;return as.wrap((function _callee17$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:t.serverId,accids:ps(t.accids)});case 3:return a=m.sent,m.prev=4,h=JSON.parse(a.content.serverRoles),forEach$1(c=Uo(h)).call(c,(function(t){var a;forEach$1(a=h[t]).call(a,(function(a,c){h[t][c]=deserialize(a,Wg().serverRole)})),h[t]=formatRoles(h[t])})),m.abrupt("return",h);case 10:throw m.prev=10,m.t0=m.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+t.serverId+" and "+t.accids,a.content.serverRoles),m.t0;case 14:case"end":return m.stop()}}),_callee17,this,[[4,10]])})))},a.getExistingChannelRolesByServerRoleIds=function getExistingChannelRolesByServerRoleIds(t){return __awaiter(this,void 0,void 0,as.mark((function _callee18(){var a;return as.wrap((function _callee18$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:t.serverId,channelId:t.channelId,roleIds:ps(t.roleIds)});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return c.stop()}}),_callee18,this)})))},a.getExistingAccidsOfMemberRoles=function getExistingAccidsOfMemberRoles(t){return __awaiter(this,void 0,void 0,as.mark((function _callee19(){var a,c;return as.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),h.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:t.serverId,channelId:t.channelId,accids:ps(t.accids)});case 3:return a=h.sent,c=a.content.memberRoles,h.abrupt("return",c&&c.length>0?map$6(c).call(c,(function(t){return t.accid})):[]);case 6:case"end":return h.stop()}}),_callee19,this)})))},a.getExistingAccidsInServerRole=function getExistingAccidsInServerRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee20(){var a,c;return as.wrap((function _callee20$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),h.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:t.serverId,roleId:t.roleId,accids:ps(t.accids)});case 3:return a=h.sent,c=a.content.members,h.abrupt("return",c&&c.length>0?map$6(c).call(c,(function(t){return t.accid})):[]);case 6:case"end":return h.stop()}}),_callee20,this)})))},a.updateServerRolePriorities=function updateServerRolePriorities(t){return __awaiter(this,void 0,void 0,as.mark((function _callee21(){var a,c;return as.wrap((function _callee21$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},t),h.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:t.serverId,serverRoles:map$6(a=t.serverRoles).call(a,(function(t){return{serverId:t.serverId,roleId:t.roleId,priority:t.priority}}))});case 3:return c=h.sent,h.abrupt("return",formatRoles(c.content.serverRoles));case 5:case"end":return h.stop()}}),_callee21,this)})))},a.checkPermission=function checkPermission(t){return __awaiter(this,void 0,void 0,as.mark((function _callee22(){var a;return as.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},t),c.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:wt(wt({},t),{auth:tg[t.auth]||t.auth})});case 3:return a=c.sent,c.abrupt("return",a.content.checked);case 5:case"end":return c.stop()}}),_callee22,this)})))},a.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee23(){return as.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee23,this)})))},a.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee24(){return as.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee24,this)})))},a.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee25(){return as.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee26(){return as.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee26,this)})))},a.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee27(){return as.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee27,this)})))},a.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee28(){return as.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee28,this)})))},a.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee29(){return as.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee29,this)})))},a.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,as.mark((function _callee30(){return as.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee30,this)})))},a.checkPermissions=function checkPermissions(t){return __awaiter(this,void 0,void 0,as.mark((function _callee31(){var a,c,h,m;return as.wrap((function _callee31$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},t),this.core.logger.log("qchatRole::checkPermission options is",t),g.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:wt(wt({},t),{auths:ps(map$6(a=t.auths).call(a,(function(t){return tg[t]||t})))})});case 4:return h=g.sent,this.core.logger.log("qchatRole::checkPermission result is",h.content),m={},forEach$1(c=h.content.checkPermissionsResult).call(c,(function(t){m[t.auth]=t.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",m),g.abrupt("return",formatRoleAuths(m));case 10:case"end":return g.stop()}}),_callee31,this)})))},QChatRoleService}(_m);var Qg=function basePick(t,a){return Jh(t,a,(function(a,c){return Wh(t,c)}))};var Kg=function flatten(t){return(null==t?0:t.length)?Km(t,1):[]};var zg,Jg,Xg=function flatRest(t){return Cd(yd(t,void 0,Kg),t+"")}((function(t,a){return null==t?{}:Qg(t,a)})),Zg={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},ev={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:Im},tv=function getDeserializeTag(){return invertSerializeMap(ev)},rv=function getCmdConfig(){var t=tv();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:ev.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:ev.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:ev.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:ev.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:ev.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:t.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:ev.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:t.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:t.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:ev.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:ev.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:t.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:t.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:ev.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:ev.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:t.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:t.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:ev.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:ev.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:t.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:ev.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:ev.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:ev.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:t.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:t.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:t.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:t.qchatMsgTag}]}}};!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(zg||(zg={}));var nv=["image","audio","video","file"],av={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:vg},fromClientType:{type:"enum",values:zg},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function generatorSysMsgForCmd(t,a){var c=wt({},t),h=wt({type:a||vg.custom},formatReverse(av,c));return h.serverId&&h.channelId&&h.toAccids?h.toType=gg.channelAccids:h.serverId&&h.toAccids?h.toType=gg.serverAccids:h.serverId&&h.channelId?h.toType=gg.channel:h.serverId?h.toType=gg.server:h.toAccids?h.toType=gg.accids:h.toType=gg.unknown,h}function generatorSysMsgMarkersForCmd(t){var a=Xg(t,["msgIdServer","type"]);return formatReverse(av,a)}var ov=((Jg={})[vg.channelUpdateWhiteBlackIdentify]=function(t){var a=Cm();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateWhiteBlackRoleTag)),t},Jg[vg.channelUpdateWhiteBlackIdentifyUser]=function(t){var a=Cm();return t.notify=function formatUpdateWhiteBlackMembers(t){return format(jm,t)}(deserialize(t.notify,a.qchatUpdateWhiteBlackMembersTag)),t},Jg[vg.updateQuickComment]=function(t){var a=tv();return t.notify=function formatQuickCommentRequest(t){return format(cv,t)}(deserialize(t.notify,a.qchatQuickCommentRequestTag)),t},Jg[vg.channelCategoryCreate]=function(t){var a=Cm();return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,a.QChatChannelCategoryInfo)),t},Jg[vg.channelCategoryUpdate]=function(t){var a=Cm();return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,a.QChatChannelCategoryInfo)),t},Jg[vg.channelCategoryUpdateWhiteBlackIdentify]=function(t){var a=Cm();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateChannelCategoryWhiteBlackRoleTag)),t},Jg[vg.channelCategoryUpdateWhiteBlackIdentifyUser]=function(t){var a=Cm();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateChannelCategoryWhiteBlackMembersTag)),t},Jg[vg.serverIdentifyAdd]=function(t){var a=Wg();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},Jg[vg.serverIdentifyRemove]=function(t){var a=Wg();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},Jg[vg.serverIdentifyUpdate]=function(t){var a=Wg();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},Jg[vg.channelIdentifyUpdate]=function(t){var a=Wg();return t.channelIdentifyInfo=formatRole(deserialize(t.channelIdentifyInfo,a.channelRole)),t},Jg[vg.userIdentifyUpdate]=function(t){var a=Wg();return t.userIdentifyInfo=formatRole(deserialize(t.userIdentifyInfo,a.memberRole)),t},Jg[vg.myMemberInfoUpdated]=function(t){var a,c=Vc(t,"userInfo.name"),h=Vc(t,"userInfo.icon");return t.updatedInfos=map$6(a=t.reuseServers).call(a,(function(t){var a={serverId:t.serverId};return 1==(1&t.bits)&&"string"==typeof c&&wt(a,{nickChanged:!0,nick:c}),2==(2&t.bits)&&"string"==typeof h&&wt(a,{avatarChanged:!0,avatar:h}),a})),delete t.userInfo,delete t.reuseServers,t},Jg);function formatSystemNotification(t,a){var c=format(av,t);if(!c.attach)return c;var h=Rm(),m=Cm();if(c.attach.serverInfo&&(c.attach.serverInfo=formatServer(deserialize(c.attach.serverInfo,h.serverInfo))),c.attach.channelInfo&&(c.attach.channelInfo=formatChannel(deserialize(c.attach.channelInfo,m.channelInfo))),c.attach.serverMember&&(c.attach.serverMember=formatMember$1(deserialize(c.attach.serverMember,h.memberInfo))),ov[c.attach.type]&&(c.attach=ov[c.attach.type](c.attach)),c.attach.updateAuths)try{c.attach.updateAuths=formatRoleAuths(JSON.parse(c.attach.updateAuths))}catch(t){a.error("formatSystemNotification:JSON parse updateAuths error: ",t)}return c.attach.type&&(c.attach.rawType=c.attach.type,c.attach.type=vg[c.attach.type]),c}var iv={type:{type:"enum",values:hg},fromClientType:{type:"enum",values:zg},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:mg},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function generatorMsgForCmd(t){t.onSendBefore,t.onUploadStart,t.onUploadDone,t.onUploadProgress;var a=__rest(t,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),c=formatReverse(iv,a);if(c.msgIdClient=t.resendFlag?t.msgIdClient:ap(),!c.msgIdClient)throw new id("msgIdClient is required for resend a message","msgIdClient","required");return t.replyMessage&&t.replyMessage.msgIdServer&&(c.replyMsgFromAccount=t.replyMessage.fromAccount,c.replyMsgTime=+t.replyMessage.time,c.replyMsgIdServer=t.replyMessage.msgIdServer,c.replyMsgIdClient=t.replyMessage.msgIdClient,t.replyMessage.threadRefer&&t.replyMessage.threadRefer.msgIdServer?(c.threadMsgFromAccount=t.replyMessage.threadRefer.fromAccount,c.threadMsgTime=+t.replyMessage.threadRefer.time,c.threadMsgIdServer=t.replyMessage.threadRefer.msgIdServer,c.threadMsgIdClient=t.replyMessage.threadRefer.msgIdClient):(c.threadMsgFromAccount=t.replyMessage.fromAccount,c.threadMsgTime=+t.replyMessage.time,c.threadMsgIdServer=t.replyMessage.msgIdServer,c.threadMsgIdClient=t.replyMessage.msgIdClient),delete c.replyMessage),c}function formatMsgOperatorInfo(t){return format({operatorClientType:{type:"enum",values:zg},pushPayload:{type:"object"}},t)}function formatMsg(t,a,c){var h,m;return void 0===a&&(a={}),__awaiter(this,void 0,void 0,as.mark((function _callee(){var g,E,I,M;return as.wrap((function _callee$(C){for(;;)switch(C.prev=C.next){case 0:return(g=format(iv,t)).deliveryStatus=a.deliveryStatus?fg[a.deliveryStatus]:fg[fg.success],a.time&&(g.time=a.time),E=tv(),g.updateContent&&(I=format({status:{type:"number"}},I=deserialize(I=JSON.parse(g.updateContent),E.qchatMsgTag)),g.updateContent=I),g.updateOperatorInfo&&(M=formatMsgOperatorInfo(deserialize(M=JSON.parse(g.updateOperatorInfo),E.qchatMsgUpdateTag)),g.updateOperatorInfo=M),""===(null===(h=null==g?void 0:g.threadRefer)||void 0===h?void 0:h.fromAccount)&&delete g.threadRefer,""===(null===(m=null==g?void 0:g.replyRefer)||void 0===m?void 0:m.fromAccount)&&delete g.replyRefer,g.attach&&a.attachUrl&&(g.attach.url=a.attachUrl),C.next=11,formatMsgAttach(g,c);case 11:return C.abrupt("return",C.sent);case 12:case"end":return C.stop()}}),_callee)})))}function formatMsgAttach(t,a){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var c;return as.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(includes(nv).call(nv,t.type)&&t.attach&&t.attach.url){h.next=2;break}return h.abrupt("return",t);case 2:if(a&&a.cloudStorage&&"function"==typeof a.cloudStorage.getPrivateUrl&&"function"==typeof a.cloudStorage.getOriginUrl){h.next=4;break}return h.abrupt("return",t);case 4:if(!(indexOf(c=t.attach.url).call(c,"_im_url=1")<0)){h.next=7;break}return t.attach.url=a.cloudStorage.getPrivateUrl(t.attach.url),h.abrupt("return",t);case 7:return h.prev=7,h.next=10,a.cloudStorage.getOriginUrl(t.attach.url);case 10:t.attach.url=h.sent,h.next=16;break;case 13:throw h.prev=13,h.t0=h.catch(7),new id('url "'+t.attach.url+'" parse error',"message.attach.url","parse error");case 16:return h.abrupt("return",t);case 17:case"end":return h.stop()}}),_callee2,null,[[7,13]])})))}function formatMsgs(t,a,c){return void 0===a&&(a={}),__awaiter(this,void 0,void 0,as.mark((function _callee3(){var h;return as.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if(sf(t)&&t.length>0){m.next=2;break}return m.abrupt("return",[]);case 2:return h=map$6(t).call(t,(function(t){return formatMsg(t,a,c)})),m.next=5,za.all(h);case 5:return m.abrupt("return",m.sent);case 6:case"end":return m.stop()}}),_callee3)})))}var sv={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function formatQuickComments(t){var a=map$6(t).call(t,(function(t){var a,c=format(sv,t);return c.details=map$6(a=c.details).call(a,(function(t){var a=t.createTime?rl(t.createTime):0;return a=isNaN(a)?0:a,{count:t.count,hasSelf:t.self,severalAccids:t.topN,type:t.type,createTime:a}})),c})),c={};return forEach$1(a).call(a,(function(t){return c[t.msgIdServer]=t})),c}var cv={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}};var lv={includeSelf:{type:"number"},order:{type:"enum",values:fm},sort:{type:"enum",values:pg},msgTypes:{type:"object"},subTypes:{type:"object"}};var uv={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}};var dv,pv,hv={6:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(t.serverId),!0},16:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(t.serverId,t.channelId),!0},26:function _(t){var a=Vc(t,"attach.addAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},27:function _(t){var a=Vc(t,"attach.deleteAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},31:function _(t){var a,c;return 1===t.attach.event?(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:t.serverId,channelId:t.channelId}],isInternalTrigger:!0}):2===t.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)),!0},32:function _(t){var a,c;return 2===t.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)):1===t.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(t.serverId),(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:t.serverId}],isInternalTrigger:!0})),!0},34:function _(t){return 2===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(t.serverId,t.channelId),!0},101:function _(t){var a=Xg(t,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",a),this.core.emit("recvTypingEvent",a),this.core.qchatMsg.emit("recvTypingEvent",a),!1}},fv=function(){function NotificationModuleService(t){this.core=t,this.logger=t.logger}var t=NotificationModuleService.prototype;return t.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c;return as.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(t)});case 2:return a=h.sent,c=formatSystemNotification(a.content.sysMsg,this.logger),"debug"===this.core.options.debugLevel?this.logger.debug("sendCustomSysMsg success",c):this.logger.log("sendCustomSysMsg success",c.serverId,c.channelId,c.msgIdServer),h.abrupt("return",c);case 6:case"end":return h.stop()}}),_callee,this)})))},t.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c,h,m,g;return as.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:return a=t.systemNotification,c=__rest(t,["systemNotification"]),h=Xg(a,["msgIdServer","type","body","ext","status"]),m=generatorSysMsgForCmd(h),E.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:m,qchatMsgUpdateTag:wt(wt({},c),{operatorAccount:this.core.account,operatorClientType:zg.Web,pushPayload:ps(t.pushPayload),routeEnable:wm.boolean(t,"routeEnable")})});case 5:return g=E.sent,E.abrupt("return",formatSystemNotification(g.content.sysMsg,this.logger));case 7:case"end":return E.stop()}}),_callee2,this)})))},t.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:map$6(a=t.systemNotifications).call(a,(function(t){return generatorSysMsgMarkersForCmd(t)}))});case 2:case"end":return c.stop()}}),_callee3,this)})))},t.onSysMsg=function onSysMsg(t){var a=t.content.sysMsg;if(a){var c=formatSystemNotification(a,this.core.logger),h=hv[vg[c.type]];if(h)if(!1===h.call(this,c))return;var m={feature:"default",systemNotifications:[c]};this.logger.log("qchat on systemNotification: ",m),this.core.emit("systemNotification",m),this.core.qchatMsg.emit("systemNotification",m)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function onMultiSysMsg(t){var a=t.content.sysMsg;if(a){var c=formatSystemNotification(a,this.logger);this.core.emit("systemNotificationUpdate",c),this.core.qchatMsg.emit("systemNotificationUpdate",c)}},t.onSyncSysMsg=function onSyncSysMsg(t){var a=this,c=t.content.systemNotifications;if(c&&c.length>0){var h=map$6(c).call(c,(function(t){return formatSystemNotification(t,a.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:h}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:h})}else this.logger.warn("sync system notification not exist")},NotificationModuleService}(),mv=["image","audio","video","file"],gv=function(){function MessageModuleService(t){var a=this;this.markMessageRead=throttle((function(t){return __awaiter(a,void 0,void 0,as.mark((function _callee(){var a,c;return as.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:t});case 2:a=h.sent,c=formatUnreadInfo(a.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[c]);case 5:case"end":return h.stop()}}),_callee,this)})))}),200),this.core=t,this.logger=t.logger}var t=MessageModuleService.prototype;return t.sendMessage=function sendMessage(t){var a,c,h,m;return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var g,E,I,M,C,b;return as.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:if(!(indexOf(mv).call(mv,t.type)>-1)){S.next=4;break}return S.next=3,this.doSendFile(t);case 3:t.attach=S.sent;case 4:return g=generatorMsgForCmd(wt({fromAccount:this.core.account},t)),S.next=7,formatMsg(g,{time:(new Date).getTime(),deliveryStatus:fg.sending},this.core);case 7:E=S.sent;try{t.onSendBefore&&t.onSendBefore(E)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return S.prev=9,S.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:g});case 12:I=S.sent,S.next=22;break;case 15:return S.prev=15,S.t0=S.catch(9),S.next=19,formatMsg(g,{time:(new Date).getTime(),deliveryStatus:fg.failed,attachUrl:null===(a=E.attach)||void 0===a?void 0:a.url},this.core);case 19:throw M=S.sent,S.t0.msg=M,S.t0;case 22:return C=I.content,S.next=25,formatMsg(wt({},C.qchatMsg),{deliveryStatus:fg.success,attachUrl:null===(c=E.attach)||void 0===c?void 0:c.url},this.core);case 25:if(!(b=S.sent).isAntispam){S.next=29;break}throw{code:10403,msg:b,message:(null===(h=null==b?void 0:b.antiSpamInfo)||void 0===h?void 0:h.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(m=null==b?void 0:b.antiSpamInfo)||void 0===m?void 0:m.yidunAntiSpamRes)||""};case 29:return S.abrupt("return",b);case 30:case"end":return S.stop()}}),_callee2,this,[[9,15]])})))},t.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){c.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){c.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return c.prev=5,c.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=c.sent,c.next=15;break;case 11:throw c.prev=11,c.t0=c.catch(5),this.logger.error("sendFile:: upload File error or abort.",c.t0),c.t0;case 15:return c.abrupt("return",a);case 16:case"end":return c.stop()}}),_callee3,this,[[5,11]])})))},t.resendMessage=function resendMessage(t){var a,c;return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var h,m,g,E,I;return as.wrap((function _callee4$(M){for(;;)switch(M.prev=M.next){case 0:return(h=generatorMsgForCmd(wt(wt({},t),{resendFlag:!0}))).deliveryStatus=fg.sending,M.prev=2,M.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:h});case 5:m=M.sent,M.next=15;break;case 8:return M.prev=8,M.t0=M.catch(2),M.next=12,formatMsg(h,{time:(new Date).getTime(),deliveryStatus:fg.failed},this.core);case 12:throw g=M.sent,M.t0.msg=g,M.t0;case 15:return E=m.content,M.next=18,formatMsg(wt({},E.qchatMsg),{deliveryStatus:fg.success},this.core);case 18:if(!(I=M.sent).isAntispam){M.next=22;break}throw{code:10403,msg:I,message:(null===(a=null==I?void 0:I.antiSpamInfo)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(c=null==I?void 0:I.antiSpamInfo)||void 0===c?void 0:c.yidunAntiSpamRes)||""};case 22:return M.abrupt("return",I);case 23:case"end":return M.stop()}}),_callee4,this,[[2,8]])})))},t.doUpdateMessage=function doUpdateMessage(t){var a,c;return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var h,m,g,E,I;return as.wrap((function _callee5$(M){for(;;)switch(M.prev=M.next){case 0:return h=t.message,m=__rest(t,["message"]),(g=generatorMsgForCmd(h)).msgIdClient=void 0,g.time=h.time,M.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:g,qchatMsgUpdateTag:wt(wt({},m),{operatorAccount:this.core.account,operatorClientType:zg.Web,pushPayload:ps(t.pushPayload),routeEnable:wm.boolean(t,"routeEnable")})});case 6:return E=M.sent,M.next=9,formatMsg(E.content.qchatMsg,{},this.core);case 9:if(I=M.sent,this.core.eventBus.emit("qchatChannel/changeUnread",I,!0),!E.content.qchatMsg.isAntispam){M.next=14;break}throw{code:10403,msg:g,message:(null===(a=E.content.qchatMsg)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(c=E.content.qchatMsg)||void 0===c?void 0:c.yidunAntiSpamRes)||""};case 14:return M.abrupt("return",I);case 15:case"end":return M.stop()}}),_callee5,this)})))},t.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var a,c,h,m=this;return as.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:wt(wt({},t),{reverse:reverse(t)?1:0})});case 2:return c=g.sent,h=c.content,g.next=6,za.all(map$6(a=h.qchatMsgs).call(a,(function(t){return formatMsg(t,{},m.core)})));case 6:return g.abrupt("return",g.sent);case 7:case"end":return g.stop()}}),_callee6,this)})))},t.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){var a,c,h,m,g,E=this;return as.wrap((function _callee7$(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:t});case 2:return c=I.sent,h=c.content,M=h.page,m=format(uv,M),I.next=7,za.all(map$6(a=h.datas).call(a,(function(t){return formatMsg(t,{},E.core)})));case 7:return g=I.sent,I.abrupt("return",{pageInfo:m,messages:g});case 9:case"end":return I.stop()}var M}),_callee7,this)})))},t.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){var a,c,h;return as.wrap((function _callee8$(m){for(;;)switch(m.prev=m.next){case 0:a={},c=0;case 2:if(!(c<t.length)){m.next=13;break}if((h=t[c]).fromAccount!==this.core.account){m.next=7;break}return a[h.msgIdClient]=!1,m.abrupt("continue",10);case 7:return m.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(h,!0);case 9:a[h.msgIdClient]=m.sent;case 10:c++,m.next=2;break;case 13:return m.abrupt("return",a);case 14:case"end":return m.stop()}}),_callee8,this)})))},t.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,as.mark((function _callee9(){var a,c,h;return as.wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return a=m.sent,c=a.content.msgs,m.next=6,formatMsgs(c,{},this.core);case 6:return h=m.sent,m.abrupt("return",reduce(h).call(h,(function(t,a){return t[a.channelId]=a,t}),{}));case 8:case"end":return m.stop()}}),_callee9,this)})))},t.messageSearchByPage=function messageSearchByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee10(){var a,c,h,m,g;return as.wrap((function _callee10$(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:wt(wt({},(I=t,formatReverse(lv,I))),{includeSelf:t.includeSelf?1:""})});case 2:return a=E.sent,c=a.content,h=c.datas,m=c.listQueryTag,E.next=6,formatMsgs(h,{},this.core);case 6:return g=E.sent,E.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:m.nextTimetag?rl(m.nextTimetag):0,cursor:m.cursor},datas:g});case 8:case"end":return E.stop()}var I}),_callee10,this)})))},t.onMsg=function onMsg(t){return __awaiter(this,void 0,void 0,as.mark((function _callee11(){var a,c;return as.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:if(a=t.content.qchatMsg){h.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),h.abrupt("return");case 4:return h.next=6,formatMsg(a,{},this.core);case 6:c=h.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!1),this.core.emit("message",c),this.core.qchatMsg.emit("message",c);case 10:case"end":return h.stop()}}),_callee11,this)})))},t.onRecvUnreadInfo=function onRecvUnreadInfo(t){return __awaiter(this,void 0,void 0,as.mark((function _callee12(){var a,c;return as.wrap((function _callee12$(h){for(;;)switch(h.prev=h.next){case 0:if(a=t.content.qchatMsg){h.next=3;break}return h.abrupt("return");case 3:return h.next=5,formatMsg(a);case 5:c=h.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!1);case 7:case"end":return h.stop()}}),_callee12,this)})))},t.onMultiSyncRead=function onMultiSyncRead(t){var a=t.content.unreadInfo;if(a){var c=formatUnreadInfo(a);this.core.eventBus.emit("qchatChannel/updateUnreads",[c])}},t.onMultiSyncServersRead=function onMultiSyncServersRead(t){var a=t.content.qchatMultiSyncServersMessageReadTag;if(a){var c=formatClearServersUnread(a),h=c.successServerIds,m=c.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",h,m)}},t.onRecvMsgUpdate=function onRecvMsgUpdate(t){return __awaiter(this,void 0,void 0,as.mark((function _callee13(){var a,c,h,m;return as.wrap((function _callee13$(g){for(;;)switch(g.prev=g.next){case 0:if(a=t.content.qchatMsg,c=t.content.qchatMsgUpdateInfo,a){g.next=4;break}return g.abrupt("return");case 4:return g.next=6,formatMsg(a,{},this.core);case 6:h=g.sent,m=formatMsgOperatorInfo(c),this.core.eventBus.emit("qchatChannel/changeUnread",h,!0),this.core.emit("messageUpdate",h,m),this.core.qchatMsg.emit("messageUpdate",h,m);case 11:case"end":return g.stop()}}),_callee13,this)})))},MessageModuleService}(),vv=function(){function ExtendModuleService(t){var a=this;this._sendTypingEvent=throttle((function(t){return __awaiter(a,void 0,void 0,as.mark((function _callee(){return as.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(wt(wt({},t),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),vg.msgTyping)});case 2:case"end":return a.stop()}}),_callee,this)})))}),3e3),this.core=t,this.logger=t.logger,this.lastChannelIdInTyping=""}var t=ExtendModuleService.prototype;return t.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c;return as.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return c=h.sent,h.abrupt("return",za.all(map$6(a=c.content.qchatMsgs).call(a,(function(t){return formatMsg(t)}))));case 4:case"end":return h.stop()}}),_callee2,this)})))},t.getReferMessages=function getReferMessages(t){var a,c;return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var h;return as.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if((null===(a=t.message.replyRefer)||void 0===a?void 0:a.msgIdServer)&&(null===(c=t.message.threadRefer)||void 0===c?void 0:c.msgIdServer)){m.next=2;break}throw new Error("Message has no reply");case 2:return m.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(h=m.sent,t.referType!==yg[yg.all]){m.next=9;break}return m.abrupt("return",{replyMessage:h[0],threadMessage:h[1]});case 9:if(t.referType!==yg[yg.reply]){m.next=13;break}return m.abrupt("return",{replyMessage:h[0]});case 13:if(t.referType!==yg[yg.thread]){m.next=15;break}return m.abrupt("return",{threadMessage:h[1]});case 15:return m.abrupt("return",{replyMessage:h[0],threadMessage:h[1]});case 16:case"end":return m.stop()}}),_callee3,this)})))},t.getThreadMessages=function getThreadMessages(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var c,h,m,g,E;return as.wrap((function _callee4$(I){for(;;)switch(I.prev=I.next){case 0:return h=(null===(a=t.message.threadRefer)||void 0===a?void 0:a.msgIdServer)?wt({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,I.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:h,getThreadHistoryMsgTag:wt(wt({},t.messageQueryOption),{reverse:wm.boolean(t.messageQueryOption,"reverse")})});case 3:return m=I.sent,I.next=6,formatMsg(m.content.thread);case 6:return g=I.sent,I.next=9,za.all(map$6(c=m.content.qchatMsgs).call(c,(function(t){return formatMsg(t)})));case 9:return E=I.sent,I.abrupt("return",{thread:g,threadInfo:{messageCount:+m.content.threadInfo.messageCount,lastMessageTimestamp:+m.content.threadInfo.lastMessageTimestamp},messages:E});case 11:case"end":return I.stop()}}),_callee4,this)})))},t.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a,c,h,m;return as.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return a=t.threadRootMessages,c=__rest(t,["threadRootMessages"]),g.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:a,tag:c});case 3:if(h=g.sent,!((m=h.content.metas)&&m.length>0)){g.next=7;break}return g.abrupt("return",map$6(m).call(m,(function(t){return wt(wt({},t),{total:rl(t.total),timestamp:rl(t.timestamp),msgTime:rl(t.msgTime)})})));case 7:return g.abrupt("return",[]);case 8:case"end":return g.stop()}}),_callee5,this)})))},t.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var a,c,h;return as.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:ps(map$6(a=t.msgList).call(a,(function(t){return t.msgIdServer})))}});case 2:return c=m.sent,h=c.content.quickCommentResponse,m.abrupt("return",formatQuickComments(h));case 5:case"end":return m.stop()}}),_callee6,this)})))},t.updateQuickComment=function updateQuickComment(t,a){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){var c,h,m,g,E,I;return as.wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:return validate({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),c=t.commentMessage,h=c.serverId,m=c.channelId,g=c.fromAccount,E=c.msgIdServer,I=c.time,M.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:h,channelId:m,fromAccount:g,msgIdServer:E,time:I,type:t.type,opeType:a,opeAccid:this.core.account}});case 4:case"end":return M.stop()}}),_callee7,this)})))},t.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){return as.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){a.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),a.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return a.stop()}}),_callee8,this)})))},ExtendModuleService}(),yv=function(t){function QChatMsgService(a){var c;return(c=t.call(this,"qchatMsg",a)||this).core=a,c.lastChannelIdInMark="",registerParser({cmdMap:Zg,cmdConfig:rv()}),c.notificationModuleService=new fv(a),c.messageModuleService=new gv(a),c.extendModuleService=new vv(a),c}St(QChatMsgService,t);var a=QChatMsgService.prototype;return a.sendMessage=function sendMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){return as.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(hg)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.sendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee,this)})))},a.updateMessage=function updateMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},t),!("number"==typeof t.message.status&&t.message.status<1e4)){a.next=3;break}throw new cd("Status should be greater than or equal to 10000");case 3:return a.next=5,this.messageModuleService.doUpdateMessage(t);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee2,this)})))},a.resendMessage=function resendMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){return as.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},t),a.next=3,this.messageModuleService.resendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.deleteMessage=function deleteMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a;return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(ps(t))).message.status=2,c.next=5,this.messageModuleService.doUpdateMessage(a);case 5:return c.abrupt("return",c.sent);case 6:case"end":return c.stop()}}),_callee4,this)})))},a.revokeMessage=function revokeMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var a;return as.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(ps(t))).message=Xg(a.message,["serverId","channelId","msgIdServer","time"]),a.message.status=1,c.next=6,this.messageModuleService.doUpdateMessage(a);case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}}),_callee5,this)})))},a.markMessageRead=function markMessageRead(t){return __awaiter(this,void 0,void 0,as.mark((function _callee6(){return as.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:validate({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},t),t.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=t.channelId,this.messageModuleService.markMessageRead(t);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.replyMessage=function replyMessage(t){validate({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t);var replyMessage=t.replyMessage;if(t.serverId!==replyMessage.serverId||t.channelId!==replyMessage.channelId)throw new cd("Forbid replying to message from other server, channel");return this.sendMessage(t)},a.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,as.mark((function _callee7(){return as.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getMessageHistoryByIds(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.getReferMessages=function getReferMessages(t){return __awaiter(this,void 0,void 0,as.mark((function _callee8(){return as.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:getEnumKeys(yg),required:!1}},t),a.next=3,this.extendModuleService.getReferMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee8,this)})))},a.getThreadMessages=function getThreadMessages(t){return __awaiter(this,void 0,void 0,as.mark((function _callee9(){return as.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},t),a.next=3,this.extendModuleService.getThreadMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee9,this)})))},a.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,as.mark((function _callee10(){return as.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getThreadRootMessagesMeta(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee10,this)})))},a.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,as.mark((function _callee11(){return as.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},t),a.next=3,this.notificationModuleService.sendSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee11,this)})))},a.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,as.mark((function _callee12(){return as.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(vg)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},t),a.next=3,this.notificationModuleService.updateSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee12,this)})))},a.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,as.mark((function _callee13(){return as.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.notificationModuleService.markSystemNotificationsRead(t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee14(){return as.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.getHistoryMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee14,this)})))},a.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,as.mark((function _callee15(){return as.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),a.next=3,this.messageModuleService.getMentionedMeMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee15,this)})))},a.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,as.mark((function _callee16(){var a;return as.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),every(a=t.messages).call(a,(function(a){return t.messages[0].serverId===a.serverId}))){c.next=4;break}throw new cd("Different serverId",t,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(t.messages[0].serverId)){c.next=7;break}throw new cd("Not allowed for visitor",t,10403);case 7:return c.next=9,this.messageModuleService.areMentionedMeMessages(t.messages);case 9:return c.abrupt("return",c.sent);case 10:case"end":return c.stop()}}),_callee16,this)})))},a.addQuickComment=function addQuickComment(t){return __awaiter(this,void 0,void 0,as.mark((function _callee17(){return as.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,1);case 2:case"end":return a.stop()}}),_callee17,this)})))},a.removeQuickComment=function removeQuickComment(t){return __awaiter(this,void 0,void 0,as.mark((function _callee18(){return as.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,2);case 2:case"end":return a.stop()}}),_callee18,this)})))},a.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,as.mark((function _callee19(){return as.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.extendModuleService.getQuickComments(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee19,this)})))},a.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,as.mark((function _callee20(){return as.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.extendModuleService.sendTypingEvent(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee20,this)})))},a.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,as.mark((function _callee21(){return as.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},t),a.next=3,this.messageModuleService.getLastMessageOfChannels(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee21,this)})))},a.qchatOnMsgHandler=function qchatOnMsgHandler(t){return __awaiter(this,void 0,void 0,as.mark((function _callee22(){return as.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onMsg(t);case 1:case"end":return a.stop()}}),_callee22,this)})))},a.qchatOnRecvUnreadInfoHandler=function qchatOnRecvUnreadInfoHandler(t){return __awaiter(this,void 0,void 0,as.mark((function _callee23(){return as.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvUnreadInfo(t);case 1:case"end":return a.stop()}}),_callee23,this)})))},a.qchatOnSysMsgHandler=function qchatOnSysMsgHandler(t){this.notificationModuleService.onSysMsg(t)},a.qchatMultiSyncMessageReadHandler=function qchatMultiSyncMessageReadHandler(t){this.messageModuleService.onMultiSyncRead(t)},a.qchatMultiSyncSystemNotificationUpdateHandler=function qchatMultiSyncSystemNotificationUpdateHandler(t){this.notificationModuleService.onMultiSysMsg(t)},a.qchatSyncSystemNotificationHandler=function qchatSyncSystemNotificationHandler(t){this.notificationModuleService.onSyncSysMsg(t)},a.qchatRecvMessageUpdateHandler=function qchatRecvMessageUpdateHandler(t){return __awaiter(this,void 0,void 0,as.mark((function _callee24(){return as.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvMsgUpdate(t);case 1:case"end":return a.stop()}}),_callee24,this)})))},a.searchMsgByPage=function searchMsgByPage(t){return __awaiter(this,void 0,void 0,as.mark((function _callee25(){return as.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:getEnumKeys(fm),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:getEnumKeys(pg),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),a.next=3,this.messageModuleService.messageSearchByPage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee25,this)})))},a.qchatMultiSyncServersMessageReadHandler=function qchatMultiSyncServersMessageReadHandler(t){this.messageModuleService.onMultiSyncServersRead(t)},QChatMsgService}(_m);!function(t){t.UNKNOWN="UNKNOWN",t.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",t.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",t.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",t.END_OF_LIFE="END_OF_LIFE",t.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",t.KICK_OUT="KICK_OUT",t.SYNC_DATA_ERROR="SYNC_DATA_ERROR",t.LEAVE_BY_SELF="LEAVE_BY_SELF",t.kICK_BY_SELF="kICK_BY_SELF"}(dv||(dv={})),function(t){t.offNotAllowSelfOn="offNotAllowSelfOn",t.offAllowSelfOn="offAllowSelfOn",t.disable="disable"}(pv||(pv={}));var _v={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Ev={limit:{type:"number"}};function formatMembers(t){return sf(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatMember(t){return format(_v,t)}(t)})):[]}function formatRTCChannelConfig(t){try{t.audio&&(t.audio=JSON.parse(t.audio))}catch(t){throw new ad('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{t.video&&(t.video=JSON.parse(t.video))}catch(t){throw new ad('result "video" JSON parse error',{key:"video"},"JSON parse error")}return format(Ev,t)}var Iv={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},Mv={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},Cv=function getCmdConfig(){var t=function getDeserializeTag(){return invertSerializeMap(Mv)}();return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:Mv.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:t.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:Mv.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:Mv.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:t.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:Mv.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:t.memberInfo}]}}},bv=function(t){function QChatMediaService(a,c){var h;return(h=t.call(this,"qchatMedia",a)||this).config={},h.tokenExpireTime=24e4,h.getTokenState=!1,h.core=a,registerParser({cmdMap:Iv,cmdConfig:Cv()}),c&&h.setOptions(c),h.setListener(),h.tokenExpireTime=24e4,h.channelId="",h.serverId="",h}St(QChatMediaService,t);var a=QChatMediaService.prototype;return a.setOptions=function setOptions(t){t&&(this.config=wt(this.config,t),(null==t?void 0:t.neroom)&&this.setNeroom(t.neroom))},a.setNeroom=function setNeroom(t){this.neroom=new t},a.setListener=function setListener(){var t,a,c,h,m=this;this.core.eventBus.on("disconnect",bind$1(t=this._existRomm).call(t,this)),this.core.eventBus.on("kicked",bind$1(a=this._existRomm).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._existRomm).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(h=this._existRomm).call(h,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(t){return __awaiter(m,void 0,void 0,as.mark((function _callee(){return as.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!(t.type===vg[vg.channelVisibilityUpdate]&&t.channelId===this.channelId||t.type===vg[vg.serverEnterLeave]&&t.serverId===this.serverId)){a.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){a.next=4;break}return a.next=4,this.disconnectChannel();case 4:case"end":return a.stop()}}),_callee,this)})))}))},a._existRomm=function _existRomm(){return __awaiter(this,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee2,this)})))},a._checkPermission=function _checkPermission(t){return __awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.qchatRole.checkPermission(t);case 2:return a=c.sent,c.abrupt("return",a);case 4:case"end":return c.stop()}}),_callee3,this)})))},a._checkConnectState=function _checkConnectState(){if("connect"!==this.state)throw new cd("QChatMedia::you should connect first")},a.kickMemberOut=function kickMemberOut(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee4(){return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,c.next=5,null===(a=this.roomContext)||void 0===a?void 0:a.kickMemberOut(t.accid);case 5:c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+ps(t),c.t0),new cd("QChatMedia::kickMemberOut error",c.t0);case 11:case"end":return c.stop()}}),_callee4,this,[[2,7]])})))},a.disconnectChannel=function disconnectChannel(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee5(){return as.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),a.prev=1,a.next=4,null===(t=this.roomContext)||void 0===t?void 0:t.leaveRoom();case 4:a.next=9;break;case 6:a.prev=6,a.t0=a.catch(1),this.logger.error("QChatMedia::disconnect error",a.t0);case 9:if(!this.authService){a.next=12;break}return a.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return a.stop()}}),_callee5,this,[[1,6]])})))},a._setStateInit=function _setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},a.muteAudio=function muteAudio(t){var a,c,h,m,g;return __awaiter(this,void 0,void 0,as.mark((function _callee6(){var E;return as.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){I.next=14;break}return I.prev=3,I.next=6,null===(c=this.rtcController)||void 0===c?void 0:c.muteMyAudio();case 6:I.next=12;break;case 8:throw I.prev=8,I.t0=I.catch(3),this.logger.error("QChatMedia::muteAudio error",I.t0),new cd("QChatMedia::muteAudio error",I.t0);case 12:case 25:I.next=31;break;case 14:if(I.prev=14,!(E=null===(h=this.roomContext)||void 0===h?void 0:h.roomProperties.audioOff)||(null===(m=E.value)||void 0===m?void 0:m.split("_")[0])!==pv.offNotAllowSelfOn){I.next=23;break}return I.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(I.sent){I.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),I.abrupt("return");case 23:return I.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.muteMemberAudio(t.accid);case 27:throw I.prev=27,I.t1=I.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+ps(t),I.t1),new cd("QChatMedia::muteAudio error",I.t1);case 31:case"end":return I.stop()}}),_callee6,this,[[3,8],[14,27]])})))},a.unMuteAudio=function unMuteAudio(t){var a,c,h,m,g;return __awaiter(this,void 0,void 0,as.mark((function _callee7(){var E;return as.wrap((function _callee7$(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(E=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.audioOff)||(null===(c=E.value)||void 0===c?void 0:c.split("_")[0])!==pv.offNotAllowSelfOn){I.next=10;break}return I.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(I.sent){I.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),I.abrupt("return");case 10:if((null===(h=this.roomContext)||void 0===h?void 0:h.localMember.uuid)!==t.accid){I.next=22;break}return I.prev=11,I.next=14,null===(m=this.rtcController)||void 0===m?void 0:m.unmuteMyAudio();case 14:I.next=20;break;case 16:throw I.prev=16,I.t0=I.catch(11),this.logger.error("QChatMedia::unMuteAudio error",I.t0),new cd("QChatMedia::unMuteAudio error",I.t0);case 20:case 25:I.next=31;break;case 22:return I.prev=22,I.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.unmuteMemberAudio(t.accid);case 27:throw I.prev=27,I.t1=I.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+ps(t),I.t1),new cd("QChatMedia::unMuteAudio error",I.t1);case 31:case"end":return I.stop()}}),_callee7,this,[[11,16],[22,27]])})))},a.muteVideo=function muteVideo(t){var a,c,h,m,g;return __awaiter(this,void 0,void 0,as.mark((function _callee8(){var E;return as.wrap((function _callee8$(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){I.next=14;break}return I.prev=3,I.next=6,null===(c=this.rtcController)||void 0===c?void 0:c.muteMyVideo();case 6:I.next=12;break;case 8:throw I.prev=8,I.t0=I.catch(3),this.logger.error("QChatMedia::muteVideo error",I.t0),new cd("QChatMedia::muteVideo error",I.t0);case 12:case 25:I.next=31;break;case 14:if(I.prev=14,!(E=null===(h=this.roomContext)||void 0===h?void 0:h.roomProperties.videoOff)||(null===(m=E.value)||void 0===m?void 0:m.split("_")[0])!==pv.offNotAllowSelfOn){I.next=23;break}return I.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(I.sent){I.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),I.abrupt("return");case 23:return I.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.muteMemberVideo(t.accid);case 27:throw I.prev=27,I.t1=I.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+ps(t),I.t1),new cd("QChatMedia::muteVideo error",I.t1);case 31:case"end":return I.stop()}}),_callee8,this,[[3,8],[14,27]])})))},a.unMuteVideo=function unMuteVideo(t){var a,c,h,m,g;return __awaiter(this,void 0,void 0,as.mark((function _callee9(){var E;return as.wrap((function _callee9$(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(E=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.videoOff)||(null===(c=E.value)||void 0===c?void 0:c.split("_")[0])!==pv.offNotAllowSelfOn){I.next=10;break}return I.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(I.sent){I.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),I.abrupt("return");case 10:if((null===(h=this.roomContext)||void 0===h?void 0:h.localMember.uuid)!==t.accid){I.next=22;break}return I.prev=11,I.next=14,null===(m=this.rtcController)||void 0===m?void 0:m.unmuteMyVideo();case 14:I.next=20;break;case 16:throw I.prev=16,I.t0=I.catch(11),this.logger.error("QChatMedia::unMuteVideo error",I.t0),new cd("QChatMedia::unMuteVideo error",I.t0);case 20:I.next=30;break;case 22:I.prev=22,null===(g=this.rtcController)||void 0===g||g.unmuteMemberVideo(t.accid),I.next=30;break;case 26:throw I.prev=26,I.t1=I.catch(22),this.logger.error("QChatMedia::unMuteVideo error",I.t1),new cd("QChatMedia::unMuteVideo error",I.t1);case 30:case"end":return I.stop()}}),_callee9,this,[[11,16],[22,26]])})))},a.startScreenShare=function startScreenShare(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee10(){return as.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.startScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::startScreenShare error",a.t0),new cd("QChatMedia::startScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee10,this,[[1,5]])})))},a.stopScreenShare=function stopScreenShare(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee11(){return as.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.stopScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::stopScreenShare error",a.t0),new cd("QChatMedia::stopScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee11,this,[[1,5]])})))},a.stopMemberScreenShare=function stopMemberScreenShare(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee12(){return as.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.stopMemberScreenShare(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",c.t0),new cd("QChatMedia::stopMemberScreenShare error",c.t0);case 10:case"end":return c.stop()}}),_callee12,this,[[2,6]])})))},a.subscribeRemoteVideoStream=function subscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee13(){return as.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoStream(t.accid,t.streamType),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",c.t0),new cd("QChatMedia::subscribeRemoteVideoStream error",c.t0);case 10:case"end":return c.stop()}}),_callee13,this,[[2,6]])})))},a.unSubscribeRemoteVideoStream=function unSubscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee14(){return as.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoStream(t.accid,t.streamType),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",c.t0),new cd("QChatMedia::unSubscribeRemoteVideoStream error",c.t0);case 10:case"end":return c.stop()}}),_callee14,this,[[2,6]])})))},a.setupVideoCanvas=function setupVideoCanvas(t){var a;if(this._checkConnectState(),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)===t.accid)try{return this.rtcController.setupLocalVideoCanvas(t.videoView)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new cd("QChatMedia::setupVideoCanvas error",t)}else try{return this.rtcController.setupRemoteVideoCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new cd("QChatMedia::setupVideoCanvas error",t)}},a.setupRemoteVideoSubStreamCanvas=function setupRemoteVideoSubStreamCanvas(t){this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new cd("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}},a.getScreenSharingUserUuid=function getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(t){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",t),new cd("QChatMedia::getScreenSharingUserUuid error",t)}},a.initQChatMedia=function initQChatMedia(t){return __awaiter(this,void 0,void 0,as.mark((function _callee15(){return as.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:if(this.neroom){a.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),a.abrupt("return");case 3:if(void 0===this.state){a.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),a.abrupt("return");case 6:a.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:t.serverConfig}),a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(6),this.logger.error("QChatMedia::initQChatMedia error",a.t0),new cd("QChatMedia::initQChatMedia error",a.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return a.stop()}}),_callee15,this,[[6,10]])})))},a.loginByIM=function loginByIM(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee16(){var a,c;return as.wrap((function _callee16$(h){for(;;)switch(h.prev=h.next){case 0:if("init"===this.state){h.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),h.abrupt("return");case 3:return h.next=5,this._getToken();case 5:return a=h.sent,c=Vc(this.core,"options.token")||Vc(this.core,"V2NIMLoginService.token"),h.prev=7,h.next=10,null===(t=this.authService)||void 0===t?void 0:t.loginByIM(this.core.account,a,c);case 10:h.next=16;break;case 12:throw h.prev=12,h.t0=h.catch(7),this.logger.error("QChatMedia::loginByIM error",h.t0),new cd("QChatMedia::loginByIM error",h.t0);case 16:this.state="login";case 17:case"end":return h.stop()}}),_callee16,this,[[7,12]])})))},a._getToken=function _getToken(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee18(){var a,c,h,m,g=this;return as.wrap((function _callee18$(E){for(;;)switch(E.prev=E.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),E.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(t=this.neroom)||void 0===t?void 0:t.deviceId}});case 3:return a=E.sent,c=a.content.neroomToken,h=c.token,m=c.expire,this.logger.log("QChatMedia::getToken success token is "+h+",expire is "+m+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*m-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return __awaiter(g,void 0,void 0,as.mark((function _callee17(){var t;return as.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,a.next=4,this._getToken();case 4:t=a.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return a.stop()}}),_callee17,this)})))}),1e3*m-this.tokenExpireTime)),E.abrupt("return",h);case 8:case"end":return E.stop()}}),_callee18,this)})))},a.connectChannel=function connectChannel(t){var a,c;return __awaiter(this,void 0,void 0,as.mark((function _callee19(){var h;return as.wrap((function _callee19$(m){for(;;)switch(m.prev=m.next){case 0:if(void 0!==this.state){m.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),m.abrupt("return");case 3:if("init"!==this.state){m.next=6;break}return m.next=6,this.loginByIM();case 6:return this.serverId=t.serverId,this.channelId=t.channelId,m.prev=8,m.next=11,null===(a=this.roomService)||void 0===a?void 0:a.joinRoom({roomUuid:t.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:m.next=17;break;case 13:throw m.prev=13,m.t0=m.catch(8),this.logger.error("QChatMedia::connectChannel error",m.t0),new cd("QChatMedia::connectChannel error",m.t0);case 17:if(!(h=null===(c=this.roomService)||void 0===c?void 0:c.getRoomContext(t.channelId))){m.next=28;break}return this.roomContext=h,this.rtcController=this.roomContext.rtcController,this.state="connect",m.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),m.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return m.stop()}}),_callee19,this,[[8,13]])})))},a.updateRTCChannelInfo=function updateRTCChannelInfo(t){return __awaiter(this,void 0,void 0,as.mark((function _callee20(){return as.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:wt(wt({},t),{audio:ps(t.audio),video:ps(t.video)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getRTCChannelInfo=function getRTCChannelInfo(t){return __awaiter(this,void 0,void 0,as.mark((function _callee21(){var a;return as.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:t});case 3:return a=c.sent,c.abrupt("return",formatRTCChannelConfig(a.content.RTCChannelConfig));case 5:case"end":return c.stop()}}),_callee21,this)})))},a.getRTCChannelOnlineMembers=function getRTCChannelOnlineMembers(t){return __awaiter(this,void 0,void 0,as.mark((function _callee22(){var a;return as.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:t});case 3:return a=c.sent,c.abrupt("return",formatMembers(a.content.memberList));case 5:case"end":return c.stop()}}),_callee22,this)})))},a.addRTCChannelListener=function addRTCChannelListener(){var t,a,c=this;this._checkConnectState();try{null===(t=this.authService)||void 0===t||t.addAuthListener({onAuthEvent:function onAuthEvent(t){return __awaiter(c,void 0,void 0,as.mark((function _callee23(){var a;return as.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:if(1026!==t||this.getTokenState){c.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,c.next=5,this._getToken();case 5:if(a=c.sent,!this.authService){c.next=9;break}return c.next=9,this.authService.renewToken(a);case 9:this.getTokenState=!1;case 10:case"end":return c.stop()}}),_callee23,this)})))}})}catch(t){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",t),new cd("QChatMedia::loginByIM addAuthListener error",t)}null===(a=this.roomContext)||void 0===a||a.addRoomListener({onRoomPropertiesChanged:function onRoomPropertiesChanged(t){var a,h,m,g,E,I;if(c.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",t),t.audioOff){var M=null===(a=t.audioOff.value)||void 0===a?void 0:a.split("_")[0];M!==pv.offNotAllowSelfOn&&M!==pv.offAllowSelfOn||(null===(h=c.roomContext)||void 0===h?void 0:h.localMember.isAudioOn)&&(null===(m=c.rtcController)||void 0===m||m.muteMyAudio())}else if(t.videoOff){var C=null===(g=t.videoOff.value)||void 0===g?void 0:g.split("_")[0];C!==pv.offNotAllowSelfOn&&C!==pv.offAllowSelfOn||(null===(E=c.roomContext)||void 0===E?void 0:E.localMember.isVideoOn)&&(null===(I=c.rtcController)||void 0===I||I.muteMyVideo())}},onRoomPropertiesDeleted:function onRoomPropertiesDeleted(t){c.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",t)},onMemberJoinRtcChannel:function onMemberJoinRtcChannel(t){c.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",t);var a=map$6(t).call(t,(function(t){return t.uuid}));c.core.emit("memberJoinRTCChannel",a),c.core.qchatMedia.emit("memberJoinRTCChannel",a)},onMemberLeaveRoom:function onMemberLeaveRoom(t){c.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",t);var a=map$6(t).call(t,(function(t){return t.uuid}));c.core.emit("memberLeaveRTCChannel",a),c.core.qchatMedia.emit("memberLeaveRTCChannel",a)},onRoomEnded:function onRoomEnded(t){c.authService&&c.authService.logout(),c._setStateInit(),c.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",t),c.core.emit("RTCChannelEnded",t),c.core.qchatMedia.emit("RTCChannelEnded",t)},onRtcChannelError:function onRtcChannelError(t){c.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",t),"SOCKET_ERROR"===t&&c.disconnectChannel(),c.core.emit("RTCChannelError",t),c.core.qchatMedia.emit("RTCChannelError",t)},onRtcAudioVolumeIndication:function onRtcAudioVolumeIndication(t){c.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",t),c.core.emit("onRtcAudioVolumeIndication",t),c.core.qchatMedia.emit("onRtcAudioVolumeIndication",t)},onMemberAudioMuteChanged:function onMemberAudioMuteChanged(t,a,h){c.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",t,a),c.core.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:h.uuid}),c.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:h.uuid})},onMemberScreenShareStateChanged:function onMemberScreenShareStateChanged(t,a,h){c.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",t,a),c.core.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:h.uuid}),c.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:h.uuid})},onMemberVideoMuteChanged:function onMemberVideoMuteChanged(t,a,h){c.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",t,a),c.core.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:h.uuid}),c.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:h.uuid})}})},a.enumCameraDevices=function enumCameraDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumCameraDevices error",a),new cd("QChatMedia::enumCameraDevices error",a)}))},a.enumPlayoutDevices=function enumPlayoutDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumPlayoutDevices error",a),new cd("QChatMedia::enumPlayoutDevices error",a)}))},a.enumRecordDevices=function enumRecordDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumRecordDevices error",a),new cd("QChatMedia::enumRecordDevices error",a)}))},a.removeRTCChannelListener=function removeRTCChannelListener(){var t,a;this._checkConnectState(),null===(t=this.roomContext)||void 0===t||t.removeRoomListener({}),null===(a=this.authService)||void 0===a||a.removeAuthListener({})},a.setSelectedCameraDevice=function setSelectedCameraDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedCameraDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedCameraDevice error",t),new cd("QChatMedia::setSelectedCameraDevice error",t)}))},a.setSelectedPlayoutDevice=function setSelectedPlayoutDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedPlayoutDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedPlayoutDevice error",t),new cd("QChatMedia::setSelectedPlayoutDevice error",t)}))},a.setSelectedRecordDevice=function setSelectedRecordDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedRecordDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedRecordDevice error",t),new cd("QChatMedia::setSelectedRecordDevice error",t)}))},a.getRTCMembers=function getRTCMembers(){var t,a;return this._checkConnectState(),map$6(t=filter(a=this.roomContext.remoteMembers).call(a,(function(t){return t.isInRtcChannel}))).call(t,(function(t){return{accid:t.uuid,isAudioOn:!!t.isAudioOn,isVideoOn:!!t.isVideoOn,isSharingScreen:!!t.isSharingScreen,properties:t.properties}}))},a.subscribeRemoteVideoSubStream=function subscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee24(){return as.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoSubStream(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",c.t0),new cd("QChatMedia::subscribeRemoteVideoSubStream error",c.t0);case 10:case"end":return c.stop()}}),_callee24,this,[[2,6]])})))},a.unsubscribeRemoteVideoSubStream=function unsubscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee25(){return as.wrap((function _callee25$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoSubStream(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",c.t0),new cd("QChatMedia::unsubscribeRemoteVideoSubStream error",c.t0);case 10:case"end":return c.stop()}}),_callee25,this,[[2,6]])})))},a.muteAllAudio=function muteAllAudio(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee26(){return as.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",ps({value:pv.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllAudio error",a.t0),new cd("QChatMedia::muteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee26,this,[[7,11]])})))},a.muteAllVideo=function muteAllVideo(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee27(){return as.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",ps({value:pv.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllVideo error",a.t0),new cd("QChatMedia::muteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee27,this,[[7,11]])})))},a.unMuteAllAudio=function unMuteAllAudio(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee28(){return as.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",ps({value:pv.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",a.t0),new cd("QChatMedia::unMuteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee28,this,[[7,11]])})))},a.unMuteAllVideo=function unMuteAllVideo(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee29(){return as.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",ps({value:pv.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",a.t0),new cd("QChatMedia::unMuteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee29,this,[[7,11]])})))},QChatMediaService}(_m),Sv=["error","warn","log","debug"],Tv=function emptyFunc(){},Rv=["off","error","warn","log","debug"],Av=function(){function Logger(t){this.strategies={debug:{name:"debug",func:console.log},log:{name:"  log",func:console.log},warn:{name:" warn",func:console.warn},error:{name:"error",func:console.error}},this.debug=Tv,this.log=Tv,this.warn=Tv,this.error=Tv,includes(Rv).call(Rv,t)||(t="off"),this.setLogFunc(t)}var t=Logger.prototype;return t.setLogFunc=function setLogFunc(t){var a=this,c=findIndex(Sv).call(Sv,(function(a){return a===t}));forEach$1(Sv).call(Sv,(function(t,h){h<=c&&(a[t]=function(){var a=slice$1(Array.prototype).call(arguments),c=this.strategies[t],h=this.formatArgs(a,c.name);c.func(h)})}))},t.formatArgs=function formatArgs(t,a){var c=new Date;return"[NIM "+a+" "+(c.getMonth()+1+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds())+"] "+map$6(t).call(t,(function(t){return t instanceof nd?t.toString():t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?ps(t):t})).join(" ")},t.destroy=function destroy(){this.debug=Tv,this.log=Tv,this.warn=Tv,this.error=Tv},Logger}(),Nv=TypeError,Ov=Object.getOwnPropertyDescriptor,wv=N&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(eo(t)&&!Ov(t,"length").writable)throw Nv("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},kv=arrayMethodHasSpeciesSupport("splice"),xv=Math.max,Pv=Math.min;_export({target:"Array",proto:!0,forced:!kv},{splice:function splice(t,a){var c,h,m,g,E,I,M=toObject(this),C=lengthOfArrayLike(M),b=toAbsoluteIndex(t,C),S=arguments.length;for(0===S?c=h=0:1===S?(c=0,h=C-b):(c=S-2,h=Pv(xv(toIntegerOrInfinity(a),0),C-b)),doesNotExceedSafeInteger(C+c-h),m=arraySpeciesCreate(M,h),g=0;g<h;g++)(E=b+g)in M&&createProperty(m,g,M[E]);if(m.length=h,c<h){for(g=b;g<C-h;g++)I=g+c,(E=g+h)in M?M[I]=M[E]:deletePropertyOrThrow(M,I);for(g=C;g>C-h+c;g--)deletePropertyOrThrow(M,g-1)}else if(c>h)for(g=C-h;g>b;g--)I=g+c-1,(E=g+h-1)in M?M[I]=M[E]:deletePropertyOrThrow(M,I);for(g=0;g<c;g++)M[g+b]=arguments[g+2];return wv(M,C-h+c),m}});var qv=entryVirtual("Array").splice,Lv=Array.prototype,splice=function(t){var a=t.splice;return t===Lv||Y(Lv,t)&&a===Lv.splice?qv:a};function _createForOfIteratorHelperLoose$1(t,a){var c,h=void 0!==Hi&&Af(t)||t["@@iterator"];if(h)return bind$1(c=(h=h.call(t)).next).call(c,h);if(sf(t)||(h=function _unsupportedIterableToArray$1(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var h=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===h&&t.constructor&&(h=t.constructor.name);if("Map"===h||"Set"===h)return Rf(t);if("Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){h&&(t=h);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,h=new Array(a);c<a;c++)h[c]=t[c];return h}var Dv=function(){function TimerManager(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,c){void 0===a&&(a=0),void 0===c&&(c=1);var h=(new Date).getTime(),m=this.id;return this.timerList.push({id:m,loop:c,count:0,timeout:h+a,interval:a,callback:t}),this.id++,this.checkTimer(h),m},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,c,h=0,m=_createForOfIteratorHelperLoose$1(this.timerList);!(a=m()).done;){var g=a.value;(0===h||h>g.timeout)&&(h=g.timeout)}if(0!==this.timerList.length)if(null===this.timer||h<this.timeout||this.timeout<t)this.timer=go(bind$1(c=this.nowTime).call(c,this),h-t),this.timeout=h}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose$1(this.timerList);!(t=a()).done;){var c=t.value;nowTime>=c.timeout&&(c.callback(),c.count++,c.timeout=nowTime+c.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var c;if(this.timerList[a].id===t)splice(c=this.timerList).call(c,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,c=this.timerList[t];if(c.loop>=0&&c.count>=c.loop)splice(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},TimerManager}(),Vv=function(){function CoreAdapters(t){this.lastCommonHost="",this.core=t}var t=CoreAdapters.prototype;return t.getFileUploadInformation=function getFileUploadInformation(t){return $p.getFileUploadInformation(t)},t.request=function request(t,a,c){var h=this,m=(new Date).getTime(),g=(null==c?void 0:c.exception_service)||0;return $p.request(t,a).catch((function(c){var E,I,M,C,b=c;throw h.core.reporter.reportTraceStart("exceptions",{user_id:h.core.options.account||(null===(I=null===(E=h.core)||void 0===E?void 0:E.auth)||void 0===I?void 0:I.account),trace_id:null===(C=null===(M=h.core.clientSocket)||void 0===M?void 0:M.socket)||void 0===C?void 0:C.sessionId,start_time:m,action:1,exception_service:g}),h.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof b.code?b.code:0,description:b.message||""+b.code,operation_type:0,target:t,context:a?ps(a):""},{asyncParams:$p.net.getNetworkStatus()}),h.core.reporter.reportTraceEnd("exceptions",1),c}))},t.uploadFile=function uploadFile(t){var a,c,h,m;return __awaiter(this,void 0,void 0,as.mark((function _callee(){var g,E,I,M,C,b,S,T,R,A,N,O,w,k;return as.wrap((function _callee$(x){for(;;)switch(x.prev=x.next){case 0:b=indexOf(g=t.commonUploadHostBackupList).call(g,t.commonUploadHost),S=-1===b?concat(E=[t.commonUploadHost]).call(E,t.commonUploadHostBackupList):concat(I=[t.commonUploadHost]).call(I,slice$1(M=t.commonUploadHostBackupList).call(M,0,b),slice$1(C=t.commonUploadHostBackupList).call(C,b+1)),T=Math.max(indexOf(S).call(S,this.lastCommonHost),0),R="BROWSER"===$p.platform?1:S.length,A=null,N=0;case 6:if(!(N<R)){x.next=26;break}return O=(new Date).getTime(),this.lastCommonHost=S[(N+T)%S.length],x.prev=9,x.next=12,$p.uploadFile(wt(wt({},t),{commonUploadHost:this.lastCommonHost}));case 12:return x.abrupt("return",x.sent);case 15:x.prev=15,x.t0=x.catch(9),A=x.t0,w=x.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(c=null===(a=this.core)||void 0===a?void 0:a.auth)||void 0===c?void 0:c.account),trace_id:null===(m=null===(h=this.core.clientSocket)||void 0===h?void 0:h.socket)||void 0===m?void 0:m.sessionId,start_time:O,action:1,exception_service:3}),k="BROWSER"===$p.platform?t.chunkUploadHost:this.lastCommonHost+"/"+(t.nosToken&&t.nosToken.bucket),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof w.code?w.code:0,description:w.message||""+w.code,operation_type:1,target:k},{asyncParams:$p.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1);case 23:N++,x.next=6;break;case 26:throw A;case 27:case"end":return x.stop()}}),_callee,this,[[9,15]])})))},CoreAdapters}(),Uv="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Gv="imElite_sdk_abtest_web",Fv=function(){function ABTest(t,a){this.abtInfo={},this.core=t,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:Uv,abtestProjectKey:Gv},a)}var t=ABTest.prototype;return t.setOptions=function setOptions(t){this.config=assignOptions(this.config,t)},t.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,as.mark((function _callee(){var c;return as.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(this.config.isAbtestEnable){h.next=2;break}return h.abrupt("return");case 2:if(!this.abtInfo.experiments){h.next=4;break}return h.abrupt("return");case 4:if(this.config.abtestUrl){h.next=6;break}return h.abrupt("return");case 6:return h.prev=6,h.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.4.0",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:c=h.sent,h.next=15;break;case 12:h.prev=12,h.t0=h.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==c?void 0:c.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{};case 16:case"end":return h.stop()}}),_callee,this,[[6,12]])})))},ABTest}(),Bv=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),c=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-c:t+c}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var jv=function noop(){},Wv=vh&&1/eh(new vh([,-0]))[1]==1/0?function(t){return new vh(t)}:jv,Yv=Wv;var $v=function baseUniq(t,a,c){var h=-1,m=_f,g=t.length,E=!0,I=[],M=I;if(c)E=!1,m=Ef;else if(g>=200){var C=a?null:Yv(t);if(C)return eh(C);E=!1,m=Jp,M=new Kp}else M=a?[]:I;e:for(;++h<g;){var b=t[h],S=a?a(b):b;if(b=c||0!==b?b:0,E&&S==S){for(var T=M.length;T--;)if(M[T]===S)continue e;a&&M.push(S),I.push(b)}else m(M,S,c)||(M!==I&&M.push(S),I.push(b))}return I};var Hv,Qv=function uniq(t){return t&&t.length?$v(t):[]},Kv=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],zv=["transport not supported","client not handshaken","unauthorized"],Jv=["reconnect"],Xv=function(t){function BaseWebsocket(a,c){var h;return(h=t.call(this)||this).url=c,h.websocket=null,h.socketConnectTimer=0,h.core=a,h.url=c,h.status="disconnected",h.logger=a.logger,h.connect(),h}St(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+Za(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(a){if("connecting"===t.status){var c=a.data.split(":"),h=c[0];return c[1],t.sessionId=h,t.logger.log("imsocket::XHR success. status "+t.status+", "+("connecting"===t.status?"continue websocket connection":"stop websocket connection")),t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+h)}})).catch((function(a){if("connecting"===t.status){var c='imsocket::XHR fail. raw message: "'+(a=a||{}).message+'", code: "'+a.code+'"',h=a.code;h="v2"===Vc(t.core,"options.apiVersion")?a.code===td.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?td.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:td.V2NIM_ERROR_CODE_CONNECT_FAILED:408===a.code?408:415;var m=new nd({code:h,detail:{reason:c,rawError:a}});t.logger.error(c),t.status="disconnected",t.emit("handshakeFailed",m)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(t){this.logger.warn("imsocket::attempt to send encodePacket error",t)}try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=go((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("handshakeFailed",new nd({code:"v2"===Vc(c.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new $p.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(t){var a=(null==t?void 0:t.reason)||(null==t?void 0:t.message)||(null==t?void 0:t.errMsg)||"websocket.onclose";c.logger.log("imsocket::Websocket onclose done. code is "+(null==t?void 0:t.code)+" and reason is "+a),c.clean(),c.emit("disconnect",{code:(null==t?void 0:t.code)||0,reason:a})},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"logined"===c.core.status&&c.core.clientSocket.ping()}},a.onMessage=function onMessage(t){var a,c=this.decodePacket(t.data);if(c)switch(c.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",c.data);break;case"event":c.name&&this.emit(c.name,c.args);break;case"error":"unauthorized"===c.reason?this.emit("connect_failed",c.reason):this.emit("error",c.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new nd({code:"v2"===Vc(this.core,"options.apiVersion")?td.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",c.type)}},a.encodePacket=function encodePacket(t){var a,c,h=t.type,m=t.id,g=void 0===m?"":m,E=t.endpoint,I=void 0===E?"":E,M=t.ack,C=null;if(!h)return"";switch(h){case"error":a=t.reason?indexOf(zv).call(zv,t.reason):"",c=t.advice?indexOf(Jv).call(Jv,t.advice):"",""===a&&""===c||(C=a+(""!==c?"+"+c:""));break;case"message":""!==t.data&&(C=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},C=ps(a);break;case"json":C=ps(t.data);break;case"connect":t.qs&&(C=t.qs);break;case"ack":C=t.ackId+(t.args&&t.args.length?"+"+ps(t.args):"")}var b=[indexOf(Kv).call(Kv,h),g+("data"===M?"+":""),I];return null!=C&&b.push(C),b.join(":")},a.decodePacket=function decodePacket(t){if(t)if("ï¿½"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var c,h=a[1],m=a[2],g=a[3],E=a[4],I=a[5],M={type:Kv[+h],endpoint:E};switch(m&&(M.id=m,M.ack=!g||"data"),M.type){case"error":c=I.split("+"),M.reason=zv[+c[0]]||"";break;case"message":M.data=I||"";break;case"connect":M.qs=I||"";break;case"event":try{var C=JSON.parse(I);M.name=C.name,M.args=C.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}M.args=M.args||[];break;case"json":try{M.data=JSON.parse(I)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((c=I.match(/^([0-9]+)(\+)?(.*)/))&&(M.ackId=c[1],M.args=[],c[3]))try{M.args=c[3]?JSON.parse(c[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return M}}else this.logger.error("imsocket::unrecognize dataStr",slice$1(t).call(t,0,20))},a.send=function send(t){var a,c={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(c))},BaseWebsocket}(vo);function _createForOfIteratorHelperLoose(t,a){var c,h=void 0!==Hi&&Af(t)||t["@@iterator"];if(h)return bind$1(c=(h=h.call(t)).next).call(c,h);if(sf(t)||(h=function _unsupportedIterableToArray(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var h=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===h&&t.constructor&&(h=t.constructor.name);if("Map"===h||"Set"===h)return Rf(t);if("Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){h&&(t=h);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,h=new Array(a);c<a;c++)h[c]=t[c];return h}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(Hv||(Hv={}));var Zv=function(){function V1ClientSocket(t,a){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new Bv({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Gl,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,a&&(this.auth=a),this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager}var t=V1ClientSocket.prototype;return t.setSessionId=function setSessionId(t){},t.connect=function connect(t,a){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,as.mark((function _callee(){var c,h,m,g,E,I;return as.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.core.status)){M.next=5;break}return c="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(c),M.abrupt("return",za.reject(c));case 5:this.core.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(h=t.linkUrls).call(h,this.linkUrls),this.linkUrls=Qv(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push("weblink.netease.im:443"),m=0;case 9:if(!(m<this.linkUrls.length)){M.next=31;break}return g=this.linkUrls[m],E=(new Date).getTime(),M.prev=12,M.next=15,this.doConnect(g);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+g),M.abrupt("return",g);case 20:M.prev=20,M.t0=M.catch(12),I=M.t0,a&&a(I,g),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:E,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof I.code?I.code:0,description:I.message||""+I.code,operation_type:0,target:g},{asyncParams:$p.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+g,M.t0);case 28:m++,M.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(Hv.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(Hv.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return M.stop()}}),_callee,this,[[12,20]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new za((function(h,m){var g;a.socket=new Xv(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV1::on connect",t),a.core.reporterHookLinkKeep&&(a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t})),c=!0,h()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(h){return __awaiter(a,void 0,void 0,as.mark((function _callee2(){return as.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",h),!this.core.reporterHookLinkKeep){a.next=5;break}return a.next=4,this.core.reporterHookLinkKeep.update({code:(null==h?void 0:h.code)||0,description:(null==h?void 0:h.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:c=!0,this.doDisconnect(Hv.OFFLINE,"SocketOnDisconnect");case 7:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){c?a.ping():(a.logger.error('clientsocketV1::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,m(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function beforeConnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a,c){var h,m,g,E,I;if(this.logger.log("doDisconnect: type "+t+", description "+a),"unconnected"!==this.core.status){var M={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new nd({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:M}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var C=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(t===Hv.ACTIVE||C)this.logger.log("doDisconnect: emit disconnect, type "+t,C),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(h=this.auth)||void 0===h||h.emit("disconnect"),this.destroyOnlineListener();else if(t===Hv.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var b="string"==typeof a?{reason:"unknow",message:a}:a;this.core.eventBus.emit("kicked",b),this.core.emit("kicked",b),null===(m=this.auth)||void 0===m||m.emit("kicked",b),this.destroyOnlineListener()}else t===Hv.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):t===Hv.OFFLINE&&(null===(E=null===(g=this.auth)||void 0===g?void 0:g.authenticator)||void 0===E?void 0:E.checkLoginTerminalCode(null==c?void 0:c.code))?(this.logger.log("doDisconnect: login terminal code "+(null==c?void 0:c.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(I=this.auth)||void 0===I||I.emit("disconnect")):t===Hv.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},t.attempToReconnect=function attempToReconnect(){var t,a,c=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(t=this.auth)||void 0===t||t.emit("disconnect"));var h=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+h),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:h}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:h}),null===(a=this.auth)||void 0===a||a.emit("willReconnect",{retryCount:this.retryCount,duration:h}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=go((function(){return __awaiter(c,void 0,void 0,as.mark((function _callee3(){var t=this;return as.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if("waitReconnect"===this.core.status){a.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),a.abrupt("return");case 3:return a.next=5,$p.net.getNetworkStatus();case 5:!1===a.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(Hv.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return a.stop()}}),_callee3,this)})))}),h)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function sendCmd(t,a,c){var h=this;if("logined"!==this.core.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+t),za.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return za.reject("No_socket");var m="heartbeat"!==t,g=m?this.packetSer++:0,E=function createCmd(t,a,c,h){var m=xf[t];if(!m)return c.error("createCmd:: can not find cmd config: ",t),null;var g,E={SER:a,SID:m.sid,CID:m.cid,Q:[]};return m.params&&h&&forEach$1(g=m.params).call(g,(function(t){var a=h[t.name];if(null!=a){var c=t.type,m=t.reflectMapper,g=t.select;switch(t.type){case"PropertyArray":c="ArrayMable",a=map$6(a).call(a,(function(t){return{t:"Property",v:m?serialize(t,m,g):t}}));break;case"Property":a=m?serialize(a,m,g):a;break;case"Bool":a=a?"true":"false"}E.Q.push({t:c,v:a})}})),{packet:E,hasPacketResponse:"boolean"!=typeof m.hasPacketResponse||m.hasPacketResponse,hasPacketTimer:"boolean"!=typeof m.hasPacketTimer||m.hasPacketTimer}}(t,g,this.logger,a);if(!E){var I="SendCmd "+g+" "+t+" error";return this.logger.error(I),za.reject(new Error(I))}var M=E.packet,C=E.hasPacketResponse,b=E.hasPacketTimer,S=ps(M);m&&("debug"===this.core.options.debugLevel?this.logger.debug("clientsocketV1::sendCmd",t,"ser:"+g,S):this.logger.log("clientsocketV1::sendCmd",t,"ser:"+g));var T=(new Date).getTime();return new za((function(m,E){C&&h.sendingCmdMap.set(g,{cmd:t,params:a,callback:[m,E],timer:b?go((function(){var a=new nd({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:t,ser:g,timetag:Za()}});h.markCmdInvalid(g,a,t)}),c&&c.timeout?c.timeout:h.core.config.timeout):null});try{h.socket.send(S),C||m(M)}catch(a){var I=new nd({code:415,detail:{reason:a&&a.message||"Unable to send packet",cmd:t,ser:g,timetag:Za(),rawError:a}});h.markCmdInvalid(g,I,t),E(a)}})).catch((function(t){var a,c=[408,415];if(!includes(c).call(c,t.code))return za.reject(t);h.reporter.reportTraceStart("exceptions",{user_id:h.core.options.account,trace_id:null===(a=h.socket)||void 0===a?void 0:a.sessionId,start_time:T,action:2,exception_service:6});var m=Vc(t,"data.disconnect_reason")||"",g=408===t.code?"Send failed due to timeout":"Send failed. Reason unknown";return g=415===t.code?ps({disconnect_reason:m}):g,h.reporter.reportTraceUpdateV2("exceptions",{code:t.code||415,description:g,operation_type:1,target:M.SID+"-"+M.CID,context:""+M.SER},{asyncParams:$p.net.getNetworkStatus()}),h.reporter.reportTraceEnd("exceptions",1),za.reject(t)}))},t.onMessage=function onMessage(t){var a=function parseCmd(t,a){var c,h;try{h=JSON.parse(t)}catch(c){return void a.error('Parse command error:"'+t+'"')}var m=h.sid+"_"+h.cid,g=h.r;if(includes(c=["4_1","4_2","4_10","4_11"]).call(c,m)){var E=h.r[1].headerPacket;m=E.sid+"_"+E.cid,h.sid=E.sid,h.cid=E.cid,g=h.r[1].body}var I=Pf[m],M=[];if(I){for(var C,b=_createForOfIteratorHelperLoose$4(I);!(C=b()).done;){var S=C.value;M.push(parseEachCmd(h,S.config,S.cmd,g,a))}return M}a.error("parseCmd:: mapper not exist",m,h.code)}(t,this.logger);if(a)for(var c,h=_createForOfIteratorHelperLoose(a);!(c=h()).done;){var m=c.value,g=m.raw.ser;if(m.error&&this.logger.error("core:onMessage packet error",m.raw.sid+"_"+m.raw.cid+", ser:"+g+",",m.error),m.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",m.raw.sid+"_"+m.raw.cid+", ser:"+g);"heartbeat"!==m.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:"+g,m.cmd,m.content):this.logger.log("imsocket::recvCmd ser:"+g,m.cmd)),this.packetHandler(m)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var h=t.raw.ser,m=this.sendingCmdMap.get(h);if(m&&m.cmd===t.cmd){var g=m.callback,E=m.timer,I=m.params;if(clearTimeout(E),t.params=I,this.sendingCmdMap.delete(h),"heartbeat"===t.cmd)return void g[0]();var M=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);M&&"function"==typeof M.then?M.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",t.service,t.cmd),g[0]())}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var h=this.sendingCmdMap.get(t);if(h){var m=h.callback,g=h.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+c+" is invalid:",a),m[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var h=a.callback,m=a.timer,g=a.cmd;c.logger.debug('markAllCmdInvaild:: cmd "'+g+'"'),m&&clearTimeout(m),h[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,as.mark((function _callee4(){var a=this;return as.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=18;break;case 6:return c.prev=6,c.t0=c.catch(1),c.next=10,this.testHeartBeat5Timeout();case 10:if(!c.sent){c.next=18;break}if(!this.core.reporterHookLinkKeep){c.next=16;break}return c.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(Hv.OFFLINE,"PingError"),c.abrupt("return");case 18:this.pingTimer=go((function(){a.ping()}),3e4);case 19:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var t;return as.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,$p.net.onNetworkStatusChange((function(a){t.logger.log("clientsocketV1::onlineListener:network change",a),a.isConnected&&"logined"===t.core.status?t.ping():a.isConnected&&"waitReconnect"===t.core.status?(t.reconnectTimer&&clearTimeout(t.reconnectTimer),t.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}))):a.isConnected||t.doDisconnect(Hv.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientsocketV1::onlineListener:destroy"),$p.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function disconnect(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(Hv.ACTIVE,"UserActiveDisconnect"),za.resolve();default:return za.resolve()}},V1ClientSocket}(),ey={"1_2":"heartbeat","24_2":"qchatLogin","24_4":"qchatExit","24_5":"qchatBeKicked","24_8":"qchatLoginClientChange","24_9":"qchatKick","24_19":"qchatSync"},ty={qchatLoginTag:{appkey:1,account:2,authType:3,token:4,loginExt:5,clientType:6,clientSession:7,deviceId:8,sdkVersion:9,sdkType:10,userAgent:11,customTag:12,customClientType:13,sdkHumanVersion:14,pushTokenName:20,pushToken:21,pushkitTokenName:22,pushkitToken:23,deviceInfo:24,customPushContentType:25,os:30,mac:31,bundleId:32,simCarrierCode:33,simCountryCode:34,networkCode:35,browser:36,deviceModel:37,androidid:38,imei:39,idfv:40,openuuid:41,pushType:100,hasTokenPreviously:101,consid:102,clientIP:103,clientPort:104,loginTime:105}},ry=function getCmdConfig(){var t=function getDeserializeTag(){return invertSerializeMap(ty)}();return{heartbeat:{sid:1,cid:2,service:"qchatAuth"},qchatLogin:{sid:24,cid:2,service:"qchatAuth",params:[{type:"Property",name:"qchatLoginReqTag",reflectMapper:ty.qchatLoginTag}],response:[{type:"Property",name:"qchatLoginResTag",reflectMapper:t.qchatLoginTag},{type:"PropertyArray",name:"qchatMultiLoginResult",reflectMapper:t.qchatLoginTag}]},qchatExit:{sid:24,cid:4,service:"qchatAuth"},qchatBeKicked:{sid:24,cid:5,service:"qchatAuth",response:[{type:"Property",name:"beKickedTag",reflectMapper:{1:"clientType",2:"reason",3:"ext",4:"customClientType"}}]},qchatLoginClientChange:{sid:24,cid:8,service:"qchatAuth",response:[{type:"Byte",name:"state"},{type:"Property",name:"qchatLoginResTag",reflectMapper:t.qchatLoginTag}]},qchatKick:{sid:24,cid:9,service:"qchatAuth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]},qchatSync:{sid:24,cid:19,service:"qchatAuth",hasPacketTimer:!1,params:[{type:"Property",name:"qchatSyncTag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}}};function formatLoginInfo(t,a){void 0===a&&(a=1);var c=format({clientPort:{type:"number"},clientType:{type:"enum",values:zg},customClientType:{type:"number"},loginTime:{type:"number"},hasTokenPreviously:{type:"boolean"},pushType:{type:"number"}},t);return wt(wt({},c),{online:2!==a})}var ny={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var ay={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},oy=function(){function V1AuthAuthenticatorService(t){this.core=t}return V1AuthAuthenticatorService.prototype.verifyAuthentication=function verifyAuthentication(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c,h,m,g,E,I;return as.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return a=this.core.options,c=$p.getSystemInfo(),h=wt(wt({},a),{appLogin:t?0:1,clientType:16,clientSession:this.core.config.clientSession,deviceId:this.core.config.deviceId,sdkVersion:100400,sdkType:ay[$p.platform]||0,userAgent:"Native/10.4.0",sdkHumanVersion:"10.4.0",os:c.os,browser:c.browser}),M.next=5,this.core.sendCmd("qchatLogin",{qchatLoginReqTag:h});case 5:if(!(m=M.sent).error){M.next=8;break}throw m.error;case 8:return g=m.content,E=g.qchatLoginResTag,I=g.qchatMultiLoginResult,E.isAutoReconnect=t,M.abrupt("return",{loginResult:formatLoginInfo(E),multiLoginResults:map$6(I).call(I,(function(t){return formatLoginInfo(t)}))});case 11:case"end":return M.stop()}}),_callee,this)})))},V1AuthAuthenticatorService}(),iy=function(t){function QChatAuthService(a){var c;return(c=t.call(this,"qchatAuth",a)||this).account="",c.token="",c.deviceId="",c.isManualLoginAttempt=!1,registerParser({cmdMap:ey,cmdConfig:ry()}),c.authenticatorService=new oy(a),c}St(QChatAuthService,t);var a=QChatAuthService.prototype;return a.login=function login(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,as.mark((function _callee(){return as.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t.isAutoReconnect||(this.isManualLoginAttempt=!0),a.next=3,this._connect(t);case 3:return this.core.abtest.abtRequest(),a.prev=4,a.next=7,this.doLogin(t.isAutoReconnect);case 7:this.isManualLoginAttempt=!1,a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(4),this.isManualLoginAttempt=!1,a.t0;case 14:case"end":return a.stop()}}),_callee,this,[[4,10]])})))},a._connect=function _connect(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,as.mark((function _callee2(){var a,c;return as.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){h.next=4;break}return a="Instance status is "+this.core.status+", and would not connect",this.logger.warn(a),h.abrupt("return",za.reject(a));case 4:return this.core.clientSocket.beforeConnect(),c=t.isAutoReconnect||!1,h.next=8,this.core.clientSocket.connect({linkUrls:this.core.options.linkAddresses,isAutoReconnect:c});case 8:case"end":return h.stop()}}),_callee2,this)})))},a.doLogin=function doLogin(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,as.mark((function _callee3(){var a;return as.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,this.authenticatorService.verifyAuthentication(t);case 3:a=c.sent,this.core.status="logined",c.next=14;break;case 7:if(c.prev=7,c.t0=c.catch(0),this.core.logger.warn("doLogin:: login failed",c.t0),this.core.clientSocket.doDisconnect(Hv.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed"),!this.isManualLoginAttempt){c.next=13;break}throw c.t0;case 13:return c.abrupt("return");case 14:return c.prev=14,c.next=17,this.core.cloudStorage.init();case 17:c.next=22;break;case 19:c.prev=19,c.t1=c.catch(14),this.core.logger.error("doLogin:: cloudStorage init failed ",c.t1);case 22:return this.core.eventBus.emit("logined",a.loginResult),this.core.emit("logined",a.loginResult),a.multiLoginResults&&a.multiLoginResults.length>0&&this.core.emit("multiSpotLogin",a.multiLoginResults),this.core.logger.log("login done"),this.core.clientSocket.resetConnectStatus(),c.next=29,this.sync();case 29:this.core.clientSocket.ping();case 30:case"end":return c.stop()}}),_callee3,this,[[0,7],[14,19]])})))},a.sync=function sync(){return __awaiter(this,void 0,void 0,as.mark((function _callee4(){return as.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSync",{qchatSyncTag:{systemNotification:this.syncTimeTag||0}});case 2:case"end":return t.stop()}}),_callee4,this)})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,as.mark((function _callee5(){var c;return as.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatKick",t);case 2:return c=h.sent,h.abrupt("return",null===(a=c.content)||void 0===a?void 0:a.deviceIds);case 4:case"end":return h.stop()}}),_callee5,this)})))},a.qchatSyncHandler=function qchatSyncHandler(t){var a,c;this.logger.log("sync: emit syncdone",null===(a=t.content)||void 0===a?void 0:a.timetag),this.core.emit("syncdone"),this.syncTimeTag=(null===(c=t.content)||void 0===c?void 0:c.timetag)||0},a.qchatLoginClientChangeHandler=function qchatLoginClientChangeHandler(t){if(t.error)this.logger.error("qchatLoginClientChangeHandler:: error, ",t.error);else{var a=t.content,c=formatLoginInfo(a.qchatLoginResTag,a.state);this.core.emit("multiSpotLogin",[c])}},a.qchatBeKickedHandler=function qchatBeKickedHandler(t){if(t.error)this.logger.error("qchatBeKickedHandler error, ",t.error);else{var a=function formatBeKickedTag(t){var a=format({clientType:{type:"enum",values:zg},customClientType:{type:"number"}},t),c=ny[a.reason];return wt(a,c=c||{reason:"unknow",message:"Unknown reason"})}(t.content.beKickedTag);this.logger.warn("bekicked::",a),this.core.clientSocket.doDisconnect(Hv.KICKED,a)}},QChatAuthService}(_m),sy={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},cy=function(){function ReporterHookLinkKeep(t,a){this.traceData=sy,this.core=t,this.traceData=wt({},sy,a),this.traceData.extension=[]}var t=ReporterHookLinkKeep.prototype;return t.reset=function reset(){this.traceData=wt({},sy),this.traceData.extension=[]},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function update(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c,h;return as.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,$p.net.getNetworkStatus();case 2:a=m.sent,c=a.net_type,h=a.net_connect,this.traceData.extension.push(wt({code:0,foreground:!0,foreg_backg_switch:!1,net_type:c,net_connect:h},t));case 6:case"end":return m.stop()}}),_callee,this)})))},t.end=function end(t){var a=this.traceData.extension[0],c=this.traceData.extension[1];if(a&&0===a.operation_type&&c&&1===c.operation_type){var h=a.net_type!==c.net_type||a.net_connect!==c.net_connect;if(t||!h)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},ReporterHookLinkKeep}(),ly={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},uy="ReporterHook::setMonitorForResources:",dy=function(){function ReporterHookCloudStorage(t,a){this.traceData=ly,this.core=t,this.traceData=wt({},ly,a)}var t=ReporterHookCloudStorage.prototype;return t.reset=function reset(){this.traceData=wt({},ly)},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Za()},t.update=function update(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){return as.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.traceData.user_id){a.next=2;break}return a.abrupt("return");case 2:this.core.logger.log(uy+" upload update",t),wt(this.traceData,t);case 4:case"end":return a.stop()}}),_callee,this)})))},t.end=function end(t){this.traceData.user_id&&(this.core.logger.log(uy+" upload end cause of "+t),this.traceData.state=t,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Za())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=ly)},ReporterHookCloudStorage}(),py=A("".endsWith),hy=A("".slice),fy=Math.min,my=correctIsRegexpLogic("endsWith");_export({target:"String",proto:!0,forced:!my},{endsWith:function endsWith(t){var a=toString$1(requireObjectCoercible(this));notARegexp(t);var c=arguments.length>1?arguments[1]:void 0,h=a.length,m=void 0===c?h:fy(toLength(c),h),g=toString$1(t);return py?py(a,g,m):hy(a,m-g.length,m)===g}});var gy=entryVirtual("String").endsWith,vy=String.prototype,endsWith=function(t){var a=t.endsWith;return"string"==typeof t||t===vy||Y(vy,t)&&a===vy.endsWith?gy:a};function getIsDataReportEnable(t){var a,c,h=!0;return"boolean"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.enableCompass)?h=t.reporterConfig.enableCompass:"boolean"==typeof(null===(c=null==t?void 0:t.reporterConfig)||void 0===c?void 0:c.isDataReportEnable)&&(h=t.reporterConfig.isDataReportEnable),h}function getReportConfigUrl(t){var a,c,h="https://statistic.live.126.net/dispatcher/req";return"string"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.compassDataEndpoint)?(h=t.reporterConfig.compassDataEndpoint,endsWith(h).call(h,"/")&&(h=slice$1(h).call(h,0,-1)),h+="/dispatcher/req"):"string"==typeof(null===(c=null==t?void 0:t.reporterConfig)||void 0===c?void 0:c.reportConfigUrl)&&(h=t.reporterConfig.reportConfigUrl),h}function getReportUrl(t){var a,c,h="https://statistic.live.126.net/statics/report/common/form";return"string"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.compassDataEndpoint)?(h=t.reporterConfig.compassDataEndpoint,endsWith(h).call(h,"/")&&(h=slice$1(h).call(h,0,-1)),h+="/statics/report/common/form"):"string"==typeof(null===(c=null==t?void 0:t.reporterConfig)||void 0===c?void 0:c.reportUrl)&&(h=t.reporterConfig.reportUrl),h}var yy={debugLevel:"off",needReconnect:!0,reconnectionAttempts:9007199254740991,isAbtestEnable:!0,abtestUrl:Uv,abtestProjectKey:Gv},_y=function(t){function QChat(a,c){var m;void 0===c&&(c={cloudStorageConfig:{}}),(m=t.call(this)||this).instanceName="QChat",m.status="unconnected",m.account="",m.eventBus=new vo,m.options={},m.qchatServer={},m.qchatChannel={},m.qchatMsg={},m.qchatRole={},m.qchatMedia={},m.cloudStorage={},m.logger=new Av(a.debugLevel),m.setInitOptions(a),m.otherOptions=c,m.timerManager=new Dv,m.adapters=new Vv(h(m)),m.abtest=new Fv(h(m),{isAbtestEnable:m.options.isAbtestEnable,abtestUrl:m.options.abtestUrl,abtestProjectKey:Gv});var g="",E="";m.options.isFixedDeviceId?(g=$p.localStorage.getItem("__QCHAT_DEVC_ID__")||ap(),E=$p.localStorage.getItem("__QCHAT_CLIENT_SESSION_ID__")||ap(),$p.localStorage.setItem("__QCHAT_DEVC_ID__",g),$p.localStorage.setItem("__QCHAT_CLIENT_SESSION_ID__",E)):(g=ap(),E=ap()),m.config={timeout:8e3,deviceId:g,clientSession:E};var I=$p.getSystemInfo();return m.reporter=new zo({reportConfigUrl:getReportConfigUrl(c),reportUrl:getReportUrl(c),isDataReportEnable:getIsDataReportEnable(c),common:{app_key:a.appkey,dev_id:g,platform:"Web",sdk_ver:"10.4.0",env:"online",os_name:I.os,os_ver:I.osVer,model:I.hostEnvVer,manufactor:I.hostEnv,host_env:I.hostEnv,host_env_ver:I.hostEnvVer,v2:!1},request:$p.request,logger:m.logger,autoStart:!0}),m.reporterHookLinkKeep=new cy(h(m)),m.reporterHookCloudStorage=new dy(h(m)),$p.setLogger(m.logger),m.qchatAuth=new iy(h(m)),m.auth=m.qchatAuth,m.V1NIMLoginService=m.qchatAuth,m.clientSocket=new Zv(h(m)),m.qchatServer=new rg(h(m)),m.qchatChannel=new Fg(h(m),c.qchatChannelConfig),m.qchatMsg=new yv(h(m)),m.qchatRole=new Hg(h(m)),m.qchatMedia=new bv(h(m),c.qchatMediaConfig||c.QChatMedia),m.cloudStorage=new Xf(h(m),wt({storageKeyPrefix:m.instanceName},c.cloudStorageConfig)),QChat.instance=h(m),m.logger.log("QChat init, version ","10.4.0"," sdk version ",100400," appkey ",a.appkey),m}St(QChat,t),QChat.getInstance=function getInstance(t,a){if(!QChat.instance){if(t)return new QChat(t,a);throw new Error("Instance not exist, please input options")}if(t){if(QChat.instance.options.account===t.account&&QChat.instance.options.appkey===t.appkey)return QChat.instance.setOptions(t),QChat.instance;throw new Error("Unexpected login")}return QChat.instance};var a=QChat.prototype;return a.connect=function connect(t){return void 0===t&&(t={}),this.auth.login(t)},a.login=function login(t){return void 0===t&&(t={}),this.auth.login(t)},a.setInitOptions=function setInitOptions(t){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},linkAddresses:{type:"array",itemType:"string",min:1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},debugLevel:{type:"enum",values:Rv,required:!1}},t),this.logger.log("QChat::setInitOptions options is",t),this.account=t.account,this.options=wt(wt({},yy),t)},a.setOptions=function setOptions(t){if("object"==typeof t&&null!==t&&(Object.prototype.hasOwnProperty.call(t,"account")&&t.account!==this.options.account||Object.prototype.hasOwnProperty.call(t,"appkey")&&t.appkey!==this.options.appkey))throw new Error("QChat::setOptions account and appkey is not allowed to reset");validate({token:{type:"string",required:!1},linkAddresses:{type:"array",itemType:"string",min:1,required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},debugLevel:{type:"enum",values:Rv,required:!1}},t),this.logger.log("QChat::setOptions options is",t),this.options=wt(wt({},this.options),t)},a.disconnect=function disconnect(){var t=this;switch(this.status){case"logined":return this.sendCmd("qchatExit",void 0,{timeout:1e3}).then((function(){t.clientSocket.doDisconnect(Hv.ACTIVE,"UserActiveDisconnect")})).catch((function(a){t.logger.error("Instance::disconnect sendCmd:logout error",a),t.clientSocket.doDisconnect(Hv.ACTIVE,"UserActiveDisconnect")}));case"connected":case"connecting":case"waitReconnect":return this.clientSocket.doDisconnect(Hv.ACTIVE,"UserActiveDisconnect"),za.resolve();case"unconnected":case"destroyed":return za.resolve()}},a.logout=function logout(){return this.disconnect()},a.destroy=function destroy(){var t=this;return QChat.instance=void 0,this.disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.eventBus.removeAllListeners(),t.logger.destroy(),t.reporter.destroy(),t.timerManager.destroy(),t.connect=emptyFuncWithPromise,t.disconnect=emptyFuncWithPromise,t.destroy=emptyFuncWithPromise}))},a.kickOtherClients=function kickOtherClients(t){return validate({deviceIds:{type:"array",itemType:"string"}},t),this.auth.kick(t)},a.sendCmd=function sendCmd(t,a,c){return this.clientSocket.sendCmd(t,a,c)},a.emit=function emit(a){var c=this;try{for(var h,m,g=Za(),E=arguments.length,I=new Array(E>1?E-1:0),M=1;M<E;M++)I[M-1]=arguments[M];var C=(h=t.prototype.emit).call.apply(h,concat(m=[this,a]).call(m,I)),b=Za()-g;return b>=10&&this.logger.warn("Core::emit event: "+a+" process takes: "+b+"ms"),C}catch(t){return this.logger.error("Core::emit event: "+a+". Error: "+t),go((function(){throw c.logger.error("Core::emit throw error in setTimeout. event: "+a+". Error: "+t),t}),0),!1}},QChat}(vo),Ey=createCommonjsModule((function(a,c){(function(){var h={function:!0,object:!0}[typeof window]&&window||this,m=c,g=a&&!a.nodeType&&a,E=m&&g&&"object"==typeof t&&t;!E||E.global!==E&&E.window!==E&&E.self!==E||(h=E);var I=Math.pow(2,53)-1,M=/\bOpera/,C=Object.prototype,b=C.hasOwnProperty,S=C.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var c in t)b.call(t,c)&&a(t[c],c,t)}function getClassOf(t){return null==t?capitalize(t):S.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var c=null;return function each(t,a){var c=-1,h=t?t.length:0;if("number"==typeof h&&h>-1&&h<=I)for(;++c<h;)a(t[c],c,t);else forOwn(t,a)}(t,(function(h,m){c=a(c,h,m,t)})),c}function trim(t){return String(t).replace(/^ +| +$/g,"")}var T=function parse(t){var a=h,c=t&&"object"==typeof t&&"String"!=getClassOf(t);c&&(a=t,t=null);var m=a.navigator||{},g=m.userAgent||"";t||(t=g);var E,I,C=c?!!m.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(S.toString()),b="Object",T=c?b:"ScriptBridgingProxyObject",R=c?b:"Environment",A=c&&a.java?"JavaPackage":getClassOf(a.java),N=c?b:"RuntimeObject",O=/\bJava/.test(A)&&a.java,w=O&&getClassOf(a.environment)==R,k=O?"a":"Î±",x=O?"b":"Î²",P=a.document||{},q=a.operamini||a.opera,L=M.test(L=c&&q?q["[[Class]]"]:getClassOf(q))?L:q=null,D=t,V=[],U=null,G=t==g,B=G&&q&&"function"==typeof q.version&&q.version(),j=function getLayout(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),W=function getName(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Y=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),$=function getManufacturer(a){return reduce(a,(function(a,c,h){return a||(c[Y]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Y)]||RegExp("\\b"+qualify(h)+"(?:\\b|\\w*\\d)","i").exec(t))&&h}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),H=function getOS(a){return reduce(a,(function(a,c){var h=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+h+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,c){var h={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&c&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(h=h[/[\d.]+$/.exec(t)])&&(t="Windows "+h),t=String(t),a&&c&&(t=t.replace(RegExp(a,"i"),c)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,h,c.label||c)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,c){var h=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+h+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+h+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+h+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(c.label&&!RegExp(h,"i").test(c.label)?c.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),c=c.label||c,a=format(a[0].replace(RegExp(h,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,c){return a||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(j&&(j=[j]),/\bAndroid\b/.test(H)&&!Y&&(E=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(Y=trim(E[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),$&&!Y?Y=getProduct([$]):$&&Y&&(Y=Y.replace(RegExp("^("+qualify($)+")[-_.\\s]","i"),$+" ").replace(RegExp("^("+qualify($)+")[-_.]?(\\w)","i"),$+" $2")),(E=/\bGoogle TV\b/.exec(Y))&&(Y=E[0]),/\bSimulator\b/i.test(t)&&(Y=(Y?Y+" ":"")+"Simulator"),"Opera Mini"==W&&/\bOPiOS\b/.test(t)&&V.push("running in Turbo/Uncompressed mode"),"IE"==W&&/\blike iPhone OS\b/.test(t)?($=(E=parse(t.replace(/like iPhone OS/,""))).manufacturer,Y=E.product):/^iP/.test(Y)?(W||(W="Safari"),H="iOS"+((E=/ OS ([\d_]+)/i.exec(t))?" "+E[1].replace(/_/g,"."):"")):"Konqueror"==W&&/^Linux\b/i.test(H)?H="Kubuntu":$&&"Google"!=$&&(/Chrome/.test(W)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(Y))||/\bAndroid\b/.test(H)&&/^Chrome/.test(W)&&/\bVersion\//i.test(t)?(W="Android Browser",H=/\bAndroid\b/.test(H)?H:"Android"):"Silk"==W?(/\bMobi/i.test(t)||(H="Android",V.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&V.unshift("accelerated")):"UC Browser"==W&&/\bUCWEB\b/.test(t)?V.push("speed mode"):"PaleMoon"==W&&(E=/\bFirefox\/([\d.]+)\b/.exec(t))?V.push("identifying as Firefox "+E[1]):"Firefox"==W&&(E=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(H||(H="Firefox OS"),Y||(Y=E[1])):!W||(E=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(W))?(W&&!Y&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(E+"/")+8))&&(W=null),(E=Y||$||H)&&(Y||$||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H))&&(W=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H)?H:E)+" Browser")):"Electron"==W&&(E=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&V.push("Chromium "+E),B||(B=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(W),"(?:Firefox|Minefield|NetFront)"])),(E=("iCab"==j&&parseFloat(B)>3?"WebKit":/\bOpera\b/.test(W)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(t)&&("Mac OS"==H?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(W)&&"NetFront")&&(j=[E]),"IE"==W&&(E=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(W+=" Mobile",H="Windows Phone "+(/\+$/.test(E)?E:E+".x"),V.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(W="IE Mobile",H="Windows Phone 8.x",V.unshift("desktop mode"),B||(B=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=W&&"Trident"==j&&(E=/\brv:([\d.]+)/.exec(t))&&(W&&V.push("identifying as "+W+(B?" "+B:"")),W="IE",B=E[1]),G){if(function isHostType(t,a){var c=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(c)||"object"==c&&!t[a])}(a,"global"))if(O&&(D=(E=O.lang.System).getProperty("os.arch"),H=H||E.getProperty("os.name")+" "+E.getProperty("os.version")),w){try{B=a.require("ringo/engine").version.join("."),W="RingoJS"}catch(t){(E=a.system)&&E.global.system==a.system&&(W="Narwhal",H||(H=E[0].os||null))}W||(W="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(E=a.process)&&("object"==typeof E.versions&&("string"==typeof E.versions.electron?(V.push("Node "+E.versions.node),W="Electron",B=E.versions.electron):"string"==typeof E.versions.nw&&(V.push("Chromium "+B,"Node "+E.versions.node),W="NW.js",B=E.versions.nw)),W||(W="Node.js",D=E.arch,H=E.platform,B=(B=/[\d.]+/.exec(E.version))?B[0]:null));else getClassOf(E=a.runtime)==T?(W="Adobe AIR",H=E.flash.system.Capabilities.os):getClassOf(E=a.phantom)==N?(W="PhantomJS",B=(E=E.version||null)&&E.major+"."+E.minor+"."+E.patch):"number"==typeof P.documentMode&&(E=/\bTrident\/(\d+)/i.exec(t))?(B=[B,P.documentMode],(E=+E[1]+4)!=B[1]&&(V.push("IE "+B[1]+" mode"),j&&(j[1]=""),B[1]=E),B="IE"==W?String(B[1].toFixed(1)):B[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(W)&&(V.push("masking as "+W+" "+B),W="IE",B="11.0",j=["Trident"],H="Windows");H=H&&format(H)}if(B&&(E=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(B)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(G&&m.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(U=/b/i.test(E)?"beta":"alpha",B=B.replace(RegExp(E+"\\+?$"),"")+("beta"==U?x:k)+(/\d+\+?/.exec(E)||"")),"Fennec"==W||"Firefox"==W&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(H))W="Firefox Mobile";else if("Maxthon"==W&&B)B=B.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Y))"Xbox 360"==Y&&(H=null),"Xbox 360"==Y&&/\bIEMobile\b/.test(t)&&V.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(W)&&(!W||Y||/Browser|Mobi/.test(W))||"Windows CE"!=H&&!/Mobi/i.test(t))if("IE"==W&&G)try{null===a.external&&V.unshift("platform preview")}catch(t){V.unshift("embedded")}else(/\bBlackBerry\b/.test(Y)||/\bBB10\b/.test(t))&&(E=(RegExp(Y.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||B)?(H=((E=[E,/BB10/.test(t)])[1]?(Y=null,$="BlackBerry"):"Device Software")+" "+E[0],B=null):this!=forOwn&&"Wii"!=Y&&(G&&q||/Opera/.test(W)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==W&&/\bOS X (?:\d+\.){2,}/.test(H)||"IE"==W&&(H&&!/^Win/.test(H)&&B>5.5||/\bWindows XP\b/.test(H)&&B>8||8==B&&!/\bTrident\b/.test(t)))&&!M.test(E=parse.call(forOwn,t.replace(M,"")+";"))&&E.name&&(E="ing as "+E.name+((E=E.version)?" "+E:""),M.test(W)?(/\bIE\b/.test(E)&&"Mac OS"==H&&(H=null),E="identify"+E):(E="mask"+E,W=L?format(L.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(E)&&(H=null),G||(B=null)),j=["Presto"],V.push(E));else W+=" Mobile";(E=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(E=[parseFloat(E.replace(/\.(\d)$/,".0$1")),E],"Safari"==W&&"+"==E[1].slice(-1)?(W="WebKit Nightly",U="alpha",B=E[1].slice(0,-1)):B!=E[1]&&B!=(E[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(B=null),E[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==E[0]&&537.36==E[2]&&parseFloat(E[1])>=28&&"WebKit"==j&&(j=["Blink"]),G&&(C||E[1])?(j&&(j[1]="like Chrome"),E=E[1]||((E=E[0])<530?1:E<532?2:E<532.05?3:E<533?4:E<534.03?5:E<534.07?6:E<534.1?7:E<534.13?8:E<534.16?9:E<534.24?10:E<534.3?11:E<535.01?12:E<535.02?"13+":E<535.07?15:E<535.11?16:E<535.19?17:E<536.05?18:E<536.1?19:E<537.01?20:E<537.11?"21+":E<537.13?23:E<537.18?24:E<537.24?25:E<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),E=(E=E[0])<400?1:E<500?2:E<526?3:E<533?4:E<534?"4+":E<535?5:E<537?6:E<538?7:E<601?8:E<602?9:E<604?10:E<606?11:E<608?12:"12"),j&&(j[1]+=" "+(E+="number"==typeof E?".x":/[.+]/.test(E)?"":"+")),"Safari"==W&&(!B||parseInt(B)>45)?B=E:"Chrome"==W&&/\bHeadlessChrome/i.test(t)&&V.unshift("headless")),"Opera"==W&&(E=/\bzbov|zvav$/.exec(H))?(W+=" ",V.unshift("desktop mode"),"zvav"==E?(W+="Mini",B=null):W+="Mobile",H=H.replace(RegExp(" *"+E+"$"),"")):"Safari"==W&&/\bChrome\b/.exec(j&&j[1])?(V.unshift("desktop mode"),W="Chrome Mobile",B=null,/\bOS X\b/.test(H)?($="Apple",H="iOS 4.3+"):H=null):/\bSRWare Iron\b/.test(W)&&!B&&(B=getVersion("Chrome")),B&&0==B.indexOf(E=/[\d.]+$/.exec(H))&&t.indexOf("/"+E+"-")>-1&&(H=trim(H.replace(E,""))),H&&-1!=H.indexOf(W)&&!RegExp(W+" OS").test(H)&&(H=H.replace(RegExp(" *"+qualify(W)+" *"),"")),j&&!/\b(?:Avant|Nook)\b/.test(W)&&(/Browser|Lunascape|Maxthon/.test(W)||"Safari"!=W&&/^iOS/.test(H)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(W)&&j[1])&&(E=j[j.length-1])&&V.push(E),V.length&&(V=["("+V.join("; ")+")"]),$&&Y&&Y.indexOf($)<0&&V.push("on "+$),Y&&V.push((/^on /.test(V[V.length-1])?"":"on ")+Y),H&&(E=/ ([\d.+]+)$/.exec(H),I=E&&"/"==H.charAt(H.length-E[0].length-1),H={architecture:32,family:E&&!I?H.replace(E[0],""):H,version:E?E[1]:null,toString:function(){var t=this.version;return this.family+(t&&!I?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(E=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(H&&(H.architecture=64,H.family=H.family.replace(RegExp(" *"+E),"")),W&&(/\bWOW64\b/i.test(t)||G&&/\w(?:86|32)$/.test(m.cpuClass||m.platform)&&!/\bWin64; x64\b/i.test(t))&&V.unshift("32-bit")):H&&/^OS X/.test(H.family)&&"Chrome"==W&&parseFloat(B)>=39&&(H.architecture=64),t||(t=null);var Q={};return Q.description=t,Q.layout=j&&j[0],Q.manufacturer=$,Q.name=W,Q.prerelease=U,Q.product=Y,Q.ua=t,Q.version=W&&B,Q.os=H||{architecture:null,family:null,version:null,toString:function(){return"null"}},Q.parse=parse,Q.toString=function toStringPlatform(){return this.description||""},Q.version&&V.unshift(B),Q.name&&V.unshift(W),H&&W&&(H!=String(H).split(" ")[0]||H!=W.split(" ")[0]&&!Y)&&V.push(Y?"("+H+")":"on "+H),V.length&&(Q.description=V.join(" ")),Q}();m&&g?forOwn(T,(function(t,a){m[a]=t})):h.platform=T}).call(t)})),Iy=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function d(a,c){for(var h in c)t.o(c,h)&&!t.o(a,h)&&Eo(a,h,{enumerable:!0,get:c[h]})},o:function o(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function _default(){return S}});var c=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(t){},this.onProgress=function(t){},this.onUploadProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var c=void 0!==Hi&&Af(t)||t["@@iterator"];if(!c){if(sf(t)||(c=function(t,a){if(t){var c;if("string"==typeof t)return r(t,a);var h=slice$1(c=Object.prototype.toString.call(t)).call(c,8,-1);return"Object"===h&&t.constructor&&(h=t.constructor.name),"Map"===h||"Set"===h?Rf(t):"Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var h=0,m=function i(){};return{s:m,n:function n(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}},e:function e(t){throw t},f:m}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var g,E=!0,I=!1;return{s:function s(){c=c.call(t)},n:function n(){var t=c.next();return E=t.done,t},e:function e(t){I=!0,g=t},f:function f(){try{E||null==c.return||c.return()}finally{if(I)throw g}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,h=new Array(a);c<a;c++)h[c]=t[c];return h}var h={privateObj:{},setItem:function setItem(t,a){h.privateObj[t]=a},getItem:function getItem(t){return h.privateObj[t]},removeItem:function removeItem(t){delete h.privateObj[t]},getKeys:function getKeys(){return Uo(h.privateObj)}},m={getFileKey:function getFileKey(t){var a=t.size.toString(),c=t.lastModified.toString();return"_NosUploader_"+t.name+slice$1(a).call(a,a.length-5)+slice$1(c).call(c,c.length-5)},getFileInfo:function getFileInfo(t){var a=h.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function initFile(t,a,c){m.clearExpiredInfo();var g=this.getFileKey(a),E={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Za(),end:!1};return t.payload&&(E.payload=t.payload),c&&h.setItem(g,ps(E)),g},setUploadContext:function setUploadContext(t,a,c){var m=this.getFileInfo(t);m&&(m.ctx=a,c&&h.setItem(t,ps(m)))},setComplete:function setComplete(t,a){var c=this.getFileInfo(t);c&&(c.modifyAt=Za(),c.end=!0,a&&h.setItem(t,ps(c)))},getUploadContext:function getUploadContext(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function removeFileInfo(t){0===indexOf(t).call(t,"_NosUploader_")&&h.removeItem(t)},clearExpiredInfo:function clearExpiredInfo(){var t,a="function"==typeof h.getKeys?h.getKeys():Uo(h),c=Za(),g=[],E=n(a);try{for(E.s();!(t=E.n()).done;){var I=t.value;if(0===indexOf(I).call(I,"_NosUploader_")){var M=m.getFileInfo(I);null===M||c-M.modifyAt>S.expireTime?h.removeItem(I):g.push({fileInfo:M,key:I})}}}catch(t){E.e(t)}finally{E.f()}if(g.length>S.maxFileCache){var C,b,T=n(slice$1(C=sort(g).call(g,(function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt}))).call(C,S.maxFileCache));try{for(T.s();!(b=T.n()).done;){var R,A=b.value;0===indexOf(R=A.key).call(R,"_NosUploader_")&&h.removeItem(A.key)}}catch(t){T.e(t)}finally{T.f()}}}},g=m;function u(t){return(u="function"==typeof Hi&&"symbol"==typeof Qi?function(t){return typeof t}:function(t){return t&&"function"==typeof Hi&&t.constructor===Hi&&t!==Hi.prototype?"symbol":typeof t})(t)}function f(t,a){return!a||"object"!==u(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function l(t){var a="function"==typeof Gl?new Gl:void 0;return(l=function l(t){var c,h;if(null===t||(h=t,-1===indexOf(c=Function.toString.call(h)).call(c,"[native code]")))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return s(t,arguments,y(this).constructor)}return n.prototype=dt(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function s(t,a,c){return(s=p()?Kl:function(t,a,c){var h=[null];h.push.apply(h,a);var m=new(bind$1(Function).apply(t,h));return c&&d(m,c.prototype),m}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Kl)return!1;if(Kl.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Kl(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=mt||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=mt?Ji:function(t){return t.__proto__||Ji(t)})(t)}var E=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=dt(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,c,h=(a=r,c=p(),function(){var t,h=y(a);if(c){var m=y(this).constructor;t=Kl(h,arguments,m)}else t=h.apply(this,arguments);return f(this,t)});function r(t,a){var c;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(c=h.call(this,"NosUploadError:"+t)).errCode=a,c.errMsg=t,c}return r}(l(Error)),I=function e(t,a,c){if("uploading"===t.uploadState){var h=t.config,m=t.param,I=g.getUploadContext(t.fileKey);if(!I)return c(0);var M=new XMLHttpRequest,C=h.directUploadAddr+"/".concat(m.bucketName)+"/".concat(encodeURIComponent(m.objectName))+"?uploadContext"+"&context=".concat(I)+"&version=".concat(h.version);M.onreadystatechange=function(){var m;if("abort"!==t.uploadState&&4===M.readyState){var I,b,S,T;try{T=JSON.parse(M.responseText)}catch(t){T={errMsg:"JsonParseError in getOffset",errCode:500}}200===M.status?T.errCode?t.config.onError(new E(T.errMsg,T.errCode)):c(T.offset):M.status.toString().match(/^5/)?e(t,a-1,c):a>0?("function"==typeof(null===(m=h.logger)||void 0===m?void 0:m.error)&&h.logger.error(concat(I="getOffset(".concat(C,") error. retry after 3 seconds. ")).call(I,(new Date).toTimeString())),go((function(){e(t,a-1,c)}),3500)):M.status?(g.removeFileInfo(t.fileKey),h.onError(new E(concat(b=concat(S="getOffset(".concat(C,") error: ")).call(S,M.status," ")).call(b,M.statusText)))):h.onError(new E("getOffset(".concat(C,") error. no Error Code")))}},M.open("get",C),M.setRequestHeader("x-nos-token",m.token),M.timeout=h.getOffsetTimeout,M.send()}},M=function e(t,a,c,h){if("uploading"===t.uploadState){var m=t.param,I=t.config,M=slice$1(File.prototype),C=void 0!==m.ctx?m.ctx:"",b=a+I.trunkSize>t.file.size,S=b?t.file.size:a+I.trunkSize,T=new XMLHttpRequest,R=I.directUploadAddr+"/".concat(m.bucketName)+"/".concat(encodeURIComponent(m.objectName));if(T.upload.onprogress=function(c){if("abort"!==t.uploadState){var h=0;c.lengthComputable?(h=(a+c.loaded)/t.file.size,I.onProgress(h),I.onUploadProgress({loaded:c.loaded,total:t.file.size,percentage:h,percentageText:(100*h).toFixed(2)+"%"})):I.onError(new E("browser does not support query upload progress"))}},T.onreadystatechange=function(){var m,M;if("abort"!==t.uploadState&&4===T.readyState){var C,S,A,N;try{N=JSON.parse(T.responseText)}catch(t){"function"==typeof(null===(m=I.logger)||void 0===m?void 0:m.error)&&I.logger.error("JsonParseError in uploadTrunk",t),N={errMsg:"JsonParseError in uploadTrunk"}}200===T.status?(t.setContext(N.context),b?(h(),t.setComplete()):e(t,N.offset,I.retryCount,h)):T.status.toString().match(/^5/)?c>0?e(t,a,c-1,h):(g.removeFileInfo(t.fileKey),I.onError(new E(N.errMsg,N.errCode))):c>0?("function"==typeof(null===(M=I.logger)||void 0===M?void 0:M.error)&&I.logger.error(concat(C="uploadTrunk(".concat(R,") error. retry after 3 seconds. ")).call(C,(new Date).toTimeString())),go((function(){e(t,a,c-1,h)}),3500)):T.status?(g.removeFileInfo(t.fileKey),I.onError(new E(concat(S=concat(A="uploadTrunk(".concat(R,") error: ")).call(A,T.status," ")).call(S,T.statusText)))):I.onError(new E("uploadTrunk(".concat(R,") error. no Error Code. Please check your network")))}},T.open("post",R+"?offset=".concat(a)+"&complete=".concat(b)+"&context=".concat(C)+"&version=".concat(I.version)),T.setRequestHeader("x-nos-token",m.token),m.md5&&T.setRequestHeader("content-md5",m.md5),t.file.type&&T.setRequestHeader("content-type",t.file.type),T.timeout=I.trunkUploadTimeout,"undefined"!=typeof FileReader){var A=new FileReader;A.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)instanceof ArrayBuffer&&t.target.result.byteLength>0?T.send(t.target.result):I.onError(new E("Read ArrayBuffer failed",194003))})),A.addEventListener("error",(function(t){var a=t.target.error;I.onError(new E("Read ArrayBuffer error. ".concat(a.toString()),194003))})),A.readAsArrayBuffer(M.call(t.file,a,S))}else T.send(M.call(t.file,a,S))}};function v(t,a){for(var c=0;c<a.length;c++){var h=a[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Eo(t,h.key,h)}}var C=function(){function e(t,a,c){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=c,this.file=t,this.param=a,this.fileKey=g.initFile(a,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function value(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;I(this,a.retryCount,(function(c){M(t,c,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function value(){this.setUploadState("paused")}},{key:"abort",value:function value(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new E("Upload Aborted",10499)))}},{key:"setUploadState",value:function value(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function value(t){g.setUploadContext(this.fileKey,t,this.config.enableCache),this.param.ctx=t}},{key:"setComplete",value:function value(){g.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&v(e.prototype,t),e}(),b={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function getFileUploadInformation(t){var a=g.getFileKey(t),c=g.getFileInfo(a);return null===c?null:Za()-c.modifyAt>b.expireTime?(g.removeFileInfo(a),null):{uploadInfo:wt({bucketName:c.bucket,objectName:c.obj,token:c.token,ctx:c.ctx},c.payload?{payload:c.payload}:{}),complete:c.end}},setMaxFileCache:function setMaxFileCache(t){b.maxFileCache=t},setExpireTime:function setExpireTime(t){b.expireTime=t},printCaches:function printCaches(){if("undefined"!=typeof localStorage)for(var t=0,a=Uo(localStorage);t<a.length;t++){var c=a[t],h=g.getFileInfo(c);h&&console.log(h,"modifiedAt",new Date(h.modifyAt).toTimeString())}},createConfig:function createConfig(t){return new c(t)},createTask:function createTask(t,a,c){return new C(t,a,c)}},S=b;return a.default}()})),My=createCommonjsModule((function(t,a){t.exports=function(){function object2String(t){if(t){var a,c="";return forEach$1(a=Uo(t)).call(a,(function(a,h){c+=0===h?"?":"&",c+=a+"="+t[a]})),c}return""}var t=function(t){function V2NIMError(a,c,h,m){var g;return(g=t.call(this,h)||this).source=a,g.code=c,g.desc=h,g.detail=m||{},g}return St(V2NIMError,t),V2NIMError}(Zl(Error));function request(a,c){void 0===c&&(c={dataType:"json",method:"GET",timeout:5e3});var h="text"===c.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",m="GET"===c.method?object2String(c.params):"";return new za((function(g,E){if(window.XMLHttpRequest){var I,M=new XMLHttpRequest;if(M.onreadystatechange=function(){if(4===M.readyState)if(200===M.status){try{I=JSON.parse(M.response||"{}")}catch(t){I=M.response}g({status:M.status,data:I})}else go((function(){E(new t(1,M.status,"readyState: "+M.readyState+"; statusText: "+M.statusText))}),0)},M.open(c.method,""+a+m),M.timeout=c.timeout||5e3,M.setRequestHeader("Content-Type",h),c.headers)for(var C in c.headers)M.setRequestHeader(C,c.headers[C]);M.ontimeout=function(a){E(new t(1,408,a&&a.message?a.message:"request timeout"))},M.send(ps(c.data))}else E(new t(2,10400,"request no suppout"))}))}return request}()})),Cy=console;function uploadFile(t){return __awaiter(this,void 0,void 0,as.mark((function _callee(){var a,c,h,m,g,E;return as.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:if(t.fileInput||t.file){I.next=2;break}throw new Error("File not exist");case 2:if(!t.file){I.next=6;break}m=t.file,I.next=20;break;case 6:if("string"!=typeof t.fileInput){I.next=15;break}if(!((g=document.getElementById(t.fileInput))&&g.files&&g.files[0])){I.next=12;break}m=g.files[0],I.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:I.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){I.next=19;break}m=t.fileInput.files[0],I.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(!(t.maxSize&&m.size>t.maxSize)){I.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+m.size);case 22:return I.next=24,new za((function(a,c){var h,g=Iy.getFileUploadInformation(m),E=Iy.createConfig({enableCache:!0,retryCount:0,directUploadAddr:t.chunkUploadHost,onError:function onError(t){c(t)},onUploadProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}});if(g)if(g.complete)t.onUploadProgress&&t.onUploadProgress({total:m.size,loaded:m.size,percentage:1,percentageText:"100%"}),a(g.uploadInfo);else{h=Iy.createTask(m,g.uploadInfo,E);try{t.onUploadStart&&t.onUploadStart(h)}catch(t){Cy.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),h.abort(),c(t)}}else{h=Iy.createTask(m,wt(wt({bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},t.md5?{md5:t.md5}:{}),t.payload?{payload:t.payload}:{}),E);try{t.onUploadStart&&t.onUploadStart(h)}catch(t){Cy.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),h.abort(),c(t)}}}));case 24:return(E=I.sent).name=m.name,E.size=m.size,E.type=m.type,E.ext=lastIndexOf(a=E.name).call(a,".")>-1?slice$1(c=E.name).call(c,lastIndexOf(h=E.name).call(h,".")+1).toLowerCase():"",I.abrupt("return",E);case 30:case"end":return I.stop()}}),_callee)})))}function getFileUploadInformation(t){var a;if(t.file)a=t.file;else if("string"==typeof t.fileInput){var c=document.getElementById(t.fileInput);if(!(c&&c.files&&c.files[0]))throw new Error("Can not get file from fileInput");a=c.files[0]}else{if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0]))throw new Error("Can not get file from fileInput "+t.fileInput);a=t.fileInput.files[0]}return Iy.getFileUploadInformation(a)}function getSystemInfo(){var t,a,c=Ey.version||"";if(isElectron())try{var h=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);h&&h[1]&&"string"==typeof h[1]&&(c=h[1])}catch(t){}return{os:(null===(t=Ey.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=Ey.os)||void 0===a?void 0:a.version)||"",browser:Ey.name||"",browserVer:Ey.version||"",libEnv:"BROWSER",hostEnv:isElectron()?"Electron":isMobile()?"H5":isBrowser()?"BROWSER":"Unset",hostEnvEnum:isElectron()?Fp.Electron:isMobile()?Fp.H5:isBrowser()?Fp.BROWSER:Fp.Unset,hostEnvVer:c,userAgent:navigator&&navigator.userAgent,model:c,manufactor:Ey.name||""}}var by=null,Sy=null;return function setAdapters(t){Wp($p,t())}((function getAdapter(){return{setLogger:function setLogger(t){Cy=t},platform:"BROWSER",localStorage:window.localStorage,request:My,WebSocket:window.WebSocket,uploadFile:uploadFile,getFileUploadInformation:getFileUploadInformation,getSystemInfo:getSystemInfo,net:{getNetworkStatus:function getNetworkStatus(){return za.resolve({net_type:Bp.kStatNetTypeUnkonw,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function onNetworkStatusChange(t){by=function onlineListener(){t({isConnected:!0,networkType:Bp.kStatNetTypeUnkonw})},Sy=function offlineListener(){t({isConnected:!1,networkType:Bp.kStatNetTypeUnkonw})},window.addEventListener("online",by),window.addEventListener("offline",Sy)},offNetworkStatusChange:function offNetworkStatusChange(){by&&window.removeEventListener("online",by),Sy&&window.removeEventListener("offline",Sy),by=null,Sy=null}}}})),_y}));
